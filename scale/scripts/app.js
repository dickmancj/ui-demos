(function () {
    'use strict';

    var app = angular.module('scaleApp', [
        'scaleConfigModule',
        'ngResource',
        'ngSanitize',
        'ngRoute',
        'emguo.poller',
        'ui.bootstrap',
        'ui.grid',
        'ui.grid.selection',
        'ui.grid.pagination',
        'ui.grid.resizeColumns',
        'cfp.hotkeys',
        'toggle-switch'
    ]);

    app.config(['$routeProvider', '$resourceProvider', '$provide', 'pollerConfig', function($routeProvider, $resourceProvider, $provide, pollerConfig) {
        // Fix sourcemaps
        // @url https://github.com/angular/angular.js/issues/5217#issuecomment-50993513
        $provide.decorator('$exceptionHandler', ['$delegate', function ($delegate) {
            return function (exception, cause) {
                $delegate(exception, cause);
                setTimeout(function() {
                    throw exception;
                });
            };
        }]);

        // stop pollers when route changes
        pollerConfig.stopOnRouteChange = true;
        pollerConfig.smart = true;

        // preserve trailing slashes
        $resourceProvider.defaults.stripTrailingSlashes = false;

        //routing
        $routeProvider
            .when('/', {
                controller: 'ovController',
                controllerAs: 'vm',
                templateUrl: 'modules/overview/partials/ovTemplate.html'
            })
            .when('/admin/login',{
                controller: 'adminLoginController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/admin/logout',{
                controller: 'logoutController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/about', {
                controller: 'aboutController',
                controllerAs: 'vm',
                templateUrl: 'modules/about/partials/aboutTemplate.html'
            })
            .when('/feed', {
                controller: 'feedDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/feedDetailsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests', {
                controller: 'ingestRecordsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests/:id', {
                controller: 'ingestRecordDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordDetailsTemplate.html'
            })
            .when('/metrics', {
                controller: 'metricsController',
                controllerAs: 'vm',
                templateUrl: 'modules/metrics/partials/metricsTemplate.html',
                reloadOnSearch: false
            })
            .when('/nodes', {
                controller: 'nodesController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodesTemplate.html'
            })
            .when('/nodes/:id', {
                controller: 'nodeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodeDetailsTemplate.html'
            })
            .when('/load/queued', {
                controller: 'loadController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadTemplate.html'
            })
            .when('/load/running', {
                controller: 'queueRunningController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/queueRunningTemplate.html'
            })
            .when('/load/depth', {
                controller: 'loadDepthController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadDepthTemplate.html'
            })
            .when('/recipes', {
                controller: 'recipesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipesTemplate.html',
                reloadOnSearch: false
            })
            .when('/recipes/recipe/:id', {
                controller: 'recipeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeDetailsTemplate.html'
            })
            .when('/recipes/types/:id?', {
                controller: 'recipeTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeTypesTemplate.html'
            })
            .when('/jobs', {
                controller: 'jobsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobsTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/job/:id', {
                controller: 'jobDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobDetailTemplate.html'
            })
            .when('/jobs/types/:id?', {
                controller: 'jobTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesTemplate.html'
            })
            .when('/jobs/failure-rates', {
                controller: 'jobTypesFailureRatesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesFailureRatesTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/executions', {
                controller: 'jobExecutionsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionsTemplate.html'
            })
            .when('/jobs/executions/:id', {
                controller: 'jobExecutionDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionDetailTemplate.html'
            })
            .when('/workspaces/:id?', {
                controller: 'workspacesController',
                controllerAs: 'vm',
                templateUrl: 'modules/workspaces/partials/workspacesTemplate.html'
            })
            .when('/feed/strikes/:id?', {
                controller: 'strikesController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/strikesTemplate.html'
            })
            .otherwise({
                redirectTo: '/'
            });
    }])
    .value('moment', window.moment)
    .value('localStorage', window.localStorage)
    .value('XMLHttpRequest', window.XMLHttpRequest)
    .value('toastr', window.toastr);
})();

(function () {
    'use strict';

    angular.module('scaleConfigModule', []).provider('scaleConfig', function () {
        var scaleConfig = {},
            scaleConfigLocal = {};

        this.$get = function () {
            var config = $.ajax({
                type: 'GET',
                url: 'config/scaleConfig.json',
                cache: false,
                async: false,
                contentType: 'application/json',
                dataType: 'json'
            });
            
            if (config.status === 200) {
                scaleConfig = config.responseJSON.scaleConfig;

                var configLocal = $.ajax({
                    type: 'GET',
                    url: 'config/scaleConfig.local.json',
                    cache: false,
                    async: false,
                    contentType: 'application/json',
                    dataType: 'json'
                });

                if (configLocal.status === 200) {
                    scaleConfigLocal = configLocal.responseJSON.scaleConfigLocal;
                }

                _.merge(scaleConfig, scaleConfigLocal);

                // add function for getApiPrefix
                scaleConfig.getUrlPrefix = function(serviceName){
                    return scaleConfig.urls.overrides && scaleConfig.urls.overrides[serviceName] ? scaleConfig.urls.overrides[serviceName] : scaleConfig.urls.apiPrefix;
                }
            }

            return scaleConfig;
        }


    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHeaderController', ['subnavService', function(subnavService) {
        var vm = this;
        vm.currentPath = subnavService.getCurrentPath();
    }])
    .directive('aisHeader', function () {
        /**
         * Usage: <ais-header name={name}></ais-header>
         */
        return {
            controller: 'aisHeaderController',
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: 'modules/header/headerTemplate.html',
            scope: {
                name: '=',
                hideTitle: '=',
                loading: '=', // optional - will overlay a loading spinner on the page based on the passed-in value
                showSubnav: '=',
                subnavLinks: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('scaleNavigation', function () {
        return {
            restrict: 'E',
            templateUrl: 'modules/navigation/partials/navTemplate.html',
            controller: 'navController',
            controllerAs: 'vm'
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aboutController', ['$scope', '$location', 'navService', 'stateService', function($scope, $location, navService, stateService) {
        var vm = this;
        
        vm.stateService = stateService;
        vm.version = '';

        var initialize = function() {
            navService.updateLocation('about');
        };

        initialize();

        $scope.$watch('vm.stateService.getVersion()', function (newValue) {
            vm.version = newValue;
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('adminLoginController', ['$timeout', '$location', 'stateService', 'userService', function ($timeout, $location, stateService, userService) {

        var initialize = function () {
            var user = userService.getUserCreds();
            
            if (!user) {
                userService.login('admin');
            }

            $timeout(function () {
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path('/');
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('logoutController', ['$timeout', '$rootScope', '$location', 'userService', function ($timeout, $rootScope, $location, userService) {

        var initialize = function () {
            userService.logout();
            $timeout(function(){
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path("/");
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDataFeedController', ['$scope', 'scaleConfig', 'loadService', 'scaleService', function ($scope, scaleConfig, loadService, scaleService) {
        var days = [],
            hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],
            values = {};
        
        var processNewFeed = function () {
            days = [];
            var day = '';
            if ($scope.feed) {
                _.forEach($scope.feed.values, function (val) {
                    var valday = moment.utc(val.time).format(scaleConfig.dateFormats.day);
                    var valhour = moment.utc(val.time).hour();
                    var id = valday + '_' + valhour;
                    values[id] = val;
                    if (valday !== day) {
                        day = valday;
                        days.push(valday);
                    }
                });
                buildTable();
            }
        };

        var buildTable = function () {
            var currDay = moment().utc().format(scaleConfig.dateFormats.day);
            var currHour = moment().utc().hour();

            var table_html = '<div class="table-responsive"><table>';
            table_html += '<tr><th>Hour (UTC)</th>';
            for(day in days) {
                table_html += '<td class="day-label" title="' + days[day] + '"><div class="day-of-week">' + scaleService.getDayString(moment(days[day]).day()) + '</div>' + moment(days[day]).format('MM/DD') + '</td>';
            }
            table_html += '</tr>';
            for(var hour in hours) {
                hour = 23-hour;
                table_html += '<tr>';
                table_html += '<th title="' + hours[hour] + ':00">' + hours[hour] + '</th>';

                for(var day in days) {
                    var key =  days[day] + '_' + hours[hour];
                    var files = values[key].files;
                    var size = values[key].size;
                    var cls = 'good';
                    if (days[day] === currDay) {
                        if (hours[hour] === currHour) {
                            cls = 'current';
                        }
                        else if (hours[hour] > currHour) {
                            cls = 'future';
                        }
                    }
                    if (files === 0 && size === 0 && cls !== 'current' && cls !== 'future') {
                        cls = 'unknown';
                    }
                    table_html += '<td id="' + key + '" title="' + days[day] + ' ' + hours[hour] + ':00">';
                    if (cls === 'future') {
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">&nbsp;</span></td>';
                    }
                    else{
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">' + scaleService.calculateFileSizeFromBytes(size,1) + ' / ' + files + '</span></td>';
                    }

                }
                table_html += '</tr>';
            }
            table_html += '</table></div>';
            $('#history').html(table_html);
        };

        var initialize = function () {

            $scope.$watch('feed', function (value) {
                if ($scope.feed) {
                    processNewFeed();
                }
            });
        };

        initialize();
    }]).directive('aisDataFeed', function () {
        return {
            controller: 'aisDataFeedController',
            templateUrl: 'modules/charts/dataFeed/dataFeedTemplate.html',
            restrict: 'E',
            scope: {
                feed: '=' // Feed data
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDonutController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var colData = [],
            chart = null;

        var genChart = function () {
            if (chart) {
                var oldData = [],
                    removeIds = [];

                // reassemble currently displayed data to match colData
                _.forEach(chart.data(), function (d) {
                    oldData.push([d.values[0].id, d.values[0].value]);
                });

                // determine which elements to remove
                _.forEach(oldData, function (od) {
                    var keep = _.find(colData, function (cd) {
                        return cd[0] === od[0];
                    });
                    if (!keep) {
                        removeIds.push(od[0]);
                    }
                });

                // update chart
                chart.load({
                    columns: colData,
                    unload: removeIds
                });
            } else {
                chart = c3.generate({
                    bindto: $element[0],
                    data: {
                        columns: colData,
                        type: $scope.type,
                        colors: {
                            down: scaleConfig.colors.chart_red,
                            warning: scaleConfig.colors.chart_yellow,
                            up: scaleConfig.colors.chart_green,
                            Completed: scaleConfig.colors.chart_green,
                            Done: '#3681bf',
                            Queue: scaleConfig.colors.chart_yellow,
                            Failed: scaleConfig.colors.chart_red,
                            ALGORITHM: scaleConfig.colors.failure_algorithm,
                            DATA: scaleConfig.colors.failure_data,
                            SYSTEM: scaleConfig.colors.failure_system,
                            Offline: scaleConfig.colors.chart_red,
                            'High Failure Rate': scaleConfig.colors.chart_orange,
                            Paused: scaleConfig.colors.chart_yellow
                        }
                    },
                    transition: {
                        duration: 700
                    },
                    pie: {
                        label: {
                            format: d3.format(',')
                        }
                    },
                    donut: {
                        label: {
                            format: $scope.showLabel ? d3.format(',') : function () {
                                return '';
                            }
                        },
                        width: $scope.width,
                        title: $scope.name
                    },
                    tooltip: {
                        format: {
                            value: d3.format(',')
                        }
                    },
                    size: {
                        height: $scope.size || 320
                    }
                });
            }
            $element[0].style.position = 'static';
        };

        var initColumnData = function (){
            colData = [];
            $scope.data.forEach(function (obj){
                colData.push([obj.status,obj.count]);
            });
        };

        var initialize = function () {
            initColumnData();
            genChart();
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (data.length > 0) {
                    initialize();
                } else {
                    $($element[0]).empty();
                }
            }
        });

        window.onresize = function () {
            genChart();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisDonut', function () {
        return {
            controller: 'aisDonutController',
            restrict: 'E',
            scope: {
                data: '=',
                type: '=',
                size: '=',
                showLabel: '=',
                width: '=',
                name: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisGridChartController', ['$rootScope', '$scope', '$location', '$uibModal', 'userService', 'scaleConfig', 'scaleService', function ($rootScope, $scope, $location, $uibModal, userService, scaleConfig, scaleService) {
        var vm = this,
            svg = null,
            rect = null,
            scale = parseFloat($scope.scale),
            tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function(d) {
                    var failures = d.status.getFailures(),
                        failStr = failures.length > 0 ? '<br /><br />' : '',
                        running = getCellActivityTotal(d),
                        completed = getCellTotal(d),
                        statusStr = running > 0 || completed > 0 ? '<br />' : '';

                    if (running > 0) {
                        statusStr = statusStr + '<span class="label label-running">Running: ' + running + '</span>';
                    }
                    if (completed > 0) {
                        statusStr = statusStr + ' <span class="label label-completed">Completed: ' + completed + '</span>';
                    }

                    failures = _.sortByOrder(failures, ['order']);

                    _.forEach(failures, function (f) {
                        failStr = failStr + '<span class="label label-' + f.status.toLowerCase() + '">' + _.capitalize(f.status.toLowerCase()) + ': ' + f.count + '</span> ';
                    });
                    return d.title + ' ' + d.version + '<br />' + statusStr + failStr;
                }),
            cellWidth = 50 * scale,
            cellHeight = 50 * scale,
            enableZoom = typeof $scope.mode !== 'undefined' ? $scope.mode === 'zoom' : true,
            enableTooltip = typeof $scope.mode !== 'undefined' ? $scope.mode === 'tooltip' : false,
            enableReveal = typeof $scope.reveal !== 'undefined' ? $scope.reveal : true,
            user = userService.getUserCreds(),
            gridData = [],
            width = $('.grid-chart').width(),
            height = (Math.ceil(width / cellWidth) * cellHeight),
            cols = 0,
            rows = 0,
            cellFontLg = .4,
            cellFontSm = .3;
        
        vm.loading = true;
        vm.pauseReason = '';
        vm.dataValues = [];
        vm.gridClass = function () {
            return $scope.icons === true ? 'icons' : '';
        };

        $scope.$watchCollection('vm.dataValues', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            height = (Math.ceil(newValue.length / (Math.floor(width / cellWidth))) * cellHeight);
            if (enableZoom) {
                height = height * 6;
            }
            d3.select('.grid-chart-container svg').attr('height', height);
            d3.select('.overlay').attr('height', height);
        });

        var getDataValues = function (data) {
            gridData = [];
            vm.dataValues = [];
            if (data.data) {
                var dataType = data.data.toString().split(',')[0];
                if (dataType === 'JobType') {
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['name'], ['asc']);
                    // associate JobType with JobTypeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'job_type.id', val.id);
                    });
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['status.has_running', 'status.description', 'name'], ['asc', 'asc', 'asc']);
                } else if (dataType === 'Node') {
                    vm.dataValues = _.values(data.data);
                    //vm.dataValues = _.sortByOrder(_.values(data.data), ['hostname'], ['asc']);
                    // associate Node with NodeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'node.id', val.id);
                    });
                    //vm.dataValues = _.sortByOrder(vm.dataValues, ['hostname'], ['asc']); // sort by hostName asc
                } else {
                    vm.dataValues = data.data;
                }

                cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
                rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

                d3.range(rows).map(function (row) {
                    d3.range(cols).map(function (col) {
                        if (col <= vm.dataValues.length - 1) {
                            var dataObj = vm.dataValues[(cols * row) + col];
                            if (dataObj) {
                                dataObj.coords = [col * cellHeight, row * cellWidth];
                                gridData.push(dataObj);
                            }
                        }
                    });
                });

                update();
            }
        };

        var revealData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'none');
            d3.selectAll('.cell-text-detail')
                .style('display', 'block');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'block');
        };

        var hideData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'block');
            d3.selectAll('.cell-text-detail')
                .style('display', 'none');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'none');
        };

        var initialize = function (data) {
            cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
            rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

            var tickValues = Array.apply(null, {length: rows}).map(Number.call, Number);

            var zoom = d3.behavior.zoom()
                .scaleExtent([1, 6])
                //.center([0, 0])
                .on('zoom', zoomed);

            if (enableZoom) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(zoom)
                    .append('g');
            } else if (enableTooltip) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(tip);
            } else {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g');
            }

            svg.append('rect')
                .attr('class', 'overlay')
                .attr('width', width)
                .attr('height', height);

            if (vm.showAxes) {
                var y = d3.scale.linear()
                    .domain([0, rows])
                    .range([0, height-10]);

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient('left')
                    .tickValues(tickValues);

                svg.attr('transform', 'translate(' + 25 + ',' + 0 + ')')
                    .append('g')
                    .attr('class', 'y axis')
                    .attr('transform', 'translate(' + 0 + ',' + cellHeight / 2 + ')')
                    .call(yAxis);
            }

            getDataValues(data);

            function zoomed() {
                var s = d3.event.scale;

                if (enableReveal) {
                    if (s > 3) {
                        revealData();
                    } else {
                        hideData();
                    }
                }
                if (s === 1) {
                    if ($scope.showAxes) {
                        zoom.translate([25, 0]);
                    } else {
                        zoom.translate([0, 0]);
                    }
                }
                svg.attr('transform', 'translate(' + zoom.translate() + ')scale(' + d3.event.scale + ')');
            }

            vm.loading = false;
        };

        var dragOffsetX = 0,
            dragOffsetY = 0,
            clickOffsetX = 0,
            clickOffsetY = 0;

        var drag = d3.behavior.drag()
            .on('dragstart', function () {
                // track offsetX and offsetY to distinguish between drag and click
                dragOffsetX = d3.event.sourceEvent.layerX;
                dragOffsetY = d3.event.sourceEvent.layerY;
            });

        var getCellFill = function (d) {
            if (d && d.status) {
                return d.status.getCellFill();
            }
            return 'none';
        };

        var getCellText = function (d) {
            if (d) {
                return d.getCellText();
            }
        };

        var getCellActivity = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellActivity();
                }
            }
        };

        var getCellPauseResume = function (d) {
            if (d && d.status) {
                return d.status.getCellPauseResume();
            }
        };

        var getCellActivityTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellActivityTotal();
            }
        };

        var getCellTitle = function (d) {
            if (d) {
                return d.getCellTitle();
            }
        };

        var getCellError = function (d) {
            if (d && d.status) {
                return d.status.getCellError();
            }
            return 'Failed: Unavailable';
        };

        var getCellTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellTotal();
            }
            return 'Completed: Unavailable';
        };

        var getCellStatus = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellStatus();
                }
            }
            return 'Status Unavailable';
        };

        var getCellJobs = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellJobs();
                }
            }
        };

        var getCellFailures = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellFailures();
                }
            }
        };

        var cellClickHandler = function (target) {
            // track offsetX and offsetY to distinguish between drag and click
            clickOffsetX = d3.event.layerX;
            clickOffsetY = d3.event.layerY;
            if (dragOffsetX === clickOffsetX && dragOffsetY === clickOffsetY) {
                // offsets are the same; no dragging occurred; process as click event
                $scope.$apply(function () {
                    if (target.toString() === 'JobType') {
                        $location.path('/jobs').search('job_type_id', target.id).search('status', target.status.has_running.status);
                    } else if (target.toString() === 'Node') {
                        $location.path('/nodes/' + target.id);
                    }
                });
            }
        };

        var update = function () {
            var elem = $('.cell-activity-icon');
            TweenMax.to(elem, 1, {
                rotation: 360,
                transformOrigin: '50% 50%',
                repeat: -1,
                ease: Linear.easeNone
            });

            // DATA JOIN
            // Join new data with old elements, if any.
            if (enableTooltip) {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)
                    .on('click', tip.hide);
            } else {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; });
            }

            // UPDATE
            // Update old elements as needed.
            containerGroup.selectAll('.stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.cell')
                .data(gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                });

            var cg = containerGroup.selectAll('.cell-gradient');

            containerGroup.selectAll('.cell-text')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('y', function (d) {
                    if (d.toString() === 'JobType' && getCellActivityTotal(d) > 0) {
                        return cellHeight / 2;
                    }
                    return (cellHeight / 2) + 10;
                });

            containerGroup.selectAll('.cell-total-active')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                });

            containerGroup.selectAll('.cell-pause-resume-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellPauseResume(d);
                });

            containerGroup.selectAll('.cell-activity-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellActivity(d);
                });

            containerGroup.selectAll('.cell-title')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellTitle(d);
                });

            containerGroup.selectAll('.cell-error')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellError(d, true);
                });

            containerGroup.selectAll('.cell-total')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellTotal(d);
                });

            containerGroup.selectAll('.cell-status')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellStatus(d);
                });

            containerGroup.selectAll('.cell-jobs')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellJobs(d);
                });

            containerGroup.selectAll('.cell-overlay')
                .data(gridData, function (d) { return d.coords; })
                .on('click', function (target) {
                    cellClickHandler(target);
                });

            // ENTER
            // Create new elements as needed.
            var cellGroup = containerGroup.enter()
                .append('g')
                .attr('class', 'cell-group');

            var defs = cellGroup.append('defs');
            var gradient = defs.append('linearGradient')
                .attr('id', function (d) {
                    return d.name;
                })
                .attr('class', 'cell-gradient')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', 0)
                .attr('y2', 1);
            gradient.append('stop')
                .attr('class', 'stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            cellGroup.append('rect')
                .attr('class', 'cell')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                })
                .attr('fill', function (d) {
                    if (d.toString() === 'JobType') {
                        return 'url(#' + d.name + ')';
                    }
                })
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .transition()
                .duration(750);

            cellGroup.append('text')
                .attr('class', 'cell-text')
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', function (d) {
                    if (d.toString() === 'JobType') {
                        if (getCellActivityTotal(d) > 0) {
                            return cellHeight / 2;
                        }
                        return (cellHeight / 2) + 10;
                    }
                    return cellHeight / 2;
                })
                .style('font-size', function (d) {
                    if (d.toString() === 'Node') {
                        return $scope.scale * 8 + 'px';
                    }
                    return '';
                })
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('text')
                .attr('class', 'cell-total-active')
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', cellHeight - 5)
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('g')
                .attr('class', 'cell-activity')
                .append('text')
                .attr('class', 'cell-activity-icon')
                .attr('font-size', 11)
                .html(function (d) {
                    return getCellActivity(d);
                })
                .attr('text-anchor', 'end')
                .attr('x', cellWidth - 2)
                .attr('y', 13);

            var detail = cellGroup.append('text')
                .attr('class', 'cell-text-detail')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.15)) // 15% from top of cell
                .attr('dy', 0)
                .style('display', enableReveal ? 'none' : 'block');

            detail.append('tspan')
                .attr('class', 'cell-title')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .15)) // 15% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellTitle(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-error')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.3)) // 30% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellError(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-total')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.4)) // 40% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellTotal(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-status')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .55)) // 55% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontLg * scale + 'em')
                .text(function (d) {
                    return getCellStatus(d);
                });

            detail.append('tspan')
                .attr('class', 'cell-jobs')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .75)) // 75% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellJobs(d);
                })
                .call(wrap);

            cellGroup.append('rect')
                .attr('class', 'cell-overlay')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', '#fff')
                .on('mouseover', function () {
                    d3.select(this)
                        .style('fill-opacity', '0.25');
                })
                .on('mouseout', function () {
                    d3.select(this)
                        .style('fill-opacity', '0');
                })
                .on('click', function (d) {
                    cellClickHandler(d);
                })
                .call(drag);

            if (user && user.is_admin) {
                cellGroup.append('text')
                    .attr('class', 'cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    })
                    .attr('text-anchor', 'start')
                    .attr('x', enableReveal ? 2 : 5)
                    .attr('y', enableReveal ? $scope.scale * 8 : 20)
                    .style('display', enableReveal ? 'none' : 'block')
                    .style('font-size', enableReveal ? $scope.scale * 7 + 'px' : '1.3em')
                    .on('mouseover', function () {
                        d3.select(this)
                            .style('cursor', 'pointer')
                            .style('fill', scaleConfig.colors.chart_blue);
                    })
                    .on('mouseout', function () {
                        d3.select(this)
                            .style('fill', 'white');
                    });
            }

            // ENTER + UPDATE
            // Appending to the enter selection expands the update selection to include
            // entering elements; so, operations on the update selection after appending to
            // the enter selection will apply to both entering and updating nodes.
            containerGroup.transition()
                .duration(750)
                .attr('transform', function (d) {
                    return 'translate(' + d.coords + ')';
                });

            var updateCellFill = function () {
                containerGroup.selectAll('.cell')
                    .transition()
                    .duration(250)
                    .style('stroke', function (d) {
                        return d ? '#fff' : 'none';
                    })
                    .style('fill', function (d) {
                        return getCellFill(d);
                    });
            };

            var updatePauseResume = function () {
                containerGroup.selectAll('.cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    });
            };

            var updateCellStatus = function () {
                containerGroup.selectAll('.cell-status')
                    .text(function (d) {
                        return getCellStatus(d);
                    });
            };

            // EXIT
            // Remove old elements as needed.
            containerGroup.exit()
                .attr('class', 'cell-exit')
                .transition()
                .duration(750)
                .attr('transform', 'translate(0,0)')
                .remove();

            function wrap (text, width) {
                text.each(function () {
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1,
                        y = text.attr('y'),
                        dy = parseFloat(text.attr('dy')),
                        tspan = text.text(null).append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', dy + 'em');
                    while (word = words.pop()) {
                        if (word !== 'undefined') {
                            line.push(word);
                            tspan.text(line.join(' '));
                            if (tspan.node().getComputedTextLength() > (cellWidth - 10)) {
                                line.pop();
                                tspan.text(line.join(' '));
                                line = [word];
                                tspan = text.append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                            }
                        }
                    }
                });
            }
        };

        $scope.$watch('data', function (data) {
            if (_.keys(data).length > 0) {
                $('.grid-chart').empty();
                initialize(data);
            }
        });

        $scope.$on('redrawGrid', function (event, data) {
            getDataValues(data);
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridChart', function () {
        return {
            controller: 'aisGridChartController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/grid/gridChartTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                icons: '=', // indicates whether cell-text is entirely made up of icons
                scale: '=', // multiplier to increase cell size
                reveal: '=', // if true, less data will show when zoomed out
                mode: '@', // valid values are zoom or tooltip
                columns: '=',
                rows: '=',
                showAxes: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHealthController', ['$scope', function ($scope) {
        var vm = this,
            initialized = false;

        var initialize = function () {
            initialized = true;
            var scale = $scope.scale || 1;
            vm.donutSize = 275 * scale;
            vm.donutWidth = 25 * scale;
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (_.keys(data).length > 0) {
                    if (!initialized) {
                        initialize();
                    }
                }
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisHealth', function () {
        return {
            controller: 'aisHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/health/healthTemplate.html',
            restrict: 'E',
            scope: {
                name: '=',
                data: '=',
                scale: '=',
                errorLabel: '=',
                type: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobLoadController', ['$scope', 'scaleConfig', 'scaleService', 'loadService', function ($scope, scaleConfig, scaleService, loadService) {
        var vm = this,
            chart = null,
            colArr = [],
            xArr = [];

        vm.filterValue = 1;
        vm.filterDuration = 'w';
        vm.filterDurations = ['M', 'w', 'd'];
        vm.zoomEnabled = false;
        vm.zoomClass = 'btn-default';
        vm.zoomText = 'Enable Zoom';
        vm.jobLoadData = {};
        vm.loadingJobLoad = true;
        vm.jobLoadError = null;
        vm.jobLoadErrorStatus = null;
        vm.total = 0;
        vm.chartStyle = '';

        var jobLoadParams = {
            started: moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate(), ended: moment.utc().endOf('d').toDate(), job_type_id: null, job_type_name: null, job_type_category: null, url: null
        };

        vm.toggleZoom = function () {
            vm.zoomEnabled = !vm.zoomEnabled;
            chart.zoom.enable(vm.zoomEnabled);
            if (vm.zoomEnabled) {
                vm.zoomClass = 'btn-primary';
                vm.zoomText = 'Disable Zoom';
            } else {
                vm.zoomClass = 'btn-default';
                vm.zoomText = 'Enable Zoom';
            }
        };

        var initChart = function () {
            xArr = [];
            
            xArr = _.pluck(vm.jobLoadData.results, 'time');
            _.forEach(xArr, function (d, i) {
                xArr[i] = moment.utc(d).toDate();
            });
            xArr.unshift('x');

            var pendingArr = _.pluck(vm.jobLoadData.results, 'pending_count'),
                queuedArr = _.pluck(vm.jobLoadData.results, 'queued_count'),
                runningArr = _.pluck(vm.jobLoadData.results, 'running_count');

            pendingArr.unshift('Pending');
            queuedArr.unshift('Queued');
            runningArr.unshift('Running');

            // add to colArr
            colArr = [xArr, pendingArr, queuedArr, runningArr];

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function(col){
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = 'area';
                    groups.push(col[0]);
                }
                angular.extend(types, type);
            });

            if (chart) {
                chart.flush();
            }
            // chart config
            chart = c3.generate({
                bindto: '#job-load',
                data: {
                    x: 'x',
                    columns: colArr,
                    types: types,
                    groups: [groups],
                    colors: {
                        Pending: scaleConfig.colors.chart_pink,
                        Queued: scaleConfig.colors.chart_purple,
                        Running: scaleConfig.colors.chart_blue
                    }
                },
                transition: {
                    duration: 700
                },
                tooltip: {
                    format: {
                        title: function (x) {
                            return moment.utc(x).startOf('h').format(scaleConfig.dateFormats.day_second);
                        }
                    }
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: function (d) {
                                return moment.utc(d).format(scaleConfig.dateFormats.day);
                            }
                        }
                    }
                }
            });
            vm.loadingJobLoad = false;
        };

        var getJobLoad = function (showPageLoad) {
            if (showPageLoad) {
                $scope.$parent.loading = true;
            } else {
                vm.loadingJobLoad = true;
            }
            jobLoadParams.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate();
            jobLoadParams.ended = moment.utc(jobLoadParams.started).add(1, vm.filterDuration).endOf('d').toDate();
            jobLoadParams.page_size = 1000;

            loadService.getJobLoad(jobLoadParams).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.jobLoadData = result;
                    initChart();
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.jobLoadErrorStatus = result.statusText;
                    }
                    vm.jobLoadError = 'Unable to retrieve job load.';
                }
                if (showPageLoad) {
                    $scope.$parent.loading = false;
                } else {
                    vm.loadingJobLoad = false;
                }
            });
        };

        vm.updateJobLoadRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getJobLoad(true);
        };

        $scope.$watch('vm.filterValue', function (value) {
            var $jobLoadNewer = $('.job-load-newer'),
                $jobLoadToday = $('.job-load-today');

            if (value > 1) {
                $jobLoadNewer.removeAttr('disabled');
                $jobLoadToday.removeAttr('disabled');
            } else {
                $jobLoadNewer.attr('disabled', 'disabled');
                $jobLoadToday.attr('disabled', 'disabled');
            }
        });


        if ($scope.autoHeight) {
            // set chart height
            angular.element(document).ready(function () {
                // set container heights equal to available page height
                var viewport = scaleService.getViewportSize(),
                    offset = scaleConfig.headerOffset,
                    headerOffset = $('.job-load-header').height(),
                    legendOffset = $('.job-load-legend-label').height(),
                    filterOffset = $('.job-load-filter').outerHeight(true),
                    chartMaxHeight = viewport.height - offset - headerOffset - legendOffset - filterOffset - 5;

                vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
                getJobLoad();
            });
        } else {
            getJobLoad();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisJobLoad', function () {
        return {
            controller: 'aisJobLoadController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/jobLoad/jobLoadTemplate.html',
            restrict: 'E',
            scope: {
                showFilter: '=', // show time range filter UI
                cullLegend: '=', // only show job types in legend whose value is > 0
                hideTitle: '=',
                autoHeight: '='
            }
        };
    });
})();

'use strict';

angular.module('scaleApp').controller('aisRadialPercentageController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
    var isInitialized = false,
        foreground = '',
        text = '',
        arcTween = '',
        textTween = '';

    var getForeground = function () {
        var value = parseFloat($scope.percentage);
        if (value >= 75) {
            return scaleConfig.colors.chart_green;
        } else if (value < 75 && value >= 50) {
            return scaleConfig.colors.chart_yellow;
        } else {
            return scaleConfig.colors.chart_red;
        }
    };

    var initialize = function () {
        // handle input either .83 or 83
        var percentage = $scope.percentage || 0;
        if (percentage > 1) {
            percentage /= 100;
        }

        // size the chart to the parent container. It's square, so take the
        // smaller of width/height
        var size = $element[0].parentNode.clientWidth;
        if ($element[0].parentNode.clientHeight < size) {
            size = $element[0].parentNode.clientHeight;
        }
        
        var formatPercent = d3.format('.0%');

        var arc = d3.svg.arc()
            .startAngle(0)
            .outerRadius(size * 0.95 / 2)
            .innerRadius(size * 0.80 / 2);

        var svg = d3.select($element[0]).append('svg').attr({
            width: size,
            height: size
        }).append('g').attr({
            'transform': 'translate(' + size / 2 + ',' + size / 2 + ')',
            'class': 'aisRadial'
        });

        var meter = svg.append('g').attr({
            'transform': 'rotate(180)'
        });
        meter.append('path')
            .datum({
                endAngle: (2 * Math.PI),
            })
            .attr('class', 'background')
            .attr('d', arc);

        foreground = meter.append('path')
            .datum({
                endAngle: 0
            })
            .attr({
                'd': arc
            })
            .style('fill', function () {
                return getForeground();
            });

        text = svg.append('text')
            .datum({
                percentage: 0
            })
            .attr('text-anchor', 'middle')
            .attr('dy', '.35em');


        textTween = function (transition, newPercentage) {
            transition.attrTween('text', function (d) {
                if (typeof d === 'undefined') {
                    d = 0;
                }
                var i = d3.interpolate(d.percentage, newPercentage);
                return function (t) {
                    d.percentage = i(t);
                    text.text(formatPercent(i(t)));
                    return t;
                }
            });
        };
        arcTween = function (transition, newAngle) {
            transition.attrTween('d', function (d) {
                var i = d3.interpolate(d.endAngle, newAngle);
                return function (t) {
                    d.endAngle = i(t);
                    return arc(d);
                };
            });
        };

        isInitialized = true;

        redraw(percentage);
    };

    var redraw = function (value) {
        if (isInitialized) {
            var percentage = value;
            if (percentage > 1) {
                percentage /= 100;
            }

            foreground.transition().duration(1000)
                .style('fill', function () {
                    return getForeground();
                })
                .call(arcTween, (Math.PI * 2) * percentage);
            text.transition().duration(1000).call(textTween, percentage);
        }
    };

    $scope.$watch('percentage', function (value) {
        if (value && !isInitialized) {
            initialize();
        } else {
            redraw(value);
        }
    })
}]);

'use strict';

angular.module('scaleApp').directive('aisRadialPercentage', function () {
    return {
        controller: 'aisRadialPercentageController',
        restrict: 'E',
        scope: {
            percentage: '@'
        }
    };
});

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisTimelineDirectiveController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var vm = this,
            gantt = null,
            taskNames = [];

        $element[0].onresize = function () {
            console.log('element resize');
        };

        var initialize = function () {
            $scope.$watch('tasks', function (value) {
                drawTimeline();
            });
        };

        var drawTimeline = function () {
            if ($scope.tasks && $scope.tasks.length > 0) {
                $scope.tasks.sort(function (a, b) {
                    return a[$scope.ended] - b[$scope.ended];
                });

                taskNames = _($scope.tasks).pluck('taskName').uniq().value();
                var height = taskNames.length * 30 + 20;

                var width = $element[0].clientWidth;
                if (!width || width === 0) { width = 600; }


                $scope.tasks.sort(function (a, b) {
                    return a[$scope.started] - b[$scope.started];
                });
                var minDate = $scope.tasks[0][$scope.started];
                var maxDate = $scope.tasks[$scope.tasks.length - 1][$scope.ended];
                var daysDiff = moment.utc(maxDate).diff(moment.utc(minDate),'days');
                var format = '%H:%M:%S.%m';
                if (daysDiff > 0) {
                    format = "%m/%d/%y %H:%M";
                }

                gantt = d3.gantt().renderTo("#ais-timeline").taskTypes(taskNames).taskStatus(scaleConfig.taskStatusStyles).tickFormat(format).begin($scope.started).ended($scope.ended).height(height).width(width);

                gantt.timeDomainMode("fit");

                gantt($scope.tasks);

            }
        };

        vm.formatDate = function (date) {
            if (date) {
                return moment.utc(date).toISOString();
            }
            else {
                return date;
            }
        };
        initialize();

    }]).directive('aisTimeline', function () {
        return {
            controller: 'aisTimelineDirectiveController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/timeline/timelineDirectiveTemplate.html',
            restrict: 'E',
            scope: {
                tasks: '=',
                started: '=',
                ended: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridPagination', function () {
        return {
            templateUrl: 'modules/common/directives/aisGridPaginationTemplate.html',
            restrict: 'E'
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisMultiselect', function () {
        return {
            restrict: 'A',
            require: '^ngModel',
            scope: {
                multiselectDataProvider: '=',
                enableFiltering: '=',
                maxHeight: '=',
                numberDisplayed: '=',
                includeSelectAllOption: '=',
                nonSelectedText: '=',
                ngModel: '='
            },
            link: function(scope, element, attributes) {
                element = $(element[0]);

                element.multiselect({
                    enableFiltering: scope.enableFiltering,
                    enableCaseInsensitiveFiltering: true,
                    maxHeight: scope.maxHeight || 300,
                    numberDisplayed: scope.numberDisplayed || 3,
                    includeSelectAllOption: scope.includeSelectAllOption,
                    nonSelectedText: scope.nonSelectedText || 'None Selected',
                    onChange: function (optionElement, checked) {
                        scope.$apply(function () {
                            scope.ngModel = element.val();
                        });
                    }
                });

                scope.$watchCollection('multiselectDataProvider', function (newValue, oldValue) {
                    if (angular.equals(newValue, oldValue)) {
                        return;
                    }
                    element.multiselect('dataprovider', newValue);
                });

                /*
                // Watch for any changes to the length of our select element
                scope.$watch(function () {
                    return element[0];
                }, function (newValue) {
                    debugger;
                    //element.multiselect('setOptions', element[0]);
                    //element.multiselect('rebuild');
                }, true);

                // Watch for any changes from outside the directive and refresh
                scope.$watch(attributes.ngModel, function () {
                    element.multiselect('refresh');
                });
                */
            }
        };
    })
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('gaugeFactory', ['scaleConfig', function (scaleConfig) {
        var Gauge = function (placeholderName, configuration)
        {
            this.placeholderName = placeholderName;

            var self = this; // for internal d3 functions

            this.configure = function(configuration)
            {
                this.config = configuration;

                this.config.size = this.config.size * 0.9;

                this.config.radius = this.config.size * 0.97 / 2;
                this.config.cx = this.config.size / 2;
                this.config.cy = this.config.size / 2;

                this.config.min = undefined != configuration.min ? configuration.min : 0;
                this.config.max = undefined != configuration.max ? configuration.max : 100;
                this.config.range = this.config.max - this.config.min;

                this.config.majorTicks = configuration.majorTicks || 5;
                this.config.minorTicks = configuration.minorTicks || 2;

                this.config.greenColor 	= configuration.greenColor || '#8fca0e';
                this.config.yellowColor = configuration.yellowColor || '#ffc317';
                this.config.redColor 	= configuration.redColor || '#f54d36';
                this.config.grayColor   = configuration.grayColor || '#aaa';

                this.config.transitionDuration = configuration.transitionDuration || 500;
            };

            this.render = function()
            {
                this.body = d3.select('#' + this.placeholderName)
                    .append('svg:svg')
                    .attr('class', 'gauge')
                    .attr('width', this.config.size)
                    .attr('height', this.config.size);

                this.body.append('svg:circle')
                    .attr('class', 'outer-circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', this.config.radius)
                    .style('fill', '#ccc');
                /*.style('stroke', '#000')
                 .style('stroke-width', '0.5px');*/

                this.body.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.9 * this.config.radius)
                    .style('fill', '#fff')
                    .style('stroke', '#e0e0e0')
                    .style('stroke-width', '2px');

                for (var greenIdx in this.config.greenZones)
                {
                    this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
                }

                for (var yellowIdx in this.config.yellowZones)
                {
                    this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
                }

                for (var redIdx in this.config.redZones)
                {
                    this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
                }

                var fontSize = 0;

                if (undefined != this.config.label)
                {
                    fontSize = Math.round(this.config.size / 9);
                    this.body.append('svg:text')
                        .attr('x', this.config.cx)
                        .attr('y', this.config.cy / 2 + fontSize / 2)
                        .attr('dy', fontSize / 2)
                        .attr('text-anchor', 'middle')
                        .text(this.config.label)
                        .style('font-size', fontSize + 'px')
                        .style('fill', '#333')
                        .style('stroke-width', '0px');
                }

                fontSize = Math.round(this.config.size / 16);
                var majorDelta = this.config.range / (this.config.majorTicks - 1);
                for (var major = this.config.min; major <= this.config.max; major += majorDelta)
                {
                    var minorDelta = majorDelta / this.config.minorTicks,
                        point1 = 0,
                        point2 = 0;
                    for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
                    {
                        point1 = this.valueToPoint(minor, 0.75);
                        point2 = this.valueToPoint(minor, 0.85);

                        this.body.append('svg:line')
                            .attr('x1', point1.x)
                            .attr('y1', point1.y)
                            .attr('x2', point2.x)
                            .attr('y2', point2.y)
                            .style('stroke', '#666')
                            .style('stroke-width', '1px');
                    }

                    point1 = this.valueToPoint(major, 0.7);
                    point2 = this.valueToPoint(major, 0.85);

                    this.body.append('svg:line')
                        .attr('x1', point1.x)
                        .attr('y1', point1.y)
                        .attr('x2', point2.x)
                        .attr('y2', point2.y)
                        .style('stroke', '#333')
                        .style('stroke-width', '2px');

                    if (major == this.config.min || major == this.config.max)
                    {
                        var point = this.valueToPoint(major, 0.63);

                        this.body.append('svg:text')
                            .attr('x', point.x)
                            .attr('y', point.y)
                            .attr('dy', fontSize / 3)
                            .attr('text-anchor', major == this.config.min ? 'start' : 'end')
                            .text(major)
                            .style('font-size', fontSize + 'px')
                            .style('fill', '#333')
                            .style('stroke-width', '0px');
                    }
                }

                var pointerContainer = this.body.append('svg:g').attr('class', 'pointerContainer');

                var midValue = (this.config.min + this.config.max) / 2;

                var pointerPath = this.buildPointerPath(midValue);

                var pointerLine = d3.svg.line()
                    .x(function(d) { return d.x })
                    .y(function(d) { return d.y })
                    .interpolate('basis');

                pointerContainer.selectAll('path')
                    .data([pointerPath])
                    .enter()
                    .append('svg:path')
                    .attr('d', pointerLine)
                    .style('fill', '#888');

                pointerContainer.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.07 * this.config.radius)
                    .style('fill', '#888');

                fontSize = Math.round(this.config.size / 10);
                pointerContainer.selectAll('text')
                    .data([midValue])
                    .enter()
                    .append('svg:text')
                    .attr('x', this.config.cx)
                    .attr('y', this.config.size - this.config.cy / 4 - fontSize)
                    .attr('dy', fontSize / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', fontSize + 'px')
                    .style('fill', '#000')
                    .style('stroke-width', '0px');

                this.redraw(this.config.min, 0);
            };

            this.buildPointerPath = function(value)
            {
                var delta = this.config.range / 13;

                var head = valueToPoint(value, 0.85);
                var head1 = valueToPoint(value - delta, 0.12);
                var head2 = valueToPoint(value + delta, 0.12);

                var tailValue = value - (this.config.range * (1/(270/360)) / 2);
                var tail = valueToPoint(tailValue, 0.28);
                var tail1 = valueToPoint(tailValue - delta, 0.12);
                var tail2 = valueToPoint(tailValue + delta, 0.12);

                return [head, head1, tail2, tail, tail1, head2, head];

                function valueToPoint(value, factor)
                {
                    var point = self.valueToPoint(value, factor);
                    point.x -= self.config.cx;
                    point.y -= self.config.cy;
                    return point;
                }
            };

            this.drawBand = function(start, end, color)
            {
                if (0 >= end - start) return;

                this.body.append('svg:path')
                    .style('fill', color)
                    .attr('d', d3.svg.arc()
                        .startAngle(this.valueToRadians(start))
                        .endAngle(this.valueToRadians(end))
                        .innerRadius(0.65 * this.config.radius)
                        .outerRadius(0.85 * this.config.radius))
                    .attr('transform', function() { return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(270)' });
            };

            this.redraw = function(value, transitionDuration)
            {
                var isDisabled = false;
                if (value < 0) {
                    isDisabled = true;
                    value = 0;
                }
                var pointerContainer = this.body.select('.pointerContainer');

                pointerContainer.selectAll('text').text(parseFloat(value).toFixed(2) + '%');

                var pointer = pointerContainer.selectAll('path');
                pointer.transition()
                    .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
                    //.delay(0)
                    //.ease('linear')
                    //.attr('transform', function(d)
                    .attrTween('transform', function()
                    {
                        var pointerValue = value;
                        if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                        else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                        var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                        var currentRotation = self._currentRotation || targetRotation;
                        self._currentRotation = targetRotation;

                        return function(step)
                        {
                            var rotation = currentRotation + (targetRotation-currentRotation)*step;
                            return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(' + rotation + ')';
                        }
                    });

                var outerCircle = this.body.select('.outer-circle')
                    .transition()
                    .duration(750)
                    .style('fill', function () {
                        var i = parseInt(value);
                        if (i >= 0 && i < 75 && !isDisabled) {
                            return self.config.greenColor;
                        } else if (i >= 75 && i < 90 && !isDisabled) {
                            return self.config.yellowColor;
                        } else if (i === 0 && isDisabled) {
                            return self.config.redColor;
                        } else {
                            return self.config.redColor;
                        }
                    });
            };

            this.valueToDegrees = function(value)
            {
                // thanks @closealert
                //return value / this.config.range * 270 - 45;
                return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
            };

            this.valueToRadians = function(value)
            {
                return this.valueToDegrees(value) * Math.PI / 180;
            };

            this.valueToPoint = function(value, factor)
            {
                return { 	x: this.config.cx - this.config.radius * factor * Math.cos(this.valueToRadians(value)),
                    y: this.config.cy - this.config.radius * factor * Math.sin(this.valueToRadians(value)) 		};
            };

            // initialization
            this.configure(configuration);
        };

        return {
            createGauge: function (name, label, min, max, size) {
                var config = {
                    size: size || scaleConfig.defaultGaugeWidth,
                    label: label,
                    min: min || 0,
                    max: max || 100,
                    minorTicks: 5
                };

                var range = config.max - config.min;
                config.yellowZones = [{ from: config.min + range*0.75, to: config.min + range*0.9 }];
                config.redZones = [{ from: config.min + range*0.9, to: config.max }];

                var gauge = new Gauge(name + 'GaugeContainer', config);
                gauge.render();
                return gauge;
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('gridFactory', ['uiGridConstants', function (uiGridConstants) {

        var getSortConfig = function (orderParam) {
            var sortArr = [];

            if (orderParam) {
                _.forEach(orderParam, function (param) {
                    var sortField = param;
                    var sortDirection = 'asc';
                    if (_.startsWith(param, '-')) {
                        sortDirection = 'desc';
                    }
                    sortArr.push({
                        direction: sortDirection,
                        field: sortField
                    })
                });
            }

            return sortArr;
        };

        return {
            defaultGridOptions: function () {
                return {
                    enableRowSelection: true,
                    enableRowHeaderSelection: false,
                    enableHorizontalScrollbar: uiGridConstants.scrollbars.NEVER,
                    enableVerticalScrollbar: uiGridConstants.scrollbars.NEVER,
                    multiSelect: false,
                    enableFiltering: true,
                    useExternalSorting: true,
                    useExternalFiltering: true,
                    enableSorting: true,
                    minRowsToShow: 17,
                    paginationPageSizes: [25, 50, 75, 100],
                    paginationPageSize: 25,
                    useExternalPagination: true,
                    enablePaginationControls: false,
                    paginationCurrentPage: 1
                }
            },
            applySortConfig: function (columnDefs, gridParams) {
                var sortConfig = getSortConfig(gridParams.order);
                _.forEach(sortConfig, function (config, idx) {
                    var field = _.startsWith(config.field, '-') ? config.field.substring(1) : config.field,
                        colDef = _.find(columnDefs, {field: field});

                    if (colDef) {
                        colDef.sort = {
                            direction: config.direction,
                            priority: idx
                        };
                    }
                });
                return columnDefs;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('pollerFactory', ['poller', function (poller) {
        return {
            newPoller: function (resource, interval) {
                return poller.get(resource, {
                    delay: interval,
                    catchError: true
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Status', ['StatusMaster', 'StatusScheduler', 'StatusResources', function (StatusMaster, StatusScheduler, StatusResources) {
        var Status = function ($resolved, master, scheduler, queue_depth, resources) {
            this.$resolved = $resolved;
            this.master = StatusMaster.transformer(master);
            this.scheduler = StatusScheduler.transformer(scheduler);
            this.queue_depth = queue_depth;
            this.resources = StatusResources.transformer(resources);
        };

        // public methods
        Status.prototype = {
            getCpuUsage: function () {
                if (this.resources.scheduled.cpus && this.resources.total.cpus) {
                    if (this.resources.total.cpus > 0) {
                        return ((this.resources.scheduled.cpus / this.resources.total.cpus) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getMemUsage: function () {
                if (this.resources.scheduled.mem && this.resources.total.mem) {
                    if (this.resources.total.mem > 0) {
                        return ((this.resources.scheduled.mem / this.resources.total.mem) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getDiskUsage: function () {
                if (this.resources.scheduled.disk && this.resources.total.disk) {
                    if (this.resources.total.disk > 0) {
                        return ((this.resources.scheduled.disk / this.resources.total.disk) * 100).toFixed(2);
                    }
                }
                return 0.00;
            }
        };

        // static methods, assigned to class
        Status.build = function (data) {
            if (data) {
                return new Status(
                    data.$resolved,
                    data.master,
                    data.scheduler,
                    data.queue_depth,
                    data.resources
                );
            }
            return new Status();
        };

        Status.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Status.build)
                    .filter(Boolean);
            }
            return Status.build(data);
        };

        return Status;
    }]);
})();
(function () {
    'use strict';
    
    angular.module('scaleApp').factory('StatusMaster', function () {
        var StatusMaster = function (is_online, hostname, port) {
            this.is_online = is_online;
            this.hostname = hostname;
            this.port = port;
        };

        // public methods
        StatusMaster.prototype = {

        };

        // static methods, assigned to class
        StatusMaster.build = function (data) {
            if (data) {
                return new StatusMaster(
                    data.is_online,
                    data.hostname,
                    data.port
                );
            }
            return new StatusMaster();
        };

        StatusMaster.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusMaster.build)
                    .filter(Boolean);
            }
            return StatusMaster.build(data);
        };

        return StatusMaster;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResource', function () {
        var StatusResource = function (cpus, mem, disk) {
            this.cpus = cpus;
            this.mem = mem;
            this.disk = disk;
        };

        // public methods
        StatusResource.prototype = {

        };

        // static methods, assigned to class
        StatusResource.build = function (data) {
            if (data) {
                return new StatusResource(
                    data.cpus,
                    data.mem,
                    data.disk
                );
            }
            return new StatusResource();
        };

        StatusResource.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResource.build)
                    .filter(Boolean);
            }
            return StatusResource.build(data);
        };

        return StatusResource;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResources', ['StatusResource', function (StatusResource) {
        var StatusResources = function (total, scheduled, used) {
            this.total = StatusResource.transformer(total);
            this.scheduled = StatusResource.transformer(scheduled);
            this.used = StatusResource.transformer(used);
        };

        // public methods
        StatusResources.prototype = {

        };

        // static methods, assigned to class
        StatusResources.build = function (data) {
            if (data) {
                return new StatusResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new StatusResources();
        };

        StatusResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResources.build)
                    .filter(Boolean);
            }
            return StatusResources.build(data);
        };

        return StatusResources;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusScheduler', function () {
        var StatusScheduler = function (is_online, is_paused, hostname) {
            this.is_online = is_online;
            this.is_paused = is_paused;
            this.hostname = hostname;
        };

        // public methods
        StatusScheduler.prototype = {

        };

        // static methods, assigned to class
        StatusScheduler.build = function (data) {
            if (data) {
                return new StatusScheduler(
                    data.is_online,
                    data.is_paused,
                    data.hostname
                );
            }
            return new StatusScheduler();
        };

        StatusScheduler.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusScheduler.build)
                    .filter(Boolean);
            }
            return StatusScheduler.build(data);
        };

        return StatusScheduler;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('scaleService', ['$q', '$http', 'scaleConfig', function ($q, $http, scaleConfig) {
        function padWithZero (input, length) {
            // Cast input to string
            input = '' + input;

            var paddingSize = Math.max(0, length - input.length);
            return new Array(paddingSize > 0 ? paddingSize + 1 : 0).join('0') + input;
        }

        return {
            calculateFileSizeFromMib: function(num){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(2) + ' MB';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(2) + ' GB';
                    }
                    return (num/1024/1024).toFixed(2) + ' TB';
                }
                return num;
            },
            calculateFileSizeFromBytes: function(num,decimals){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(decimals) + ' Bytes';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(decimals) + ' KB';
                    }
                    if (num >= 1024*1024 && num < 1024*1024*1024) {
                        return (num/1024/1024).toFixed(decimals) + ' MB';
                    }
                    if (num >= 1024*1024*1024 && num < 1024*1024*1024*1024) {
                        return (num/1024/1024/1024).toFixed(decimals) + ' GB';
                    }
                    return (num/1024/1024/1024/1024).toFixed(decimals) + ' TB';
                }
                return num;
            },
            getViewportSize: function () {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = document.body,
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    y = w.innerHeight || e.clientHeight || g.clientHeight;

                return {
                    width: x,
                    height: y
                };
            },
            calculateDuration: function (start, stop) {
                var to = moment.utc(stop),
                    from = moment.utc(start),
                    diff = moment.utc(to).diff(moment.utc(from)),
                    durationStr = '';

                var duration = moment.duration(diff);

                durationStr = duration.days() > 0 ? durationStr + padWithZero(duration.days(), 2) + 'd, ' : durationStr;
                durationStr = duration.hours() > 0 ? durationStr + padWithZero(duration.hours(), 2) + 'h, ' : durationStr;
                durationStr = duration.minutes() > 0 ? durationStr + padWithZero(duration.minutes(), 2) + 'm, ' : durationStr;
                durationStr = durationStr + padWithZero(duration.seconds(), 2) + 's';
                
                return durationStr;
            },
            getDayString: function(dayNumber){
                var dayArr = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
                return dayArr[dayNumber];
            },
            isIE: function () {
                var ua = window.navigator.userAgent,
                    oldIE = ua.indexOf('MSIE'),
                    newIE = ua.indexOf('Trident/');

                if ((oldIE > -1) || (newIE > -1)) {
                    return true;
                }
                return false;
            },
            getMediaTypeHtml: function(mediaType){
                var iconHtml = '<i class="fa ' + 'fa-file' + '"></i>';
                if(mediaType){
                    var ic = _.find(scaleConfig.mediaTypes, {mimeType: mediaType})
                    if(ic){
                        iconHtml = '<i class="fa ' + ic.icon + '"></i>';
                    }
                }
                return iconHtml;
            },
            getVersion: function () {
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'v' + scaleConfig.majorVersion + '/version/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            setGridHeight: function (offset) {
                // set container heights equal to available page height
                offset = offset || scaleConfig.headerOffset;
                
                var viewport = this.getViewportSize(),
                    gridMaxHeight = viewport.height - offset;

                return 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('schedulerService', ['$http', '$q', 'scaleConfig', function ($http, $q, scaleConfig) {
        var getUpdateSchedulerData = function (is_paused) {
            return {
                is_paused: is_paused
            };
        };

        return {
            updateScheduler: function (data) {
                data = data || getUpdateSchedulerData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('scheduler') + 'scheduler/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('stateService', ['$location', function ($location) {
        var version = '',
            jobsColDefs = [],
            jobsParams = {},
            jobExecutionsParams = {},
            recipesColDefs = [],
            jobTypesFailureRatesParams = {},
            recipesParams = {},
            ingestsColDefs = [],
            ingestsParams = {},
            nodesColDefs = [],
            nodeStatusParams = {},
            showActiveWorkspaces = true,
            nodesParams = {};

        var updateQuerystring = function (data) {
            // set defaults
            data.page = data.page || 1;
            data.page_size = data.page_size || 25;
            data.started = data.started || null;
            data.ended = data.ended || null;
            data.order = data.order ? Array.isArray(data.order) ? data.order : [data.order] : null;
            data.status = data.status || null;
            // check for params in querystring, and update as necessary
            _.forEach(_.pairs(data), function (param) {
                $location.search(param[0], param[1]);
            });
        };

        var initJobsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                error_category: data.error_category ? data.error_category : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                url: null
            };
        };

        var initJobExecutionsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                node_id: data.node_id ? data.node_id : null
            };
        };

        var initJobTypesFailureRatesParams = function (data) {
            return {
                page: null,
                page_size: null,
                started: null,
                ended: null,
                name: data.name ? data.name : null,
                category: null,
                order: null
            };
        };

        var initRecipesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                type_id: data.type_id ? parseInt(data.type_id) : null,
                type_name: data.type_name ? data.type_name : null,
                url: null
            };
        };

        var initIngestsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-ingest_started'],
                status: data.status ? data.status : null,
                file_name: data.file_name ? data.file_name : null
            };
        };

        var initNodesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['hostname'],
                include_inactive: data.include_inactive ? data.include_inactive : null
            };
        };

        var initNodeStatusParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(3, 'hours').toISOString(),
                ended: data.ended ? data.ended : moment.utc().toISOString()
            };
        };

        return {
            getVersion: function () {
                return version;
            },
            setVersion: function (data) {
                version = data;
            },
            getJobsColDefs: function () {
                return jobsColDefs;
            },
            setJobsColDefs: function (data) {
                jobsColDefs = data;
            },
            getJobsParams: function () {
                if (_.keys(jobsParams).length === 0) {
                    return initJobsParams($location.search());
                }
                return jobsParams;
            },
            setJobsParams: function (data) {
                jobsParams = initJobsParams(data);
                updateQuerystring(jobsParams);
            },
            getJobExecutionsParams: function () {
                if (_.keys(jobExecutionsParams).length === 0) {
                    return initJobExecutionsParams($location.search());
                }
                return jobExecutionsParams;
            },
            setJobExecutionsParams: function (data) {
                jobExecutionsParams = initJobExecutionsParams(data);
                updateQuerystring(jobExecutionsParams);
            },
            getJobTypesFailureRatesParams: function () {
                if (_.keys(jobTypesFailureRatesParams).length === 0) {
                    return initJobTypesFailureRatesParams($location.search());
                }
                return jobTypesFailureRatesParams;
            },
            setJobTypesFailureRatesParams: function (data) {
                jobTypesFailureRatesParams = initJobTypesFailureRatesParams(data);
                _.forEach(_.pairs(jobTypesFailureRatesParams), function (param) {
                    $location.search(param[0], param[1]);
                });
            },
            getRecipesColDefs: function () {
                return recipesColDefs;
            },
            setRecipesColDefs: function (data) {
                recipesColDefs = data;
            },
            getRecipesParams: function () {
                if (_.keys(recipesParams).length === 0) {
                    return initRecipesParams($location.search());
                }
                return recipesParams;
            },
            setRecipesParams: function (data) {
                recipesParams = initRecipesParams(data);
                updateQuerystring(recipesParams);
            },
            getIngestsColDefs: function () {
                return ingestsColDefs;
            },
            setIngestsColDefs: function (data) {
                ingestsColDefs = data;
            },
            getIngestsParams: function () {
                if (_.keys(ingestsParams).length === 0) {
                    return initIngestsParams($location.search());
                }
                return ingestsParams;
            },
            setIngestsParams: function (data) {
                ingestsParams = initIngestsParams(data);
                updateQuerystring(ingestsParams);
            },
            getNodesColDefs: function () {
                return nodesColDefs;
            },
            setNodesColDefs: function (data) {
                nodesColDefs = data;
            },
            getNodeStatusParams: function () {
                if (_.keys(nodeStatusParams).length === 0) {
                    return initNodeStatusParams($location.search());
                }
                return nodeStatusParams;
            },
            setNodeStatusParams: function (data) {
                nodeStatusParams = initNodeStatusParams(data);
                updateQuerystring(nodeStatusParams);
            },
            getShowActiveWorkspaces: function () {
                return showActiveWorkspaces;
            },
            setShowActiveWorkspaces: function (data) {
                showActiveWorkspaces = data;
            },
            getNodesParams: function () {
                if (_.keys(nodesParams).length === 0) {
                    return initNodesParams($location.search());
                }
                return nodesParams;
            },
            setNodesParams: function (data) {
                nodesParams = initNodesParams(data);
                updateQuerystring(nodesParams);
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('statusService', ['$resource', 'scaleConfig', 'poller', 'pollerFactory', 'Status', function ($resource, scaleConfig, poller, pollerFactory, Status) {
        return {
            getStatus: function () {
                var statusResource = $resource(scaleConfig.getUrlPrefix('status') + 'status/'),
                    statusPoller = pollerFactory.newPoller(statusResource, scaleConfig.pollIntervals.status);

                return statusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result = Status.transformer(result);
                    } else {
                        statusPoller.stop();
                    }
                    return result;
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('userService', function () {
        return {
            getUserCreds: function () {
                var creds = localStorage.getItem('userCreds');
                try {
                    return JSON.parse(creds);
                } catch (e) {
                    console.log('Error parsing user credentials');
                    return creds;
                }
            },
            setUserCreds: function (user) {
                if (user !== null) {
                    localStorage.setItem('userCreds', JSON.stringify(user));
                } else {
                    localStorage.removeItem('userCreds');
                }

            },
            login: function (username) {
                var user = {
                    username: username,
                    is_admin: true
                };
                this.setUserCreds(user);
                return user;
            },
            logout: function () {
                this.setUserCreds(null);
            }
        }
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('feedDetailsController', ['$scope', '$location', 'scaleConfig', 'navService', 'subnavService', 'feedService', 'moment', function ($scope, $location, scaleConfig, navService, subnavService, feedService, moment) {
        var vm = this;
        
        vm.loading = true;
        vm.feedData = {};
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.useIngestTime = 'false';
        vm.filterValue = 1;
        vm.filterDuration = 'w';

        vm.changeFeedSelection = function (){
            setFeedUrl();
            //getFeed();
        };

        vm.changeIngestTimeSelection = function (){
            setFeedUrl();
            getFeed();
        };

        var getFeedParams = function (){
            var params = {};
            var strikeId = vm.selectedFeed ? vm.selectedFeed.strike.id : null;
            var useIngestTime = vm.useIngestTime ? vm.useIngestTime : null;

            params.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toISOString();
            params.ended = moment.utc(params.started).add(1, vm.filterDuration).endOf('d').toISOString();

            if (strikeId != $location.search().strike_id) {
                params.strike_id = strikeId;
            } else if ($location.search().strike_id) {
                params.strike_id = $location.search().strike_id;
            }

            if (useIngestTime != $location.search().use_ingest_time) {
               params.use_ingest_time = useIngestTime;
            } else if ($location.search().use_ingest_time) {
               console.log('getFeedParams use_ingest_time: ' + $location.search().use_ingest_time);
               params.use_ingest_time = $location.search().use_ingest_time;
            }

            return params;
        };

        var getFeed = function () {
            vm.loading = true;
            if ($location.search().use_ingest_time) {
                vm.useIngestTime = $location.search().use_ingest_time;
            }
            var feedParams = getFeedParams();
            $location.search(feedParams);
            feedService.getFeed(feedParams).then(function (data) {
                vm.allFeeds = _.sortByOrder(data.results, ['strike.name'], ['asc']);
                var strikeId = $location.search().strike_id;
                if(strikeId){
                    // set selectedFeed = new feed
                    var feed = _.find(vm.allFeeds, function (feed){
                        return feed.strike.id == strikeId;
                    });
                    vm.selectedFeed = feed ? feed : null;
                } else {
                    vm.selectedFeed = vm.allFeeds[0];
                    setFeedUrl();
                }
            }).finally(function (){
                vm.loading = false;
            });
        };

        vm.updateFeedRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getFeed();
        };

        var setFeedUrl = function (){
            // set param in URL
            var params = getFeedParams();
            $location.search(params);
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed');
            getFeed();
        };

        initialize();

        $scope.$watch('vm.filterValue', function (value) {
            var $feedNewer = $('.feed-newer'),
                $feedToday = $('.feed-today');

            if (value > 1) {
                $feedNewer.removeAttr('disabled');
                $feedToday.removeAttr('disabled');
            } else {
                $feedNewer.attr('disabled', 'disabled');
                $feedToday.attr('disabled', 'disabled');
            }
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('ingestRecordDetailsController', ['$scope', '$routeParams', 'scaleConfig', 'scaleService', 'navService', 'subnavService', 'feedService', function ($scope, $routeParams, scaleConfig, scaleService, navService, subnavService, feedService) {
        var vm = this;
        
        vm.loading = false;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.scaleService = scaleService;
        vm.moment = moment;
        vm.ingestRecord = null;

        var getIngestRecordDetails = function () {
            vm.loading = true;
            feedService.getSourceDetails($routeParams.id).then(function (data) {
                vm.ingestRecord = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/ingests');
            getIngestRecordDetails();
        };

        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('ingestRecordsController', ['$scope', '$location', '$timeout', 'scaleConfig', 'scaleService', 'stateService', 'feedService', 'navService', 'subnavService', 'gridFactory', function ($scope, $location, $timeout, scaleConfig, scaleService, stateService, feedService, navService, subnavService, gridFactory) {
        subnavService.setCurrentPath('feed/ingests');

        var vm = this;

        vm.ingestsParams = stateService.getIngestsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.ingestStatusValues = scaleConfig.ingestStatus;
        vm.selectedIngestStatus = vm.ingestsParams.status || vm.ingestStatusValues[0];
        vm.lastModifiedStart = moment.utc(vm.ingestsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.ingestsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.ingestData = [];
        vm.searchText = vm.ingestsParams.file_name || '';
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.data = [];

        $timeout(function () {
            vm.gridOptions.paginationCurrentPage = vm.ingestsParams.page || 1;
            vm.gridOptions.paginationPageSize = vm.ingestsParams.page_size || vm.gridOptions.paginationPageSize;
        });

        vm.refreshData = function () {
            var filteredData = _.filter(vm.ingestData, function (d) {
                return d.file_name.toLowerCase().includes(vm.searchText.toLowerCase());
            });
            vm.gridOptions.data = filteredData.length > 0 ? filteredData : vm.gridOptions.data;
        };

        var filteredByStatus = vm.ingestsParams.status ? true : false,
            filteredByOrder = vm.ingestsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'file_name',
                displayName: 'File Name',
                //filterHeaderTemplate: '<div class="ui-grid-filter-container"><input ng-model="grid.appScope.vm.searchText" ng-change="grid.appScope.vm.refreshData()" class="form-control" placeholder="Search"></div>'
                enableFiltering: false
            },
            {
                field: 'file_size',
                displayName: 'File Size',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.file_size_formatted }}</div>'
            },
            {
                field: 'strike.id',
                displayName: 'Strike Process',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.strike.id }}</div>'
            },
            {
                field: 'status',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedIngestStatus" ng-options="status.toUpperCase() for status in grid.appScope.vm.ingestStatusValues"></select></div>'
            },
            {
                field: 'transfer_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_started_formatted }}</div>'
            },
            {
                field: 'transfer_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_ended_formatted }}</div>'
            },
            {
                field: 'ingest_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_started_formatted }}</div>'
            },
            {
                field: 'ingest_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_ended_formatted }}</div>'
            }
        ];

        vm.getIngests = function () {
            vm.loading = true;
            feedService.getIngestsOnce(vm.ingestsParams).then(function (data) {
                vm.ingestData = data.results;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            stateService.setIngestsParams(vm.ingestsParams);
            vm.getIngests();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.ingestsParams);
        };

        vm.updateIngestOrder = function (sortArr) {
            vm.ingestsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateIngestStatus = function (value) {
            if (value != vm.ingestsParams.status) {
                vm.ingestsParams.page = 1;
            }
            vm.ingestsParams.status = value === 'VIEW ALL' ? null : value;
            vm.ingestsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.ingestsParams.page = currentPage;
                vm.ingestsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if(row.entity.source_file && row.entity.source_file.id){
                    $location.search({});
                    $location.path('/feed/ingests/' + row.entity.source_file.id);
                } else {
                    toastr["info"]('Source file is undefined for ' + row.entity.file_name);
                }

            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setIngestsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateIngestOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setIngestsParams(vm.ingestsParams);
            vm.updateColDefs();
            vm.getIngests();
            navService.updateLocation('feed');
        };

        vm.initialize();

        $scope.$watch('vm.selectedIngestStatus', function (value) {
            if (vm.loading) {
                if (filteredByStatus) {
                    vm.updateIngestStatus(value);
                }
            } else {
                filteredByStatus = value !== 'VIEW ALL';
                vm.updateIngestStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.searchText', function (value) {
           if (!vm.loading){
               vm.ingestsParams.file_name = value;
               vm.filterResults();
           }
        });

        $scope.$watchCollection('vm.stateService.getIngestsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getIngestsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.ingestsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('strikesController', ['$scope', '$route', '$location', '$routeParams', 'Strike', 'StrikeIngestFile', 'scaleConfig', 'navService', 'subnavService', 'strikeService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'toastr', function ($scope, $route, $location, $routeParams, Strike, StrikeIngestFile, scaleConfig, navService, subnavService, strikeService, workspacesService, scaleService, stateService, userService, toastr) {
        var vm = this,
            currStrike = {};

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.strikes = [];
        vm.workspaces = [];
        vm.newWorkspaces = [];
        vm.activeWorkspace = {};
        vm.localStrikes = [];
        vm.activeStrike = new Strike();
        vm.activeStrikeIngestFile = new StrikeIngestFile();
        vm.dataType = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.JSON = JSON;

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the strike
            vm.activeStrike = Strike.transformer(_.cloneDeep(currStrike));
            if ($routeParams.id === '0') {
                $location.path('/feed/strikes');
            }
        };

        vm.editStrike = function () {
            // store a reference of the strike as it currently exists in case the user cancels the edit
            currStrike = Strike.transformer(_.cloneDeep(vm.activeStrike));
            vm.mode = 'edit';
        };

        vm.saveStrike = function () {
            strikeService.saveStrike(vm.activeStrike).then(function (strike) {
                vm.activeStrike = Strike.transformer(strike);
                if (scaleConfig.static) {
                    localStorage.setItem('strike' + vm.activeStrike.id, JSON.stringify(vm.activeStrike));
                }
                $route.reload();
            }).catch(function () {

            });
        };

        vm.clearLocalStrikes = function () {
            _.forEach(vm.localStrikes, function (strike) {
                localStorage.removeItem('strike' + strike.id);
            });
            $location.path('/feed/strikes');
        };

        vm.newStrike = function () {
            vm.mode = 'add';
            vm.loadStrike(0);
        };

        vm.loadStrike = function (id) {
            $location.path('feed/strikes/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateStrike = function () {
            vm.loading = true;
            strikeService.validateStrike(vm.activeStrike).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Strike is valid.');
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error']('Error validating strike');
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.disableSaveBtn = function (invalid) {
            var returnVal = !(!invalid && vm.activeStrike.configuration.files_to_ingest.length > 0);
            vm.saveBtnClass = returnVal ? 'btn-default' : 'btn-success';
            return returnVal;
        };

        vm.addStrikeIngestFile = function () {
            if (_.keys(vm.activeStrikeIngestFile).length > 0) {
                vm.activeStrike.configuration.files_to_ingest.push(StrikeIngestFile.transformer(vm.activeStrikeIngestFile));
                vm.activeStrikeIngestFile = new StrikeIngestFile();
            }
        };

        vm.deleteStrikeIngestFile = function (file) {
            _.remove(vm.activeStrike.configuration.files_to_ingest, function (f) {
                return angular.equals(f, file);
            });
        };

        vm.addDataType = function () {
            if (vm.dataType) {
                vm.activeStrikeIngestFile.data_types.push(vm.dataType);
                vm.dataType = '';
            }
        };

        vm.removeDataType = function (dataType) {
            _.remove(vm.activeStrikeIngestFile.data_types, function (d) {
                return d === dataType;
            });
        };

        vm.updateWorkspace = function () {
            if (vm.activeStrike) {
                var workspaceObj = _.find(vm.workspaces, {name: vm.activeStrike.configuration.workspace});
                if (workspaceObj) {
                    vm.newWorkspaces = _.cloneDeep(vm.workspaces);
                    _.remove(vm.newWorkspaces, workspaceObj);
                    getWorkspaceDetails(workspaceObj.id);
                }
            }
        };

        var getWorkspaceDetails = function (id) {
            vm.loading = true;
            workspacesService.getWorkspaceDetails(id).then(function (data) {
                vm.activeWorkspace = data;
                if (vm.activeWorkspace.json_config.broker.type === 'host') {
                    vm.activeStrike.configuration.monitor.type = 'dir-watcher';
                } else if (vm.activeWorkspace.json_config.broker.type === 's3') {
                    vm.activeStrike.configuration.monitor.type = 's3';
                } else {
                    vm.activeStrike.configuration.monitor.type = null;
                }
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var getWorkspaces = function () {
            workspacesService.getWorkspaces().then(function (data) {
                vm.workspaces = data;
                vm.newWorkspaces = data;
                vm.updateWorkspace();
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var getStrikes = function () {
            vm.loading = true;
            strikeService.getStrikes().then(function (data) {
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'strike')) {
                            var type = JSON.parse(o[1]);
                            vm.localStrikes.push(type);
                            data.push(type);
                        }
                    });
                }
                vm.strikes = data;
                getWorkspaces();
            }).catch(function (error) {
                console.log(error);
                vm.loading = false;
            });
        };

        var initialize = function () {
            getStrikes();
            vm.activeStrike = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeStrike = new Strike();
                } else {
                    strikeService.getStrikeDetails(id).then(function (data) {
                        vm.activeStrike = Strike.transformer(data);
                    });
                }
            }
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/strikes');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset + 60;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Feed', ['scaleConfig', function (scaleConfig) {
        var Feed = function (value, status) {
            this.value = value;
            this.status = status;
        };

        // public methods
        Feed.prototype = {
            toString: function () {
                return 'Feed';
            },
            getCellText: function () {
                return this.value;
            },
            getCellTitle: function () {
                return '';
            }
        };

        // static methods, assigned to class
        Feed.build = function (data) {
            if (data) {
                return new Feed(
                    data.value,
                    data.status
                );
            }
            return new Feed();
        };

        Feed.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Feed.build)
                    .filter(Boolean);
            }
            return Feed.build(data);
        };

        return Feed;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('FeedStatus', ['scaleConfig', function (scaleConfig) {
        var FeedStatus = function (status) {
            this.status = status;
        };

        // public methods
        FeedStatus.prototype = {
            toString: function () {
                return 'FeedStatus';
            },
            getCellFill: function () {
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                return '';
            },
            getCellActivityTotal: function () {
                return '';
            },
            getCellError: function () {
                return '';
            },
            getCellTotal: function () {
                return '';
            }
        };

        // static methods, assigned to class
        FeedStatus.build = function (data) {
            if (data) {
                return new FeedStatus(
                    data.status
                );
            }
            return new FeedStatus();
        };

        FeedStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(FeedStatus.build)
                    .filter(Boolean);
            }
            return FeedStatus.build(data);
        };

        return FeedStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Ingest', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var Ingest = function (id, file_name, strike, status, bytes_transferred, transfer_started, transfer_ended, media_type, file_size, data_type, ingest_started, ingest_ended, source_file, created, last_modified) {
            this.id = id;
            this.file_name = file_name;
            this.strike = strike;
            this.status = status;
            this.bytes_transferred = bytes_transferred;
            this.transfer_started = transfer_started;
            this.transfer_started_formatted = moment.utc(transfer_started).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.transfer_ended = transfer_ended;
            this.transfer_ended_formatted = moment.utc(transfer_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_formatted = scaleService.calculateFileSizeFromBytes(file_size);
            this.data_type = data_type;
            this.ingest_started = ingest_started;
            this.ingest_started_formatted = ingest_started ? moment.utc(ingest_started).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.ingest_ended = ingest_ended;
            this.ingest_ended_formatted = ingest_ended ? moment.utc(ingest_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.source_file = source_file;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
        };

        // public methods
        Ingest.prototype = {
            
        };

        // static methods, assigned to class
        Ingest.build = function (data) {
            if (data) {
                return new Ingest(
                    data.id,
                    data.file_name,
                    data.strike,
                    data.status,
                    data.bytes_transferred,
                    data.transfer_started,
                    data.transfer_ended,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.ingest_started,
                    data.ingest_ended,
                    data.source_file,
                    data.created,
                    data.last_modified
                );
            }
            return new Ingest();
        };

        Ingest.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Ingest.build);
            }
            return Ingest.build(data);
        };

        return Ingest;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Strike', ['scaleConfig', 'Job', 'StrikeConfiguration', function (scaleConfig, Job, StrikeConfiguration) {
        var Strike = function (id, name, title, description, job, created, last_modified, configuration) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.job = Job.transformer(job);
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc);
            this.configuration = StrikeConfiguration.transformer(configuration);
        };

        Strike.prototype = {
            clean: function () {
                return {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    configuration: this.configuration
                };
            }
        };

        // static methods, assigned to class
        Strike.build = function (data) {
            if (data) {
                return new Strike(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.job,
                    data.created,
                    data.last_modified,
                    data.configuration
                );
            }
            return new Strike();
        };

        Strike.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Strike.build);
            }
            return Strike.build(data);
        };

        return Strike;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('StrikeConfiguration', ['scaleConfig', 'StrikeIngestFile', function (scaleConfig, StrikeIngestFile) {
        var StrikeConfiguration = function (version, workspace, monitor, files_to_ingest) {
            this.version = scaleConfig.strikeConfigurationVersion;
            this.workspace = workspace;
            this.monitor = monitor ? monitor : {
                type: '',
                region_name: '',
                credentials: {
                    access_key_id: '',
                    secret_access_key: ''
                }
            };
            this.files_to_ingest = files_to_ingest ? StrikeIngestFile.transformer(files_to_ingest) : [];
        };

        StrikeConfiguration.prototype = {

        };

        // static methods, assigned to class
        StrikeConfiguration.build = function (data) {
            if (data) {
                return new StrikeConfiguration(
                    data.version,
                    data.workspace,
                    data.monitor,
                    data.files_to_ingest
                );
            }
            return new StrikeConfiguration();
        };

        StrikeConfiguration.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(StrikeConfiguration.build);
            }
            return StrikeConfiguration.build(data);
        };

        return StrikeConfiguration;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('StrikeIngestFile', function () {
        var StrikeIngestFile = function (filename_regex, data_types, new_workspace, new_file_path) {
            this.filename_regex = filename_regex;
            this.data_types = data_types || [];
            this.new_workspace = new_workspace || '';
            this.new_file_path = new_file_path || '';
        };

        StrikeIngestFile.prototype = {

        };

        // static methods, assigned to class
        StrikeIngestFile.build = function (data) {
            if (data) {
                var returnObj = new StrikeIngestFile(
                    data.filename_regex,
                    data.data_types,
                    data.new_workspace,
                    data.new_file_path
                );
                if (data.data_types && data.data_types.length === 0) {
                    delete returnObj.data_types;
                }
                // remove empty/null/undefined values from returnObj
                return _.pick(returnObj, _.identity);
            }
            return new StrikeIngestFile();
        };

        StrikeIngestFile.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(StrikeIngestFile.build);
            }
            return StrikeIngestFile.build(data);
        };

        return StrikeIngestFile;
    });
})();

(function () {
    'use strict';
    angular.module('scaleApp').service('feedService', ['$location', '$timeout', '$q', '$http', 'scaleConfig', 'Ingest', function ($location, $timeout, $q, $http, scaleConfig, Ingest) {

        var getFeedParams = function (params) {
            if(!params) { params = {}; }
            var p = {};
            p.page_size = 1000;
            p.started = params.started ? params.started : moment.utc().add(-7,'days').startOf('d').toDate();
            p.ended = params.ended ? params.ended : moment.utc().toDate();
            p.use_ingest_time = params.use_ingest_time ? params.use_ingest_time : null;
            return p;
        };

        var getIngestsParams = function (params) {
            return params;
        };

        var getSourceParams = function (page, page_size, started, ended, order, is_parsed, file_name) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                order: order ? order : '-last_modified',
                is_parsed: is_parsed,
                file_name: file_name
            };
        };

        return {
            getFeed: function (params) {
                var d = $q.defer();
                var params = getFeedParams(params);
                $http({
                    url: scaleConfig.getUrlPrefix('ingests') + 'ingests/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getIngestsOnce: function (params) {
                var d = $q.defer();
                var params = getIngestsParams(params);
                $http({
                    url: scaleConfig.getUrlPrefix('ingests') + 'ingests/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Ingest.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSources: function (params) {
                params = params || getSourceParams();
                var d = $q.defer();
                $http({
                    url: scaleConfig.getUrlPrefix('sources') + 'sources/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSourceDetails: function (id) {
                var d = $q.defer();
                $http({
                    url: scaleConfig.getUrlPrefix('sources') + 'sources/' + id + '/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('strikeService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getStrikes: function () {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'strikes/';

                $http({
                    url: url,
                    method: 'GET',
                    params: { order: '-title' }
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getStrikeDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'strikes/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateStrike: function (strike) {
                var d = $q.defer();
                var cleanStrike = strike.clean();

                $http.post(scaleConfig.urls.apiPrefix + 'strikes/validation/', cleanStrike).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveStrike: function (strike) {
                var d = $q.defer();

                if (!strike.id) {
                    $http.post(scaleConfig.urls.apiPrefix + 'strikes/', strike.clean()).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'strikes/' + strike.id + '/', strike.clean()).success(function (result) {
                        strike = result;
                        d.resolve(strike);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

/**
 * <scale-file-ancestry-tree />
 */
(function () {
    angular.module('scaleApp').controller('scaleFileAncestryTreeController', ['$scope', 'scaleService', function ($scope, scaleService) {
        var vm = this;
        vm.source = $scope.source;

        $scope.$watchCollection('vm.source', function() {
            draw();
            //console.log(vm.source);
        });

        function formatFileName(filename){
            var maxlen = 25;
            var newfname = filename;
            if(filename.length > 30){
                var ext = filename.substring(filename.lastIndexOf('.')+1);
                var firstpart = filename.substring(0, filename.lastIndexOf('.'));
                var firstpartLen = maxlen - ext.length;
                var newfname = filename.substring(0,firstpartLen-1) + '...' + ext;
            }
            return newfname;
        };

        function getNodeHtml(file) {
            var iconHtml = scaleService.getMediaTypeHtml(file.media_type);
            var fname = formatFileName(file.file_name);
            var html = "<div class='graph'>";
            html += "<span class='name' title='" + file.file_name + "'>";
            html += "<a ng-show='" + file.url + "' href='" + file.url + "' target='_jobfile'>" + iconHtml + " " + fname + "</a>";
            html += "</span>";
            html += "</div>";

            return html;
        };

        function getJobNodeHtml(jobtype, jobid){
            var html = "<div>";
            html += "<span class='status'></span><span class='job-name'><a href='#/jobs/job/" + jobid + "'>" + jobtype.name + "</a></span>";
            html += "</div>";

            return html;
        }

        function draw() {
            if(vm.source && vm.source !== undefined){
                var svg = d3.select("svg");
                var inner = svg.select("g");

                // Set up zoom support
                var zoom = d3.behavior.zoom()
                    .on("zoom", function() {
                        // don't zoom on WheelEvent or MouseEvent, just window sizing
                        console.log('zoomed');
                        if(d3.event.sourceEvent === null){
                            inner.attr("transform", "translate(" + d3.event.translate + ")" +
                                "scale(" + d3.event.scale + ")");
                        }
                });
                svg.call(zoom);

                var render = new dagreD3.render();
                // Left-to-right layout
                var g = new dagreD3.graphlib.Graph({multigraph: true});
                g.setGraph({
                    nodesep: 30,
                    ranksep: 70,
                    rankdir: "LR",
                    marginx: 20,
                    marginy: 0
                });

                //Starting node
                var html = getNodeHtml(vm.source);
                g.setNode('file-' + vm.source.id, {
                    labelType: "html",
                    label: html,
                    rx: 10,
                    ry: 10,
                    padding: 10,
                    width: 250,
                    height: 20
                });

                // Products
                for (var id in vm.source.products) {
                    var prod = vm.source.products[id];
                    var jobNodeHtml = getJobNodeHtml(prod.job_type, prod.job.id);
                    // Add node for the job
                    g.setNode('job-' + prod.job.id, {
                        labelType: "html",
                        label: jobNodeHtml,
                        rx: 10,
                        ry: 10,
                        padding: 10,
                        width: 200,
                        height: 20
                    });
                    g.setEdge('file-'+vm.source.id, 'job-'+prod.job.id, {
                        //labelType: "html",
                        //label: "<a href='#/jobs/job/" + prod.job.id + "'>" + prod.job_type.name + "</a>"
                        //width: 40
                    });


                    var html = getNodeHtml(prod);
                    g.setNode('file-' + prod.id, {
                        labelType: "html",
                        label: html,
                        rx: 10,
                        ry: 10,
                        padding: 10,
                        width: 250,
                        height: 20
                    });
                    g.setEdge('job-'+prod.job.id, 'file-'+prod.id, {
                        //labelType: "html",
                        //label: "<a href='#/jobs/job/" + prod.job.id + "'>" + prod.job_type.name + "</a>"
                        //width: 40
                    });

                }

                var render = new dagreD3.render();

                // Run the renderer. This is what draws the final graph.
                render(inner, g);

                // Center the graph
                var vbx = svg.attr('viewBox').split(' ');
                var gwidth = g.graph().width;
                var gheight = g.graph().height;
                var ratio = gheight/gwidth;

                console.log(gheight);
                console.log(vbx[3]);

                // If graph is shorter than container, shrink the container height
                if( gheight < vbx[3] ){
                    svg.attr('viewBox', vbx[0] + ' ' + vbx[1] + ' ' + vbx[2] + ' ' + gheight*1.1);
                }

                // Scale graph based on width or height based on which exceeds
                // viewbox by most pixels
                var initialScale = Math.min((vbx[2]*0.95)/gwidth,(vbx[3]*0.95)/gheight);
                zoom
                    .translate([(vbx[2]*0.02), (vbx[3]*0.02)])
                    .scale(initialScale)
                    .event(svg);

                // set appropriate class for job nodes
                $('.job-name').closest('.node').children('rect').attr('class', 'job'); //.addClass('job');

                // clear zoom handler and mousewheel events
                // so they don't interfere with scrolling
                zoom.on('zoom', null);
                svg.on("mousedown.zoom", null)
                    .on("mousewheel.zoom", null)
                    .on("mousemove.zoom", null)
                    .on("DOMMouseScroll.zoom", null)
                    .on("dblclick.zoom", null)
                    .on("touchstart.zoom", null)
                    .on("touchmove.zoom", null)
                    .on("touchend.zoom", null)
                    .on("wheel.zoom", null);
            }

        }



    }]).directive('scaleFileAncestryTree', function () {
        'use strict';
        /**
         * Usage: <scale-file-ancestry-tree source="source" />
         */
        return {
            controller: 'scaleFileAncestryTreeController',
            templateUrl: 'modules/feed/directives/fileAncestryTreeTemplate.html',
            restrict: 'E',
            scope: {
                source: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobDetailController', ['$scope', '$rootScope', '$location', '$routeParams', '$uibModal', 'stateService', 'navService', 'jobService', 'jobExecutionService', 'nodeService', 'loadService', 'scaleConfig', 'subnavService', 'userService', 'scaleService', 'toastr', function ($scope, $rootScope, $location, $routeParams, $uibModal, stateService, navService, jobService, jobExecutionService, nodeService, loadService, scaleConfig, subnavService, userService, scaleService, toastr) {
        var vm = this;
        
        vm.job = {};
        vm.jobId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs');
        vm.loadingJobDetail = false;
        vm.latestExecution = null;
        vm.executionLog = null;
        vm.executionDetails = null;
        vm.selectedExecutionDetailValues = null;
        vm.timeline = [];
        vm.readonly = true;
        vm.jobErrorCreated = '';
        vm.jobErrorLastModified = '';
        vm.lastStatusChange = '';
        vm.supersededStatus = '';
        vm.triggerOccurred = '';

        vm.showLog = function (execution) {
            jobExecutionService.getJobExecutionDetails(execution.id).then(function(result){
                vm.selectedExecutionLog = result;
            });

            $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                windowClass: 'log-modal-window'
            });
        };

        vm.showExecutionDetails = function (executionId) {
            jobExecutionService.getJobExecutionDetails(executionId).then(function (data) {
                vm.selectedExecutionDetails = data;
                vm.selectedExecutionDetailValues = _.pairs(data);
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showExecutionDetails.html',
                    scope: $scope,
                    size: 'lg'
                });
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.requeueJob = function (jobId) {
            vm.loading = true;
            loadService.requeueJobs({ job_ids: [jobId] }).then(function (data) {
                toastr['success']('Requeued Job');
                vm.job.status = data.job_status;
                getJobDetail(jobId);
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.loading = true;
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                console.log(error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        var getJobDetail = function (jobId) {
            vm.loadingJobDetail = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.job = data;
                vm.timeline = calculateTimeline(data);
                vm.latestExecution = data.getLatestExecution();
                vm.jobErrorCreated = data.error ? moment.utc(data.error.created).toISOString() : '';
                vm.lastStatusChange = data.last_status_change ? moment.duration(moment.utc(data.last_status_change).diff(moment.utc())).humanize(true) : '';
                vm.supersededChange = data.superseded ? moment.duration(moment.utc(data.superseded).diff(moment.utc())).humanize(true) : '';
                vm.triggerOccurred = data.event.occurred ? moment.duration(moment.utc(data.event.occurred).diff(moment.utc())).humanize(true) : '';
                vm.inputs = data.inputs;
                vm.outputs = data.outputs;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingJobDetail = false;
            });
        };

        var calculateTimeline = function (job) {
            var tl = [];
            tl.push({ taskName: 'Created', started: job.created ? moment.utc(job.created).toDate() : job.created, ended: job.queued ? moment.utc(job.queued).toDate() : job.queued });
            tl.push({ taskName: 'Queued', started: job.queued ? moment.utc(job.queued).toDate() : job.queued, ended: job.started ? moment.utc(job.started).toDate() : job.started });
            tl.push({ taskName: 'Executed', started: job.started ? moment.utc(job.started).toDate() : job.started, ended: job.ended ? moment.utc(job.ended).toDate() : job.ended });

            return tl;
        };

        var initialize = function () {
            navService.updateLocation('jobs');
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            getJobDetail(vm.jobId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionDetailController', ['$scope', '$location', '$routeParams', 'navService', 'jobExecutionService', 'nodeService', 'scaleConfig', 'subnavService', function ($scope, $location, $routeParams, navService, jobExecutionService, nodeService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.jobExecution = {};
        vm.jobExecutionId = $routeParams.id;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/runs');

        var getJobExecutionDetail = function () {
            jobExecutionService.getJobExecutionDetail(id).then(function (data) {
                vm.jobExecution = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getJobExecutionDetail($routeParams.id);
            navService.updateLocation('jobs');
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionsController', ['$scope', '$location', 'navService', 'stateService', 'gridFactory', 'userService', 'jobExecutionService', 'jobTypeService', 'uiGridConstants', 'scaleConfig', 'subnavService', function ($scope, $location, navService, stateService, gridFactory, userService, jobExecutionService, jobTypeService, uiGridConstants, scaleConfig, subnavService) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobExecutionsParams = stateService.getJobExecutionsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobExecutionsParams.job_type_id ? vm.jobExecutionsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobExecutionsParams.status || vm.jobStatusValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobExecutionsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobExecutionsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobExecutionsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobExecutionsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobExecutionsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobExecutionsParams.status ? true : false,
            filteredByOrder = vm.jobExecutionsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobExecutions = function () {
            jobExecutionService.getJobExecutions(vm.jobExecutionsParams).then(function (data) {
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobExecutionsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobExecutions();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobExecution) {
            // show log modal
            vm.actionClicked = true;
            vm.jobExecution = jobExecution;
            $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                size: 'lg',
                windowClass: 'log-modal-window'
            });
        };

        vm.filterResults = function () {
            stateService.setJobsParams(vm.jobExecutionsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobExecutionsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobExecutionsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobExecutionsParams.job_type_id) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobExecutionsParams.status) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobExecutionsParams.page = currentPage;
                vm.jobExecutionsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobExecutionsParams(vm.jobExecutionsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs/executions');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobExecutionsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypesController', ['$rootScope', '$scope', '$routeParams', '$location', 'hotkeys', 'scaleService', 'navService', 'jobTypeService', 'scaleConfig', 'subnavService', 'nodeService', 'localStorage', 'userService', function ($rootScope, $scope, $routeParams, $location, hotkeys, scaleService, navService, jobTypeService, scaleConfig, subnavService, nodeService, localStorage, userService) {
        var vm = this;
        
        vm.containerStyle = '';
        vm.requestedJobTypeId = parseInt($routeParams.id);
        vm.jobTypes = [];
        vm.jobTypeIds = [];
        vm.jobTypeCount = 0;
        vm.activeJobTypeDetails = {};
        vm.activeJobTypeInterfaceValues = [];
        vm.activeJobTypeErrors = [];
        vm.activeJobTypeStats = {};
        vm.showJobTypeErrors = false;
        vm.loading = true;
        vm.activeJobType = null;
        vm.healthData6 = {};
        vm.healthData12 = {};
        vm.healthData24 = {};
        vm.activityIcon = '<i class="fa fa-pulse">&#x' + scaleConfig.activityIconCode + '</i>';
        vm.jobDetailsClass = 'hidden';
        vm.pauseBtnClass = 'fa-pause';
        vm.user = userService.getUserCreds();
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/types');

        vm.viewDetails = function (id) {
            vm.activeJobType = _.find(vm.jobTypes, 'id', id);
            vm.activeJobType.created = formatDateTime(vm.activeJobType.created);
            vm.activeJobType.lastModified = formatDateTime(vm.activeJobType.lastModified);

            $location.path('jobs/types/' + id);

            getJobTypeDetails(vm.activeJobType.id);

            vm.jobDetailsClass = 'visible';
        };

        vm.togglePause = function () {
            vm.activeJobType.is_paused = !vm.activeJobType.is_paused;
            vm.activeJobTypeDetails.is_paused = vm.activeJobType.is_paused;
            vm.loading = true;
            jobTypeService.updateJobType(vm.activeJobTypeDetails).then(function(data){
                vm.activeJobTypeDetails = data;
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                vm.loading = false;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
                vm.loading = false;
            });
        };

        vm.getPauseButtonClass = function(is_paused){
            return is_paused ? 'fa-play' : 'fa-pause';
        };

        vm.getJobTypeListItemClass = function(jobType){
            return jobType.is_paused ? 'paused' : '';
        };

        var formatDateTime = function (dt) {
            return moment.utc(dt).toISOString();
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypes = data.results;
                vm.jobTypeIds = _.pluck(vm.jobTypes, 'id');
                vm.jobTypeCount = data.count;
                if (vm.requestedJobTypeId) {
                    vm.viewDetails(vm.requestedJobTypeId);
                } else {
                    vm.loading = false;
                }
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx > 0) {
                                    vm.viewDetails(vm.jobTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx < (vm.jobTypeIds.length - 1)) {
                                    vm.viewDetails(vm.jobTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
                vm.loading = false;
            });
        };

        var getJobTypeDetails = function (id) {
            vm.loading = true;
            jobTypeService.getJobTypeDetails(id).then(function (data) {
                vm.activeJobTypeDetails = data;
                vm.activeJobTypeInterfaceValues = _.pairs(data.job_type_interface);
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                // format error mapping
                vm.activeJobTypeErrors = [];
                vm.showJobTypeErrors = _.keys(data.error_mapping.exit_codes).length > 0;
                if (vm.showJobTypeErrors) {
                    _.forEach(data.error_mapping.exit_codes, function (error_name) {
                        var error = _.find(data.errors, 'name', error_name),
                            exitCode = _.invert(data.error_mapping.exit_codes)[error_name];
                        vm.activeJobTypeErrors.push({code: exitCode, data: error});
                    });
                }

                // format job type stats
                var performance = data.getPerformance(),
                    failures = data.getFailures();

                vm.activeJobTypeStats = performance;

                vm.healthData6 = {
                    gaugeData: performance.hour6.rate,
                    donutData: failures.hour6
                };
                vm.healthData12 = {
                    gaugeData: performance.hour12.rate,
                    donutData: failures.hour12
                };
                vm.healthData24 = {
                    gaugeData: performance.hour24.rate,
                    donutData: failures.hour24
                };
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getJobTypes();
            navService.updateLocation('jobs');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobTypesFailureRatesController', ['$scope', '$location', 'scaleConfig', 'stateService', 'scaleService', 'subnavService', 'jobTypeService', 'metricsService', 'gridFactory', 'JobType', 'toastr', 'moment', function ($scope, $location, scaleConfig, stateService, scaleService, subnavService, jobTypeService, metricsService, gridFactory, JobType, toastr, moment) {
        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobTypesParams = stateService.getJobTypesFailureRatesParams();

        var jobTypes = [],
            started = moment.utc().subtract(30, 'days').startOf('d').toISOString(),
            ended = moment.utc().endOf('d').toISOString(),
            filteredByJobType = vm.jobTypesParams.name ? true : false;

        vm.stateService = stateService;
        vm.scaleService = scaleService;
        vm.loading = true;
        vm.dates = [];
        vm.performanceData = [];
        vm.jobTypeValues = [jobTypeViewAll];
        vm.selectedJobType = vm.jobTypesParams.name ? vm.jobTypesParams.name : jobTypeViewAll;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/failure-rates');

        var defaultColumnDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>',
                enableSorting: false
            },
            {
                field: 'twentyfour_hours',
                displayName: '24 Hours',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'fortyeight_hours',
                displayName: '48 Hours',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'thirty_days',
                displayName: '30 Days',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            }
        ];

        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.columnDefs = defaultColumnDefs;
        vm.gridOptions.data = [];
        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            $scope.gridApi = gridApi;
            $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if ($scope.actionClicked) {
                    $scope.actionClicked = false;
                } else {
                    $scope.$apply(function () {
                        $location.path('/jobs/types/' + row.entity.job_type.id);
                    });
                }
            });
        };
        
        vm.setStyle = function (colField, errorType) {
            var errorValue = (colField[errorType] / colField.total).toFixed(2);
            var textColor = errorValue >= 0.5 ? '#fff' : '#000';
            var rgb = errorType === 'system' ? '103, 0, 13' : errorType === 'algorithm' ? '203, 24, 29' : '241, 105, 19';
            return 'background: rgba(' + rgb + ', ' + errorValue + '); color: ' + textColor;
        };

        vm.failRateStyle = function (error, total) {
            var percentage = ((error / total) * 100).toFixed(0);
            return percentage > 0 ? 'width: ' + percentage + '%' : 'display: none';
        };
        
        vm.getPercentageOfTotal = function (errorTotal, total) {
            if (total === 0) {
                return '0%';
            }
            return ((errorTotal / total) * 100).toFixed(0) + '%';
        };

        vm.filterResults = function () {
            vm.gridOptions.data = [];
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            _.forEach(_.pairs(vm.jobTypesParams), function (param) {
                $location.search(param[0], param[1]);
            });
            vm.loading = true;
            initialize();
        };

        vm.updateJobType = function (value) {
            vm.jobTypesParams.name = value.name === 'VIEW ALL' ? null : value.name;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        var formatData = function (data, numDays) {
            var dataArr = [];
            _.forEach(data, function (result) {
                var filteredResult = _.filter(result, function (d) {
                    var date = moment.utc(d.date, 'YYYY-MM-DD');
                    if (moment.utc().diff(moment.utc(date), 'd') <= numDays) {
                        return d;
                    }
                });
                dataArr.push(filteredResult);
            });
            return dataArr;
        };

        var formatColumn = function (cData, id) {
            var systemErrors = cData[0],
                algorithmErrors = cData[1],
                dataErrors = cData[2],
                totalCount = cData[3];

            var obj = {
                system: _.sum(_.map(_.filter(systemErrors, { id: id }), 'value')),
                algorithm: _.sum(_.map(_.filter(algorithmErrors, { id: id }), 'value')),
                data: _.sum(_.map(_.filter(dataErrors, { id: id }), 'value')),
                total: _.sum(_.map(_.filter(totalCount, { id: id }), 'value'))
            };
            obj.errorTotal = obj.system + obj.algorithm + obj.data;

            return obj;
        };

        var initialize = function () {
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            jobTypeService.getJobTypesOnce().then(function (jobTypesData) {
                jobTypes = _.cloneDeep(jobTypesData.results);
                vm.jobTypeValues.push(jobTypesData.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { name: vm.jobTypesParams.name }) || jobTypeViewAll;
                vm.gridOptions.totalItems = jobTypesData.count;

                var metricsParams = {
                    page: null,
                    page_size: null,
                    started: started,
                    ended: ended,
                    choice_id: vm.selectedJobType.id > 0 ? [vm.selectedJobType.id] : _.map(jobTypes, 'id'),
                    column: ['error_system_count', 'error_algorithm_count', 'error_data_count', 'total_count'],
                    group: null,
                    dataType: 'job-types'
                };

                metricsService.getPlotData(metricsParams).then(function (data) {
                    if (data.results.length > 0) {
                        var data30Days = _.map(data.results, 'values'),
                            data48Hours = formatData(data30Days, 2),
                            data24Hours = formatData(data48Hours, 1);

                        _.forEach(jobTypes, function (jobType) {
                            vm.performanceData.push({
                                job_type: JobType.transformer(jobType),
                                twentyfour_hours: formatColumn(data24Hours, jobType.id),
                                fortyeight_hours: formatColumn(data48Hours, jobType.id),
                                thirty_days: formatColumn(data30Days, jobType.id)
                            });
                        });

                        vm.performanceData = _.sortByOrder(vm.performanceData, [function (d) {
                            if (d.twentyfour_hours.total > 0) {
                                return d.twentyfour_hours.errorTotal / d.twentyfour_hours.total;
                            }
                            return 0;
                        }, 'twentyfour_hours.total'], ['desc', 'desc']);

                        vm.gridOptions.minRowsToShow = vm.performanceData.length;
                        vm.gridOptions.virtualizationThreshold = vm.performanceData.length;
                        vm.gridOptions.data = vm.performanceData;
                    }

                    vm.loading = false;
                }).catch(function (error) {
                    vm.loading = false;
                    console.log(error);
                    toastr['error'](error);
                });
            });
        };
        
        initialize();

        $scope.$watch('vm.selectedJobType', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (vm.loading) {
                if (filteredByJobType) {
                    vm.updateJobType(newValue);
                }
            } else {
                filteredByJobType = newValue !== 'VIEW ALL';
                vm.updateJobType(newValue);
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobsController', ['$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'stateService', 'navService', 'subnavService', 'userService', 'jobService', 'jobExecutionService', 'jobTypeService', 'loadService', 'gridFactory', 'toastr', function ($scope, $location, $uibModal, scaleConfig, scaleService, stateService, navService, subnavService, userService, jobService, jobExecutionService, jobTypeService, loadService, gridFactory, toastr) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobsParams = stateService.getJobsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobsParams.job_type_id ? vm.jobsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobsParams.status || vm.jobStatusValues[0];
        vm.errorCategoryValues = _.map(scaleConfig.errorCategories, 'name');
        vm.selectedErrorCategory = vm.jobsParams.error_category || vm.errorCategoryValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobsParams.status ? true : false,
            filteredByErrorCategory = vm.jobsParams.error_category ? true : false,
            filteredByOrder = vm.jobsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents">' +
                    '<div class="pull-right">' +
                        '<button ng-show="((!grid.appScope.vm.readonly && !row.entity.is_superseded) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job">' +
                            '<i class="fa fa-repeat"></i></button> ' +
                        '<button ng-show="!grid.appScope.vm.readonly && !row.entity.is_superseded && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job">' +
                            '<i class="fa fa-ban"></i></button>' +
                    '</div> {{ row.entity.status }} <span type="button"  ng-if="row.entity.is_superseded" class="label label-info pull-right" tooltip-append-to-body="true" uib-tooltip="Superseded">S</span></div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.category',
                width: 150,
                displayName: 'Error Category',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedErrorCategory"><option ng-selected="{{ grid.appScope.vm.errorCategoryValues[$index] == grid.appScope.vm.selectedErrorCategory }}" value="{{ grid.appScope.vm.errorCategoryValues[$index] }}" ng-repeat="error in grid.appScope.vm.errorCategoryValues track by $index">{{ error.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.title',
                displayName: 'Error',
                cellTemplate: '<div class="ui-grid-cell-contents"><div uib-tooltip="{{ row.entity.error.description }}" tooltip-append-to-body="true">{{ row.entity.error.title }}</div></div>',
                width: 200,
                enableFiltering: false
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity.id)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobs = function () {
            jobService.getJobsOnce(vm.jobsParams).then(function (data) {
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobs();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobId) {
            // show log modal
            vm.actionClicked = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.jobExecution = data.getLatestExecution();
                jobExecutionService.getJobExecutionDetails(vm.jobExecution.id).then(function(result){
                    vm.jobExecution = result;
                });
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showLog.html',
                    scope: $scope,
                    windowClass: 'log-modal-window'
                });
            });
        };

        vm.requeueJobs = function (jobsParams) {
            if (!jobsParams) {
                jobsParams = vm.jobsParams ? vm.jobsParams : { started: vm.lastModifiedStart.toISOString(), ended: vm.lastModifiedStop.toISOString() };
            }
            vm.actionClicked = true;
            vm.loading = true;
            loadService.requeueJobs(jobsParams).then(function () {
                toastr['success']('Requeue Successful');
                vm.getJobs();
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.filterResults = function () {
            stateService.setJobsParams(vm.jobsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobsParams.job_type_id) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobsParams.status) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateErrorCategory = function (value) {
            if (value != vm.jobsParams.error_category) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.error_category = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobsParams.page = currentPage;
                vm.jobsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobsParams(vm.jobsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.selectedErrorCategory', function (value) {
            if (vm.loading) {
                if (filteredByErrorCategory) {
                    vm.updateErrorCategory(value);
                }
            } else {
                filteredByErrorCategory = value !== 'VIEW ALL';
                vm.updateErrorCategory(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('jobExecutionService', ['$http', '$q', '$resource', 'poller', 'scaleConfig', 'JobExecution', 'JobExecutionLog', function ($http, $q, $resource, poller, scaleConfig, JobExecution, JobExecutionLog) {

        var getJobExecutionsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, node_id) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                node_id: node_id
            };
        };

        return {
            getJobExecutions: function (params) {
                params = params || getJobExecutionsParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-executions') + 'job-executions/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobExecution.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobExecutionDetails: function (id) {
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + id + '/').success(function (data) {
                    d.resolve(JobExecution.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLogOnce: function(execId){
                var d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + execId + '/logs/combined/'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLog: function(execId){
                var url = url || scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + execId + '/logs/combined/';

                // Update view. Since a promise can only be resolved or rejected once but we want
                // to keep track of all requests, poller service uses the notifyCallback. By default
                // poller only gets notified of success responses.
                var jobExecutionLogResource = $resource(url,{},{
                    get:{
                        method:'GET'
                    }
                });

                var jobExecutionLogPoller = poller.get(jobExecutionLogResource, {
                        action: 'get',
                        delay: scaleConfig.pollIntervals.jobExecutionLog
                    });

                return jobExecutionLogPoller.promise.then(null, null, function (result) {
                    if(result.$resolved){
                        result.execution_log = JobExecutionLog.transformer(result);
                        if(result.execution_log.status === 'COMPLETED' || result.execution_log.status === 'FAILED'){
                            jobExecutionLogPoller.stop();
                        }
                        return result;
                    } else {
                        jobExecutionLogPoller.stop();
                        return result;
                    }

                });
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobService', ['$http', '$q', '$resource', 'scaleConfig', 'Job', 'JobDetails', 'RunningJob', 'poller', 'pollerFactory', function($http, $q, $resource, scaleConfig, Job, JobDetails, RunningJob, poller, pollerFactory) {

        var getJobsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                url: url
            };
        };

        var getJobUpdateData = function (status) {
            return {
                status: status
            };
        };

        return {
            getJobs: function (params) {
                params = params || getJobsParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('jobs') + 'jobs/';

                var jobsResource = $resource(params.url, params),
                    jobsPoller = pollerFactory.newPoller(jobsResource, scaleConfig.pollIntervals.jobs);

                return jobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Job.transformer(data.results);
                    } else {
                        jobsPoller.stop();
                    }
                    return data;
                });
            },
            getJobsOnce: function (params) {
                params = params || getJobsParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('jobs') + 'jobs/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Job.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getJobCountsByStatus: function (hour) {
                hour = hour || 3;
                var d = $q.defer();

                $http.get(scaleConfig.urls.getJobCountsByStatus(hour)).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobDetail: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('jobs') + 'jobs/' + id + '/').success(function (data) {
                    d.resolve(JobDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getRunningJobs: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var runningJobsResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', params),
                    runningJobsPoller = pollerFactory.newPoller(runningJobsResource, scaleConfig.pollIntervals.runningJobs);

                return runningJobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = RunningJob.transformer(data.results);
                    } else {
                        runningJobsPoller.stop();
                    }
                    return data;
                });
            },
            getRunningJobsOnce: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', params).success(function (data) {
                    data.results = RunningJob.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJob: function (id, data) {
                data = data || getJobUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('jobs') + 'jobs/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobTypeService', ['$http', '$q', '$resource', 'poller', 'pollerFactory', 'scaleConfig', 'jobService', 'JobType', 'JobTypeDetails', 'JobTypeStatus', function ($http, $q, $resource, poller, pollerFactory, scaleConfig, jobService, JobType, JobTypeDetails, JobTypeStatus) {
        /*var totalJobTypes = 5;

        var getTotalJobTypes = function () {
            return totalJobTypes;
        };

        var setTotalJobTypes = function () {
            totalJobTypes = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
        };

        setInterval(function () {
            setTotalJobTypes();
        }, 3100);*/

        var getJobTypeParams = function (page, page_size, started, ended, name, category, order) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                name: name,
                category: category,
                order: order ? order : ['title', 'version']
            };
        };

        var getJobTypeStatusParams = function (page, page_size, started, ended) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended
            };
        };

        return {
            getJobTypes: function (params) {
                params = params || getJobTypeParams();
                // var params = {
                //     order: order || ['name','version']
                // };

                var jobTypesResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/', params),
                    jobTypesPoller = pollerFactory.newPoller(jobTypesResource, scaleConfig.pollIntervals.jobTypes);

                return jobTypesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            job_types: []
                        };
                        for (var i = 1; i < getTotalJobTypes(); i++) {
                            returnResult.job_types.push(
                                {
                                    "is_system": true,
                                    "paused": null,
                                    "disk": 64.0,
                                    "id": i,
                                    "docker_image": null,
                                    "archived": null,
                                    "uses_docker": false,
                                    "priority": 10,
                                    "version": "1.0",
                                    "icon_code": scaleConfig.jobTypes[i - 1].code,
                                    "description": "Ingests a source file into a workspace",
                                    "mem": 64.0,
                                    "is_active": true,
                                    "cpus": 1.0,
                                    "last_modified": "2015-03-11T00:00:00Z",
                                    "max_tries": 3,
                                    "is_paused": false,
                                    "name": scaleConfig.jobTypes[i - 1].title,
                                    "created": "2015-03-11T00:00:00Z",
                                    "timeout": 1800,
                                    "is_long_running": false
                                }
                            )
                        }
                        result = returnResult;*/

                        data.results = JobType.transformer(data.results);
                        return data;
                    } else {
                        jobTypesPoller.stop();
                        return data;
                    }
                });
            },
            getJobTypesOnce: function (params) {
                params = params || getJobTypeParams();

                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeStatus: function (params) {
                params = params || getJobTypeStatusParams();

                var jobTypeStatusResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/status/', params),
                    jobTypeStatusPoller = pollerFactory.newPoller(jobTypeStatusResource, scaleConfig.pollIntervals.jobTypeStatus);

                return jobTypeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returndata = {
                            $resolved: true,
                            job_type_stats: []
                        };
                        for (var i = 0; i < getTotalJobTypes(); i++) {
                            returndata.job_type_stats.push(
                                {
                                    "id": i,
                                    "icon_code": "",
                                    "name": "",
                                    "version": "",
                                    "num_completed": Math.floor(Math.random() * (20000 - 10000 + 1)) + 10000,
                                    "num_canceled": Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                                    "num_error_DATA": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_SYSTEM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_ALGORITHM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20
                                }
                            )
                        }
                        data = returndata;*/

                        data.results = JobTypeStatus.transformer(data.results);
                    } else {
                        jobTypeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getJobTypeStatusOnce: function (params) {
                var d = $q.defer();

                params = params || getJobTypeStatusParams();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobTypeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('job-types') + 'job-types/' + id + '/').success(function (data) {
                    d.resolve(JobTypeDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJobType: function (data){
                var updatedJobType = function(data){
                    return {
                        error_mappings: data.error_mappings,
                        is_paused: data.is_paused
                    };
                };
                var updatedData = updatedJobType(data);
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/' + data.id + '/',
                    method: 'PATCH',
                    data: updatedData
                }).success(function (result) {
                    d.resolve(JobTypeDetails.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });                
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'loadService', 'uiGridConstants', 'scaleConfig', 'subnavService', 'QueueStatus', 'gridFactory', function($scope, $location, scaleService, stateService, navService, loadService, uiGridConstants, scaleConfig, subnavService, QueueStatus, gridFactory) {
        var vm = this;
        
        vm.loading = true;
        vm.queueStatusError = null;
        vm.queueStatusErrorStatus = null;
        vm.totalQueued = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/queued');
        
        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize) {
            vm.loading = true;
            loadService.getQueueStatus(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for (var i = 0; i < vm.gridOptions.paginationPageSize; i++) {
                    newData.push(data.jobs[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'job_type.title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                { field: 'job_type.version', displayName: 'Version', enableFiltering: false },
                { field: 'highest_priority', enableFiltering: false },
                {
                    field: 'longestQueued',
                    displayName: 'Duration of Longest Queued Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                },
                { field: 'count', enableFiltering: false }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                //set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'QUEUED', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };


            loadService.getQueueStatus(0, vm.gridOptions.paginationPageSize).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.gridOptions.minRowsToShow = result.results.length;
                    vm.gridOptions.virtualizationThreshold = result.results.length;
                    vm.gridOptions.data = result.results;
                    vm.gridOptions.totalItems = result.results.length;
                    vm.totalQueued = _.sum(result.results, 'count');
                    console.log('queue status updated');
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.queueStatusErrorStatus = result.statusText;
                    }
                    vm.queueStatusError = 'Unable to retrieve queue status.';
                }
                vm.loading = false
            });

            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadDepthController', ['$scope', '$location', 'navService', 'scaleConfig', 'subnavService', function ($scope, $location, navService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/depth');

        vm.loading = false;

        var initialize = function () {
            navService.updateLocation('load');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('queueRunningController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'jobService', 'gridFactory', 'uiGridConstants', 'scaleConfig', 'subnavService', function($scope, $location, scaleService, stateService, navService, jobService, gridFactory, uiGridConstants, scaleConfig, subnavService) {
        var vm = this;
        
        vm.loading = true;
        vm.runningJobsError = null;
        vm.runningJobsErrorStatus = null;
        vm.totalRunning = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/running');

        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize){
            vm.loading = true;
            jobService.getRunningJobsOnce(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for(var i = 0; i < vm.gridOptions.paginationPageSize; i++){
                    newData.push(data.results[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue running status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                {field: 'job_type.version', displayName: 'Version', enableFiltering: false},
                {field: 'count', displayName: 'Number of Jobs', enableFiltering: false},
                {
                    field: 'longestRunning',
                    displayName: 'Duration of Longest Running Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                // set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'RUNNING', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };

            jobService.getRunningJobs(0, vm.gridOptions.paginationPageSize).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                    vm.gridOptions.totalItems = data.results.length;
                    vm.totalRunning = _.sum(data.results, 'count');
                    console.log('running jobs updated');
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.runningJobsErrorStatus = data.statusText;
                    }
                    vm.runningJobsError = 'Unable to retrieve running jobs.';
                }
                vm.loading = false;
            });
            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('QueueStatus', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var QueueStatus = function (job_type, count, longest_queued, highest_priority) {
            this.job_type = JobType.transformer(job_type);
            this.count = count;
            this.longest_queued = longest_queued;
            this.highest_priority = highest_priority;
        };

        // public methods
        QueueStatus.prototype = {
            getIcon: function () {
                return this.job_type.icon_code ? '<i class="fa">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_queued, moment.utc().toISOString());
            }
        };

        // static methods, assigned to class
        QueueStatus.build = function (data) {
            if (data) {
                return new QueueStatus(
                    data.job_type,
                    data.count,
                    data.longest_queued,
                    data.highest_priority
                );
            }
            return new QueueStatus();
        };

        QueueStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(QueueStatus.build);
            }
            return QueueStatus.build(data);
        };

        return QueueStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('loadService', ['$http', '$q', '$resource', 'scaleConfig', 'poller', 'pollerFactory', 'QueueStatus', function($http, $q, $resource, scaleConfig, poller, pollerFactory, QueueStatus) {
        var getJobLoadParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                started: started,
                ended: ended,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                page_size: 1000,
                url: url
            };
        };

        var getRequeueJobsParams = function (started, ended, job_status, job_type_ids, job_type_names, job_type_categories, priority, url) {
            return {
                started: started,
                ended: ended,
                job_status: job_status,
                job_ids: job_ids,
                job_type_ids: job_type_ids,
                job_type_names: job_type_names,
                job_type_categories: job_type_categories,
                priority: priority,
                url: url
            };
        };

        return {
            getQueueStatus: function (pageNumber, pageSize) {
                var params = {
                    page_number: pageNumber,
                    page_size: pageSize
                };

                var queueStatusResource = $resource(scaleConfig.getUrlPrefix('queue') + 'queue/status/', params),
                    queueStatusPoller = pollerFactory.newPoller(queueStatusResource, scaleConfig.pollIntervals.queueStatus);

                return queueStatusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result.results = QueueStatus.transformer(result.results);
                    } else {
                        queueStatusPoller.stop();
                    }
                    return result;
                });
            },
            getQueueStatusOnce: function () {
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('queue') + 'queue/status/').success(function (data) {
                    data.results = QueueStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            requeueJobs: function (params) {
                params = params || getRequeueJobsParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('queue') + 'queue/requeue-jobs/';

                var d = $q.defer();

                $http.post(params.url, params).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            getJobLoad: function (params) {
                params = params || getJobLoadParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('load') + 'load/';

                var jobLoadResource = $resource(params.url, params),
                    jobLoadPoller = pollerFactory.newPoller(jobLoadResource, scaleConfig.pollIntervals.jobLoad);

                return jobLoadPoller.promise.then(null, null, function (data) {
                    if (!data.$resolved) {
                        jobLoadPoller.stop();
                    }
                    return data;
                });
            },
            getJobLoadOnce: function (params) {
                params = params || getJobLoadParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('load') + 'load/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobExecutionLogController', ['$scope', '$location', '$element', '$timeout', 'jobExecutionService', 'scaleConfig', function ($scope, $location, $element, $timeout, jobExecutionService, scaleConfig) {
        var vm = this;
        
        var initialize = function () {
            vm.forceScroll = true;
            vm.jobLogError = null;

            $scope.$watch('execution', function () {
                if ($scope.execution) {
                    vm.status = $scope.execution.status.toLowerCase();
                    console.log($scope.execution);
                    jobExecutionService.getLog($scope.execution.id).then(null, null, function (result) {
                        // get difference of max scroll length and current scroll length.var  = result.data;
                        if (result) {
                            var div = $($element[0]).find('.bash');
                            vm.scrollDiff = (div.scrollTop() + div.prop('offsetHeight')) - div.prop('scrollHeight');
                            if (vm.scrollDiff >= 0) {
                                vm.forceScroll = true;
                            }
                            vm.execLog = result;
                        } else {
                            if (result.statusText && result.statusText !== '') {
                                vm.jobLogErrorStatus = result.statusText;
                            }
                            $scope.jobLogError = 'Unable to retrieve job logs.';
                        }
                    });
                }
            });
            $scope.$watch('vm.execLog', function () {
                if (vm.execLog) {
                    if (vm.forceScroll || vm.scrollDiff >= 0) {
                        $timeout(function () {
                            vm.forceScroll = false;
                            var scrlHeight = $($element[0]).find('.bash').prop('scrollHeight');
                            $($element[0]).find('.bash').scrollTop(scrlHeight);
                        }, 50);
                    }
                }
            });
        };

        vm.scrollitem = function (item) {
            console.log(item);
        };

        vm.stdoutChanged = function () {
            console.log('stdout changed.');
        };

        initialize();

    }]).directive('jobExecutionLog', function () {
        return {
            controller: 'jobExecutionLogController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobExecutionLogTemplate.html',
            restrict: 'E',
            scope: {
                execution: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobHealthController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {
        var vm = this;
        
        vm.loadingJobHealth = true;
        vm.jobHealthError = null;
        vm.jobHealthErrorStatus = null;
        vm.jobHealth = {};

        var getJobTypeStatus = function () {
            jobTypeService.getJobTypeStatus({
                page: null,
                page_size: 1000,
                started: $scope.duration,
                ended: null
            }).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobHealthError = null;
                    vm.jobTypeStatus = data.results;
                    vm.total = 0;
                    vm.failed = 0;

                    var performance = {},
                        failures = [];

                    _.forEach(data.results, function (status) {
                        performance = status.getPerformance();
                        vm.total = vm.total + performance.total;
                        vm.failed = vm.failed + performance.failed;
                        failures.push(status.getFailures());
                    });

                    var failureData = [],
                        systemFailures = 0,
                        dataFailures = 0,
                        algorithmFailures = 0;

                    _.forEach(failures, function (f) {
                        _.forEach(f, function (type) {
                            if (type.status === 'SYSTEM') {
                                systemFailures = systemFailures + type.count;
                            } else if (type.status === 'DATA') {
                                dataFailures = dataFailures + type.count;
                            } else if (type.status === 'ALGORITHM') {
                                algorithmFailures = algorithmFailures + type.count;
                            }
                        });
                    });

                    if (systemFailures > 0 || dataFailures > 0 || algorithmFailures > 0) {
                        if (systemFailures > 0) {
                            failureData.push({
                                status: 'SYSTEM',
                                count: systemFailures
                            });
                        }
                        if (algorithmFailures > 0) {
                            failureData.push({
                                status: 'ALGORITHM',
                                count: algorithmFailures
                            });
                        }
                        if (dataFailures > 0) {
                            failureData.push({
                                status: 'DATA',
                                count: dataFailures
                            });
                        }
                    }

                    vm.jobHealth = {
                        gaugeData: vm.total === 0 ? 0 : 100 - ((vm.failed / vm.total) * 100).toFixed(2),
                        donutData: failureData
                    };

                    if ($scope.broadcastData) {
                        $rootScope.$broadcast('jobTypeStatus', vm.jobTypeStatus);
                    }
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobHealthErrorStatus = data.statusText;
                    }
                    vm.jobHealthError = 'Unable to retrieve job statistics.';
                }
                vm.loadingJobHealth = false;
            });
        };

        getJobTypeStatus();
    }]).directive('aisJobHealth', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'aisJobHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobHealthTemplate.html',
            restrict: 'E',
            scope: {
                duration: '=',
                broadcastData: '=', // set to true when using another widget in the same view that also calls getJobTypeStatus
                showDescription: '='
            }
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypeInterfaceDirectiveController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {

    }]).directive('aisJobTypeInterface', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'jobTypeInterfaceDirectiveController',
            templateUrl: 'modules/jobs/directives/jobTypeInterfaceTemplate.html',
            restrict: 'E',
            scope: {
                jobTypeInterface: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Job', ['scaleConfig', 'JobType', 'scaleService', function (scaleConfig, JobType, scaleService) {
        var Job = function (id, job_type, job_type_rev, event, error, status, priority, num_exes, timeout, max_tries,
                            cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started,
                            ended, last_status_change, last_modified, is_superseded) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = event;
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.queued = queued;
            this.started = started;
            this.ended = ended;
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.is_superseded = is_superseded;
        };

        // public methods
        Job.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();
                return scaleService.calculateDuration(start, end);
            }
        };

        // static methods, assigned to class
        Job.build = function (data) {
            if (data) {
                return new Job(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.is_superseded
                );
            }
            return new Job();
        };

        Job.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Job.build)
                    .filter(Boolean);
            }
            return Job.build(data);
        };

        return Job;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEvent', ['JobDetailEventRule', function (JobDetailEventRule) {
        var JobDetailEvent = function (id, type, rule, occurred) {
            this.id = id;
            this.type = type;
            this.rule = JobDetailEventRule.transformer(rule);
            this.occurred = occurred;
        };

        // public methods
        JobDetailEvent.prototype = {

        };

        // static methods, assigned to class
        JobDetailEvent.build = function (data) {
            if (data) {
                return new JobDetailEvent(
                    data.id,
                    data.type,
                    data.rule,
                    data.occurred
                );
            }
            return new JobDetailEvent();
        };

        JobDetailEvent.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEvent.build)
                    .filter(Boolean);
            }
            return JobDetailEvent.build(data);
        };

        return JobDetailEvent;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEventRule', function () {
        var JobDetailEventRule = function (id, type, is_active, created, archived, last_modified) {
            this.id = id;
            this.type = type;
            this.is_active = is_active;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
        };

        // public methods
        JobDetailEventRule.prototype = {

        };

        // static methods, assigned to class
        JobDetailEventRule.build = function (data) {
            if (data) {
                return new JobDetailEventRule(
                    data.id,
                    data.type,
                    data.is_active,
                    data.created,
                    data.archived,
                    data.last_modified
                );
            }
            return new JobDetailEventRule();
        };

        JobDetailEventRule.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEventRule.build)
                    .filter(Boolean);
            }
            return JobDetailEventRule.build(data);
        };

        return JobDetailEventRule;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailInputData', function () {
        var JobDetailInputData = function (name, value, file_id, file_ids, files) {
            this.name = name;
            this.value = value;
            this.file_id = file_id;
            this.file_ids = file_ids;
            this.files = files;
        };

        // public methods
        JobDetailInputData.prototype = {
            getValue: function () {
                if (this.value)
                    return this.value;
                if (this.file_id)
                    return this.file_id;
                if (this.file_ids)
                    return this.file_ids;
            }
        };

        // static methods, assigned to class
        JobDetailInputData.build = function (data) {
            if (data) {
                return new JobDetailInputData(
                    data.name,
                    data.value,
                    data.file_id,
                    data.file_ids,
                    data.files
                );
            }
            return new JobDetailInputData();
        };

        JobDetailInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailInputData.build)
                    .filter(Boolean);
            }
            return JobDetailInputData.build(data);
        };

        return JobDetailInputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailOutputData', function () {
        var JobDetailOutputData = function (name, workspace_id, files) {
            this.name = name;
            this.workspace_id = workspace_id;
            this.files = files;
        };

        // public methods
        JobDetailOutputData.prototype = {

        };

        // static methods, assigned to class
        JobDetailOutputData.build = function (data) {
            if (data) {
                return new JobDetailOutputData(
                    data.name,
                    data.workspace_id,
                    data.files
                );
            }
            return new JobDetailOutputData();
        };

        JobDetailOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailOutputData.build)
                    .filter(Boolean);
            }
            return JobDetailOutputData.build(data);
        };

        return JobDetailOutputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetails', ['scaleConfig', 'JobType', 'JobExecution', 'Product', 'JobDetailInputData', 'JobDetailOutputData', 'Recipe', 'JobDetailEvent', 'scaleService', function (scaleConfig, JobType, JobExecution, Product, JobDetailInputData, JobDetailOutputData, Recipe, JobDetailEvent, scaleService) {
        var JobDetails = function (id, job_type, job_type_rev, event, error, status,
                                   priority, num_exes, timeout, max_tries, cpus_required, mem_required,
                                   disk_in_required, disk_out_required, created, queued, started, ended,
                                   last_status_change, last_modified, data, results, recipes, job_exes,
                                   inputs, outputs, is_superseded, root_superseded_job, superseded_job,
                                   superseded_by_job, superseded) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = JobDetailEvent.transformer(event);
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.queued = queued;
            this.queued_formatted = moment.utc(queued).format(scaleConfig.dateFormats.day_second_utc);
            this.started = started;
            this.started_formatted = moment.utc(started).format(scaleConfig.dateFormats.day_second_utc);
            this.ended = ended;
            this.ended_formatted = moment.utc(ended).format(scaleConfig.dateFormats.day_second_utc);
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.data = {
                input_data: JobDetailInputData.transformer(data.input_data),
                version: data.version,
                output_data: JobDetailOutputData.transformer(data.output_data)
            };
            this.results = {
                output_data: JobDetailOutputData.transformer(results.output_data),
                version: results.version
            };
            this.recipes = _.sortBy(Recipe.transformer(recipes), ['created']).reverse();
            this.job_exes = JobExecution.transformer(job_exes);
            this.inputs = inputs;
            this.outputs = outputs;
            this.is_superseded = is_superseded;
            this.root_superseded_job = root_superseded_job;
            this.superseded_job = superseded_job;
            this.superseded_by_job = superseded_by_job;
            this.superseded = superseded;
            this.superseded_formatted = moment.utc(superseded).format(scaleConfig.dateFormats.day_second_utc);;

        };

        // public methods
        JobDetails.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();

                return scaleService.calculateDuration(start, end);
            },
            getLatestExecution: function(){
                if (this.num_exes > 0 ) {
                    return this.job_exes[0];
                }
                return null;
            },
            getStatusClass: function(){
                // if(this.status === 'COMPLETED'){
                //     return 'label-success';
                // }
                // else if( this.status === 'FAILED'){
                //     return 'label-default';//    return 'label-danger';
                // }
                // else{
                //     return 'label-default';
                // }
                return this.status.toLowerCase();
            }
        };

        // static methods, assigned to class
        JobDetails.build = function (data) {
            if (data) {
                return new JobDetails(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.data,
                    data.results,
                    data.recipes,
                    data.job_exes,
                    data.inputs,
                    data.outputs,
                    data.is_superseded,
                    data.root_superseded_job,
                    data.superseded_job,
                    data.superseded_by_job,
                    data.superseded
                );
            }
            return new JobDetails();
        };

        JobDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetails.build)
                    .filter(Boolean);
            }
            return JobDetails.build(data);
        };

        return JobDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecution', ['scaleConfig', 'Job', 'Node', 'moment', function (scaleConfig, Job, Node, moment) {
        var JobExecution = function (id, status, command_arguments, timeout, pre_started, pre_completed, pre_exit_code, job_started, job_completed, job_exit_code, post_started, post_completed, post_exit_code, created, queued, started, ended, last_modified, job, node, error, environment, cpus_scheduled, mem_scheduled, disk_in_scheduled, disk_out_scheduled, disk_total_scheduled, results, current_stdout_url, current_stderr_url, results_manifest) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.pre_exit_code = pre_exit_code;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.job_exit_code = job_exit_code;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.post_exit_code = post_exit_code;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.queued = queued;
            this.queued_formatted = queued ? moment.utc(queued).toISOString() : queued;
            this.started = started;
            this.started_formatted = started ? moment.utc(started).toISOString() : started;
            this.ended = ended;
            this.ended_formatted = ended ? moment.utc(ended).toISOString() : ended;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.environment = environment;
            this.cpus_scheduled = cpus_scheduled;
            this.mem_scheduled = mem_scheduled;
            this.disk_in_scheduled = disk_in_scheduled;
            this.disk_out_scheduled = disk_out_scheduled;
            this.disk_total_scheduled = disk_total_scheduled;
            this.results = results;
            this.current_stdout_url = current_stdout_url;
            this.current_stderr_url = current_stderr_url;
            this.results_manifest = results_manifest;
        };

        // public methods
        JobExecution.prototype = {
            getDuration: function () {
                return moment.utc(this.job_completed).diff(moment.utc(this.job_started));
            },
            getIcon: function () {
                return this.job.jobType.iconCode ? '<i class="fa">&#x' + this.job.jobType.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobExecution.build = function (data) {
            if (data) {
                return new JobExecution(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.pre_started,
                    data.pre_completed,
                    data.pre_exit_code,
                    data.job_started,
                    data.job_completed,
                    data.job_exit_code,
                    data.post_started,
                    data.post_completed,
                    data.post_exit_code,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.environment,
                    data.cpus_scheduled,
                    data.mem_scheduled,
                    data.disk_in_scheduled,
                    data.disk_out_scheduled,
                    data.disk_total_scheduled,
                    data.results,
                    data.current_stdout_url,
                    data.current_stderr_url,
                    data.results_manifest
                );
            }
            return new JobExecution();
        };

        JobExecution.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecution.build)
                    .filter(Boolean);
            }
            return JobExecution.build(data);
        };

        return JobExecution;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecutionLog', ['scaleConfig', 'Job', 'Node', function (scaleConfig, Job, Node) {
        var JobExecutionLog = function (id, status, command_arguments, timeout, exit_code, created, queued, scheduled, pre_started, pre_completed, job_started, job_completed, post_started, post_completed, ended, last_modified, job, node, error, is_finished, stdout, stderr) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.exit_code = exit_code;
            this.created = created;
            this.queued = queued;
            this.scheduled = scheduled;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.ended = ended;
            this.last_modified = last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.is_finished = is_finished;
            this.stdout = stdout;
            this.stdoutHtml = stdout ? stdout.replace(new RegExp('\r?\n','g'), '<br />') : '';
            this.stderr = stderr;
        };

        // public methods
        JobExecutionLog.prototype = {
            toHtml: function(instr){
                return instr
            }

        };

        // static methods, assigned to class
        JobExecutionLog.build = function (data) {
            if (data) {
                return new JobExecutionLog(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.exit_code,
                    data.created,
                    data.queued,
                    data.scheduled,
                    data.pre_started,
                    data.pre_completed,
                    data.job_started,
                    data.job_completed,
                    data.post_started,
                    data.post_completed,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.is_finished,
                    data.stdout,
                    data.stderr
                );
            }
            return new JobExecutionLog();
        };

        JobExecutionLog.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecutionLog.build)
                    .filter(Boolean);
            }
            return JobExecutionLog.build(data);
        };

        return JobExecutionLog;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobType', ['scaleConfig', 'JobTypeInterface', function (scaleConfig, JobTypeInterface) {
        var JobType = function (id, name, title, version, description, is_system, is_long_running, is_active, is_operational, is_paused, uses_docker, docker_privileged, docker_image, priority, timeout, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, icon_code, created, archived, paused, last_modified, job_type_interface) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.version = version;
            this.description = description;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.priority = priority;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_mult_required = disk_out_mult_required;
            this.icon_code = icon_code;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = JobTypeInterface.transformer(job_type_interface);
        };

        // public methods
        JobType.prototype = {
            toString: function () {
                return 'JobType';
            },
            getIcon: function () {
                return this.icon_code ? '<i class="fa fa-fw">&#x' + this.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getCellText: function () {
                return this.icon_code ? '&#x' + this.icon_code + ';' : '&#x' + scaleConfig.defaultIconCode + ';';
            },
            getCellTitle: function () {
                return this.title;
            }
        };

        // static methods, assigned to class
        JobType.build = function (data) {
            if (data) {
                return new JobType(
                    data.id,
                    data.name,
                    data.title,
                    data.version,
                    data.description,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.priority,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.icon_code,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    data.interface
                );
            }
            return new JobType();
        };

        JobType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobType.build)
                    .filter(Boolean);
            }
            return JobType.build(data);
        };

        return JobType;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeDetails', ['scaleConfig', 'JobTypeInterface', 'JobTypeErrorMapping', 'JobTypeError', 'scaleService', function (scaleConfig, JobTypeInterface, JobTypeErrorMapping, JobTypeError, scaleService) {
        var JobTypeDetails = function (id, name, version, title, description, category, author_name, author_url, is_system, is_long_running, is_active, is_operational, is_paused, icon_code, uses_docker, docker_privileged, docker_image, revision_num, priority, timeout, max_scheduled, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, created, archived, paused, last_modified, job_type_interface, error_mapping, trigger_rule, errors, job_counts_6h, job_counts_12h, job_counts_24h) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.category = category;
            this.author_name = author_name;
            this.author_url = author_url;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.icon_code = icon_code;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.revision_num = revision_num;
            this.priority = priority;
            this.timeout = timeout;
            this.max_scheduled = max_scheduled;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.mem_required_formatted = scaleService.calculateFileSizeFromMib(mem_required);
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_const_required_formatted = scaleService.calculateFileSizeFromMib(disk_out_const_required);
            this.disk_out_mult_required = disk_out_mult_required;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = job_type_interface;
            this.error_mapping = JobTypeErrorMapping.transformer(error_mapping);
            this.trigger_rule = trigger_rule;
            this.errors = JobTypeError.transformer(errors);
            this.job_counts_6h = job_counts_6h;
            this.job_counts_12h = job_counts_12h;
            this.job_counts_24h = job_counts_24h;
        };

        // public methods
        JobTypeDetails.prototype = {
            getIcon: function () {
                return this.icon_code ? '<i class="fa">&#x' + this.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getPerformance: function () {
                var failed6Arr = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed12Arr = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed24Arr = _.where(this.job_counts_24h, { 'status': 'FAILED' });

                var completed6 = _.find(this.job_counts_6h, 'status', 'COMPLETED') || { count: 0 },
                    failed6 = _.sum(failed6Arr, 'count'),
                    total6 = failed6Arr.length > 0 ? failed6 + completed6.count : completed6.count,
                    successRate6 = total6 === 0 ? 0 : 100 - ((failed6 / total6) * 100).toFixed(2),
                    completed12 = _.find(this.job_counts_12h, 'status', 'COMPLETED') || { count: 0 },
                    failed12 = _.sum(failed12Arr, 'count'),
                    total12 = failed12Arr.length > 0 ? failed12 + completed12.count : completed12.count,
                    successRate12 = total12 === 0 ? 0 : 100 - ((failed12 / total12) * 100).toFixed(2),
                    completed24 = _.find(this.job_counts_24h, 'status', 'COMPLETED') || { count: 0 },
                    failed24 = _.sum(failed24Arr, 'count'),
                    total24 = failed24Arr.length > 0 ? failed24 + completed24.count : completed24.count,
                    successRate24 = total24 === 0 ? 0 : 100 - ((failed24 / total24) * 100).toFixed(2);

                return {
                    hour6: {
                        rate: successRate6,
                        failed: failed6,
                        completed: completed6.count,
                        total: total6
                    },
                    hour12: {
                        rate: successRate12,
                        failed: failed12,
                        completed: completed12.count,
                        total: total12
                    },
                    hour24: {
                        rate: successRate24,
                        failed: failed24,
                        completed: completed24.count,
                        total: total24
                    }
                };
            },
            getFailures: function () {
                var failed6 = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed6Values = _.values(_.groupBy(failed6, 'category')),
                    failed12 = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed12Values = _.values(_.groupBy(failed12, 'category')),
                    failed24 = _.where(this.job_counts_24h, { 'status': 'FAILED' }),
                    failed24Values = _.values(_.groupBy(failed24, 'category'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count });
                        });
                    });
                    return returnArr;
                };

                return {
                    hour6: getFailureCounts(failed6Values),
                    hour12: getFailureCounts(failed12Values),
                    hour24: getFailureCounts(failed24Values)
                };
            }
        };

        // static methods, assigned to class
        JobTypeDetails.build = function (data) {
            if (data) {
                // TODO: change property returned by API from "interface" to "job_type_interface" because "interface" is a reserved word in JS
                var jobTypeInterface = data.interface ? data.interface : data.job_type_interface;
                return new JobTypeDetails(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.category,
                    data.author_name,
                    data.author_url,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.icon_code,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.revision_num,
                    data.priority,
                    data.timeout,
                    data.max_scheduled,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    jobTypeInterface,
                    data.error_mapping,
                    data.trigger_rule,
                    data.errors,
                    data.job_counts_6h,
                    data.job_counts_12h,
                    data.job_counts_24h
                );
            }
            return new JobTypeDetails();
        };

        JobTypeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeDetails.build);
            }
            return JobTypeDetails.build(data);
        };

        return JobTypeDetails;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeError', ['moment', 'scaleConfig', function (moment, scaleConfig) {
        var JobTypeError = function (id, name, title, description, category, created, last_modified) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.category = category;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
        };

        // public methods
        JobTypeError.prototype = {

        };

        // static methods, assigned to class
        JobTypeError.build = function (data) {
            if (data) {
                return new JobTypeError(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.category,
                    data.created,
                    data.last_modified
                );
            }
            return new JobTypeError();
        };

        JobTypeError.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeError.build)
                    .filter(Boolean);
            }
            return JobTypeError.build(data);
        };

        return JobTypeError;
    }])
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').factory('JobTypeErrorMapping', function () {
        var JobTypeErrorMapping = function (version, exit_codes) {
            this.version = version;
            this.exit_codes = exit_codes;
        };

        // public methods
        JobTypeErrorMapping.prototype = {

        };

        // static methods, assigned to class
        JobTypeErrorMapping.build = function (data) {
            if (data) {
                return new JobTypeErrorMapping(
                    data.version,
                    data.exit_codes
                );
            }
            return new JobTypeErrorMapping();
        };

        JobTypeErrorMapping.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeErrorMapping.build)
                    .filter(Boolean);
            }
            return JobTypeErrorMapping.build(data);
        };

        return JobTypeErrorMapping;
    })
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInputData', ['scaleConfig', function (scaleConfig) {
        var JobTypeInputData = function (media_types, required, type, name) {
            this.media_types = media_types;
            this.required = required;
            this.type = type;
            this.name = name;
        };

        // public methods
        JobTypeInputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeInputData.build = function (data) {
            if (data) {
                return new JobTypeInputData(
                    data.media_types,
                    data.required,
                    data.type,
                    data.name
                );
            }
            return new JobTypeInputData();
        };

        JobTypeInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInputData.build);
            }
            return JobTypeInputData.build(data);
        };

        return JobTypeInputData;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInterface', ['scaleConfig', 'JobTypeInputData', 'JobTypeOutputData', function (scaleConfig, JobTypeInputData, JobTypeOutputData) {
        var JobTypeInterface = function (version, command, command_arguments, input_data, output_data) {
            this.version = version;
            this.command = command;
            this.command_arguments = command_arguments;
            this.input_data = JobTypeInputData.transformer(input_data);
            this.output_data = JobTypeOutputData.transformer(output_data);
        };

        // public methods
        JobTypeInterface.prototype = {
            getIcon: function () {
                return this.iconCode ? '<i class="fa">&#x' + this.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobTypeInterface.build = function (data) {
            if (data) {
                return new JobTypeInterface(
                    data.version,
                    data.command,
                    data.command_arguments,
                    data.input_data,
                    data.output_data
                );
            }
            return new JobTypeInterface();
        };

        JobTypeInterface.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInterface.build)
                    .filter(Boolean);
            }
            return JobTypeInterface.build(data);
        };

        return JobTypeInterface;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeOutputData', function () {
        var JobTypeOutputData = function (name, type, required, media_type) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.media_type = media_type;
        };

        // public methods
        JobTypeOutputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeOutputData.build = function (data) {
            if (data) {
                return new JobTypeOutputData(
                    data.name,
                    data.type,
                    data.required,
                    data.media_type
                );
            }
            return new JobTypeOutputData();
        };

        JobTypeOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeOutputData.build)
                    .filter(Boolean);
            }
            return JobTypeOutputData.build(data);
        };

        return JobTypeOutputData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeStatus', ['scaleConfig', 'JobType', 'JobExecution', function (scaleConfig, JobType, JobExecution) {
        var JobTypeStatus = function (job_type, job_counts) {
            this.job_type = JobType.transformer(job_type);
            this.job_counts = job_counts;
            this.has_running = _.find(job_counts, 'status', 'RUNNING');
            this.description = this.getPerformance().rateDescription;
        };

        // public methods
        JobTypeStatus.prototype = {
            toString: function () {
                return 'JobTypeStatus';
            },
            getPerformance: function () {
                var failedArr = _.sortByOrder(_.filter(this.job_counts, { status: 'FAILED' }), ['count'], ['desc']),
                    completed = _.find(this.job_counts, 'status', 'COMPLETED') || { count: 0 },
                    failed = _.sum(failedArr, 'count'),
                    failedCategory = failedArr.length > 0 ? failedArr[0].category : '',
                    total = failedArr.length > 0 ? failed + completed.count : completed.count,
                    successRate = total === 0 ? 0 : 100 - ((failed / total) * 100).toFixed(2),
                    successRateDescription = 'success';

                if (successRate <= 30 && total > 0) {
                    successRateDescription = 'error';
                } else if (successRate > 30 && successRate <= 60 && total > 0) {
                    successRateDescription = 'warning';
                } else if (total === 0 && !this.has_running) {
                    successRateDescription = 'z_inactive'; // prepend with 'z_' for ordering purposes
                }

                return {
                    rate: successRate,
                    rateDescription: successRateDescription,
                    failed: failed,
                    failedCategory: failedCategory,
                    completed: completed.count,
                    total: total
                };
            },
            getRunning: function () {
                return _.find(this.job_counts, 'status', 'RUNNING') || { count: 0 };
            },
            getFailures: function () {
                var failed = _.where(this.job_counts, { 'status': 'FAILED' });

                _.forEach(failed, function (f) {
                    var category = _.find(scaleConfig.errorCategories, { name: f.category });
                    f.order = category ? category.order : '';
                });

                var failedValues = _.values(_.groupBy(failed, 'order'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count, order: val.order });
                        });
                    });
                    return _.sortByOrder(returnArr, ['order'], ['desc']);
                };

                return getFailureCounts(failedValues);
            },
            getCellFill: function () {
                var status = this.getPerformance();
                if (status.rateDescription === 'z_inactive') {
                    return scaleConfig.colors.chart_gray_dark;
                }
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                var running = this.getRunning();
                if (running.count > 0) {
                    return '&#x' + scaleConfig.activityIconCode + ';';
                }
                return '';
            },
            getCellActivityTotal: function () {
                return this.getRunning().count > 0 ? this.getRunning().count : '';
            },
            getCellError: function () {
                var performance = this.getPerformance();
                return 'Failed: ' + (performance.failed);
            },
            getCellTotal: function () {
                var performance = this.getPerformance();
                return performance.completed;
            },
            getCellPauseResume: function () {
                return;
            },
            getCellFailures: function () {
                return _.map(this.getFailures(), 'status');
            }
        };

        // static methods, assigned to class
        JobTypeStatus.build = function (data) {
            if (data) {
                return new JobTypeStatus(
                    data.job_type,
                    data.job_counts
                );
            }
            return new JobTypeStatus();
        };

        JobTypeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeStatus.build)
                    .filter(Boolean);
            }
            return JobTypeStatus.build(data);
        };

        return JobTypeStatus;
    }]);
})();

(function (){
    'use strict';

    angular.module('scaleApp').factory('Product', ['JobType', 'scaleService', 'scaleConfig', function (JobType, scaleService, scaleConfig) {
        var Product = function (id, workspace, file_name, media_type, file_size, data_type, is_deleted, uuid, url, created, deleted, data_started, data_ended, geometry, center_point, meta_data, countries, last_modified, is_operational, is_published, published, unpublished, job_type, job, job_exe, update, source_files) {
            this.id = id;
            this.workspace = workspace;
            this.file_name = file_name;
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_readable = this.getReadableFileSize();
            this.data_type = data_type;
            this.is_deleted = is_deleted;
            this.uuid = uuid;
            this.url = url;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.deleted = deleted;
            this.data_started = data_started;
            this.data_ended = data_ended;
            this.geometry = geometry;
            this.center_point = center_point;
            this.meta_data = meta_data;
            this.countries = countries;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.is_operational = is_operational;
            this.is_operational_label = is_operational ? 'Operational' : 'R&amp;D';
            this.is_published = is_published;
            this.published = published;
            this.unpublished = unpublished;
            this.job_type = JobType.transformer(job_type);
            this.job = job;
            this.job_exe = job_exe;
            this.update = update;
            this.source_files = source_files;
        };

        // public methods
        Product.prototype = {
            getDuration: function () {
                return moment.utc(this.last_modified).diff(moment.utc(this.created));
            },
            getReadableFileSize: function () {
                return scaleService.calculateFileSizeFromBytes(this.file_size);
            }
        };

        // static methods, assigned to class
        Product.build = function (data) {
            if (data) {
                return new Product(
                    data.id,
                    data.workspace,
                    data.file_name,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.is_deleted,
                    data.uuid,
                    data.url,
                    data.created,
                    data.deleted,
                    data.data_started,
                    data.data_ended,
                    data.geometry,
                    data.center_point,
                    data.meta_data,
                    data.countries,
                    data.last_modified,
                    data.is_operational,
                    data.is_published,
                    data.published,
                    data.unpublished,
                    data.job_type,
                    data.job,
                    data.job_exe,
                    data.update,
                    data.source_files
                );
            }
            return new Product();
        };

        Product.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Product.build)
                    .filter(Boolean);
            }
            return Product.build(data);
        };

        return Product;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RunningJob', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var RunningJob = function (count, longest_running, job_type) {
            this.count = count;
            this.longest_running = longest_running;
            this.job_type = JobType.transformer(job_type);
        };

        // public methods
        RunningJob.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_running, moment.utc().toISOString());
            },
            getIcon: function () {
                var icon = this.job_type.icon_code ? '<i class="fa fa-fw">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
                return icon;
            }
        };

        // static methods, assigned to class
        RunningJob.build = function (data) {
            if (data) {
                return new RunningJob(
                    data.count,
                    data.longest_running,
                    data.job_type
                );
            }
            return new RunningJob();
        };

        RunningJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RunningJob.build)
                    .filter(Boolean);
            }
            return RunningJob.build(data);
        };

        return RunningJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('SystemFailure', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var SystemFailure = function (count, job_type_name, job_type_version, error_name, first_error, last_error) {
            this.count = count;
            this.job_type_name = job_type_name;
            this.job_type_version = job_type_version;
            this.error_name = error_name;
            this.first_error = first_error;
            this.last_error = last_error;
        };

        // public methods
        SystemFailure.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.first_error, this.last_error);
            },
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type_name);
                if (configJobType) {
                    return configJobType.icon;
                }
                return scaleConfig.defaultIcon;
            }
        };

        // static methods, assigned to class
        SystemFailure.build = function (data) {
            if (data) {
                return new SystemFailure(
                    data.count,
                    data.job_type_name,
                    data.job_type_version,
                    data.error_name,
                    data.first_error,
                    data.last_error
                );
            }
            return new SystemFailure();
        };

        SystemFailure.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(SystemFailure.build)
                    .filter(Boolean);
            }
            return SystemFailure.build(data);
        };

        return SystemFailure;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('metricsController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'navService', 'metricsService', 'moment', function ($scope, $location, scaleConfig, scaleService, navService, metricsService, moment) {
        var vm = this,
            chart = null,
            colArr = [],
            colNames = {},
            xArr = [],
            removeIds = [],
            yUnits = [];

        vm._ = _;
        vm.moment = moment;
        vm.loadingMetrics = false;
        vm.chartArr = [];
        vm.chartData = [];
        vm.chartStyle = '';
        vm.selectedDataType = {};
        vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
        vm.inputEndDate = moment.utc().toDate();
        vm.openInputStart = function ($event) {
            $event.stopPropagation();
            vm.inputStartOpened = true;
        };
        vm.inputStartOpened = false;
        vm.openInputEnd = function ($event) {
            $event.stopPropagation();
            vm.inputEndOpened = true;
        };
        vm.inputEndOpened = false;
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.dataTypeFilterText = '';
        vm.filtersApplied = [];
        vm.filteredChoices = [];
        vm.filteredChoicesOptions = [];
        vm.selectedMetrics = [];
        vm.columnGroupsOptions = [];
        vm.columns = [];
        vm.groups = [];
        vm.chartTitle = '';
        vm.chartDisplay = 'stacked';
        vm.stackedClass = 'btn-primary';
        vm.groupedClass = 'btn-default';
        vm.subchartClass = 'btn-primary';
        vm.subchartEnabled = false;
        vm.chartType = 'bar';
        vm.chartTypeDisplay = 'Bar';
        vm.barClass = 'btn-primary';
        vm.areaClass = 'btn-default';
        vm.lineClass = 'btn-default';
        vm.splineClass = 'btn-default';
        vm.scatterClass = 'btn-default';
        vm.metricsTotal = 0;

        vm.getPlotDataParams = function (obj) {
            return {
                page: null,
                page_size: null,
                started: obj.started,
                ended: obj.ended,
                choice_id: obj.choice_id,
                column: obj.column,
                group: obj.group,
                dataType: obj.dataType.name
            };
        };

        vm.resetSelections = function () {
            vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
            vm.inputEndDate = moment.utc().toDate();
            vm.selectedDataType = {};
            vm.changeDataTypeSelection();
        };

        vm.updateChart = function () {
            vm.chartData = [];
            if (vm.chartArr.length === 0) {
                // nothing to show on chart
                chart.destroy();
                chart = null;
            } else {
                var callInit = _.after(vm.chartArr.length, function () {
                    // only initChart after this function has been called for all datasets in chartArr
                    vm.loadingMetrics = false;
                    vm.initChart();
                });

                _.forEach(vm.chartArr, function (obj) {
                    var params = vm.getPlotDataParams(obj);
                    metricsService.getPlotData(params).then(function (data) {
                    //metricsService.getGeneratedPlotData({query: obj, params: params}).then(function (data) {
                        vm.chartData.push({
                            query: obj,
                            results: data.results
                        });
                        callInit();
                    }).catch(function (error) {
                        vm.loadingMetrics = false;
                        console.log(error);
                        toastr['error'](error);
                    });
                });
            }
        };

        vm.addToChart = function () {
            vm.chartArr = []; // comment this out if allowing multiple adds
            vm.loadingMetrics = true;
            var filteredChoices = [],
                selectedColumns = [];
            // find the filter object associated with the chosen filter IDs
            _.forEach(vm.filtersApplied, function (id) {
                filteredChoices.push(_.find(vm.filteredChoices, { id: parseInt(id) }));
            });
            if (angular.isArray(vm.selectedMetrics)) {
                _.forEach(vm.selectedMetrics, function (metric) {
                    selectedColumns.push(_.find(vm.columns, { name: metric }));
                });
            } else {
                selectedColumns.push(_.find(vm.columns, { name: vm.selectedMetrics }));
            }
            vm.chartArr.push({
                started: vm.inputStartDate.toISOString(),
                ended: vm.inputEndDate.toISOString(),
                choice_id: vm.filtersApplied,
                column: _.pluck(selectedColumns, 'name'),
                group: null,
                dataType: vm.selectedDataType,
                filtersApplied: filteredChoices,
                selectedMetrics: selectedColumns
            });
            vm.updateChart();
            //vm.resetSelections();
        };

        vm.deleteFromChart = function (objToDelete) {
            _.remove(vm.chartArr, function (obj) {
                return JSON.stringify(obj) === JSON.stringify(objToDelete);
            });
            vm.updateChart();
        };

        vm.getFilterOptions = function (param) {
            return _.uniq(_.pluck(vm.filteredChoices, param));
        };

        vm.changeDataTypeSelection = function () {
            // reset options
            vm.filtersApplied = [];
            vm.selectedDataTypeOptions = [];
            vm.dataTypeFilterText = '';
            vm.selectedMetrics = [];
            vm.columns = [];

            if (!vm.selectedDataType.name || vm.selectedDataType.name === '') {
                vm.selectedDataType = {};
                vm.getDataTypes();
            } else {
                vm.getDataTypeOptions(vm.selectedDataType);
            }
        };

        vm.areFiltersApplied = function () {
            return vm.filtersApplied.length > 0;
        };

        vm.updateChartDisplay = function (display) {
            vm.chartDisplay = display;
            vm.stackedClass = display === 'stacked' ? 'btn-primary' : 'btn-default';
            vm.groupedClass = display === 'grouped' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.updateChartType = function (type) {
            vm.chartType = type;
            vm.chartTypeDisplay = _.capitalize(type);
            vm.barClass = type === 'bar' ? 'btn-primary' : 'btn-default';
            vm.areaClass = type === 'area' ? 'btn-primary' : 'btn-default';
            vm.lineClass = type === 'line' ? 'btn-primary' : 'btn-default';
            vm.splineClass = type === 'spline' ? 'btn-primary' : 'btn-default';
            vm.scatterClass = type === 'scatter' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.toggleSubchart = function () {
            vm.subchartEnabled = !vm.subchartEnabled;
            if (vm.subchartEnabled) {
                vm.subchartClass = 'btn-primary';
            } else {
                vm.subchartClass = 'btn-default';
            }
        };

        vm.initialize = function () {
            navService.updateLocation('metrics');
            vm.getDataTypes();
        };

        vm.getDataTypes = function () {
            metricsService.getDataTypes().then(function (result) {
                vm.availableDataTypes = result.results;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.getDataType = function (id) {
            metricsService.getDataTypeMetrics(id).then(function (result) {
                vm.selectedDataTypeAvailableMetrics = result.metrics;
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.getDataTypeOptions = function (dataType) {
            metricsService.getDataTypeOptions(dataType.name).then(function (result) {
                vm.selectedDataTypeOptions = result;
                _.forEach(result.filters, function (filter) {
                    vm.dataTypeFilterText = vm.dataTypeFilterText.length === 0 ? _.capitalize(filter.param) : vm.dataTypeFilterText + ', ' + _.capitalize(filter.param);
                });
                vm.filteredChoices = _.sortByOrder(result.choices, ['title','version'], ['asc','asc']);
                // format filteredChoices for use with multiselect directive
                var filteredChoicesOptions = [];
                _.forEach(vm.filteredChoices, function (choice) {
                    filteredChoicesOptions.push({
                        label: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        title: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        value: choice.id
                    });
                });
                vm.filteredChoicesOptions = filteredChoicesOptions;
                vm.columns = _.sortByOrder(result.columns, ['title'], ['asc']);
                vm.groups = result.groups;

                // create an array of objects containing grouped columns
                var columnGroupsOptions = [],
                    columnGroups = _.pairs(_.groupBy(result.columns, 'group'));
                _.forEach(columnGroups, function (group) {
                    var option = {
                        label: _.find(vm.groups, { name: group[0] }).title,
                        children: []
                    };
                    _.forEach(group[1], function (column) {
                        var child = {
                            label: column.title,
                            title: column.title,
                            value: column.name
                        };
                        option.children.push(child);
                    });
                    columnGroupsOptions.push(option);
                });
                columnGroupsOptions.unshift({
                    label: 'None Selected',
                    title: 'None Selected',
                    value: ''
                });
                vm.columnGroupsOptions = columnGroupsOptions;
            }).catch(function (error){
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.initialize();

        $scope.$watch('vm.inputEndDate', function (value) {
            console.log(value)
        });

        // set up chart
        vm.initChart = function () {
            // mark any existing data for removal
            // compare currCols (columns currently in the chart) with displayCols (columns to display)
            removeIds = [];
            vm.metricsTotal = 0;
            var currCols = [],
                displayCols = [];
            _.forEach(colArr, function (col, idx) {
                if (idx > 0) {
                    currCols.push(col[0]);
                }
            });
            _.forEach(vm.chartData, function (d) {
                displayCols = displayCols.concat(_.pluck(d.query.filtersApplied, 'name'));
                // increase metrics total if selected metric produces a sum
                // for now it is only possible to select one metric at a time
                // so just check the first element from selectedMetrics
                if (d.query.selectedMetrics[0].aggregate === 'sum') {
                    vm.metricsTotal = vm.metricsTotal + _.sum(d.results[0].values, 'value');
                }
            });
            if (vm.metricsTotal > 0) {
                vm.chartTitle = vm.chartData[0].query.selectedMetrics[0].title + ' for ' + moment.utc(vm.inputStartDate).format('DD MMM YYYY') + ' - ' + moment.utc(vm.inputEndDate).format('DD MMM YYYY') + ' (' + vm.metricsTotal.toLocaleString() + ')';
            } else {
                vm.chartTitle = vm.chartData[0].query.selectedMetrics[0].title + ' ' + moment.utc(vm.inputStartDate).format('DD MMM YYYY') + ' - ' + moment.utc(vm.inputEndDate).format('DD MMM YYYY');
            }
            // determine the exact differences between currCols and displayCols
            // if none are found, then removeIds stays empty
            _.forEach(currCols, function (currCol) {
                var displayCol = _.find(displayCols, function (dCol) {
                    return dCol === currCol;
                });
                if (!displayCol) {
                    removeIds.push(currCol);
                }
            });

            // init with new data
            colArr = [];
            xArr = [];
            colNames = {};

            // create xArr
            var numDays = moment.utc(vm.inputEndDate).endOf('d').diff(moment.utc(vm.inputStartDate.toISOString()).startOf('d'), 'd') + 1; // add 1 to include starting day in count
            for (var i = 0; i < numDays; i++) {
                xArr.push(moment.utc(vm.inputStartDate.toISOString()).startOf('d').add(i, 'd').toDate());
            }

            // iterate over datatypes and add values to colArr
            _.forEach(vm.chartData, function (data) {
                var valueArr = [],
                    query = data.query,
                    queryFilter = {},
                    queryDates = [];

                yUnits = _.pluck(query.selectedMetrics, 'units');

                if (query.filtersApplied.length > 0) {
                    // filters were applied, so build data source accordingly
                    _.forEach(data.results, function (result) {
                        if (result.values.length > 0) {
                            // values for all filters are returned in one array of arrays,
                            // so group results by id to isolate filter values
                            var groupedResult = _.groupBy(result.values, 'id'),
                                resultObj = {},
                                filterIds = _.pluck(query.filtersApplied, 'id');
                            // try to get each filter id from groupedResult.
                            // if it's undefined, an empty array will be returned
                            // this allows a zeroed array to appear in the chart,
                            // since we want to include all filters selected by the user
                            // regardless of value
                            if (filterIds.length > 1) {
                                // when more than one filter is requested, then an id
                                // value is present within data.results
                                _.forEach(filterIds, function (id) {
                                    resultObj[id] = _.get(groupedResult, id, []);
                                });
                            } else {
                                // when one filter is requested, no id value is included
                                // in data.results, so build resultObj with the other
                                // info we have
                                resultObj[query.choice_id[0]] = _.pairs(groupedResult)[0][1];
                            }
                            _.forEach(_.pairs(resultObj), function (d) {
                                valueArr = [];
                                // d[0] will be choice id, d[1] will be values
                                // if only one filter was selected, d[0] will return as string 'undefined' since no id is included in this case
                                queryFilter = d[0] === 'undefined' ? query.filtersApplied[0] : _.find(query.filtersApplied, {id: parseInt(d[0])});
                                queryDates = d[1];

                                // add result values to valueArr
                                _.forEach(xArr, function (xDate) {
                                    var valueObj = _.find(queryDates, function (qDate) {
                                        return moment.utc(qDate.date).isSame(xDate, 'day');
                                    });
                                    // push 0 if data for xDate is not present in queryDates
                                    valueArr.push(valueObj ? valueObj.value : 0);
                                });

                                // prepend valueArr with filter title, and push onto colArr
                                valueArr.unshift(queryFilter.name + queryFilter.id);
                                colNames[queryFilter.name + queryFilter.id] = queryFilter.version ? queryFilter.title + ' ' + queryFilter.version : queryFilter.title;
                                colArr.push(valueArr);
                            });
                        }
                    });
                } else {
                    // no filters were applied, so show aggregate statistics
                    _.forEach(data.results, function (result) {
                        // add result values to valueArr
                        _.forEach(xArr, function (xDate) {
                            var valueObj = _.find(result.values, function (qDate) {
                                return moment.utc(qDate.date).isSame(xDate, 'day');
                            });
                            // push 0 if data for xDate is not present in result.values
                            valueArr.push(valueObj ? valueObj.value : 0);
                        });

                        // prepend valueArr with filter title, and push onto colArr
                        var columnLabel = result.column.title + ' for all ' + query.dataType.title;
                        valueArr.unshift(columnLabel);
                        colNames['aggregate'] = columnLabel;
                        colArr.push(valueArr);
                    });
                }
            });

            // inform the user if the metrics they selected are empty
            if (_.sum(_.flatten(colArr)) === 0) {
                toastr['info']('There is no data to display.');
            }

            // prepend xArr with an 'x' label and add to colArr
            xArr.unshift('x');
            colArr.unshift(xArr);

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function (col) {
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = vm.chartType;
                    if (vm.chartDisplay === 'stacked') {
                        groups.push(col[0]);
                    }
                }
                angular.extend(types, type);
            });

            if (chart) {
                // chart already exists, so update values
                chart.groups([groups]);
                chart.data.names(colNames);
                chart.axis.labels({
                    y: _.capitalize(yUnits[0])
                });
                chart.load({
                    columns: colArr,
                    types: types,
                    unload: removeIds
                });
            } else {
                // no chart yet, so set it up
                chart = c3.generate({
                    bindto: '#metrics',
                    data: {
                        x: 'x',
                        columns: colArr,
                        types: types,
                        groups: [groups],
                        names: colNames
                    },
                    subchart: {
                        show: vm.subchartEnabled
                    },
                    transition: {
                        duration: 700
                    },
                    color: {
                        pattern: scaleConfig.colors.patternD320
                    },
                    axis: {
                        type: 'timeseries',
                        x: {
                            tick: {
                                format: function (d) {
                                    return moment.utc(d).toISOString();
                                }
                            },
                            label: {
                                text: 'Dates',
                                position: 'outer-center'
                            }
                        },
                        y: {
                            tick: {
                                format: function (d) {
                                    if (yUnits[0] === 'seconds') {
                                        return scaleService.calculateDuration(moment.utc().startOf('d'), moment.utc().startOf('d').add(d, 's'));
                                    } else if (yUnits[0] === 'bytes') {
                                        return scaleService.calculateFileSizeFromBytes(d, 1);
                                    }
                                    return d;
                                }
                            },
                            label: {
                                text: _.capitalize(yUnits[0]),
                                position: 'outer-middle'
                            }
                        }
                    }
                });
            }
        };

        // set chart height
        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                chartMaxHeight = viewport.height - offset;

            vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('metricsService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        var getPlotDataParams = function (page, page_size, started, ended, choice_id, column, group, dataType) {
            console.log(choice_id);
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                choice_id: choice_id,
                column: column,
                group: group,
                dataType: dataType
            };
        };

        return {
            getDataTypes: function () {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('metrics') + 'metrics/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeMetrics: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('metrics') + 'metrics/' + id + '/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeOptions: function (name) {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('metrics') + 'metrics/' + name + '/';
                $http.get(url).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getPlotData: function (params) {
                var params = params || getPlotDataParams(),
                    d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.getUrlPrefix('metrics') + 'metrics/' + params.dataType + '/plot-data/',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getGeneratedPlotData: function (obj) {
                var d = $q.defer();

                var returnObj = {
                    count: 28,
                    next: null,
                    previous: null,
                    results: []
                };

                var numDays = moment.utc(obj.params.ended).diff(moment.utc(obj.params.started), 'd') + 1;

                _.forEach(obj.query.selectedMetrics, function (metric) {
                    var returnResult = {
                        column: metric,
                        min_x: moment.utc(obj.params.started).format('YYYY-MM-DD'),
                        max_x: moment.utc(obj.params.ended).format('YYYY-MM-DD'),
                        min_y: 1,
                        max_y: 100,
                        values: []
                    };

                    for (var i = 0; i < numDays; i++) {
                        if (obj.query.filtersApplied.length > 1) {
                            _.forEach(obj.query.filtersApplied, function (filter) {
                                returnResult.values.push({
                                    date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                    value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1,
                                    id: filter.id
                                });
                            });
                        } else {
                            returnResult.values.push({
                                date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1
                            });
                        }
                    }
                    returnObj.results.push(returnResult);
                });

                d.resolve(returnObj);

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('navController', ['$scope', '$location', '$window', 'scaleConfig', 'scaleService', 'stateService', 'navService', function($scope, $location, $window, scaleConfig, scaleService, stateService, navService) {
        document.getElementsByTagName('body')[0].style.backgroundColor = scaleConfig.colors.nav_bg;

        var vm = this;

        vm.version = '';
        vm.activePage = 'overview';
        vm.docsUrl = scaleConfig.urls.documentation;

        vm.goto = function(loc) {
            $location.search('');
            $location.path(loc);
        };

        var locationUpdated = function() {
            vm.activePage = navService.location;
        };

        var initialize = function() {
            navService.registerObserver(locationUpdated);

            scaleService.getVersion().then(function (data) {
                vm.version = data.version;
                stateService.setVersion(data.version);
            });
        };
        initialize();
    }]);
})();

(function () {
    'use strict';
    /**
     * See: http://stackoverflow.com/questions/12576798/angularjs-how-to-watch-service-variables/17558885#17558885
     * Doing things this way so that ssNavbarController can get notified
     * when the location changes. Then, our controllers just need to call into
     * this service to updateLocation.
     *
     * The only thing I don't like about this is that the individual
     * controllers have to call in and tell the ssNavigationService what
     * page they are showing.
     */
    angular.module('scaleApp').service('navService', ['$location', function ($location) {

        this.location = 'overview'; // where the app starts

        var observers = [];

        this.registerObserver = function(callback) {
            observers.push(callback);
        };

        this.notifyObservers = function() {
            angular.forEach(observers, function(observer) {
                observer();
            });
        };

        this.updateLocation = function(locationIn) {
            this.location = locationIn;
            this.notifyObservers();
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('subnavService', ['$http', 'scaleConfig', function ($http, scaleConfig) {
        var currentPath = '';

        this.setCurrentPath = function (path) {
            currentPath = path;
        };

        this.getCurrentPath = function () {
            return currentPath;
        };
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('workspacesController', ['$scope', '$location', '$uibModal', '$routeParams', 'scaleConfig', 'navService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'gridFactory', 'Workspace', 'toastr', function ($scope, $location, $uibModal, $routeParams, scaleConfig, navService, workspacesService, scaleService, stateService, userService, gridFactory, Workspace, toastr) {
        var vm = this,
            currWorkspace = {},
            activeWorkspaces = [],
            inactiveWorkspaces = [];

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.showActive = stateService.getShowActiveWorkspaces();
        vm.workspaces = [];
        vm.localWorkspaces = [];
        vm.activeWorkspace = {};
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.brokerDescription = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the workspace
            vm.activeWorkspace = Workspace.transformer(_.cloneDeep(currWorkspace));
            if ($routeParams.id === '0') {
                $location.path('/workspaces');
            }
        };

        vm.editWorkspace = function () {
            // store a reference of the workspace as it currently exists in case the user cancels the edit
            currWorkspace = Workspace.transformer(_.cloneDeep(vm.activeWorkspace));
            vm.mode = 'edit';
        };

        vm.saveWorkspace = function () {
            workspacesService.saveWorkspace(vm.activeWorkspace).then(function (workspace) {
                vm.activeWorkspace = Workspace.transformer(workspace);
                if (scaleConfig.static) {
                    localStorage.setItem('workspace' + vm.activeWorkspace.id, JSON.stringify(vm.activeWorkspace));
                }
                vm.mode = 'view';
                getWorkspaces();
            }).catch(function () {
                
            });
        };

        vm.clearLocalWorkspaces = function () {
            _.forEach(vm.localWorkspaces, function (workspace) {
                localStorage.removeItem('workspace' + workspace.id);
            });
            $location.path('/workspaces');
        };
        
        vm.newWorkspace = function () {
            vm.mode = 'add';
            vm.loadWorkspace(0);
        };

        vm.loadWorkspace = function (id) {
            $location.path('workspaces/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateWorkspace = function () {
            vm.loading = true;
            workspacesService.validateWorkspace(vm.activeWorkspace).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Workspace is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        $scope.$watch('vm.activeWorkspace.json_config.broker.type', function (newValue) {
            if (newValue === 'nfs') {
                vm.brokerDescription = scaleConfig.nfsBrokerDescription;
            } else if (newValue === 'host') {
                vm.brokerDescription = scaleConfig.hostBrokerDescription;
            } else if (newValue === 's3') {
                vm.brokerDescription = scaleConfig.s3BrokerDescription;
            }
        });

        $scope.$watch('vm.showActive', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.showActive = newValue;
            stateService.setShowActiveWorkspaces(newValue);
            vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
        });

        var getWorkspaces = function () {
            vm.loading = true;
            workspacesService.getWorkspaces().then(function (data) {
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'workspace')) {
                            var type = JSON.parse(o[1]);
                            vm.localWorkspaces.push(type);
                            data.push(type);
                        }
                    });
                }
                activeWorkspaces = _.filter(data, { 'is_active': true });
                inactiveWorkspaces = _.filter(data, { 'is_active': false });
                vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
                vm.loading = false;
            }).catch(function (error) {
                vm.loading = false;
                console.log(error);
            });
        };

        var initialize = function () {
            getWorkspaces();
            vm.activeWorkspace = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeWorkspace = new Workspace();
                } else {
                    // set activeWorkspace = workspace details for id
                    workspacesService.getWorkspaceDetails(id).then(function (data) {
                        vm.activeWorkspace = Workspace.transformer(data);
                    });
                }
            }
            navService.updateLocation('workspaces');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset + 60;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Workspace', ['scaleConfig', function (scaleConfig) {
        var Workspace = function (id, name, title, description, base_url, is_active, used_size, total_size, created, archived, last_modified, json_config) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.base_url = base_url;
            this.is_active = is_active;
            this.used_size = used_size;
            this.total_size = total_size;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
            this.json_config = json_config || _.cloneDeep(scaleConfig.workspaceTypes[0]);
        };

        Workspace.prototype = {
            clean: function () {
                return {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    base_url: this.base_url,
                    is_active: this.is_active,
                    json_config: this.json_config
                };
            }
        };

        // static methods, assigned to class
        Workspace.build = function (data) {
            if (data) {
                return new Workspace(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.base_url,
                    data.is_active,
                    data.used_size,
                    data.total_size,
                    data.created,
                    data.archived,
                    data.last_modified,
                    data.json_config
                );
            }
            return new Workspace();
        };

        Workspace.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Workspace.build);
            }
            return Workspace.build(data);
        };

        return Workspace;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('workspacesService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getWorkspaces: function () {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('workspaces') + 'workspaces/';

                $http({
                    url: url,
                    method: 'GET',
                    params: { order: '-title' }
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getWorkspaceDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('workspaces') + 'workspaces/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateWorkspace: function (workspace) {
                var d = $q.defer();
                var cleanWorkspace = workspace.clean();

                $http.post(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/validation/', cleanWorkspace).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveWorkspace: function (workspace) {
                var d = $q.defer();

                if (!workspace.id) {
                    $http.post(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', workspace.clean()).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/' + workspace.id + '/', workspace.clean()).success(function (result) {
                        workspace = result;
                        d.resolve(workspace);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeDetailsController', ['$scope', '$location', '$routeParams', '$timeout', 'navService', 'nodeService', 'scaleService', function($scope, $location, $routeParams, $timeout, navService, nodeService, scaleService) {
        var vm = this;
        
        vm.loading = true;
        vm.nodeId = $routeParams.id;
        vm.scaleService = scaleService;

        var getNodeDetails = function (nodeId) {
            nodeService.getNode(nodeId).then( function (data) {
                vm.node = data;
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function() {
            navService.updateLocation('nodes');
            getNodeDetails(vm.nodeId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodesController', ['$scope', '$location', '$timeout', '$uibModal', 'navService', 'nodeService', 'stateService', 'userService', 'gridFactory', 'toastr', function($scope, $location, $timeout, $uibModal, navService, nodeService, stateService, userService, gridFactory, toastr) {
        var vm = this;

        vm.nodesParams = stateService.getNodesParams();

        vm.stateService = stateService;
        vm.nodeStatus = [];
        vm.loading = true;
        vm.loadingStatus = true;
        vm.readonly = true;
        vm.nodesError = null;
        vm.nodesErrorStatus = null;
        vm.statusError = null;
        vm.statusErrorStatus = null;
        vm.actionClicked = false;
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.nodesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.nodesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        $scope.pauseReason = '';

        var filteredByOrder = vm.nodesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'hostname',
                displayName: 'Hostname',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right" ng-show="!grid.appScope.vm.readonly && grid.appScope.vm.nodeStatus.length > 0"><button class="btn btn-xs btn-default" ng-click="grid.appScope.vm.pauseNode(row.entity)"><i class="fa" ng-class="{ \'fa-pause\': !row.entity.is_paused, \'fa-play\': row.entity.is_paused }"></i></button></div> {{ row.entity.hostname }}</div>'
            },
            {
                field: 'is_online',
                displayName: 'Status',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status"><span ng-bind-html="row.entity.statusLabel"></span></div>'
            },
            {
                field: 'id',
                displayName: 'Statistics',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status">{{ row.entity.status.getCellError() }} / {{ row.entity.status.getCellTotal() }}</div>'
            },
            {
                field: 'id',
                displayName: 'Current Jobs',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status"><span ng-bind-html="row.entity.status.getCellJobs()"></span></div>'
            }
        ];

        vm.gridOptions.columnDefs = vm.colDefs;

        vm.pauseNode = function (entity) {
            $scope.pauseReason = '';
            vm.actionClicked = true;
            var id = entity.id;
            var nodeStatus = _.find(vm.nodeStatus, { node: { id: id } });
            var curr_state = entity.is_paused;

            $scope.updateReason = function (value) {
                $scope.pauseReason = value;
            };

            var pauseResume = function () {

                nodeStatus.pauseResumeCell($scope.pauseReason).then(function (result) {
                    var node = _.find(vm.gridOptions.data, { id: result.id });
                    entity.is_paused = result.is_paused;
                    nodeStatus.node.is_paused = entity.is_paused;
                    entity.statusLabel = vm.getStatusLabel(nodeStatus);
                    if (curr_state === entity.is_paused) {
                        toastr.warning(entity.hostname + ' Status Unchanged');
                    } else if (entity.is_paused) {
                        toastr.info(node.hostname + ' Paused');
                    } else {
                        toastr.info(node.hostname + ' Resumed');
                    }
                });
            };

            // only prompt for reason when pausing (not resuming)
            if (!nodeStatus.node.is_paused && !nodeStatus.node.is_paused_errors) {
                var modalInstance = $uibModal.open({
                    animation: true,
                    templateUrl: 'pauseDialog.html',
                    scope: $scope
                });

                modalInstance.result.then(function () {
                    pauseResume();
                });
            } else {
                pauseResume();
            }
        };

        vm.getStatusLabel = function (status) {
            var online = status.is_online ? '<span class="label label-online">Online</span>' : '<span class="label label-offline">Offline</span>';
            var paused = status.node.is_paused ? '<span class="label label-paused">Paused</span>' : '';
            var pausedErrors = status.node.is_paused_errors ? '<span class="label label-paused-errors">Paused with Errors</span>' : '';
            return online + ' ' + paused + ' ' + pausedErrors;
        };

        vm.filterResults = function () {
            stateService.setNodesParams(vm.nodesParams);
            vm.loading = true;
            getNodes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.nodesParams);
        };

        vm.updateNodeOrder = function (sortArr) {
            vm.nodesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.search({});
                    $location.path('/nodes/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.nodesParams.page = currentPage;
                vm.nodesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setNodesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateNodeOrder(sortArr);
            });
        };

        var getNodes = function () {
            nodeService.getNodes(vm.nodesParams).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodesError = null;
                    vm.gridOptions.totalItems = data.count;
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodesErrorStatus = data.statusText;
                    }
                    vm.nodesError = 'Unable to retrieve nodes.';
                }
                vm.loading = false;
            })
        };

        var getNodeStatus = function () {
            nodeService.getNodeStatus(null, null, 'PT3H', null).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.statusError = null;
                    vm.nodeStatus = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.statusErrorStatus = data.statusText;
                    }
                    vm.statusError = 'Unable to retrieve node status.';
                }
                vm.loadingStatus = false;
            });
        };

        var initialize = function () {
            stateService.setNodesParams(vm.nodesParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            getNodes();
            getNodeStatus();
            navService.updateLocation('nodes');
        };

        initialize();

        $scope.$watchCollection('vm.stateService.getNodesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getNodesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.nodesParams = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.nodeStatus', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            _.forEach(vm.gridOptions.data, function (node) {
                var status = _.find(newValue, { node: { id: node.id } });
                if (status) {
                    node.status = status;
                    console.log('status changed');
                    node.statusLabel = vm.getStatusLabel(status);
                }
            });
        });
    }]);
})();
(function (){
    'use strict';

    angular.module('scaleApp').controller('aisNodeHealthController', ['$rootScope', '$scope', function ($rootScope, $scope) {
        var vm = this;
        
        vm.nodes = [];
        vm.nodesOffline = 0;
        vm.nodesPausedErrors = 0;
        vm.nodesPaused = 0;
        vm.nodesOfflineAndPaused = 0;
        vm.nodesOfflineAndPausedErrors = 0;
        vm.healthyNodes = 0;
        vm.totalNodes = 0;

        var getNodeStatus = function () {
            vm.totalNodes = vm.nodes.length;

            var nodesOffline = [],
                nodesPausedErrors = [],
                nodesPaused = [],
                nodesOfflineAndPausedErrors = [],
                nodesOfflineAndPaused = [];

            _.forEach(vm.nodes, function (n) {
                if (!n.is_online) {
                    // node is offline
                    if (n.node.is_paused_errors) {
                        nodesOfflineAndPausedErrors.push(n);
                    } else if (n.node.is_paused) {
                        nodesOfflineAndPaused.push(n);
                    } else {
                        nodesOffline.push(n);
                    }
                } else {
                    // node is online
                    if (n.node.is_paused_errors) {
                        nodesPausedErrors.push(n);
                    } else if (n.node.is_paused) {
                        nodesPaused.push(n);
                    }
                }
            });

            vm.nodesOffline = nodesOffline.length;
            vm.nodesPausedErrors = nodesPausedErrors.length;
            vm.nodesPaused = nodesPaused.length;
            vm.nodesOfflineAndPausedErrors = nodesOfflineAndPausedErrors.length;
            vm.nodesOfflineAndPaused = nodesOfflineAndPaused.length;

            // add the length of nodes both offline and paused to produce an accurate healthy count
            vm.healthyNodes = vm.totalNodes - vm.nodesOffline - vm.nodesPausedErrors - vm.nodesPaused - vm.nodesOfflineAndPaused - vm.nodesOfflineAndPausedErrors;

            var donutData = [];

            // determine percentage of healthy nodes, and breakdown of why nodes are unhealthy
            var gaugeData = vm.totalNodes > 0 ? ((vm.healthyNodes / vm.totalNodes) * 100).toFixed(2) : 0.00;

            if (vm.nodesOffline > 0) {
                donutData.push({
                    status: 'Offline',
                    count: vm.nodesOffline
                });
            }

            if (vm.nodesPausedErrors > 0) {
                donutData.push({
                    status: 'High Failure Rate',
                    count: vm.nodesPausedErrors
                });
            }

            if (vm.nodesPaused > 0) {
                donutData.push({
                    status: 'Paused',
                    count: vm.nodesPaused
                });
            }

            if (vm.nodesOfflineAndPaused) {
                donutData.push({
                    status: 'Offline and Paused',
                    count: vm.nodesOfflineAndPaused
                });
            }

            if (vm.nodesOfflineAndPausedErrors) {
                donutData.push({
                    status: 'Offline and Paused due to Errors',
                    count: vm.nodesOfflineAndPausedErrors
                });
            }

            vm.nodeHealth = {
                gaugeData: gaugeData,
                donutData: donutData
            };
        };

        $scope.$watch('data', function (newValue) {
            vm.nodes = newValue;
            getNodeStatus();
        });
    }]).directive('aisNodeHealth', function(){
        /**
         * Usage: <ais-node-health />
         **/
         return {
             controller: 'aisNodeHealthController',
             controllerAs: 'vm',
             templateUrl: 'modules/nodes/directives/nodeHealthTemplate.html',
             restrict: 'E',
             scope: {
                 data: '=',
                 duration: '=',
                 showDescription: '=',
                 loading: '='
             }
         };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeStatusGridController', ['$scope', '$location', function ($scope, $location) {
        var vm = this,
            cellSize = $scope.cellSize || '10px';

        vm.nodes = [];
        vm.hours = $scope.hours || 3;
        vm.cellStyle = {
            width: cellSize,
            height: cellSize
        };

        vm.getNodeClass = function (node) {
            console.log('getNodeClass');
            if (!node.is_online) {
                return 'offline';
            } else {
                if (node.node.is_paused) {
                    return 'is-paused';
                } else if (node.node.is_paused_errors) {
                    return 'is-paused-errors';
                }
            }
            return 'online';
        };

        vm.viewNode = function (id) {
            $location.path('nodes/' + id);
        };

        $scope.$watch('data', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            _.forEach(newValue, function (node) {
                if (!node.is_online) {
                    node.class = 'offline';
                } else {
                    if (node.node.is_paused) {
                        node.class = 'is-paused';
                    } else if (node.node.is_paused_errors) {
                        node.class = 'is-paused-errors';
                    } else {
                        node.class = 'online';
                    }
                }
            });
            vm.nodes = newValue;
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisNodeStatusGrid', function () {
        return {
            controller: 'nodeStatusGridController',
            controllerAs: 'vm',
            templateUrl: 'modules/nodes/directives/nodeStatusGridTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                hours: '=',
                cellSize: '@'
            }
        };
    });
})();
(function(){
    'use strict';

    angular.module('scaleApp').factory('Node', ['NodeResources', 'scaleService', function (NodeResources, scaleService) {
        var Node = function (id, hostname, port, slave_id, is_paused, is_paused_errors, is_active, archived, created, last_offer, last_modified, job_exes_running, resources) {
            this.id = id;
            this.hostname = hostname;
            this.port = port;
            this.slave_id = slave_id;
            this.is_paused = is_paused;
            this.is_paused_errors = is_paused_errors;
            this.is_active = is_active;
            this.archived = archived;
            this.created = created;
            this.last_offer = last_offer;
            this.last_modified = last_modified;
            this.job_exes_running = job_exes_running;
            this.resources = NodeResources.transformer(resources);
        };

        //public methods
        Node.prototype = {
            toString: function () {
                return 'Node';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getCellText: function () {
                // this is only used reveal = true on gridChart directive
                return this.hostname;
            },
            getCellTitle: function () {
                return this.hostname;
            },
            isPaused: function () {
                return this.is_paused;
            }
        };

        // static methods, assigned to class
        Node.build = function (data) {
            if (data) {
                return new Node(
                    data.id,
                    data.hostname,
                    data.port,
                    data.slave_id,
                    data.is_paused,
                    data.is_paused_errors,
                    data.is_active,
                    data.archived,
                    data.created,
                    data.last_offer,
                    data.last_modified,
                    data.job_exes_running,
                    data.resources
                );
            }
            return new Node();
        };

        Node.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Node.build);
            }
            return Node.build(data);
        };

        return Node;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('NodeResources', function(){
        var NodeResources = function (total, scheduled, used) {
            this.total = total;
            this.scheduled = scheduled;
            this.used = used;
        };

        //public methods
        NodeResources.prototype = {
            // getDuration: function() {
                //return scaleService.calculateDuration(this.created, this.last_modified);
            // }
        };

        // static methods, assigned to class
        NodeResources.build = function (data) {
            if (data) {
                return new NodeResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new NodeResources();
        };

        NodeResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeResources.build)
                    .filter(Boolean);
            }
            return NodeResources.build(data);
        };

        return NodeResources;
    });
})();

(function() {
    'use strict';

    angular.module('scaleApp').factory('NodeStatus', ['scaleConfig', 'nodeUpdateService', 'Node', 'JobExecution', function (scaleConfig, nodeUpdateService, Node, JobExecution) {
        var NodeStatus = function (node, is_online, job_exe_counts, job_exes_running) {
            this.node = Node.transformer(node);
            this.is_online = is_online;
            this.job_exe_counts = job_exe_counts;
            this.job_exes_running = JobExecution.transformer(job_exes_running);
        };

        //public methods
        NodeStatus.prototype = {
            toString: function () {
                return 'NodeStatus';
            },
            getCompleted: function () {
                var completed = _.find(this.job_exe_counts, 'status', 'COMPLETED');
                return completed ? completed.count : 0;
            },
            getFailed: function () {
                var failed = _.find(this.job_exe_counts, 'status', 'FAILED');
                return failed ? failed.count : 0;
            },
            getCellFill: function () {
                var color = '';
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        color = scaleConfig.colors.chart_orange;
                    } else if (this.node.is_paused) {
                        color = scaleConfig.colors.chart_yellow;
                    } else {
                        color = scaleConfig.colors.chart_green;
                    }
                } else {
                    color = scaleConfig.colors.chart_red;
                }
                return color;
            },
            getRunning: function () {
                return { count: 0 };
            },
            getCellError: function () {
                return 'Failed: ' + this.getFailed();
            },
            getCellTotal: function () {
                return 'Completed: ' + this.getCompleted();
            },
            getCellStatus: function () {
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        return 'High Failure Rate';
                    } else if (this.node.is_paused) {
                        return 'Paused';
                    } else {
                        return 'Online';
                    }
                } else {
                    return 'Offline';
                }
            },
            getCellJobs: function () {
                var text = '';
                _.forEach(this.job_exes_running, function (jobExecution) {
                    text = jobExecution.job.job_type.icon_code ?
                    text + ' ' + '<i class="fa fa-fw">&#x' + jobExecution.job.job_type.icon_code + '</i>' :
                    text + ' ' + '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
                });
                return text;
            },
            getCellPauseResume: function () {
                return this.node.is_paused ? '&#xf04b;' : '&#xf04c;';
            },
            pauseResumeCell: function (pause_reason) {
                var updateData = {
                    pause_reason: pause_reason || '',
                    is_paused: !this.node.is_paused
                };
                return nodeUpdateService.updateNode(this.node.id, updateData).then(function (result) {
                    return Node.transformer(result);
                }).catch(function (error) {
                    console.log(error);
                });
            }
        };

        // static methods, assigned to class
        NodeStatus.build = function (data) {
            if (data) {
                return new NodeStatus(
                    data.node,
                    data.is_online,
                    data.job_exe_counts,
                    data.job_exes_running
                );
            }
            return new NodeStatus();
        };

        NodeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeStatus.build);
            }
            return NodeStatus.build(data);
        };

        return NodeStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeService', ['$http', '$q', '$resource', 'scaleConfig', 'Node', 'NodeStatus', 'poller', 'pollerFactory', function ($http, $q, $resource, scaleConfig, Node, NodeStatus, poller, pollerFactory) {
        var getNodesParams = function (page, page_size, started, ended, order, include_inactive, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                include_inactive: include_inactive,
                url: url
            };
        };

        var getNodeStatusParams = function (page, page_size, started, ended) {
            var params = {};

            if(page) { params.page = page; }
            if(page_size) { params.page_size = page_size; }
            if(started) { params.started = started; }
            if(ended) { params.ended = ended; }

            return params;
        };

        return {
            getNodes: function (params) {
                params = params || getNodesParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('nodes') + 'nodes/';

                var nodesResource = $resource(params.url, params),
                    nodesPoller = pollerFactory.newPoller(nodesResource, scaleConfig.pollIntervals.nodes);

                return nodesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Node.transformer(data.results);
                    } else {
                        nodesPoller.stop();
                    }
                    return data;
                });
            },
            getNodesOnce: function (params) {
                params = params || getNodesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('nodes') + 'nodes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    var returnData = Node.transformer(data.nodes);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getNode: function (slaveId) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('nodes') + 'nodes/' + slaveId + '/').success(function (data) {
                    var returnData = Node.transformer(data);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeStatus: function (page, page_size, started, ended) {
                var params = getNodeStatusParams(page, page_size, started, ended);

                var nodeStatusResource = $resource(scaleConfig.getUrlPrefix('nodes') + 'nodes/status/', params),
                    nodeStatusPoller = pollerFactory.newPoller(nodeStatusResource, scaleConfig.pollIntervals.nodeStatus);

                return nodeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = NodeStatus.transformer(data.results);
                    } else {
                        nodeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getNodeStatusOnce: function (page, page_size, started, ended) {
                var d = $q.defer();
                var params = getNodeStatusParams(page, page_size, started, ended);
                $http({
                    url: scaleConfig.getUrlPrefix('nodes') + 'nodes/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = NodeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeData: function (slaveId, since) {
                var data = {},
                    self = this;

                since = since || 'PT3H';

                return self.getNodes().then(function (nodes) {
                    data.nodes = nodes;
                    return self.getNodeStatus(since).then(function (stats) {
                        data.stats = stats;
                        return data;
                    });
                });
            }
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeUpdateService', ['$http', '$q', 'scaleConfig', 'Node', function ($http, $q, scaleConfig, Node) {
        var getNodeUpdateData = function (pause_reason, is_paused) {
            return {
                pause_reason: pause_reason,
                is_paused: is_paused
            };
        };

        return {
            updateNode: function (id, data) {
                data = data || getNodeUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('nodes') + 'nodes/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(Node.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }])
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('ovController', ['$rootScope', '$scope', 'navService', 'nodeService', 'jobService', 'jobTypeService', 'statusService', 'gaugeFactory', 'scaleConfig', 'scaleService', 'schedulerService', 'userService', function($rootScope, $scope, navService, nodeService, jobService, jobTypeService, statusService, gaugeFactory, scaleConfig, scaleService, schedulerService, userService) {
        var vm = this;
        
        vm.date = new Date();
        vm.jobError = null;
        vm.jobErrorStatus = null;
        vm.loadingJobs = true;
        vm.loadingNodeHealth = true;
        vm.jobTypes = [];
        vm.nodes = [];
        vm.nodeHealthError = null;
        vm.nodeHealthErrorStatus = '';
        vm.hourValue = 3;
        vm.jobData = {
            data: null,
            status: null
        };
        vm.jobErrorBreakdown = [];
        vm.status = null;
        vm.statusError = null;
        vm.loadingStatus = true;
        vm.masterStatus = '';
        vm.masterStatusClass = 'alert-success';
        vm.schedulerStatus = '';
        vm.schedulerStatusClass = 'alert-success';
        vm.memCalc = '';
        vm.diskCalc = '';
        vm.schedulerIsPaused = false;
        vm.user = userService.getUserCreds();
        vm.schedulerContainerClass = vm.user ? vm.user.is_admin ? 'col-xs-8 col-lg-10' : 'col-xs-12' : 'col-xs-12';
        vm.schedulerBtnClass = 'fa-pause';

        vm.toggleScheduler = function () {
            vm.schedulerIsPaused = !vm.schedulerIsPaused;
            var schedulerData = {
                is_paused: vm.schedulerIsPaused
            };
            schedulerService.updateScheduler(schedulerData).then(function (data) {
                vm.schedulerStatus = data.is_paused ? 'Paused' : 'Running';
                vm.schedulerStatusClass = data.is_paused ? 'alert-warning' : 'alert-success';
                vm.schedulerBtnClass = data.is_paused ? 'fa-play' : 'fa-pause';
            }).catch(function (error) {
                console.log(error);
            });
        };

        var redrawGrid = function () {
            $scope.$broadcast('redrawGrid', vm.jobData);
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypes().then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobError = null;
                    vm.jobData.data = data.results;
                    redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobErrorStatus = data.statusText;
                    }
                    vm.jobError = 'Unable to retrieve job types.';
                }
                vm.loadingJobs = false;
            });
        };

        var getStatus = function () {
            var cpuGauge = gaugeFactory.createGauge('cpu', 'CPU', 0, 100, 180),
                memGauge = gaugeFactory.createGauge('memory', 'Memory', 0, 100, 180),
                diskGauge = gaugeFactory.createGauge('disk', 'Disk', 0, 100, 180);

            statusService.getStatus().then(null, null, function (result) {
                if (result.$resolved) {
                    vm.statusError = null;
                    vm.status = result;
                    cpuGauge.redraw(result.getCpuUsage());
                    memGauge.redraw(result.getMemUsage());
                    diskGauge.redraw(result.getDiskUsage());
                    vm.masterStatus = result.master.is_online ? 'Master is Online' : 'Master is Offline';
                    vm.masterStatusClass = result.master.is_online ? 'alert-success' : 'alert-danger';
                    if (result.scheduler.is_online) {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Paused' : 'Scheduler is Running';
                        vm.schedulerStatusClass = result.scheduler.is_paused ? 'alert-warning' : 'alert-success';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    } else {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Offline; Paused' : 'Scheduler is Offline';
                        vm.schedulerStatusClass = 'alert-danger';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    }
                    if (result.resources.scheduled.mem && result.resources.total.mem) {
                        vm.memCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.mem) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.mem);
                    }
                    if (result.resources.scheduled.disk && result.resources.total.disk) {
                        vm.diskCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.disk) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.disk);
                    }
                } else {
                    vm.statusError = result.statusText && result.statusText !== '' ? result.statusText : 'Unable to retrieve cluster status.';
                    cpuGauge.redraw(-1);
                    memGauge.redraw(-1);
                    diskGauge.redraw(-1);
                    vm.masterStatus = 'Master Status is Unknown';
                    vm.masterStatusClass = 'alert-danger';
                    vm.schedulerContainerClass = 'col-xs-12';
                    vm.schedulerStatus = 'Scheduler Status is Unknown';
                    vm.schedulerStatusClass = 'alert-danger';
                }
                vm.loadingStatus = false;
            });
        };

        var getNodeStatus = function () {
            nodeService.getNodeStatus(null, null, 'PT3H', null).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodeHealthError = null;
                    vm.nodes = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodeHealthErrorStatus = data.statusText;
                    }
                    vm.nodeHealthError = 'Unable to retrieve nodes.';
                }
                vm.loadingNodeHealth = false;
            });
        };

        $rootScope.$on('jobTypeStatus', function (event, data) {
            vm.jobData.status = data;
            redrawGrid();
        });

        var initialize = function () {
            getJobTypes();
            getStatus();
            getNodeStatus();
            navService.updateLocation('overview');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeDetailsController', ['$rootScope', '$scope', '$location', '$routeParams', 'navService', 'recipeService', 'scaleConfig', 'subnavService', 'userService', function ($rootScope, $scope, $location, $routeParams, navService, recipeService, scaleConfig, subnavService, userService) {

        var vm = this;

        vm.recipe = {};
        vm.recipeId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes');
        vm.loadingRecipeDetail = true;
        vm.activeTab = 'status';
        vm.lastStatusChange = '';

        vm.getRecipeDetail = function (recipeId) {
            vm.loadingRecipeDetail = true;
            recipeService.getRecipeDetails(recipeId).then(function (data) {
                vm.recipe = data;
                recipeService.getRecipeTypeDetail(data.recipe_type.id).then(function(recipeType){
                    vm.recipeType = recipeType;
                }).catch(function(error){
                   console.log(error);
                });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingRecipeDetail = false;
            });
        };

        vm.initialize = function () {
            navService.updateLocation('recipes');
            vm.getRecipeDetail(vm.recipeId);
        };



        vm.switchTab = function (tab) {
            $('#' + vm.activeTab).hide();
            vm.activeTab = tab;
            $('#' + vm.activeTab).show();
        };

        vm.initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeTypesController', ['$rootScope', '$scope', '$routeParams', '$location', '$uibModal', 'hotkeys', 'scaleService', 'navService', 'recipeService', 'subnavService', 'jobTypeService', 'scaleConfig', 'RecipeType', 'userService', 'localStorage', function ($rootScope, $scope, $routeParams, $location, $uibModal, hotkeys, scaleService, navService, recipeService, subnavService, jobTypeService, scaleConfig, RecipeType, userService, localStorage) {
        var vm = this;
        
        vm.loading = true;
        vm.containerStyle = '';
        vm.recipeTypes = [];
        vm.recipeTypeIds = [];
        vm.requestedRecipeTypeId = parseInt($routeParams.id);
        vm.activeRecipeType = null;
        vm.percentage = 73;
        vm.date = new Date();
        vm.recipes = null;
        vm.mode = 'view'; // valid values are add, view, and edit
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.isRecipeModified = false;
        vm.saveBtnClass = 'btn-default';
        vm.masterClass = 'col-xs-3';
        vm.detailClass = 'col-xs-9';
        vm.minimizeMaster = false;
        vm.minimizeBtnClass = 'fa fa-chevron-left';
        vm.user = userService.getUserCreds();
        vm.scaleConfig = scaleConfig;
        vm.localRecipeTypes = [];

        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes/types');

        var initialize = function () {
            navService.updateLocation('recipes');
            getRecipeTypes();
        };
        
        var getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypes = data.results;
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'recipeType')) {
                            var type = JSON.parse(o[1]);
                            vm.localRecipeTypes.push(type);
                            vm.recipeTypes.push(type);
                        }
                    });
                }
                vm.recipeTypeIds = _.pluck(data, 'id');
                vm.viewRecipeTypeDetail(vm.requestedRecipeTypeId);
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx > 0) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx < (vm.recipeTypeIds.length - 1)) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                if (vm.loading) {
                    vm.loading = false;
                }
            })
        };

        vm.clearLocalRecipeTypes = function () {
            _.forEach(vm.localRecipeTypes, function (type) {
                localStorage.removeItem('recipeType' + type.id);
            });
            $location.path('/recipes/types');
        };

        vm.newRecipeType = function(){
            $location.path('/recipes/types/0');
        };

        vm.viewRecipeTypeDetail = function (recipeTypeId) {
            if (recipeTypeId > 0) {
                recipeService.getRecipeTypeDetail(recipeTypeId).then(function (data) {
                    vm.activeRecipeType = data;
                });
            } else if( recipeTypeId === 0) {
                vm.activeRecipeType = new RecipeType();
            }
        };

        vm.loadRecipeType = function (id) {
            if (vm.activeRecipeType && vm.activeRecipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    $location.path('/recipes/types/' + id);
                }, function () {
                    // Cancel

                });
            } else {
                $location.path('/recipes/types/' + id);
            }
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        vm.toggleMaster = function (minimizeMaster) {
            if (typeof minimizeMaster !== 'undefined') {
                vm.minimizeMaster = minimizeMaster;
            } else {
                vm.minimizeMaster = !vm.minimizeMaster;
            }
            vm.masterClass = vm.minimizeMaster ? 'col-xs-1 minimized' : 'col-xs-3';
            vm.detailClass = vm.minimizeMaster ? 'col-xs-11' : 'col-xs-9';
            vm.minimizeBtnClass = vm.minimizeMaster ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
        };

        $rootScope.$on('toggleEdit', function (event, data) {
            vm.toggleMaster(data === 'edit');
        });

        initialize();

        $rootScope.$on('recipeModified', function () {
            vm.isRecipeModified = true;
            vm.saveBtnClass = 'btn-success';
        });

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('recipesController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'stateService', 'recipeService', 'navService', 'subnavService', 'gridFactory', function ($scope, $location, scaleConfig, scaleService, stateService, recipeService, navService, subnavService, gridFactory) {
        subnavService.setCurrentPath('recipes');

        var vm = this,
            recipeTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.recipesParams = stateService.getRecipesParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.recipeTypeValues = [recipeTypeViewAll];
        vm.selectedRecipeType = vm.recipesParams.type_id ? vm.recipesParams.type_id : recipeTypeViewAll;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        vm.lastModifiedStart = moment.utc(vm.recipesParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.recipesParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.recipesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.recipesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByRecipeType = vm.recipesParams.type_id ? true : false,
            filteredByOrder = vm.recipesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'recipe_type',
                displayName: 'Recipe Type',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'completed',
                enableFiltering: false,
                enableSorting: true,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.completed_formatted }}</div>'
            }
        ];

        vm.getRecipes = function () {
            recipeService.getRecipes(vm.recipesParams).then(function (data) {
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypeValues.push(data.results);
                vm.recipeTypeValues = _.flatten(vm.recipeTypeValues);
                vm.selectedRecipeType = _.find(vm.recipeTypeValues, { id: vm.recipesParams.type_id }) || recipeTypeViewAll;
                vm.getRecipes();
            }).catch(function (error) {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            stateService.setRecipesParams(vm.recipesParams);
            vm.loading = true;
            vm.getRecipes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.recipesParams);
        };

        vm.updateRecipeOrder = function (sortArr) {
            vm.recipesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateRecipeType = function (value) {
            if (value.id !== vm.recipesParams.type_id) {
                vm.recipesParams.page = 1;
            }
            vm.recipesParams.type_id = value.id === 0 ? null : value.id;
            vm.recipesParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.path('/recipes/recipe/' + row.entity.id);
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.recipesParams.page = currentPage;
                vm.recipesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setRecipesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateRecipeOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setRecipesParams(vm.recipesParams);
            vm.updateColDefs();
            vm.getRecipeTypes();
            navService.updateLocation('recipes');
        };

        vm.initialize();

        $scope.$watch('vm.selectedRecipeType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.recipeTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByRecipeType) {
                        vm.updateRecipeType(value);
                    }
                } else {
                    filteredByRecipeType = !angular.equals(value, recipeTypeViewAll);
                    vm.updateRecipeType(value);
                }
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.recipesParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.recipesParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getRecipesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getRecipesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.recipesParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
/**
 * <ais-scale-recipe-viewer />
 */
(function () {
    angular.module('scaleApp').controller('aisScaleRecipeGraphViewerController', ['$rootScope', '$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'jobTypeService', 'recipeService', 'workspacesService', 'RecipeType', 'RecipeTypeDetail', 'JobType', 'localStorage', function ($rootScope, $scope, $location, $uibModal, scaleConfig, scaleService, jobTypeService, recipeService, workspacesService, RecipeType, RecipeTypeDetail, JobType, localStorage) {
        var vm = this;
        
        vm.vertices = [];
        vm.edges = [];
        vm.selectedJob = null;
        vm.selectedInputProvider = null;
        vm.mode = null;
        vm.editMode = null;
        vm.dependencyBtnClass = 'fa-plus';
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.saveBtnClass = 'btn-default';
        vm.savingRecipe = false;
        vm.warnings = [];
        vm.readonly = true;
        vm.detailMaxHeight = 0;
        vm.recipeTypeTrigger = { dataTypes: '' };
        vm.detailContainerStyle = '';
        vm.containerClass = $scope.hasContainer ? '' : 'detail-container no-tabs';
        vm.lastStatusChange = '';
        vm.availableWorkspaces = [];
        vm.recipeInputTypes = [
            {
                name: 'property',
                title: 'Property',
                fields: []
            },
            {
                name: 'file',
                title: 'File',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            },
            {
                name: 'files',
                title: 'Files',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            }
        ];
        vm.availableTriggerTypes = scaleConfig.triggerTypes;
        vm.selectedRecipeInputType = {};
        vm.recipeInput = {
            name: '',
            required: true,
            type: ''
        };
        vm.isIE = scaleService.isIE();

        var startJob = null;
        var zoomScale = 0;

        // Dagre variables
        var svg = null;
        var inner = null;
        var graph = null;
        var zoom = null;
        var render = null;

        var getClosestNode = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d === name;
            });
        };

        var getOtherNodes = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d !== name;
            });
        };

        var resetEditBtn = function () {
            vm.editBtnText = vm.mode === 'edit' ? 'Cancel Edit' : 'Edit';
            vm.editBtnClass = vm.mode === 'edit' ? 'btn-warning' : 'btn-success';
            vm.editBtnIcon = vm.mode === 'edit' ? 'fa-close' : 'fa-edit';
        };

        var resetAddBtn = function () {
            vm.addBtnText = vm.mode === 'add' ? 'Cancel' : 'New Recipe';
            vm.addBtnClass = vm.mode === 'add' ? 'btn-warning' : 'btn-primary';
            vm.addBtnIcon = vm.mode === 'add' ? 'fa-close' : 'fa-plus-circle';
        };

        var toggleAddRecipe = function () {
            vm.mode = vm.mode === 'add' ? 'view' : 'add';
            resetAddBtn();
        };

        var toggleEditRecipe = function () {
            if (vm.mode === 'edit') {
                vm.mode = 'view';
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                vm.mode = 'edit';
            }
            vm.editMode = '';
            resetEditBtn();
        };

        var enableSaveRecipe = function () {
            $scope.recipeType.modified = true;
            vm.saveBtnClass = 'btn-success';
        };

        var disableSaveRecipe = function () {
            $scope.recipeType.modified = false;
            vm.saveBtnClass = 'btn-default;'
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        var getRecipeTypeJobClassName = function (job) {
            // default to 'nostatus'
            var className = 'nostatus';
            // find the associated job in the recipe.jobs
            if ($scope.recipe) {
                var recipejob = _.find($scope.recipe.jobs,{job_name: job.name});
                if (recipejob) {
                    className = recipejob.job.status.toLowerCase();
                }
            }
            return className;
        };

        vm.reloadRecipeTypeDetail = function (id) {
            var getRecipeDetail = function () {
                recipeService.getRecipeTypeDetail(id).then(function (data) {
                    $scope.recipeType = data;

                });
            };

            if ($scope.recipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    disableSaveRecipe();
                    resetAddBtn();
                    if (vm.mode === 'edit') {
                        toggleEditRecipe();
                    }
                    getRecipeDetail();
                }, function () {
                    // Cancel

                });
            } else {
                if (vm.mode === 'edit') {
                    toggleEditRecipe();
                }
                resetAddBtn();
                getRecipeDetail();
            }
        };

        vm.redraw = function () {
            initialize();
            //$rootScope.$broadcast('recipeModified');
        };

        vm.nodeClick = function (name) {
            // Remove selection class
            //$('div').removeClass('selected-node');
            d3.selectAll('.nodeRect').classed('selected-node', false);

            // find the job in the recipe definition
            var job = _.find($scope.recipeType.definition.jobs, { name: name });

            if (name === 'start') {
                job = startJob;
            }
            var $name = $('#' + name);
            var pos = $name.position();

            // click node different from selectedJob
            if (!vm.selectedJob || job.name !== vm.selectedJob.name) {
                if (vm.editMode === 'addDependency') {
                    addDependency(name);
                    enableSaveRecipe();
                    vm.redraw();

                } else if (vm.editMode === 'addInput') {
                    var contentStr = '';
                    if (job.name === 'start') {
                        contentStr = '<ul class="list-group">';
                        _.forEach($scope.recipeType.definition.input_data, function (recipeInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapInputRecipeInput(\'' + recipeInput.name + '\')">' + recipeInput.name + '</a>';
                            if (recipeInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + recipeInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select provider/output'
                        });
                        $name.popover('show');
                    } else {
                        if (job.job_type.job_type_interface.output_data.length > 0) {
                            contentStr = '<ul class="list-group">';
                            _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput) {
                                contentStr = contentStr + '<li class="list-group-item">';
                                contentStr = contentStr + '<a onclick="mapInput(\'' + job.name + '\', \'' + jobOutput.name + '\')">' + jobOutput.name + '</a>';
                                if (jobOutput.media_type) {
                                    contentStr = contentStr + '<div class="input-media-types">' + jobOutput.media_type + '</div>';
                                }
                                contentStr = contentStr + '</li>';
                            });
                            contentStr = contentStr + '</ul>';
                            $name.popover({
                                container: 'body',
                                content: contentStr,
                                html: true,
                                title: 'Select provider/output'
                            });
                            $name.popover('show');
                        }
                    }
                } else if (vm.editMode === 'addOutput') {
                    vm.selectedOutputReceiver = job;
                    if (job.job_type.job_type_interface.input_data.length > 0) {
                        contentStr = '<ul class="list-group">';
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapOutput(\'' + job.name + '\', \'' + jobInput.name + '\')">' + jobInput.name + '</a>';
                            if (jobInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + jobInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select receiver/input'
                        });
                        $name.popover('show');
                    }
                } else {
                    // update the selected job
                    vm.selectedJob = job;
                    if ($scope.recipe) {
                        vm.selectedRecipeJob = _.find($scope.recipe.jobs, { job_name: job.name });
                    }
                    // apply the selected-node class
                    //$name.addClass('selected-node');
                    getClosestNode(name).classed('selected-node', true);
                }
            }
            else { // click selected node
                //$('div').removeClass('selected-node');
                d3.selectAll('.nodeRect').classed('selected-node', false);
                vm.selectedJob = null;
                vm.selectedRecipeJob = null;
                vm.selectedOutputReceiver = null;
                vm.selectedInputProvider = null;
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';

                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
                getOtherNodes(name).classed('selected-node-selectable', false);
            }
            if (vm.selectedJob) {
                //$('#' + vm.selectedJob.name).addClass('selected-node');
                getClosestNode(vm.selectedJob.name).classed('selected-node', true);
            }
        };
        vm.toggleEditMode = function () {
            if (vm.mode === 'edit') {
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                toggleEditRecipe();
                resetAddBtn();
            }
            $rootScope.$broadcast('toggleEdit', vm.mode);
        };

        vm.openAddJob = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addJobContent.html',
                scope: $scope,
                size: 'sm'
            });

            modalInstance.result.then(function () {
                if (vm.selectedJobType) {
                    jobTypeService.getJobTypeDetails(vm.selectedJobType.id).then(function (data) {
                        vm.addJobType(data);
                        enableSaveRecipe();
                    });
                }
            }, function () {

            });
        };

        vm.openEditTrigger = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'editTrigger.html',
                scope: $scope,
                size: 'md'
            });

            modalInstance.result.then(function () {
                if (vm.mode === 'edit' || vm.mode === 'add') {
                    $scope.recipeType.trigger_rule.configuration.condition.data_types = vm.recipeTypeTrigger.dataTypes ? vm.recipeTypeTrigger.dataTypes.split(',') : [];
                    enableSaveRecipe();
                }
            }, function () {

            });


        };

        vm.deleteRecipeInput = function (inputName) {
            var removedRecipeInput = _.remove($scope.recipeType.definition.input_data, function (recipeInput) {
                return recipeInput.name === inputName;
            });
            console.log('removed ' + removedRecipeInput.length + ' recipe inputs.');
            enableSaveRecipe();
            vm.redraw();

        };

        vm.openAddInput = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addInput.html',
                scope: $scope
            });

            modalInstance.result.then(function () {
                // check for fields and add as necessary
                if ( vm.selectedRecipeInputType.fields.length > 0) {
                    var fieldArr = [];
                    _.forEach(vm.selectedRecipeInputType.fields, function (field) {
                        _.forEach(field.value.split(','), function (value) {
                            fieldArr.push(value);
                        });
                        vm.recipeInput[field.name] = fieldArr;
                    });
                }

                // add input to recipe type definition
                $scope.recipeType.definition.input_data.push(vm.recipeInput);
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    if (job.recipe_inputs.length === 0) {
                        job.recipe_inputs.push({
                            job_input: vm.recipeInput.name,
                            recipe_input: vm.recipeInput.name
                        });
                    }
                });
                getIoMappings();

                // reset form fields
                vm.recipeInput = {
                    name: '',
                    required: true,
                    type: ''
                };
                vm.selectedRecipeInputType = {};
            });
        };

        vm.changeInputType = function () {
            vm.selectedRecipeInputType = _.find(vm.recipeInputTypes, {'name': vm.recipeInput.type});
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateRecipeType = function () {
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                } else {
                    toastr["success"]('Recipe is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr["error"](error.detail);
                } else {
                    toastr["error"](error);
                }
            });

        };


        vm.saveRecipeType = function () {
            vm.savingRecipe = true;
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                    vm.savingRecipe = false;
                } else {
                    recipeService.saveRecipeType($scope.recipeType).then(function (saveResult) {
                        vm.savingRecipe = false;
                        $scope.recipeType = RecipeTypeDetail.transformer(saveResult);
                        if (scaleConfig.static) {
                            console.log(JSON.stringify($scope.recipeType));
                            localStorage.setItem('recipeType' + $scope.recipeType.id, JSON.stringify($scope.recipeType));
                        }
                        vm.redraw();
                        $location.path('/recipes/types/' + $scope.recipeType.id);
                    });
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
                vm.savingRecipe = false;
            });

            disableSaveRecipe();
        };

        vm.addJobType = function (selectedJobType) {
            console.log(selectedJobType.name);
            $scope.recipeType.definition.addJob(selectedJobType);
            //$scope.$broadcast('redrawRecipes');
            vm.redraw();
        };

        vm.mapInput = function (providerName, providerOutput) {
            console.log('map selected job input to ' + providerName + '.' + providerOutput);
            var dependency = _.find(vm.selectedJob.dependencies, {name: providerName});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: providerOutput, input: vm.selectedJobInput.name });
                if (!conn) {
                    dependency.connections.push({ output: providerOutput, input: vm.selectedJobInput.name });
                }
            }
            else if (!dependency) {
                dependency = {name: providerName, connections: [{ output: providerOutput, input: vm.selectedJobInput.name }]};
                vm.selectedJob.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{ output: providerOutput, input: vm.selectedJobInput.name }];
            }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.mapInputRecipeInput = function (recipeInput) {
            console.log('map selected job to recipe input ' + recipeInput);
            var existingInput = _.find(vm.selectedJob.recipe_inputs, { job_input: vm.selectedJobInput.name });
            if ( existingInput && existingInput.recipe_name !== recipeInput) {
                // update it
                existingInput.recipe_input = recipeInput;
                enableSaveRecipe();
                vm.redraw();
            } else if ( !existingInput ) {
                // create it
                vm.selectedJob.recipe_inputs.push({
                    job_input: vm.selectedJobInput.name,
                    recipe_input: recipeInput
                });
                enableSaveRecipe();
                vm.redraw();
            }
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
        };

        vm.mapOutput = function (receiverName, receiverInput) {
            var dependency = _.find(vm.selectedOutputReceiver.dependencies, {name: vm.selectedJob.name});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: vm.selectedJobOutput.name, input: receiverInput });
                if (!conn) {
                    dependency.connections.push({output: vm.selectedJobOutput.name, input: receiverInput});
                }
            }
            else if (!dependency) {
                dependency = {name: vm.selectedJob.name, connections: [{output: vm.selectedJobOutput.name, input: receiverInput}]};
                vm.selectedOutputReceiver.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{output: vm.selectedJobOutput.name, input: receiverInput}];
            }
            vm.selectedOutputReceiver.depStart = false;
            vm.editMode = '';
            vm.selectedJobOutput = null;
            vm.selectedOutputReceiver = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.toggleAddDependency = function () {
            if (vm.editMode === 'addDependency') {
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                console.log('toggle addDependency mode');
                vm.editMode = 'addDependency';
                vm.dependencyBtnClass = 'fa-remove';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddInput = function (jobinput) {
            if (vm.editMode === 'addInput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobInput = jobinput;
                console.log('toggle addInput mode');
                vm.editMode = 'addInput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddOutput = function (joboutput) {
            if (vm.editMode === 'addOutput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobOutput = joboutput;
                console.log('toggle addOutput mode');
                vm.editMode = 'addOutput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.removeDependency = function (depName) {
            var removedDeps = _.remove(vm.selectedJob.dependencies, function (dep) {
                return dep.name === depName;
            });
            console.log('removed ' + removedDeps.length + ' dependencies.');
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeInputMapping = function (depName, depOutput) {
            if ( depName === 'recipe' ) {
                // remove it from selectedJob.recipe_inputs
                var dep = _.remove(vm.selectedJob.recipe_inputs, { recipe_input: depOutput });
                enableSaveRecipe();
                vm.redraw();
            } else {
                var dep = _.find(vm.selectedJob.dependencies, {name: depName});
                if (dep && dep.connections) {
                    // it's an input from another job
                    var removedCon = _.remove(dep.connections, function (conn) {
                        return conn.output === depOutput;
                    });
                    console.log('removed ' + removedCon.length + ' input connections.');
                    enableSaveRecipe();
                    vm.redraw();
                }
            }

        };

        vm.deleteRecipeJob = function (jobName) {
            // remove dependent connections
            _.forEach($scope.recipeType.definition.jobs, function (job) {
                _.remove(job.dependencies, {name: jobName});
            });
            // remove job from definition.jobs
            _.remove($scope.recipeType.definition.jobs, { name: jobName });
            // enable save and redraw
            vm.selectedJob = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeOutputMapping = function (jobName, depOutput) {
            // we have to remove output mapping from the job where the dependency is defined
            var receiver = _.find($scope.recipeType.definition.jobs,{name: jobName});
            // remove it from receiver.dependencies
            var dep = _.find(receiver.dependencies, {name: vm.selectedJob.name});
            if (dep && dep.connections) {
                var removedCon = _.remove(dep.connections, function (conn) {
                    return conn.output === depOutput;
                });
                console.log('removed ' + removedCon.length + ' output connections.');
                enableSaveRecipe();
                vm.redraw();
            }
        };

        vm.selectJobTypeToAdd = function (item) {
            vm.selectedJobType = item;
        };

        $scope.$on('redrawRecipes', function () {
            vm.redraw();
        });

        var addDependency = function (jobName) {
            console.log(vm.selectedJob.name + '->' + jobName);
            if (!vm.selectedJob.dependencies) {
                vm.selectedJob.dependencies = [];
            }
            var existingDependency = _.find(vm.selectedJob.dependencies, {name: jobName});

            if (!existingDependency) { vm.selectedJob.dependencies.push({name: jobName}); }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.dependencyBtnClass = 'fa-plus';

        };

        var getIoMappings = function () {
            if ($scope.recipeType.definition) {
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    // populate the current jobType
                    /*var thisJobType = _.find($scope.recipeType.job_types,{id: job.job_type_id});
                    job.job_type = thisJobType;*/

                    // find dependents
                    if (job.job_type && job.job_type.job_type_interface) {
                        _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput, key) {
                            if (jobOutput) {
                                var deps = getDependents(job.name,jobOutput.name);
                                jobOutput.dependents = deps;
                            }
                        });
                        // add dependency mappings
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput, key) {
                            if (jobInput) {
                                var inputMappings = [];
                                _.forEach(job.dependencies, function (dependency,key) {
                                    _.forEach(dependency.connections, function (conn,key) {
                                        if (conn.input === jobInput.name) {
                                            inputMappings.push({
                                                name: dependency.name,
                                                output: conn.output,
                                                input: conn.input
                                            });
                                        }
                                    });
                                });
                                _.forEach(job.recipe_inputs, function (recipeInput, key) {
                                    if (recipeInput.job_input === jobInput.name) {
                                        inputMappings.push({
                                            name: 'recipe',
                                            output: recipeInput.recipe_input,
                                            input: recipeInput.job_input
                                        });
                                    }
                                });
                                jobInput.dependencies = inputMappings;
                            }
                        });

                    }
                });
            }

        };

        var initialize = function () {

            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues = data.results;
            });

            workspacesService.getWorkspaces().then(function (data) {
                vm.availableWorkspaces = data
            });

            $scope.$watchCollection('recipeType', function (newValue, oldValue) {
                if (!$scope.recipeType) {
                    $scope.recipeType = new RecipeType();
                }

                if (typeof $scope.recipeType.id === 'undefined' || $scope.recipeType.id === null || $scope.recipeType.id === 0) {
                    vm.mode = 'add';
                } else {
                    if (vm.mode !== 'edit') {
                        vm.mode = 'view'
                    }
                }
                _.forEach($scope.recipeType.definition.jobs, function (job, idx) {
                    if (!job.job_type.job_type_interface && $scope.recipeType.job_types) {
                        var jobTypeData = _.find($scope.recipeType.job_types, {name: job.job_type.name, version: job.job_type.version});
                        $scope.recipeType.definition.jobs[idx].job_type = jobTypeData;
                    }
                });

                // setup string to bind comma delimited list of trigger rule configuration condition data types
                if ($scope.recipeType.trigger_rule) {
                    if ($scope.recipeType.trigger_rule.configuration) {
                        if ($scope.recipeType.trigger_rule.configuration.condition) {
                            if ($scope.recipeType.trigger_rule.configuration.condition.data_types) {
                                vm.recipeTypeTrigger.dataTypes = $scope.recipeType.trigger_rule.configuration.condition.data_types.join(',');
                            }
                        }
                    }
                }

                initGraph();
                getIoMappings();
                drawGraph();
            });
            if ($scope.$parent.vm.user) {
                vm.readonly = false;
            }
        };

        var initGraph = function () {
            // ******
            // setup D3 container and Graph
            // ******
            //vm.selectedJob = null;
            function clicked() {
                var d = d3.event;
                var x = d3.event.x;
                var y = d3.event.y;
                var width = parseInt(svg.style("width").replace(/px/, ""));
                var height = parseInt(svg.style("height").replace(/px/, ""));

                inner.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(2)translate(" + -x + "," + -y + ")");

                //inner.attr("transform", "translate(50px, 50px)scale(2,3)");

                console.log(d);
            }

            svg = d3.select("svg");
            inner = svg.select("g"); //.on("click", clicked);
            // Set up zoom support
            zoom = d3.behavior.zoom().on("zoom", function () {
                zoomScale = d3.event.scale;
                inner.attr("transform", "translate(" + d3.event.translate + ")" +
                    "scale(" + zoomScale + ")");
            });
            svg.call(zoom);

            render = new dagreD3.render();

            // Left-to-right layout
            graph = new dagreD3.graphlib.Graph();
            graph.setGraph({
                nodesep: 70,
                ranksep: 50,
                rankdir: "TB",
                marginx: 20,
                marginy: 20
            });
        };

        drawGraph = function () {
            // globals because dagre needs a reference to angular scope
            window.nodeClick = function (name) {
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.nodeClick(name);
                });
            };

            window.mapInput = function (jobName, jobOutput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInput(jobName, jobOutput);
                });
            };

            window.mapInputRecipeInput = function (recipeInputName) {
                $('#start').popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInputRecipeInput(recipeInputName);
                });
            };

            window.mapOutput = function (jobName, jobInput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapOutput(jobName, jobInput);
                });
            };

            if ($scope.recipe) {
                vm.lastStatusChange = $scope.recipe.last_modified ? moment.duration(moment.utc($scope.recipe.last_modified).diff(moment.utc())).humanize(true) : '';
            }

            var jobs = [];
            if ($scope.recipeType.definition) {
                jobs = $scope.recipeType.definition.jobs;
            }
            var childCounts = [];
            // create graph objects
            for (var idx in jobs) {
                var job = jobs[idx];

                if (job.dependencies === undefined || job.dependencies.length < 1) {
                    job.depStart = true;
                }
                var className = getRecipeTypeJobClassName(job);

                var html = '<div class="recipeNode">';
                //var html = "<div onclick=\"console.log('" + job.job_type.name + "')\">";
                if (className !== 'nostatus') {
                    html += '<span class="status"></span>';
                }
                //   html += "<span class=consumers>"+worker.consumers+"</span>";
                html += '<span class="name">';
                if (job.job_type) {
                    //console.log(job.jobType);
                    html += '<div id="' + job.name + '" class="" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + job.job_type.getIcon() + ' ' + job.name + '</span></div>';
                    //if (jobType.name) {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + jobType.title + '</span></div>';
                    //} else {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + job.name + '</span></div>';
                    //}

                }
                html += '</span>';
                //   html += "<span class=queue><span class=counter>"+worker.count+"</span></span>";
                html += '</div>';
                graph.setNode(job.name, {
                    labelType: 'html',
                    label: html,
                    rx: 5,
                    ry: 5,
                    padding: 0,
                    class: className
                });
                // setup edges
                for (var d in job.dependencies) {
                    var dep = job.dependencies[d];

                    if (dep.name) {
                        graph.setEdge(dep.name, job.name, {
                            //labelType: 'html',
                            //label: dep.name + '-->' + job.name,
                            width: 20

                        });
                        if (childCounts[dep.name]) {
                            childCounts[dep.name] += 1;
                        } else {
                            childCounts[dep.name] = 1;
                        }
                    }
                }
            }

            // set start node and edges
            graph.setNode('start', {
                labelType: 'html',
                label: '<div id="start" class="recipeNode" onclick="nodeClick(\'start\')"><span class=name>Start</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            startJob = {
                name: 'start',
                job_type: {
                    title: 'Start'
                },
                input_data: $scope.recipeType.input_data
            };
            var noDeps = _.filter(jobs, 'depStart', true);
            for (var n in noDeps) {
                graph.setEdge('start', noDeps[n].name, {
                    width: 20
                });
            }

            // set end node and edges
            graph.setNode('end', {
                labelType: 'html',
                label: '<div class="recipeNode"><span class="name">End</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            var noChildren =_.filter(jobs, function (job) {
                return !childCounts[job.name];
            });
            for (var o in noChildren) {
                graph.setEdge(noChildren[o].name, 'end', {
                    width: 20
                });
            }

            // wait for current call stack to clear
            _.defer(function () {
                inner.call(render, graph);
                zoom.event(d3.select("svg"));

                $('.node rect').attr('class', 'nodeRect');

                // add selected class to appropriate node
                if (vm.selectedJob) {
                    //$('#' + vm.selectedJob.name).addClass('selected-node');
                    getClosestNode(vm.selectedJob.name).classed('selected-node', true);
                }
            });
        };

        var getDependents = function (name,outputName) {
            var results = [];

            _.forEach($scope.recipeType.definition.jobs, function (job, key) {
                if (job.name !== name) {
                    _.forEach(job.dependencies, function (dependency, key) {
                        if (dependency.name === name) {
                            _.forEach(dependency.connections, function (conn, key) {
                                if (conn.output === outputName) {
                                    results.push({
                                        name: job.name,
                                        output: conn.output,
                                        input: conn.input
                                    });
                                }
                            });
                        }
                    });
                }
            });
            return results;
        };

        initialize();

    }]).directive('aisScaleRecipeGraphViewer', function () {
        'use strict';
        /**
         * Usage: <ais-scale-recipe-viewer recipe="recipe" />
         */
        return {
            controller: 'aisScaleRecipeGraphViewerController',
            controllerAs: 'vm',
            templateUrl: 'modules/recipes/partials/recipeGraphViewerTemplate.html',
            restrict: 'E',
            scope: {
                recipeType: '=',
                recipe: '=',
                isModified: '=modified',
                allowEdit: '=',
                hasContainer: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Recipe', ['scaleConfig', 'RecipeType', 'scaleService', function (scaleConfig, RecipeType, scaleService) {
        var Recipe = function (id, created, completed, last_modified, recipe_type) {
            this.id = id;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.completed = completed;
            this.completed_formatted = completed ? moment.utc(completed).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_status_change = last_modified ? moment.duration(moment.utc(last_modified).diff(moment.utc())).humanize(true) : '';
            this.recipe_type = RecipeType.transformer(recipe_type);
        };

        // public methods
        Recipe.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            }
        };

        // static methods, assigned to class
        Recipe.build = function (data) {
            if (data) {
                return new Recipe(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.recipe_type
                );
            }
            return new Recipe();
        };

        Recipe.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Recipe.build)
                    .filter(Boolean);
            }
            return Recipe.build(data);
        };

        return Recipe;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeData', function () {
        var RecipeData = function (input_data, version, workspace_id) {
            this.input_data = input_data;
            this.version = version;
            this.workspace_id = workspace_id;
        };

        // static methods, assigned to class
        RecipeData.build = function (data) {
            if (data) {
                return new RecipeData(
                    data.input_data,
                    data.version,
                    data.workspace_id
                );
            }
            return new RecipeData();
        };

        RecipeData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeData.build)
                    .filter(Boolean);
            }
            return RecipeData.build(data);
        };

        return RecipeData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeDetails', ['RecipeData', 'RecipeTypeDefinition', 'RecipeType', 'RecipeTypeDetail', 'RecipeJobContainer', 'scaleConfig', function (RecipeData, RecipeTypeDefinition, RecipeType, RecipeTypeDetail, RecipeJobContainer, scaleConfig) {
        var RecipeDetails = function (id, created, completed, last_modified, data, recipe_type, recipe_type_rev, jobs,
                                      is_superseded, root_superseded_recipe, superseded_recipe,
                                      superseded_by_recipe, superseded) {
            this.id = id;
            this.created = created;
            this.completed = completed;
            this.completed_formatted = this.completed ? moment.utc(this.completed).format(scaleConfig.dateFormats.day_second_utc) : this.completed;
            this.last_modified = last_modified;
            this.data = RecipeData.transformer(data);
            this.recipe_type = RecipeType.transformer(recipe_type);
            this.recipe_type_rev = RecipeTypeDetail.transformer(recipe_type_rev);
            this.jobs = RecipeJobContainer.transformer(jobs);
            this.is_superseded = is_superseded;
            this.root_superseded_recipe = root_superseded_recipe;
            this.superseded_recipe = superseded_recipe;
            this.superseded_by_recipe = superseded_by_recipe;
            this.superseded = superseded;
        };

        // static methods, assigned to class
        RecipeDetails.build = function (data) {
            if (data) {
                return new RecipeDetails(
                  data.id,
                  data.created,
                  data.completed,
                  data.last_modified,
                  data.data,
                  data.recipe_type,
                  data.recipe_type_rev,
                  data.jobs,
                  data.is_superseded,
                  data.root_superseded_recipe,
                  data.superseded_recipe,
                  data.superseded_by_recipe,
                  data.superseded
                );
            }
            return new RecipeDetails();
        };

        RecipeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                  .map(RecipeDetails.build)
                  .filter(Boolean);
            }
            return RecipeDetails.build(data);
        };

        return RecipeDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJob', ['JobType', function (JobType) {
        var RecipeJob = function (id, status, job_type) {
            this.id = id;
            this.status = status;
            this.job_type = JobType.transformer(job_type);
        };

        // static methods, assigned to class
        RecipeJob.build = function (data) {
            if (data) {
                return new RecipeJob(
                    data.id,
                    data.status,
                    data.job_type
                );
            }
            return new RecipeJob();
        };

        RecipeJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJob.build)
                    .filter(Boolean);
            }
            return RecipeJob.build(data);
        };

        return RecipeJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJobContainer', ['RecipeJob', function (RecipeJob) {
        var RecipeJobContainer = function (job_name, job) {
            this.job_name = job_name;
            this.job = RecipeJob.transformer(job);
        };

        // static methods, assigned to class
        RecipeJobContainer.build = function (data) {
            if (data) {
                return new RecipeJobContainer(
                    data.job_name,
                    data.job
                );
            }
            return new RecipeJobContainer();
        };

        RecipeJobContainer.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJobContainer.build)
                    .filter(Boolean);
            }
            return RecipeJobContainer.build(data);
        };

        return RecipeJobContainer;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeType', ['scaleConfig', 'RecipeTypeDefinition', function (scaleConfig, RecipeTypeDefinition) {
        var RecipeType = function (id, name, version, title, description, is_active, definition, revision_num, created,  last_modified, archived, trigger_rule) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = definition ? RecipeTypeDefinition.transformer(definition) : new RecipeTypeDefinition();
            this.revision_num = revision_num;
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            if (trigger_rule) {
                this.trigger_rule = trigger_rule;
            } else {
                this.trigger_rule = {
                    type: '',
                    name: '',
                    is_active: false,
                    configuration: {
                        condition: {
                            media_type: '',
                            data_types: []
                        },
                        data: {
                            workspace_name: '',
                            input_data_name: ''
                        }
                    }
                };
            }
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeType.build = function (data) {
            if (data) {
                return new RecipeType(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.revision_num,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule
                );
            }
            return new RecipeType();
        };

        RecipeType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(RecipeType.build);
            }
            return RecipeType.build(data);
        };

        return RecipeType;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinition', ['scaleConfig', 'RecipeTypeDefinitionJob', 'JobTypeInputData', function (scaleConfig, RecipeTypeDefinitionJob, JobTypeInputData) {

        var self = this;
        // private methods
        var RecipeTypeDefinition = function (input_data, version, jobs) {
            this.input_data = input_data ? JobTypeInputData.transformer(input_data) : [];
            this.version = version || '1.0';
            this.jobs = jobs ? RecipeTypeDefinitionJob.transformer(jobs) : [];
        };

        var getJobName = function(jobs, jobName){
            var theName = jobName;
            var existing = _.find(jobs, { 'name': jobName });
            var idx = 2;
            while(existing){
                theName = jobName + '-' + idx;
                existing = _.find(jobs, { 'name': theName });
                idx++;
            }
            return theName;
        };

        // public methods
        RecipeTypeDefinition.prototype = {
            addJob: function (jobType) {
                var jname = getJobName(this.jobs, jobType.name);
                console.log(jname);
                var job = {
                    dependencies: [],
                    recipe_inputs: [],
                    name: jname,
                    job_type_id: jobType.id,
                    job_type: jobType
                };
                this.jobs.push(job);
            }
        };

        // static methods, assigned to class
        RecipeTypeDefinition.build = function (data) {
            if(data){
                return new RecipeTypeDefinition(
                    data.input_data,
                    data.version,
                    data.jobs
                );
            }
            return new RecipeTypeDefinition();
        };

        RecipeTypeDefinition.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinition.build);
            }
            return RecipeTypeDefinition.build(data);
        };

        return RecipeTypeDefinition;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinitionJob', ['scaleConfig', 'JobTypeDetails', function (scaleConfig, JobTypeDetails) {
        // private methods
        var RecipeTypeDefinitionJob = function (recipe_inputs, name, job_type, dependencies) {
            this.recipe_inputs = recipe_inputs;
            this.name = name;
            this.job_type = job_type;
            //this.job_type = {
            //    name: job_type.name,
            //    version: job_type.version
            //};
            this.dependencies = dependencies || [];
        };

        // static methods, assigned to class
        RecipeTypeDefinitionJob.build = function (data) {
            if (data) {
                return new RecipeTypeDefinitionJob(
                    data.recipe_inputs,
                    data.name,
                    data.job_type,
                    data.dependencies
                );
            }
            return new RecipeTypeDefinitionJob();
        };

        RecipeTypeDefinitionJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinitionJob.build);
            }
            return RecipeTypeDefinitionJob.build(data);
        };


        return RecipeTypeDefinitionJob;

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDetail', ['scaleConfig', 'RecipeTypeDefinition', 'JobTypeDetails', function (scaleConfig, RecipeTypeDefinition, JobTypeDetails) {
        var RecipeTypeDetail = function (id, name, version, title, description, is_active, definition, created, last_modified, archived, trigger_rule, job_types) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = RecipeTypeDefinition.transformer(definition);
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            this.trigger_rule = trigger_rule;
            this.job_types = JobTypeDetails.transformer(job_types);
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeTypeDetail.build = function (data) {
            if (data) {
                return new RecipeTypeDetail(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule,
                    data.job_types
                );
            }
            return new RecipeTypeDetail();
        };

        RecipeTypeDetail.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDetail.build);
            }
            return RecipeTypeDetail.build(data);
        };

        return RecipeTypeDetail;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeValidation', ['RecipeTypeDefinition', function (RecipeTypeDefinition) {

        var getRecipeTypeValidationJobs = function (jobs) {
            var jobsOut = [];
            _.forEach(jobs, function(job){
               jobsOut.push({
                   recipe_inputs: job.recipe_inputs,
                   name: job.name,
                   job_type: {
                       name: job.job_type.name,
                       version: job.job_type.version
                   },
                   dependencies: job.dependencies
               })
            });
            return jobsOut;
        };
        
        var RecipeTypeValidation = function (id, name, version, title, description, definition, trigger_rule) {
            if (id) {
                this.id = id;
            }
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.definition = {
                input_data: definition.input_data,
                jobs: getRecipeTypeValidationJobs(definition.jobs)
            };
            this.trigger_rule = trigger_rule;
        };

        // static methods, assigned to class
        RecipeTypeValidation.build = function (data) {
            if (data) {
                return new RecipeTypeValidation(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.definition,
                    data.trigger_rule
                );
            }
            return new RecipeTypeValidation();
        };

        RecipeTypeValidation.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeValidation.build);
            }
            return RecipeTypeValidation.build(data);
        };

        return RecipeTypeValidation;
    }]);
})();
(function () {
    'use strict';
    /**
     *
     */
    angular.module('scaleApp').service('recipeService', ['$http', '$q', '$timeout', 'scaleConfig', 'RecipeType', 'RecipeTypeDetail', 'Recipe', 'RecipeDetails', 'RecipeTypeValidation', function ($http, $q, $timeout, scaleConfig, RecipeType, RecipeTypeDetail, Recipe, RecipeDetails, RecipeTypeValidation) {
        var getRecipesParams = function (page, page_size, started, ended, order, completed, recipe_type_id, recipe_type_name, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                completed: completed,
                recipe_type_id: recipe_type_id,
                recipe_type_name: recipe_type_name,
                url: url
            };
        };

        var getRecipeTypesParams = function (page, page_size, started, ended, order) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order ? order : ['title', 'version']
            };
        };

        return {
            getRecipeTypes: function (params) {
                params = params || getRecipeTypesParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = RecipeType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                
                return d.promise;
            },

            getRecipeTypeDetail: function (id) {
              var d = $q.defer();

              $http.get(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/' + id + '/').success(function (data) {
                  var returnData = RecipeTypeDetail.transformer(data);
                  d.resolve(returnData);
              });
              return d.promise;
            },

            getRecipes: function (params) {
                params = params || getRecipesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('recipes') + 'recipes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Recipe.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },

            getRecipeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('recipes') + 'recipes/' + id + '/').success(function (details) {
                    console.log('getRecipeDetails');
                    console.log(details);
                    var result = RecipeDetails.transformer(details);
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },

            saveRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                if (!cleanRecipeType.id) {
                    $http.post(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', cleanRecipeType).success(function (result) {
                        d.resolve(result);
                    }).error(function(error){
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/' + cleanRecipeType.id + '/', cleanRecipeType).success(function (result) {
                        recipeType = result;
                        d.resolve(recipeType);
                    }).error(function(error){
                        d.reject(error);
                    });
                }

                return d.promise;
            },

            validateRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                $http.post(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/validation/', cleanRecipeType).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

/**
 * @author Dimitry Kudrayvtsev
 * @version 2.1
 */

 var updateWindow = function(){
    //  x = w.innerWidth || e.clientWidth || g.clientWidth;
    //  y = w.innerHeight|| e.clientHeight|| g.clientHeight;
     //
    //  svg.attr("width", x).attr("height", y);
    console.log('resize');
 };

 window.onresize = updateWindow;

d3.gantt = function() {
    var FIT_TIME_DOMAIN_MODE = "fit";
    var FIXED_TIME_DOMAIN_MODE = "fixed";

    var margin = {
		top : 20,
		right : 20,
		bottom : 20,
		left : 60
    };
    var timeDomainStart = d3.time.day.offset(new Date(),-3);
    var timeDomainEnd = d3.time.hour.offset(new Date(),+3);
    var timeDomainMode = FIT_TIME_DOMAIN_MODE;// fixed or fit
    var taskTypes = [];
    var taskStatus = [];
    var height = document.body.clientHeight - margin.top - margin.bottom-5;
    var width = document.body.clientWidth - margin.right - margin.left-5;
	var renderTo = "body";
	var begin = '';
	var ended = '';

    var tickFormat = "%H:%M:%S";

    var keyFunction = function(d) {
		return d[begin] + d.taskName + d[ended];
    };

    var rectTransform = function(d) {
		return "translate(" + x(d[begin]) + "," + y(d.taskName) + ")";
    };

    var x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);

    var y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);

    var xAxis = d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
	    .tickSize(8).tickPadding(8);

    var yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);

    var initTimeDomain = function(tasks) {
	if (timeDomainMode === FIT_TIME_DOMAIN_MODE) {
	    if (tasks === undefined || tasks.length < 1) {
		timeDomainStart = d3.time.day.offset(new Date(), -3);
		timeDomainEnd = d3.time.hour.offset(new Date(), +3);
		return;
	    }
	    tasks.sort(function(a, b) {
		return a[ended] - b[ended];
	    });
	    timeDomainEnd = tasks[tasks.length - 1][ended];
	    tasks.sort(function(a, b) {
		return a[begin] - b[begin];
	    });
	    timeDomainStart = tasks[0][begin];
	}
    };

    var initAxis = function() {
	x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);
	y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);
	xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(Math.ceil(width/150)).tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
		.tickSize(8).tickPadding(8);

	yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);
    };

    function gantt(tasks) {

	initTimeDomain(tasks);
	initAxis();

	var svg = d3.select(renderTo)
	.append("svg")
	.attr("class", "chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
        .attr("class", "gantt-chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

      svg.selectAll(".chart")
	 .data(tasks, keyFunction).enter()
	 .append("rect")
	 .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });


	 svg.append("g")
	 .attr("class", "x axis")
	 .attr("transform", "translate(0, " + (height - margin.top - margin.bottom) + ")")
	 .transition()
	 .call(xAxis);

	 svg.append("g").attr("class", "y axis").transition().call(yAxis);

	 return gantt;

    };

    gantt.redraw = function(tasks) {
        console.log('redraw');
	initTimeDomain(tasks);
	initAxis();

        var svg = d3.select("svg");

        var ganttChartGroup = svg.select(".gantt-chart");
        var rect = ganttChartGroup.selectAll("rect").data(tasks, keyFunction);

        rect.enter()
         .insert("rect",":first-child")
         .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .transition()
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	  .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

        rect.transition()
          .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

	rect.exit().remove();

	svg.select(".x").transition().call(xAxis);
	svg.select(".y").transition().call(yAxis);

	return gantt;
    };

    gantt.margin = function(value) {
	if (!arguments.length)
	    return margin;
	margin = value;
	return gantt;
    };

    gantt.timeDomain = function(value) {
	if (!arguments.length)
	    return [ timeDomainStart, timeDomainEnd ];
	timeDomainStart = +value[0], timeDomainEnd = +value[1];
	return gantt;
    };

    /**
     * @param {string}
     *                vale The value can be "fit" - the domain fits the data or
     *                "fixed" - fixed domain.
     */
    gantt.timeDomainMode = function(value) {
	if (!arguments.length)
	    return timeDomainMode;
        timeDomainMode = value;
        return gantt;

    };

    gantt.taskTypes = function(value) {
	if (!arguments.length)
	    return taskTypes;
	taskTypes = value;
	return gantt;
    };

    gantt.taskStatus = function(value) {
	if (!arguments.length)
	    return taskStatus;
	taskStatus = value;
	return gantt;
    };

	gantt.begin = function(value){
		if(!arguments.length){
			return begin;
		}
		begin = value;
		return gantt;
	};

	gantt.ended = function(value){
		if(!arguments.length){
			return ended;
		}
		ended = value;
		return gantt;
	};

    gantt.width = function(value) {
	if (!arguments.length)
	    return width;
	width = +value;
	return gantt;
    };

    gantt.height = function(value) {
	if (!arguments.length)
	    return height;
	height = +value;
	return gantt;
    };

    gantt.tickFormat = function(value) {
	if (!arguments.length)
	    return tickFormat;
	tickFormat = value;
	return gantt;
    };

	gantt.renderTo = function(value) {
		if(!arguments.length){
			return renderTo;
		}
		renderTo = value;
		return gantt;
	};



    return gantt;
};

function Gauge(placeholderName, configuration)
{
    this.placeholderName = placeholderName;

    var self = this; // for internal d3 functions

    this.configure = function(configuration)
    {
        this.config = configuration;

        this.config.size = this.config.size * 0.9;

        this.config.raduis = this.config.size * 0.97 / 2;
        this.config.cx = this.config.size / 2;
        this.config.cy = this.config.size / 2;

        this.config.min = undefined != configuration.min ? configuration.min : 0;
        this.config.max = undefined != configuration.max ? configuration.max : 100;
        this.config.range = this.config.max - this.config.min;

        this.config.majorTicks = configuration.majorTicks || 5;
        this.config.minorTicks = configuration.minorTicks || 2;

        this.config.greenColor 	= configuration.greenColor || "#8fca0e";
        this.config.yellowColor = configuration.yellowColor || "#ffc317";
        this.config.redColor 	= configuration.redColor || "#f54d36";

        this.config.transitionDuration = configuration.transitionDuration || 500;
    };

    this.render = function()
    {
        this.body = d3.select("#" + this.placeholderName)
            .append("svg:svg")
            .attr("class", "gauge")
            .attr("width", this.config.size)
            .attr("height", this.config.size);

        this.body.append("svg:circle")
            .attr("class", "outer-circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", this.config.raduis * 0.95)
            .style("fill", "#ccc");
            /*.style("stroke", "#000")
            .style("stroke-width", "0.5px");*/

        this.body.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.9 * this.config.raduis)
            .style("fill", "#fff")
            .style("stroke", "#e0e0e0")
            .style("stroke-width", "2px");

        for (var greenIdx in this.config.greenZones)
        {
            this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
        }

        for (var yellowIdx in this.config.yellowZones)
        {
            this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
        }

        for (var redIdx in this.config.redZones)
        {
            this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
        }

        var fontSize = 0;

        if (undefined != this.config.label)
        {
            fontSize = Math.round(this.config.size / 9);
            this.body.append("svg:text")
                .attr("x", this.config.cx)
                .attr("y", this.config.cy / 2 + fontSize / 2)
                .attr("dy", fontSize / 2)
                .attr("text-anchor", "middle")
                .text(this.config.label)
                .style("font-size", fontSize + "px")
                .style("fill", "#333")
                .style("stroke-width", "0px");
        }

        fontSize = Math.round(this.config.size / 16);
        var majorDelta = this.config.range / (this.config.majorTicks - 1);
        for (var major = this.config.min; major <= this.config.max; major += majorDelta)
        {
            var minorDelta = majorDelta / this.config.minorTicks,
                point1 = 0,
                point2 = 0;
            for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
            {
                point1 = this.valueToPoint(minor, 0.75);
                point2 = this.valueToPoint(minor, 0.85);

                this.body.append("svg:line")
                    .attr("x1", point1.x)
                    .attr("y1", point1.y)
                    .attr("x2", point2.x)
                    .attr("y2", point2.y)
                    .style("stroke", "#666")
                    .style("stroke-width", "1px");
            }

            point1 = this.valueToPoint(major, 0.7);
            point2 = this.valueToPoint(major, 0.85);

            this.body.append("svg:line")
                .attr("x1", point1.x)
                .attr("y1", point1.y)
                .attr("x2", point2.x)
                .attr("y2", point2.y)
                .style("stroke", "#333")
                .style("stroke-width", "2px");

            if (major == this.config.min || major == this.config.max)
            {
                var point = this.valueToPoint(major, 0.63);

                this.body.append("svg:text")
                    .attr("x", point.x)
                    .attr("y", point.y)
                    .attr("dy", fontSize / 3)
                    .attr("text-anchor", major == this.config.min ? "start" : "end")
                    .text(major)
                    .style("font-size", fontSize + "px")
                    .style("fill", "#333")
                    .style("stroke-width", "0px");
            }
        }

        var pointerContainer = this.body.append("svg:g").attr("class", "pointerContainer");

        var midValue = (this.config.min + this.config.max) / 2;

        var pointerPath = this.buildPointerPath(midValue);

        var pointerLine = d3.svg.line()
            .x(function(d) { return d.x })
            .y(function(d) { return d.y })
            .interpolate("basis");

        pointerContainer.selectAll("path")
            .data([pointerPath])
            .enter()
            .append("svg:path")
            .attr("d", pointerLine)
            .style("fill", "#888");

        pointerContainer.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.12 * this.config.raduis)
            .style("fill", "#888");

        fontSize = Math.round(this.config.size / 10);
        pointerContainer.selectAll("text")
            .data([midValue])
            .enter()
            .append("svg:text")
            .attr("x", this.config.cx)
            .attr("y", this.config.size - this.config.cy / 4 - fontSize)
            .attr("dy", fontSize / 2)
            .attr("text-anchor", "middle")
            .style("font-size", fontSize + "px")
            .style("fill", "#000")
            .style("stroke-width", "0px");

        this.redraw(this.config.min, 0);
    };

    this.buildPointerPath = function(value)
    {
        var delta = this.config.range / 13;

        var head = valueToPoint(value, 0.85);
        var head1 = valueToPoint(value - delta, 0.12);
        var head2 = valueToPoint(value + delta, 0.12);

        var tailValue = value - (this.config.range * (1/(270/360)) / 2);
        var tail = valueToPoint(tailValue, 0.28);
        var tail1 = valueToPoint(tailValue - delta, 0.12);
        var tail2 = valueToPoint(tailValue + delta, 0.12);

        return [head, head1, tail2, tail, tail1, head2, head];

        function valueToPoint(value, factor)
        {
            var point = self.valueToPoint(value, factor);
            point.x -= self.config.cx;
            point.y -= self.config.cy;
            return point;
        }
    };

    this.drawBand = function(start, end, color)
    {
        if (0 >= end - start) return;

        this.body.append("svg:path")
            .style("fill", color)
            .attr("d", d3.svg.arc()
                .startAngle(this.valueToRadians(start))
                .endAngle(this.valueToRadians(end))
                .innerRadius(0.65 * this.config.raduis)
                .outerRadius(0.85 * this.config.raduis))
            .attr("transform", function() { return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(270)" });
    };

    this.redraw = function(value, transitionDuration)
    {
        var pointerContainer = this.body.select(".pointerContainer");

        pointerContainer.selectAll("text").text(Math.round(value));

        var pointer = pointerContainer.selectAll("path");
        pointer.transition()
            .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
            //.delay(0)
            //.ease("linear")
            //.attr("transform", function(d)
            .attrTween("transform", function()
            {
                var pointerValue = value;
                if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                var currentRotation = self._currentRotation || targetRotation;
                self._currentRotation = targetRotation;

                return function(step)
                {
                    var rotation = currentRotation + (targetRotation-currentRotation)*step;
                    return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(" + rotation + ")";
                }
            });

        var outerCircle = this.body.select(".outer-circle")
            .transition()
            .duration(750)
            .style("fill", function () {
                var i = parseInt(value);
                if (i > 0 && i < 75) {
                    return self.config.greenColor;
                } else if (i >= 75 && i < 90) {
                    return self.config.yellowColor;
                } else {
                    return self.config.redColor;
                }
            });
    };

    this.valueToDegrees = function(value)
    {
        // thanks @closealert
        //return value / this.config.range * 270 - 45;
        return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
    };

    this.valueToRadians = function(value)
    {
        return this.valueToDegrees(value) * Math.PI / 180;
    };

    this.valueToPoint = function(value, factor)
    {
        return { 	x: this.config.cx - this.config.raduis * factor * Math.cos(this.valueToRadians(value)),
            y: this.config.cy - this.config.raduis * factor * Math.sin(this.valueToRadians(value)) 		};
    };

    // initialization
    this.configure(configuration);
}
/*! 
 * angular-hotkeys v1.5.0
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(a){this.includeCheatSheet=!0,this.useNgRoute=a.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(a,b,c,d,e){function f(a){var b={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f,this._formated=null}function h(){for(var a=o.hotkeys.length;a--;){var b=o.hotkeys[a];b&&!b.persistent&&k(b)}}function i(){o.helpVisible=!o.helpVisible,o.helpVisible?(t=l("esc"),k("esc"),j("esc",t.description,i,null,["INPUT","SELECT","TEXTAREA"])):(k("esc"),t!==!1&&j(t))}function j(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&n(h.apply(this,arguments))}}"string"==typeof d?Mousetrap.bind(a,n(c),d):Mousetrap.bind(a,n(c));var m=new g(a,b,c,d,e,f);return o.hotkeys.push(m),m}function k(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=k(b[d])&&c;return c}var e=o.hotkeys.indexOf(l(b));return e>-1?(o.hotkeys[e].combo.length>1?o.hotkeys[e].combo.splice(o.hotkeys[e].combo.indexOf(b),1):o.hotkeys.splice(e,1),!0):!1}function l(a){if(!a)return o.hotkeys;for(var b,c=0;c<o.hotkeys.length;c++)if(b=o.hotkeys[c],b.combo.indexOf(a)>-1)return b;return!1}function m(a){return a.$id in p||(p[a.$id]=[],a.$on("$destroy",function(){for(var b=p[a.$id].length;b--;)k(p[a.$id].pop())})),{add:function(b){var c;return c=arguments.length>1?j.apply(this,arguments):j(b),p[a.$id].push(c),this}}}function n(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,l(d))})}}Mousetrap.prototype.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){if(null===this._formated){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);this._formated=b}return this._formated};var o=b.$new();o.hotkeys=[],o.helpVisible=!1,o.title=this.templateTitle,o.header=this.templateHeader,o.footer=this.templateFooter,o.toggleCheatSheet=i;var p=[];if(this.useNgRoute&&b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,j.apply(this,a)})}),this.includeCheatSheet){var q=e[0],r=a[0],s=angular.element(this.template);j(this.cheatSheetHotkey,this.cheatSheetDescription,i),(r===q||r===q.documentElement)&&(r=q.body),angular.element(r).append(c(s)(o))}var t=!1,u={add:j,del:k,get:l,bindTo:m,template:this.template,toggleCheatSheet:i,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:h,templateTitle:this.templateTitle};return u}]}]).directive("hotkey",["hotkeys",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}]).run(["hotkeys",function(a){}])}(),function(a,b,c){function d(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return r[a.which]?r[a.which]:s[a.which]?s[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a,b){return a.sort().join(",")===b.sort().join(",")}function g(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function h(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function i(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function j(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function k(){if(!q){q={};for(var a in r)a>95&&112>a||r.hasOwnProperty(a)&&(q[r[a]]=a)}return q}function l(a,b,c){return c||(c=k()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function m(a){return"+"===a?["+"]:(a=a.replace(/\+{2}/g,"+plus"),a.split("+"))}function n(a,b){var c,d,e,f=[];for(c=m(a),e=0;e<c.length;++e)d=c[e],u[d]&&(d=u[d]),b&&"keypress"!=b&&t[d]&&(d=t[d],f.push("shift")),j(d)&&f.push(d);return b=l(d,f,b),{key:d,modifiers:f,action:b}}function o(a,c){return a===b?!1:a===c?!0:o(a.parentNode,c)}function p(a){function c(a){a=a||{};var b,c=!1;for(b in u)a[b]?c=!0:u[b]=0;c||(x=!1)}function k(a,b,c,d,e,g){var h,i,k=[],l=c.type;if(!s._callbacks[a])return[];for("keyup"==l&&j(a)&&(b=[a]),h=0;h<s._callbacks[a].length;++h)if(i=s._callbacks[a][h],(d||!i.seq||u[i.seq]==i.level)&&l==i.action&&("keypress"==l&&!c.metaKey&&!c.ctrlKey||f(b,i.modifiers))){var m=!d&&i.combo==e,n=d&&i.seq==d&&i.level==g;(m||n)&&s._callbacks[a].splice(h,1),k.push(i)}return k}function l(a,b,c,d){s.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(h(b),i(b))}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);if(b)return"keyup"==a.type&&v===b?void(v=!1):void s.handleKey(b,g(a),a)}function o(){clearTimeout(t),t=setTimeout(c,1e3)}function q(a,b,d,f){function g(b){return function(){x=b,++u[a],o()}}function h(b){l(d,b,a),"keyup"!==f&&(v=e(b)),setTimeout(c,10)}u[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,k=j?h:g(f||n(b[i+1]).action);r(b[i],k,f,a,i)}}function r(a,b,c,d,e){s._directMap[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,g=a.split(" ");return g.length>1?void q(a,g,b,c):(f=n(a,c),s._callbacks[f.key]=s._callbacks[f.key]||[],k(f.key,f.modifiers,{type:f.action},d,a,e),void s._callbacks[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}var s=this;if(a=a||b,!(s instanceof p))return new p(a);s.target=a,s._callbacks={},s._directMap={};var t,u={},v=!1,w=!1,x=!1;s._handleKey=function(a,b,d){var e,f=k(a,b,d),g={},h=0,i=!1;for(e=0;e<f.length;++e)f[e].seq&&(h=Math.max(h,f[e].level));for(e=0;e<f.length;++e)if(f[e].seq){if(f[e].level!=h)continue;i=!0,g[f[e].seq]=1,l(f[e].callback,d,f[e].combo,f[e].seq)}else i||l(f[e].callback,d,f[e].combo);var m="keypress"==d.type&&w;d.type!=x||j(a)||m||c(g),w=i&&"keydown"==d.type},s._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)r(a[d],b,c)},d(a,"keypress",m),d(a,"keydown",m),d(a,"keyup",m)}for(var q,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},v=1;20>v;++v)r[111+v]="f"+v;for(v=0;9>=v;++v)r[v+96]=v;p.prototype.bind=function(a,b,c){var d=this;return a=a instanceof Array?a:[a],d._bindMultiple.call(d,a,b,c),d},p.prototype.unbind=function(a,b){var c=this;return c.bind.call(c,a,function(){},b)},p.prototype.trigger=function(a,b){var c=this;return c._directMap[a+":"+b]&&c._directMap[a+":"+b]({},a),c},p.prototype.reset=function(){var a=this;return a._callbacks={},a._directMap={},a},p.prototype.stopCallback=function(a,b){var c=this;return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:o(b,c.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},p.prototype.handleKey=function(){var a=this;return a._handleKey.apply(a,arguments)},p.init=function(){var a=p(b);for(var c in a)"_"!==c.charAt(0)&&(p[c]=function(b){return function(){return a[b].apply(a,arguments)}}(c))},p.init(),a.Mousetrap=p,"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define.amd&&define(function(){return p})}(window,document);
if (!String.prototype.includes) {
    String.prototype.includes = function(search, start) {
        'use strict';
        if (typeof start !== 'number') {
            start = 0;
        }

        if (start + search.length > this.length) {
            return false;
        } else {
            return this.indexOf(search, start) !== -1;
        }
    };
}
(function () {
    'use strict';

    angular.module('scaleApp').config(['$provide', function ($provide) {
        $provide.decorator('$httpBackend', angular.mock.e2e.$httpBackendDecorator);
    }]).run(['$httpBackend', 'scaleConfig', 'XMLHttpRequest', function ($httpBackend, scaleConfig, XMLHttpRequest) {

        var getSync = function (url) {
            var request = new XMLHttpRequest();
            request.open('GET', url, false);
            request.send(null);
            return [request.status, request.response, {}];
        };

        var getUrlParams = function (url) {
            var obj = {};

            if (url && url.split('?').length > 1) {
                url.split('?')[1].split('&').forEach(function (item) {
                    var s = item.split('='),
                        k = s[0],
                        v = s[1] && decodeURIComponent(s[1]);
                    (k in obj) ? obj[k].push(v) : obj[k] = [v]
                });
            }

            return obj;
        };

        // Ingests Status
        var ingestsStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('ingests') + 'ingests/status/', 'i');
        $httpBackend.whenGET(ingestsStatusRegex).respond(function () {
            var strikes = JSON.parse(getSync('test/data/ingestStrikes.json')[1]),
                startDate = moment.utc().subtract(1, 'w').startOf('d').toISOString(),
                endDate = moment.utc().add(1, 'd').startOf('d').toISOString(),
                numHours = moment.utc(endDate).diff(moment.utc(startDate), 'h'),
                thisTime = '',
                values = [],
                results = [];

            _.forEach(strikes.results, function (strike) {
                values = [];

                for (var i = 0; i < numHours; i++) {
                    thisTime = moment.utc(startDate).add(i, 'h').toISOString();
                    values.push({
                        time: thisTime,
                        files: Math.floor(Math.random() * (500 - 5 + 1)) + 5,
                        size: Math.floor(Math.random() * (500000000 - 5000000 + 1)) + 5000000
                    });
                }

                results.push({
                    strike: strike,
                    most_recent: moment.utc().startOf('h').toISOString(),
                    files: 2,
                    size: 123456789,
                    values: values
                });
            });

            var data = {
                count: 2,
                next: null,
                previous: null,
                results: results
            };

            return [200, data, {}];
        });

        // Ingests
        var ingestsOverrideUrl = 'test/data/ingests.json';
        var ingestsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('ingests') + 'ingests/', 'i');
        $httpBackend.whenGET(ingestsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(ingestsOverrideUrl),
                ingests = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                ingests.results = _.sortByOrder(ingests.results, fields, orders);
            }

            if (urlParams.page && urlParams.page.length > 0) {
                var page = parseInt(urlParams.page[0]),
                    pageSize = parseInt(urlParams.page_size[0]);

                if (page === 1) {
                    ingests.results = _.take(ingests.results, pageSize);
                } else {
                    var startIdx = (page - 1) * pageSize,
                        idxArray = [];

                    for (var i = startIdx; i < ingests.results.length - 1; i++) {
                        idxArray.push(i);
                    }

                    ingests.results = _.at(ingests.results, idxArray);
                }
            }

            if (urlParams.status) {
                ingests.results = _.filter(ingests.results, function (ingest) {
                    return ingest.status === urlParams.status[0];
                });
            }

            returnObj[1] = JSON.stringify(ingests);

            return returnObj;
        });

        // Source details
        var sourceDetailsOverrideUrl = 'test/data/sourceDetails.json';
        var sourceDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('sources') + 'sources/.*/', 'i');
        $httpBackend.whenGET(sourceDetailsRegex).respond(function (method, url) {
            // // get the jobType.id from the url
            // url = url.toString();
            // var filename = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            // sourceDetailsOverrideUrl = 'test/data/source-details/' + filename + '.json';
            return getSync(sourceDetailsOverrideUrl);
        });
        
        // Sources
        var sourcesOverrideUrl = 'test/data/sources.json';
        var sourcesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('sources') + 'sources/', 'i');
        $httpBackend.whenGET(sourcesRegex).respond(function (method, url) {
            //return getSync(sourcesOverrideUrl);
            var urlParams = getUrlParams(url),
                returnObj = getSync(sourcesOverrideUrl),
                sources = JSON.parse(returnObj[1]);

            if (urlParams.file_name && urlParams.file_name.length > 0) {
                var orders = ['file_name'],
                    fields = ['asc'];

                sources.results = _.filter(sources.results, function (r) {
                    return r.file_name.toLowerCase().includes(urlParams.file_name[0].toLowerCase());
                });

                sources.results = _.sortByOrder(sources.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(sources);

            return returnObj;
        });

        // Job load
        var jobLoadRegex = new RegExp('^' + scaleConfig.getUrlPrefix('load') + 'load/', 'i');
        $httpBackend.whenGET(jobLoadRegex).respond(function () {
            var numHours = moment.utc().endOf('d').diff(moment.utc().subtract(7, 'd').startOf('d'), 'h');
            var startTime = moment.utc().subtract(7, 'd').startOf('d');
            var data = {
                count: numHours,
                next: null,
                previous: null,
                results: []
            };

            for (var i = 0; i < data.count; i++) {
                data.results.push({
                    time: moment.utc(startTime).add(i, 'h').toISOString(),
                    pending_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    queued_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    running_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20
                });
            }

            return [200, data, {}];
        });

        // Job details
        var jobDetailsOverrideUrl = 'test/data/jobDetails.json';
        var jobDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/.*/', 'i');
        $httpBackend.whenGET(jobDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobDetailsOverrideUrl = 'test/data/job-details/jobDetails' + id + '.json';
            return getSync(jobDetailsOverrideUrl);
        });

        // Jobs
        var jobsOverrideUrl = 'test/data/jobs.json';
        var jobsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('jobs') + 'jobs/', 'i');
        $httpBackend.whenGET(jobsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobsOverrideUrl),
                jobs = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'job_type') {
                        field = 'job_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                jobs.results = _.sortByOrder(jobs.results, fields, orders);
            }

            if (urlParams.status) {
                jobs.results = _.filter(jobs.results, function (job) {
                    return job.status === urlParams.status[0];
                });
            }

            returnObj[1] = JSON.stringify(jobs);

            return returnObj;
        });

        // Job type status
        var jobTypeStatusOverrideUrl = 'test/data/jobTypeStatus.json';
        var jobTypeStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/status/', 'i');
        $httpBackend.whenGET(jobTypeStatusRegex).respond(function () {
            return getSync(jobTypeStatusOverrideUrl);
        });

        // Running job types
        var runningJobsOverrideUrl = 'test/data/runningJobs.json';
        var runningJobsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', 'i');
        $httpBackend.whenGET(runningJobsRegex).respond(function () {
            return getSync(runningJobsOverrideUrl);
        });

        // Job Type Details
        var jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType1.json';
        var jobTypeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/.*/', 'i');
        $httpBackend.whenGET(jobTypeDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType' + id + '.json';
            return getSync(jobTypeDetailsOverrideUrl);
        });

        // Job types
        var jobTypesOverrideUrl = 'test/data/jobTypes.json';
        var jobTypesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/', 'i');
        $httpBackend.whenGET(jobTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobTypesOverrideUrl),
                jobTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                jobTypes.results = _.sortByOrder(jobTypes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(jobTypes);

            return returnObj;
        });
        
        // Job execution logs
        var jobExecutionLogsOverrideUrl = 'test/data/jobExecutionLogCombined.json';
        var jobExecutionLogRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-executions') + 'job-executions/.*/logs/combined/', 'i');
        $httpBackend.whenGET(jobExecutionLogRegex).respond(function () {
            return getSync(jobExecutionLogsOverrideUrl);
        });

        // Job execution Details
        var jobExecutionDetailsOverrideUrl = 'test/data/jobExecutionDetails.json';
        var jobExecutionDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-executions') + 'job-executions/.*/', 'i');
        $httpBackend.whenGET(jobExecutionDetailsRegex).respond(function () {
            return getSync(jobExecutionDetailsOverrideUrl);
        });


        // Metrics Plot Data Detail
        //var metricsPlotDataOverrideUrl = 'test/data/metricsJobTypesPlotData.json';
        var metricsPlotDataRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/.*/.*/','i');
        $httpBackend.whenGET(metricsPlotDataRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                random = 0;

            var returnObj = {
                count: 28,
                next: null,
                previous: null,
                results: []
            };

            var numDays = moment.utc(urlParams.ended[0]).diff(moment.utc(urlParams.started[0]), 'd') + 1;

            _.forEach(urlParams.column, function (metric) {
                var maxRandom = metric === 'total_count' ? 1000 : 200;
                var minRandom = metric === 'total_count' ? 800 : 10;
                var returnResult = {
                    column: { title: _.startCase(metric) },
                    min_x: moment.utc(urlParams.started[0]).format('YYYY-MM-DD'),
                    max_x: moment.utc(urlParams.ended[0]).format('YYYY-MM-DD'),
                    min_y: 1,
                    max_y: 1000,
                    values: []
                };

                for (var i = 0; i < numDays; i++) {
                    if (urlParams.choice_id && urlParams.choice_id.length > 1) {
                        _.forEach(urlParams.choice_id, function (id) {
                            random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                            if (random <= 4) {
                                var value = Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom;
                                returnResult.values.push({
                                    date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                    value: value,
                                    id: parseInt(id)
                                });
                            }
                        });
                    } else {
                        random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                        if (random <= 4) {
                            returnResult.values.push({
                                date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom
                            });
                        }
                    }
                }
                returnObj.results.push(returnResult);
            });

            return [200, returnObj, {}];
        });

        // Metrics Detail
        var metricsDetailRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/.*/','i');
        $httpBackend.whenGET(metricsDetailRegex).respond(function (method, url) {
            var urlArr = url.split('/'),
                detailType = urlArr[urlArr.length - 2];

            if (detailType === 'job-types') {
                return getSync('test/data/metricsJobTypes.json');
            } else if (detailType === 'error-types') {
                return getSync('test/data/metricsErrorTypes.json');
            }
            return getSync('test/data/metricsIngest.json');
        });

        // Metrics
        var metricsOverrideUrl = 'test/data/metrics.json';
        var metricsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/','i');
        $httpBackend.whenGET(metricsRegex).respond(function () {
            return getSync(metricsOverrideUrl);
        });

        // Node status
        var nodeStatusOverrideUrl = 'test/data/nodeStatus.json';
        var nodeStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodes') + 'nodes/status/', 'i');
        $httpBackend.whenGET(nodeStatusRegex).respond(function () {
            return getSync(nodeStatusOverrideUrl);
        });

        // Node details
        var nodeOverrideUrl = 'test/data/node.json';
        var nodeRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodes') + 'nodes/.*/', 'i');
        $httpBackend.whenGET(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });
        $httpBackend.whenPATCH(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });

        // Nodes
        var nodesOverrideUrl = 'test/data/nodes.json';
        var nodesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodes') + 'nodes/', 'i');
        $httpBackend.whenGET(nodesRegex).respond(function () {
            return getSync(nodesOverrideUrl);
        });

        // Queue Status service
        var queueStatusOverrideUrl = 'test/data/queueStatus.json';
        var queueStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('queue') + 'queue/status/', 'i');
        $httpBackend.whenGET(queueStatusRegex).respond(function () {
            return getSync(queueStatusOverrideUrl);
        });
        
        // Recipe Details
        var recipeDetailsOverrideUrl = 'test/data/recipeDetails.json';
        var recipeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipes') + 'recipes/.*/', 'i');
        $httpBackend.whenGET(recipeDetailsRegex).respond(function (method, url) {
            // get the recipeDetail.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeDetailsOverrideUrl = 'test/data/recipe-details/recipeDetail' + id + '.json';
            console.log(recipeDetailsOverrideUrl);
            return getSync(recipeDetailsOverrideUrl);
        });

        // Recipes service
        var recipesOverrideUrl = 'test/data/recipes.json';
        var recipesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipes') + 'recipes/', 'i');
        $httpBackend.whenGET(recipesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipesOverrideUrl),
                recipes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'recipe_type') {
                        field = 'recipe_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                recipes.results = _.sortByOrder(recipes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipes);

            return returnObj;
        });

        // Recipe type validation service
        var recipeTypeValidationOverrideUrl = 'test/data/recipeTypeValidationSuccess.json';
        var recipeTypeValidationRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/validation/', 'i');
        $httpBackend.whenPOST(recipeTypeValidationRegex).respond(function () {
            return getSync(recipeTypeValidationOverrideUrl);
        });

        // Recipe Type Details
        var recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType1.json';
        var recipeTypeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/.*/', 'i');
        $httpBackend.whenGET(recipeTypeDetailsRegex).respond(function (method, url) {
            // get the recipeType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType' + id + '.json';
            var returnValue = getSync(recipeTypeDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('recipeType' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Recipe Types service
        var recipeTypesOverrideUrl = 'test/data/recipeTypes.json';
        var recipeTypesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', 'i');
        $httpBackend.whenGET(recipeTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipeTypesOverrideUrl),
                recipeTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                recipeTypes.results = _.sortByOrder(recipeTypes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipeTypes);

            return returnObj;
        });

        // Save Recipe Type
        var recipeTypeSaveRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', 'i');
        $httpBackend.whenPOST(recipeTypeSaveRegex).respond(function (method, url, data) {
            var recipeJobTypes = [],
                recipeJobTypesDetails = [],
                jobTypeData = getSync('test/data/jobTypes.json'),
                jobTypes = JSON.parse(jobTypeData[1]).results,
                recipeType = JSON.parse(data),
                uniqueRecipeTypeJobs = _.uniq(recipeType.definition.jobs, 'job_type');
            _.forEach(uniqueRecipeTypeJobs, function (job) {
                recipeJobTypes.push(_.find(jobTypes, function (jobType) {
                    return jobType.name === job.job_type.name && jobType.version === job.job_type.version;
                }));
            });
            _.forEach(recipeJobTypes, function (jobType) {
                var jt = getSync('test/data/job-types/jobType' + jobType.id + '.json');
                recipeJobTypesDetails.push(JSON.parse(jt[1]));
            });
            var returnRecipe = {
                id: Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: recipeType.name,
                version: recipeType.version,
                title: recipeType.title,
                description: recipeType.description,
                is_active: true,
                definition: recipeType.definition,
                revision_num: 1,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                archived: null,
                trigger_rule: recipeType.trigger_rule,
                job_types: recipeJobTypesDetails
            };
            return [200, JSON.stringify(returnRecipe), {}];
        });

        // Status service
        var statusOverrideUrl = 'test/data/status.json';
        var statusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('status') + 'status/', 'i');
        $httpBackend.whenGET(statusRegex).respond(function () {
            return getSync(statusOverrideUrl);
        });

        // Version
        var versionOverrideUrl = 'test/data/version.json';
        var versionRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'v3/version/', 'i');
        $httpBackend.whenGET(versionRegex).respond(function () {
            return getSync(versionOverrideUrl);
        });

        // Workspace Details
        var workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace1.json';
        var workspaceDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/.*/', 'i');
        $httpBackend.whenGET(workspaceDetailsRegex).respond(function (method, url) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace' + id + '.json';
            var returnValue = getSync(workspaceDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('workspace' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });


        // Workspaces
        var workspacesOverrideUrl = 'test/data/workspaces.json';
        var workspacesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', 'i');
        $httpBackend.whenGET(workspacesRegex).respond(function () {
            return getSync(workspacesOverrideUrl);
        });

        // Save Workspace
        var getWorkspaceReturn = function (data, id) {
            var workspace = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: workspace.name,
                title: workspace.title,
                description: workspace.description,
                base_url: workspace.base_url,
                is_active: workspace.is_active || false,
                used_size: 0,
                total_size: 0,
                created: new Date().toISOString(),
                archived: null,
                last_modified: new Date().toISOString(),
                json_config: workspace.json_config
            };
        };
        var workspaceCreateRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', 'i');
        $httpBackend.whenPOST(workspaceCreateRegex).respond(function (method, url, data) {
            var returnWorkspace = getWorkspaceReturn(data);
            return [200, JSON.stringify(returnWorkspace), {}];
        });
        $httpBackend.whenPATCH(workspaceDetailsRegex).respond(function (method, url, data) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnWorkspace = getWorkspaceReturn(data, id);
            return [200, JSON.stringify(returnWorkspace), {}];
        });

        // Strike Details
        var strikeDetailsOverrideUrl = 'test/data/strikes/strike1.json';
        var strikeDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/.*/', 'i');
        $httpBackend.whenGET(strikeDetailsRegex).respond(function (method, url) {
            // get the strike.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            strikeDetailsOverrideUrl = 'test/data/strikes/strike' + id + '.json';
            var returnValue = getSync(strikeDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('strike' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Strikes
        var strikesOverrideUrl = 'test/data/strikes.json';
        var strikesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/', 'i');
        $httpBackend.whenGET(strikesRegex).respond(function () {
            return getSync(strikesOverrideUrl);
        });

        // Save Strike
        var getStrikeReturn = function (data, id) {
            var strike = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: strike.name,
                title: strike.title,
                description: strike.description,
                job: null,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                configuration: strike.configuration
            };
        };
        var strikeCreateRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/', 'i');
        $httpBackend.whenPOST(strikeCreateRegex).respond(function (method, url, data) {
            var returnStrike = getStrikeReturn(data);
            return [200, JSON.stringify(returnStrike), {}];
        });
        $httpBackend.whenPATCH(strikeDetailsRegex).respond(function (method, url, data) {
            // get the strike.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnStrike = getStrikeReturn(data, id);
            return [200, JSON.stringify(returnStrike), {}];
        });

        // For everything else, don't mock
        $httpBackend.whenGET(/^\w+.*/).passThrough();
        $httpBackend.whenPOST(/^\w+.*/).passThrough();
    }]);
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjYWxlQ29uZmlnLmpzIiwiaGVhZGVyL2hlYWRlckRpcmVjdGl2ZS5qcyIsIm5hdmlnYXRpb24vbmF2RGlyZWN0aXZlLmpzIiwiYWJvdXQvY29udHJvbGxlcnMvYWJvdXRDb250cm9sbGVyLmpzIiwiYWRtaW4vY29udHJvbGxlcnMvYWRtaW5Mb2dpbkNvbnRyb2xsZXIuanMiLCJhZG1pbi9jb250cm9sbGVycy9sb2dvdXRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkRGlyZWN0aXZlLmpzIiwiY2hhcnRzL2RvbnV0L2RvbnV0Q29udHJvbGxlci5qcyIsImNoYXJ0cy9kb251dC9kb251dERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9ncmlkL2dyaWRDaGFydENvbnRyb2xsZXIuanMiLCJjaGFydHMvZ3JpZC9ncmlkQ2hhcnREaXJlY3RpdmUuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aENvbnRyb2xsZXIuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9qb2JMb2FkL2pvYkxvYWRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2pvYkxvYWQvam9iTG9hZERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9yYWRpYWxQZXJjZW50YWdlL3JhZGlhbFBlcmNlbnRhZ2VDb250cm9sbGVyLmpzIiwiY2hhcnRzL3JhZGlhbFBlcmNlbnRhZ2UvcmFkaWFsUGVyY2VudGFnZURpcmVjdGl2ZS5qcyIsImNoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZS5qcyIsImNvbW1vbi9kaXJlY3RpdmVzL2Fpc0dyaWRQYWdpbmF0aW9uLmpzIiwiY29tbW9uL2RpcmVjdGl2ZXMvYWlzTXVsdGlzZWxlY3QuanMiLCJjb21tb24vZmFjdG9yaWVzL2dhdWdlRmFjdG9yeS5qcyIsImNvbW1vbi9mYWN0b3JpZXMvZ3JpZEZhY3RvcnkuanMiLCJjb21tb24vZmFjdG9yaWVzL3BvbGxlckZhY3RvcnkuanMiLCJjb21tb24vbW9kZWxzL1N0YXR1cy5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzTWFzdGVyLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNSZXNvdXJjZS5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzUmVzb3VyY2VzLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNTY2hlZHVsZXIuanMiLCJjb21tb24vc2VydmljZXMvc2NhbGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3NjaGVkdWxlclNlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvc3RhdGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3N0YXR1c1NlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvdXNlclNlcnZpY2UuanMiLCJmZWVkL2NvbnRyb2xsZXJzL2ZlZWREZXRhaWxzQ29udHJvbGxlci5qcyIsImZlZWQvY29udHJvbGxlcnMvaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXIuanMiLCJmZWVkL2NvbnRyb2xsZXJzL2luZ2VzdFJlY29yZHNDb250cm9sbGVyLmpzIiwiZmVlZC9jb250cm9sbGVycy9zdHJpa2VzQ29udHJvbGxlci5qcyIsImZlZWQvbW9kZWxzL0ZlZWQuanMiLCJmZWVkL21vZGVscy9GZWVkU3RhdHVzLmpzIiwiZmVlZC9tb2RlbHMvSW5nZXN0LmpzIiwiZmVlZC9tb2RlbHMvU3RyaWtlLmpzIiwiZmVlZC9tb2RlbHMvU3RyaWtlQ29uZmlndXJhdGlvbi5qcyIsImZlZWQvbW9kZWxzL1N0cmlrZUluZ2VzdEZpbGUuanMiLCJmZWVkL3NlcnZpY2VzL2ZlZWRTZXJ2aWNlLmpzIiwiZmVlZC9zZXJ2aWNlcy9zdHJpa2VTZXJ2aWNlLmpzIiwiZmVlZC9kaXJlY3RpdmVzL2ZpbGVBbmNlc3RyeVRyZWVEaXJlY3RpdmUuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkRldGFpbENvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkV4ZWN1dGlvbnNDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JUeXBlc0NvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYlR5cGVzRmFpbHVyZVJhdGVzQ29udHJvbGxlci5qcyIsImpvYnMvY29udHJvbGxlcnMvam9ic0NvbnRyb2xsZXIuanMiLCJqb2JzL3NlcnZpY2VzL2pvYkV4ZWN1dGlvblNlcnZpY2UuanMiLCJqb2JzL3NlcnZpY2VzL2pvYlNlcnZpY2UuanMiLCJqb2JzL3NlcnZpY2VzL2pvYlR5cGVTZXJ2aWNlLmpzIiwibG9hZC9jb250cm9sbGVycy9sb2FkQ29udHJvbGxlci5qcyIsImxvYWQvY29udHJvbGxlcnMvbG9hZERlcHRoQ29udHJvbGxlci5qcyIsImxvYWQvY29udHJvbGxlcnMvcXVldWVSdW5uaW5nQ29udHJvbGxlci5qcyIsImxvYWQvbW9kZWxzL1F1ZXVlU3RhdHVzLmpzIiwibG9hZC9zZXJ2aWNlcy9sb2FkU2VydmljZS5qcyIsImpvYnMvZGlyZWN0aXZlcy9qb2JFeGVjdXRpb25Mb2dEaXJlY3RpdmUuanMiLCJqb2JzL2RpcmVjdGl2ZXMvam9iSGVhbHRoRGlyZWN0aXZlLmpzIiwiam9icy9kaXJlY3RpdmVzL2pvYlR5cGVJbnRlcmZhY2VEaXJlY3RpdmUuanMiLCJqb2JzL21vZGVscy9Kb2IuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxFdmVudC5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbEV2ZW50UnVsZS5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbElucHV0RGF0YS5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbE91dHB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxzLmpzIiwiam9icy9tb2RlbHMvSm9iRXhlY3V0aW9uLmpzIiwiam9icy9tb2RlbHMvSm9iRXhlY3V0aW9uTG9nLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZS5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVEZXRhaWxzLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUVycm9yLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUVycm9yTWFwcGluZy5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVJbnB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlSW50ZXJmYWNlLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZU91dHB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlU3RhdHVzLmpzIiwiam9icy9tb2RlbHMvUHJvZHVjdC5qcyIsImpvYnMvbW9kZWxzL1J1bm5pbmdKb2IuanMiLCJqb2JzL21vZGVscy9TeXN0ZW1GYWlsdXJlLmpzIiwibWV0cmljcy9jb250cm9sbGVycy9tZXRyaWNzQ29udHJvbGxlci5qcyIsIm1ldHJpY3Mvc2VydmljZXMvbWV0cmljc1NlcnZpY2UuanMiLCJuYXZpZ2F0aW9uL2NvbnRyb2xsZXJzL25hdkNvbnRyb2xsZXIuanMiLCJuYXZpZ2F0aW9uL3NlcnZpY2VzL25hdlNlcnZpY2UuanMiLCJuYXZpZ2F0aW9uL3NlcnZpY2VzL3N1Ym5hdlNlcnZpY2UuanMiLCJ3b3Jrc3BhY2VzL2NvbnRyb2xsZXJzL3dvcmtzcGFjZXNDb250cm9sbGVyLmpzIiwid29ya3NwYWNlcy9tb2RlbHMvV29ya3NwYWNlLmpzIiwid29ya3NwYWNlcy9zZXJ2aWNlcy93b3Jrc3BhY2VzU2VydmljZS5qcyIsIm5vZGVzL2NvbnRyb2xsZXJzL25vZGVEZXRhaWxzQ29udHJvbGxlci5qcyIsIm5vZGVzL2NvbnRyb2xsZXJzL25vZGVzQ29udHJvbGxlci5qcyIsIm5vZGVzL2RpcmVjdGl2ZXMvbm9kZUhlYWx0aERpcmVjdGl2ZS5qcyIsIm5vZGVzL2RpcmVjdGl2ZXMvbm9kZVN0YXR1c0dyaWRDb250cm9sbGVyLmpzIiwibm9kZXMvZGlyZWN0aXZlcy9ub2RlU3RhdHVzR3JpZERpcmVjdGl2ZS5qcyIsIm5vZGVzL21vZGVscy9Ob2RlLmpzIiwibm9kZXMvbW9kZWxzL05vZGVSZXNvdXJjZXMuanMiLCJub2Rlcy9tb2RlbHMvTm9kZVN0YXR1cy5qcyIsIm5vZGVzL3NlcnZpY2VzL25vZGVTZXJ2aWNlLmpzIiwibm9kZXMvc2VydmljZXMvbm9kZVVwZGF0ZVNlcnZpY2UuanMiLCJvdmVydmlldy9jb250cm9sbGVycy9vdkNvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZURldGFpbHNDb250cm9sbGVyLmpzIiwicmVjaXBlcy9jb250cm9sbGVycy9yZWNpcGVUeXBlc0NvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZXNDb250cm9sbGVyLmpzIiwicmVjaXBlcy9kaXJlY3RpdmVzL3JlY2lwZUdyYXBoVmlld2VyRGlyZWN0aXZlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlRGF0YS5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZURldGFpbHMuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVKb2IuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVKb2JDb250YWluZXIuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZURlZmluaXRpb24uanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGVEZXRhaWwuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlVmFsaWRhdGlvbi5qcyIsInJlY2lwZXMvc2VydmljZXMvcmVjaXBlU2VydmljZS5qcyIsImdhbnR0LWNoYXJ0LWQzLmpzIiwiZ2F1Z2UuanMiLCJob3RrZXlzLm1pbi5qcyIsImluY2x1ZGVzLmpzIiwiYmFja2VuZFN0dWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsWUFBQTtJQUNBOztJQUVBLElBQUEsTUFBQSxRQUFBLE9BQUEsWUFBQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFD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QUNBLElBQUEsUUFBQSxPQUFBLFVBQUEsV0FBQTtnQkFDQTs7WUFFQSxVQUFBLEtBQUEsS0FBQSxTQUFBLFVBQUEsS0FBQSxNQUFBLFFBQUEsZUFBQTtZQUNBLElBQUEsWUFBQTtnQkFDQSxTQUFBLFNBQUE7O1lBRUEsR0FBQSxPQUFBLDZCQUFBLEtBQUEsVUFBQTtZQUNBLEdBQUEsT0FBQSxZQUFBLEtBQUEsVUFBQTs7O1FBR0EsSUFBQSxnQkFBQSxVQUFBLE1BQUE7WUFDQSxXQUFBO1lBQ0EsR0FBQSxhQUFBO1lBQ0EsSUFBQSxLQUFBLE1BQUE7Z0JBQ0EsSUFBQSxXQUFBLEtBQUEsS0FBQSxXQUFBLE1BQUEsS0FBQTtnQkFDQSxJQUFBLGFBQUEsV0FBQTtvQkFDQSxHQUFBLGFBQUEsRUFBQSxZQUFBLEVBQUEsT0FBQSxLQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUE7O29CQUVBLEVBQUEsUUFBQSxHQUFBLFlBQUEsVUFBQSxLQUFBO3dCQUNBLElBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxRQUFBLGVBQUEsSUFBQTs7b0JBRUEsR0FBQSxhQUFBLEVBQUEsWUFBQSxFQUFBLE9BQUEsS0FBQSxPQUFBLENBQUEsc0JBQUEsc0JBQUEsU0FBQSxDQUFBLE9BQUEsT0FBQTt1QkFDQSxJQUFBLGFBQUEsUUFBQTtvQkFDQSxHQUFBLGFBQUEsRUFBQSxPQUFBLEtBQUE7OztvQkFHQSxFQUFBLFFBQUEsR0FBQSxZQUFBLFVBQUEsS0FBQTt3QkFDQSxJQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsUUFBQSxXQUFBLElBQUE7Ozt1QkFHQTtvQkFDQSxHQUFBLGFBQUEsS0FBQTs7O2dCQUdBLE9BQUEsT0FBQSxVQUFBLE9BQUEsVUFBQSxLQUFBLE1BQUEsUUFBQTtnQkFDQSxPQUFBLE9BQUEsT0FBQSxPQUFBLE9BQUEsS0FBQSxLQUFBLEdBQUEsV0FBQSxTQUFBOztnQkFFQSxHQUFBLE1BQUEsTUFBQSxJQUFBLFVBQUEsS0FBQTtvQkFDQSxHQUFBLE1BQUEsTUFBQSxJQUFBLFVBQUEsS0FBQTt3QkFDQSxJQUFBLE9BQUEs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WUFDQSxJQUFBLEdBQUE7Z0JBQ0EsT0FBQSxFQUFBOzs7O1FBSUEsSUFBQSxrQkFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLElBQUEsRUFBQSxlQUFBLFdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7O1FBS0EsSUFBQSxxQkFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOzs7O1FBSUEsSUFBQSx1QkFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOzs7O1FBSUEsSUFBQSxlQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsR0FBQTtnQkFDQSxPQUFBLEVBQUE7Ozs7UUFJQSxJQUFBLGVBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxPQUFBLEVBQUEsT0FBQTs7WUFFQSxPQUFBOzs7UUFHQSxJQUFBLGVBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxPQUFBLEVBQUEsT0FBQTs7WUFFQSxPQUFBOzs7UUFHQSxJQUFBLGdCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsSUFBQSxFQUFBLGVBQUEsUUFBQTtvQkFDQSxPQUFBLEVBQUEsT0FBQTs7O1lBR0EsT0FBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsSUFBQSxFQUFBLGVBQUEsUUFBQTtvQkFDQSxPQUFBLEVBQUEsT0FBQTs7Ozs7UUFLQSxJQUFBLGtCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsSUFBQSxFQUFBLGVBQUEsV0FBQTtvQkFDQSxPQUFBLEVBQUEsT0FBQTs7Ozs7UUFLQSxJQUFBLG1CQUFBLFVBQUEsUUFBQTs7WUFFQSxlQUFBLEdBQUEsTUFBQTtZQUNBLGVBQUEsR0FBQSxNQUFBO1lBQ0Es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ZUFBQSxVQUFBO2lCQUNBLEtBQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxZQUFBOzs7WUFHQSxlQUFBLFVBQUE7aUJBQ0EsS0FBQSxVQUFBLFVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtpQkFDQSxHQUFBLFNBQUEsVUFBQSxRQUFBO29CQUNBLGlCQUFBOzs7OztZQUtBLElBQUEsWUFBQSxlQUFBO2lCQUNBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBOztZQUVBLElBQUEsT0FBQSxVQUFBLE9BQUE7WUFDQSxJQUFBLFdBQUEsS0FBQSxPQUFBO2lCQUNBLEtBQUEsTUFBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBOztpQkFFQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxLQUFBLE1BQUE7aUJBQ0EsS0FBQSxNQUFBO1lBQ0EsU0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsSUFBQSxTQUFBLFdBQUEsR0FBQTs0QkFDQSxPQUFBOzt3QkFFQSxPQUFBOztvQkFFQSxPQUFBOztpQkFFQSxLQUFBLGNBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsT0FBQSxTQUFBLE9BQUEsV0FBQSxZQUFBLE9BQUEsaUJBQUEsU0FBQSxPQUFBLFNBQUEsWUFBQSxPQUFBLGVBQUEsWUFBQSxPQUFBOztvQkFFQSxPQUFBLFlBQUE7O1lBRUEsU0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsSUFBQSxTQUFBLFdBQUEsR0FBQTs0QkFD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LEtBQUEsS0FBQSxNQUFBLGFBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBOztpQkFFQSxLQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxZQUFBO2lCQUNBLEtBQUEsS0FBQSxLQUFBLE1BQUEsWUFBQTtpQkFDQSxLQUFBLE1BQUE7aUJBQ0EsTUFBQSxhQUFBLGFBQUEsUUFBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLGFBQUE7O2lCQUVBLEtBQUE7O1lBRUEsT0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxZQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxNQUFBLGFBQUEsYUFBQSxRQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsYUFBQTs7aUJBRUEsS0FBQTs7WUFFQSxPQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLGFBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxjQUFBOzs7WUFHQSxPQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLGFBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxZQUFBOztpQkFFQSxLQUFBOztZQUVBLFVBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJB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QUE7UUFDQSxHQUFBLHFCQUFBO1FBQ0EsR0FBQSxRQUFBO1FBQ0EsR0FBQSxhQUFBOztRQUVBLElBQUEsZ0JBQUE7WUFDQSxTQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsYUFBQSxHQUFBLGdCQUFBLFFBQUEsS0FBQSxVQUFBLE9BQUEsT0FBQSxNQUFBLE1BQUEsS0FBQSxVQUFBLGFBQUEsTUFBQSxlQUFBLE1BQUEsbUJBQUEsTUFBQSxLQUFBOzs7UUFHQSxHQUFBLGFBQUEsWUFBQTtZQUNBLEdBQUEsY0FBQSxDQUFBLEdBQUE7WUFDQSxNQUFBLEtBQUEsT0FBQSxHQUFBO1lBQ0EsSUFBQSxHQUFBLGFBQUE7Z0JBQ0EsR0FBQSxZQUFBO2dCQUNBLEdBQUEsV0FBQTttQkFDQTtnQkFDQSxHQUFBLFlBQUE7Z0JBQ0EsR0FBQSxXQUFBOzs7O1FBSUEsSUFBQSxZQUFBLFlBQUE7WUFDQSxPQUFBOztZQUVBLE9BQUEsRUFBQSxNQUFBLEdBQUEsWUFBQSxTQUFBO1lBQ0EsRUFBQSxRQUFBLE1BQUEsVUFBQSxHQUFBLEdBQUE7Z0JBQ0EsS0FBQSxLQUFBLE9BQUEsSUFBQSxHQUFBOztZQUVBLEtBQUEsUUFBQTs7WUFFQSxJQUFBLGFBQUEsRUFBQSxNQUFBLEdBQUEsWUFBQSxTQUFBO2dCQUNBLFlBQUEsRUFBQSxNQUFBLEdBQUEsWUFBQSxTQUFBO2dCQUNBLGFBQUEsRUFBQSxNQUFBLEdBQUEsWUFBQSxTQUFBOztZQUVBLFdBQUEsUUFBQTtZQUNBLFVBQUEsUUFBQTtZQUNBLFdBQUEsUUFBQTs7O1lBR0EsU0FBQSxDQUFBLE1BQUEsWUFBQSxXQUFBOztZQUVBLElBQUEsUUFBQTtnQkFDQSxPQUFBO2dCQUNBLFNBQUE7O1lBRUEsRUFBQSxRQUFBLFFBQUEsU0FBQSxJQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsSUFBQSxJQUFBLE9BQUEsS0FBQTtvQkFDQSxLQUFBLElBQUEsTUFBQTtvQkFDQSxPQUFBLEtBQUEsSUFBQTs7Z0JBRUEsUUFBQSxPQUFBLE9BQUE7OztZQUdBLElBQUEsT0FBQTtnQkFDQSxNQUFBOzs7WUFH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QUFBO1FBQ0EsSUFBQSxTQUFBLElBQUE7WUFDQSxPQUFBLFlBQUEsT0FBQTtlQUNBLElBQUEsUUFBQSxNQUFBLFNBQUEsSUFBQTtZQUNBLE9BQUEsWUFBQSxPQUFBO2VBQ0E7WUFDQSxPQUFBLFlBQUEsT0FBQTs7OztJQUlBLElBQUEsYUFBQSxZQUFBOztRQUVBLElBQUEsYUFBQSxPQUFBLGNBQUE7UUFDQSxJQUFBLGFBQUEsR0FBQTtZQUNBLGNBQUE7Ozs7O1FBS0EsSUFBQSxPQUFBLFNBQUEsR0FBQSxXQUFBO1FBQ0EsSUFBQSxTQUFBLEdBQUEsV0FBQSxlQUFBLE1BQUE7WUFDQSxPQUFBLFNBQUEsR0FBQSxXQUFBOzs7UUFHQSxJQUFBLGdCQUFBLEdBQUEsT0FBQTs7UUFFQSxJQUFBLE1BQUEsR0FBQSxJQUFBO2FBQ0EsV0FBQTthQUNBLFlBQUEsT0FBQSxPQUFBO2FBQ0EsWUFBQSxPQUFBLE9BQUE7O1FBRUEsSUFBQSxNQUFBLEdBQUEsT0FBQSxTQUFBLElBQUEsT0FBQSxPQUFBLEtBQUE7WUFDQSxPQUFBO1lBQ0EsUUFBQTtXQUNBLE9BQUEsS0FBQSxLQUFBO1lBQ0EsYUFBQSxlQUFBLE9BQUEsSUFBQSxNQUFBLE9BQUEsSUFBQTtZQUNBLFNBQUE7OztRQUdBLElBQUEsUUFBQSxJQUFBLE9BQUEsS0FBQSxLQUFBO1lBQ0EsYUFBQTs7UUFFQSxNQUFBLE9BQUE7YUFDQSxNQUFBO2dCQUNBLFdBQUEsSUFBQSxLQUFBOzthQUVBLEtBQUEsU0FBQTthQUNBLEtBQUEsS0FBQTs7UUFFQSxhQUFBLE1BQUEsT0FBQTthQUNBLE1BQUE7Z0JBQ0EsVUFBQTs7YUFFQSxLQUFBO2dCQUNBLEtBQUE7O2FBRUEsTUFBQSxRQUFBLFlBQUE7Z0JBQ0EsT0FBQTs7O1FBR0EsT0FBQSxJQUFBLE9BQUE7YUFDQSxNQUFBO2dCQUNBLFlBQUE7O2FBRUEsS0FBQSxlQUFBO2FBQ0EsS0FBQSxNQUFBOzs7UUFHQSxZQUFBLFVBQUEsWUFBQSxlQUFBO1lBQ0EsV0FBQSxVQUFBLFFBQUEsVUFBQSxHQUFBO2dCQUNBLElBQUEsT0FBQSxNQUFBLGFBQUE7b0JBQ0EsSUFBQTs7Z0JBRUEsSUFBQSxJQUFBLEdBQUEsWUFBQSxFQUFBLFlBQUE7Z0JBQ0EsT0FBQSxVQUFBLEdBQUE7b0JBQ0EsRUFBQSxhQUFBLEVBQUE7b0JBQ0EsS0FBQSxLQUFBLGNBQUEsRUFBQTtvQkFDQSxPQUFBOzs7O1FBSUEsV0FBQSxVQUFBLFlBQUEsVUFBQTtZQUNBLFdBQUEsVUFBQSxLQUFBLFVBQUEsR0FBQTtnQkFDQSxJQUFBLElBQUEsR0FBQSxZQUFBLEVBQUEsVUFBQTtnQkFDQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxFQUFBLFdBQUEsRUFBQTtvQkFDQSxPQUFBLElBQUE7Ozs7O1FBS0EsZ0JBQUE7O1FBRUEsT0FBQTs7O0lBR0EsSUFBQSxTQUFBLFVBQUEsT0FBQTtRQUNBLElBQUEsZUFBQTtZQUNBLElBQUEsYUFBQTtZQUNBLElBQUEsYUFBQSxHQUFBO2dCQUNBLGNBQUE7OztZQUdBLFdBQUEsYUFBQSxTQUFBO2lCQUNBLE1BQUEsUUFBQSxZQUFBO29CQUNBLE9BQUE7O2lCQUVBLEtBQUEsVUFBQSxDQUFBLEtBQUEsS0FBQSxLQUFBO1lBQ0EsS0FBQSxhQUFBLFNBQUEsTUFBQSxLQUFBLFdBQUE7Ozs7SUFJQSxPQUFBLE9BQUEsY0FBQSxVQUFBLE9BQUE7UUFDQSxJQUFBLFNBQUEsQ0FBQSxlQUFBO1lBQ0E7ZUFDQTtZQUNBLE9BQUE7Ozs7O0FDOUhBOztBQUVBLFFBQUEsT0FBQSxZQUFBLFVBQUEsdUJBQUEsWUFBQTtJQUNBLE9BQUE7UUFDQSxZQUFBO1FBQ0EsVUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBOzs7OztBQ1BBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsd0VBQUEsVUFBQSxRQUFBLFVBQUEsYUFBQTtRQUNBLElBQUEsS0FBQTtZQUNBLFFBQUE7WUFDQSxZQUFBOztRQUVBLFNBQUEsR0FBQSxXQUFBLFlBQUE7WUFDQSxRQUFBLElBQUE7OztRQUdBLElBQUEsYUFBQSxZQUFBO1lBQ0EsT0FBQSxPQUFBLFNBQUEsVUFBQSxPQUFBO2dCQUNBOzs7O1FBSUEsSUFBQSxlQUFBLFlBQUE7WUFDQSxJQUFBLE9BQUEsU0FBQSxPQUFBLE1BQUEsU0FBQSxHQUFBO2dCQUNBLE9BQUEsTUFBQSxLQUFBLFVBQUEsR0FBQSxHQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBLFNBQUEsRUFBQSxPQUFBOzs7Z0JBR0EsWUFBQSxFQUFBLE9BQUEsT0FBQSxNQUFBLFlBQUEsT0FBQTtnQkFDQSxJQUFBLFNBQUEsVUFBQSxTQUFBLEtBQUE7O2dCQUVBLElBQUEsUUFBQSxTQUFBLEdBQUE7Z0JBQ0EsSUFBQSxDQUFBLFNBQUEsVUFBQSxHQUFBLEVBQUEsUUFBQTs7O2dCQUdBLE9BQUEsTUFBQSxLQUFBLFVBQUEsR0FBQSxHQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBLFdBQUEsRUFBQSxPQUFBOztnQkFFQSxJQUFBLFVBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQTtnQkFDQSxJQUFBLFVBQUEsT0FBQSxNQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsT0FBQTtnQkFDQSxJQUFBLFdBQUEsT0FBQSxJQUFBLFNBQUEsS0FBQSxPQUFBLElBQUEsU0FBQTtnQkFDQSxJQUFBLFNBQUE7Z0JBQ0EsSUFBQSxXQUFBLEdBQUE7b0JBQ0EsU0FBQTs7O2dCQUdBLFFBQUEsR0FBQSxRQUFBLFNBQUEsaUJBQUEsVUFBQSxXQUFBLFdBQUEsWUFBQSxrQkFBQSxXQUFBLFFBQUEsTUFBQSxPQUFBLFNBQUEsTUFBQSxPQUFBLE9BQUEsT0FBQSxRQUFBLE1BQUE7O2dCQUVBLE1BQUEsZUFBQTs7Z0JBRUEsTUFBQSxPQUFBOzs7OztRQUtBLEdBQUEsYUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxPQUFBLElBQUEsTUFBQTs7aUJBRUE7Z0JBQ0EsT0FBQTs7O1FBR0E7O1FBRUEsVUFBQSxlQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7WUFDQSxhQUFBO1lBQ0EsVUFBQTtZQUNBLE9BQUE7Z0JBQ0EsT0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Ozs7Ozs7QUN0RUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsVUFBQSxxQkFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLGFBQUE7WUFDQSxVQUFBOzs7O0FDTkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsVUFBQSxrQkFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFVBQUE7WUFDQSxTQUFBO1lBQ0EsT0FBQTtnQkFDQSx5QkFBQTtnQkFDQSxpQkFBQTtnQkFDQSxXQUFBO2dCQUNBLGlCQUFBO2dCQUNBLHdCQUFBO2dCQUNBLGlCQUFBO2dCQUNBLFNBQUE7O1lBRUEsTUFBQSxTQUFBLE9BQUEsU0FBQSxZQUFBO2dCQUNBLFVBQUEsRUFBQSxRQUFBOztnQkFFQSxRQUFBLFlBQUE7b0JBQ0EsaUJBQUEsTUFBQTtvQkFDQSxnQ0FBQTtvQkFDQSxXQUFBLE1BQUEsYUFBQTtvQkFDQSxpQkFBQSxNQUFBLG1CQUFBO29CQUNBLHdCQUFBLE1BQUE7b0JBQ0EsaUJBQUEsTUFBQSxtQkFBQTtvQkFDQSxVQUFBLFVBQUEsZUFBQSxTQUFBO3dCQUNBLE1BQUEsT0FBQSxZQUFBOzRCQUNBLE1BQUEsVUFBQSxRQUFBOzs7OztnQkFLQSxNQUFBLGlCQUFBLDJCQUFBLFVBQUEsVUFBQSxVQUFBO29CQUNBLElBQUEsUUFBQSxPQUFBLFVBQUEsV0FBQTt3QkFDQTs7b0JBRUEsUUFBQSxZQUFBLGdCQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3JDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLGdDQUFBLFVBQUEsYUFBQTtRQUNBLElBQUEsUUFBQSxVQUFBLGlCQUFBO1FBQ0E7WUFDQSxLQUFBLGtCQUFBOztZQUVBLElBQUEsT0FBQTs7WUFFQSxLQUFBLFlBQUEsU0FBQTtZQUNBO2dCQUNBLEtBQUEsU0FBQTs7Z0JBRUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLE9BQUE7O2dCQUVBLEtBQUEsT0FBQSxTQUFBLEtBQUEsT0FBQSxPQUFBLE9BQUE7Z0JBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7Z0JBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7O2dCQUVBLEtBQUEsT0FBQSxNQUFBLGFBQUEsY0FBQSxNQUFBLGNBQUEsTUFBQTtnQkFDQSxLQUFBLE9BQUEsTUFBQSxhQUFBLGNBQUEsTUFBQSxjQUFBLE1BQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBOztnQkFFQSxLQUFBLE9BQUEsYUFBQSxjQUFBLGNBQUE7Z0JBQ0EsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUFBOztnQkFFQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGNBQUE7Z0JBQ0EsS0FBQSxPQUFBLGNBQUEsY0FBQSxlQUFBO2dCQUNBLEtBQUEsT0FBQSxZQUFBLGNBQUEsWUFBQTtnQkFDQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGFBQUE7O2dCQUVBLEtBQUEsT0FBQSxxQkFBQSxjQUFBLHNCQUFBOzs7WUFHQSxLQUFBLFNBQUE7WUFDQTtnQkFDQSxLQUFBLE9BQUEsR0FBQSxPQUFBLE1BQUEsS0FBQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUEsU0FBQTtxQkFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsVUFBQSxLQUFBLE9BQUE7O2dCQUVBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsU0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxNQUFBLFFBQUE7Ozs7Z0JBSUEsS0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQTtxQkFDQSxNQUFBLFFBQUE7cUJBQ0EsTUFBQSxVQUFBO3FCQUNBLE1BQUEsZ0JBQUE7O2dCQUVBLEtBQUEsSUFBQSxZQUFBLEtBQUEsT0FB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QUFBO3FCQUNBLEtBQUEsQ0FBQTtxQkFDQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUEsS0FBQTtxQkFDQSxNQUFBLFFBQUE7O2dCQUVBLGlCQUFBLE9BQUE7cUJBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQTtxQkFDQSxNQUFBLFFBQUE7O2dCQUVBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO2dCQUNBLGlCQUFBLFVBQUE7cUJBQ0EsS0FBQSxDQUFBO3FCQUNBO3FCQUNBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUEsSUFBQTtxQkFDQSxLQUFBLE1BQUEsV0FBQTtxQkFDQSxLQUFBLGVBQUE7cUJBQ0EsTUFBQSxhQUFBLFdBQUE7cUJBQ0EsTUFBQSxRQUFBO3FCQUNBLE1BQUEsZ0JBQUE7O2dCQUVBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQTs7O1lBR0EsS0FBQSxtQkFBQSxTQUFBO1lBQ0E7Z0JBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxRQUFBOztnQkFFQSxJQUFBLE9BQUEsYUFBQSxPQUFBO2dCQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTtnQkFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBLE9BQUE7O2dCQUVBLElBQUEsWUFBQSxTQUFBLEtBQUEsT0FBQSxTQUFBLEdBQUEsSUFBQSxRQUFBO2dCQUNBLElBQUEsT0FBQSxhQUFBLFdBQUE7Z0JBQ0EsSUFBQSxRQUFBLGFBQUEsWUFBQSxPQUFBO2dCQUNBLElBQUEsUUFBQSxhQUFBLFlBQUEsT0FBQTs7Z0JBRUEsT0FBQSxDQUFBLE1BQUEsT0FBQSxPQUFBLE1BQUEsT0FBQSxPQUFBOztnQkFFQSxTQUFBLGFBQUEsT0FBQTtnQkFDQTtvQkFDQSxJQUFBLFFBQUEsS0FBQSxhQUFBLE9BQUE7b0JBQ0EsTUFBQSxLQUFBLEtBQUEsT0FBQTtvQkFDQSxNQUFBLEtBQUEsS0FBQSxPQUFBO29CQUNBLE9BQUE7Ozs7WUFJQSxLQUFBLFdBQUEsU0FBQSxPQUFBLEtBQUE7WUFDQTtnQkFDQSxJQUFBLEtBQUEsTUFBQSxPQUFBOztnQkFFQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxNQUFBLFFBQUE7cUJBQ0EsS0FBQSxLQUFBLEdBQUEsSUFBQTt5QkFDQSxXQUFBLEtBQUEsZUFBQTt5QkFDQSxTQUFBLEtBQUEsZUFBQTt5QkFDQSxZQUFBLE9BQUEsS0FBQSxPQUFBO3lCQUNBLFlBQUEsT0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxhQUFBLFdBQUEsRUFBQSxPQUFBLGVBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQTs7O1lBR0EsS0FBQSxTQUFBLFNBQUEsT0FBQTtZQUNBO2dCQUNBLElBQUEsYUFBQTtnQkFDQSxJQUFBLFFBQUEsR0FBQTtvQkFDQSxhQUFBO29CQUNBLFFBQUE7O2dCQUVBLElBQUEsbUJBQUEsS0FBQSxLQUFBLE9BQUE7O2dCQUVBLGlCQUFBLFVBQUEsUUFBQSxLQUFBLFdBQUEsT0FBQSxRQUFBLEtBQUE7O2dCQUVBLElBQUEsVUFBQSxpQkFBQSxVQUFBO2dCQUNBLFFBQUE7cUJBQ0EsU0FBQSxhQUFBLHFCQUFBLHFCQUFBLEtBQUEsT0FBQTs7OztxQkFJQSxVQUFBLGFBQUE7b0JBQ0E7d0JBQ0EsSUFBQSxlQUFBO3dCQUNBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsS0FBQSxPQUFBOzZCQUNBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsS0FBQSxPQUFBO3dCQUNBLElBQUEsa0JBQUEsS0FBQSxlQUFBLGdCQUFBO3dCQUNBLElBQUEsa0JBQUEsS0FBQSxvQkFBQTt3QkFDQSxLQUFBLG1CQUFBOzt3QkFFQSxPQUFBLFNBQUE7d0JBQ0E7NEJBQ0EsSUFBQSxXQUFBLGtCQUFBLENBQUEsZUFBQSxpQkFBQTs0QkFDQSxPQUFBLGVBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxjQUFBLFdBQUE7Ozs7Z0JBSUEsSUFBQSxjQUFBLEtBQUEsS0FBQSxPQUFBO3FCQUNBO3FCQUNBLFNBQUE7cUJBQ0EsTUFBQSxRQUFBLFlBQUE7d0JBQ0EsSUFBQSxJQUFBLFNBQUE7d0JBQ0EsSUFBQSxLQUFBLEtBQUEsSUFBQSxNQUFBLENBQUEsWUFBQTs0QkFDQSxPQUFBLEtBQUEsT0FBQTsrQkFDQSxJQUFBLEtBQUEsTUFBQSxJQUFBLE1BQUEsQ0FBQSxZQUFBOzRCQUNBLE9BQUEsS0FBQSxPQUFBOytCQUNBLElBQUEsTUFBQSxLQUFBLFlBQUE7NEJBQ0EsT0FBQSxLQUFBLE9BQUE7K0JBQ0E7NEJBQ0EsT0FBQSxLQUFBLE9BQUE7Ozs7O1lBS0EsS0FBQSxpQkFBQSxTQUFBO1lBQ0E7OztnQkFHQSxPQUFBLFFBQUEsS0FBQSxPQUFBLFFBQUEsT0FBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUEsUUFBQSxNQUFBOzs7WUFHQSxLQUFBLGlCQUFBLFNBQUE7WUFDQTtnQkFDQSxPQUFBLEtBQUEsZUFBQSxTQUFBLEtBQUEsS0FBQTs7O1lBR0EsS0FBQSxlQUFBLFNBQUEsT0FBQTtZQUNBO2dCQUNBLE9BQUEsR0FBQSxHQUFBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBLFNBQUEsS0FBQSxJQUFBLEtBQUEsZUFBQTtvQkFDQSxHQUFBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBLFNBQUEsS0FBQSxJQUFBLEtBQUEsZUFBQTs7OztZQUlBLEtBQUEsVUFBQTs7O1FBR0EsT0FBQTtZQUNBLGFBQUEsVUFBQSxNQUFBLE9BQUEsS0FBQSxLQUFBLE1BQUE7Z0JBQ0EsSUFBQSxTQUFBO29CQUNBLE1BQUEsUUFBQSxZQUFBO29CQUNBLE9BQUE7b0JBQ0EsS0FBQSxPQUFBO29CQUNBLEtBQUEsT0FBQTtvQkFDQSxZQUFBOzs7Z0JBR0EsSUFBQSxRQUFBLE9BQUEsTUFBQSxPQUFBO2dCQUNBLE9BQUEsY0FBQSxDQUFBLEVBQUEsTUFBQSxPQUFBLE1BQUEsTUFBQSxNQUFBLElBQUEsT0FBQSxNQUFBLE1BQUE7Z0JBQ0EsT0FBQSxXQUFBLENBQUEsRUFBQSxNQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUEsSUFBQSxPQUFBOztnQkFFQSxJQUFBLFFBQUEsSUFBQSxNQUFBLE9BQUEsa0JBQUE7Z0JBQ0EsTUFBQTtnQkFDQSxPQUFBOzs7OztBQ2pUQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLG1DQUFBLFVBQUEsaUJBQUE7O1FBRUEsSUFBQSxnQkFBQSxVQUFBLFlBQUE7WUFDQSxJQUFBLFVBQUE7O1lBRUEsSUFBQSxZQUFBO2dCQUNBLEVBQUEsUUFBQSxZQUFBLFVBQUEsT0FBQTtvQkFDQSxJQUFBLFlBQUE7b0JBQ0EsSUFBQSxnQkFBQTtvQkFDQSxJQUFBLEVBQUEsV0FBQSxPQUFBLE1BQUE7d0JBQ0EsZ0JBQUE7O29CQUVBLFFBQUEsS0FBQTt3QkFDQSxXQUFBO3dCQUNBLE9BQUE7Ozs7O1lBS0EsT0FBQTs7O1FBR0EsT0FBQTtZQUNBLG9CQUFBLFlBQUE7Z0JBQ0EsT0FBQTtvQkFDQSxvQkFBQTtvQkFDQSwwQkFBQTtvQkFDQSwyQkFBQSxnQkFBQSxXQUFBO29CQUNBLHlCQUFBLGdCQUFBLFdBQUE7b0JBQ0EsYUFBQTtvQkFDQSxpQkFBQTtvQkFDQSxvQkFBQTtvQkFDQSxzQkFBQTtvQkFDQSxlQUFBO29CQUNBLGVBQUE7b0JBQ0EscUJBQUEsQ0FBQSxJQUFBLElBQUEsSUFBQTtvQkFDQSxvQkFBQTtvQkFDQSx1QkFBQTtvQkFDQSwwQkFBQTtvQkFDQSx1QkFBQTs7O1lBR0EsaUJBQUEsVUFBQSxZQUFBLFlBQUE7Z0JBQ0EsSUFBQSxhQUFBLGNBQUEsV0FBQTtnQkFDQSxFQUFBLFFBQUEsWUFBQSxVQUFBLFFBQUEsS0FBQTtvQkFDQSxJQUFBLFFBQUEsRUFBQSxXQUFBLE9BQUEsT0FBQSxPQUFBLE9BQUEsTUFBQSxVQUFBLEtBQUEsT0FBQTt3QkFDQSxTQUFBLEVBQUEsS0FBQSxZQUFBLENBQUEsT0FBQTs7b0JBRUEsSUFBQSxRQUFBO3dCQUNBLE9BQUEsT0FBQTs0QkFDQSxXQUFBLE9BQUE7NEJBQ0EsVUFBQTs7OztnQkFJQSxPQUFBOzs7Ozs7QUMxREEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSw0QkFBQSxVQUFBLFFBQUE7UUFDQSxPQUFBO1lBQ0EsV0FBQSxVQUFBLFVBQUEsVUFBQTtnQkFDQSxPQUFBLE9BQUEsSUFBQSxVQUFBO29CQUNBLE9BQUE7b0JBQ0EsWUFBQTs7Ozs7O0FDUkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxpRUFBQSxVQUFBLGNBQUEsaUJBQUEsaUJBQUE7UUFDQSxJQUFBLFNBQUEsVUFBQSxXQUFBLFFBQUEsV0FBQSxhQUFBLFdBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFNBQUEsYUFBQSxZQUFBO1lBQ0EsS0FBQSxZQUFBLGdCQUFBLFlBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLFlBQUEsZ0JBQUEsWUFBQTs7OztRQUlBLE9BQUEsWUFBQTtZQUNBLGFBQUEsWUFBQTtnQkFDQSxJQUFBLEtBQUEsVUFBQSxVQUFBLFFBQUEsS0FBQSxVQUFBLE1BQUEsTUFBQTtvQkFDQSxJQUFBLEtBQUEsVUFBQSxNQUFBLE9BQUEsR0FBQTt3QkFDQSxPQUFBLENBQUEsQ0FBQSxLQUFBLFVBQUEsVUFBQSxPQUFBLEtBQUEsVUFBQSxNQUFBLFFBQUEsS0FBQSxRQUFBOzs7Z0JBR0EsT0FBQTs7WUFFQSxhQUFBLFlBQUE7Z0JBQ0EsSUFBQSxLQUFBLFVBQUEsVUFBQSxPQUFBLEtBQUEsVUFBQSxNQUFBLEtBQUE7b0JBQ0EsSUFBQSxLQUFBLFVBQUEsTUFBQSxNQUFBLEdBQUE7d0JBQ0EsT0FBQSxDQUFBLENBQUEsS0FBQSxVQUFBLFVBQUEsTUFBQSxLQUFBLFVBQUEsTUFBQSxPQUFBLEtBQUEsUUFBQTs7O2dCQUdBLE9BQUE7O1lBRUEsY0FBQSxZQUFBO2dCQUNBLElBQUEsS0FBQSxVQUFBLFVBQUEsUUFBQSxLQUFBLFVBQUEsTUFBQSxNQUFBO29CQUNBLElBQUEsS0FBQSxVQUFBLE1BQUEsT0FBQSxHQUFBO3dCQUNBLE9BQUEsQ0FBQSxDQUFBLEtBQUEsVUFBQSxVQUFBLE9BQUEsS0FBQSxVQUFBLE1BQUEsUUFBQSxLQUFBLFFBQUE7OztnQkFHQSxPQUFBOzs7OztRQUtBLE9BQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxPQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsT0FBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsT0FBQSxNQUFBOzs7UUFHQSxPQUFBOzs7QUMvREEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxnQkFBQSxZQUFBO1FBQ0EsSUFBQSxlQUFBLFVBQUEsV0FBQSxVQUFBLE1BQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLE9BQUE7Ozs7UUFJQSxhQUFBLFlBQUE7Ozs7O1FBS0EsYUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsYUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLGFBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGFBQUEsTUFBQTs7O1FBR0EsT0FBQTs7O0FDcENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsa0JBQUEsWUFBQTtRQUNBLElBQUEsaUJBQUEsVUFBQSxNQUFBLEtBQUEsTUFBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsTUFBQTtZQUNBLEtBQUEsT0FBQTs7OztRQUlBLGVBQUEsWUFBQTs7Ozs7UUFLQSxlQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxlQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsZUFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsZUFBQSxNQUFBOzs7UUFHQSxPQUFBOzs7QUNwQ0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxzQ0FBQSxVQUFBLGdCQUFBO1FBQ0EsSUFBQSxrQkFBQSxVQUFBLE9BQUEsV0FBQSxNQUFBO1lBQ0EsS0FBQSxRQUFBLGVBQUEsWUFBQTtZQUNBLEtBQUEsWUFBQSxlQUFBLFlBQUE7WUFDQSxLQUFBLE9BQUEsZUFBQSxZQUFBOzs7O1FBSUEsZ0JBQUEsWUFBQTs7Ozs7UUFLQSxnQkFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsZ0JBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxnQkFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsZ0JBQUEsTUFBQTs7O1FBR0EsT0FBQTs7O0FDcENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsbUJBQUEsWUFBQTtRQUNBLElBQUEsa0JBQUEsVUFBQSxXQUFBLFdBQUEsVUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsV0FBQTs7OztRQUlBLGdCQUFBLFlBQUE7Ozs7O1FBS0EsZ0JBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLGdCQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsZ0JBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGdCQUFBLE1BQUE7OztRQUdBLE9BQUE7OztBQ3BDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLCtDQUFBLFVBQUEsSUFBQSxPQUFBLGFBQUE7UUFDQSxTQUFBLGFBQUEsT0FBQSxRQUFBOztZQUVBLFFBQUEsS0FBQTs7WUFFQSxJQUFBLGNBQUEsS0FBQSxJQUFBLEdBQUEsU0FBQSxNQUFBO1lBQ0EsT0FBQSxJQUFBLE1BQUEsY0FBQSxJQUFBLGNBQUEsSUFBQSxHQUFBLEtBQUEsT0FBQTs7O1FBR0EsT0FBQTtZQUNBLDBCQUFBLFNBQUEsSUFBQTtnQkFDQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLE1BQUEsTUFBQTt3QkFDQSxPQUFBLElBQUEsUUFBQSxLQUFBOztvQkFFQSxJQUFBLE9BQUEsUUFBQSxNQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxNQUFBLFFBQUEsS0FBQTs7b0JBRUEsT0FBQSxDQUFBLElBQUEsS0FBQSxNQUFBLFFBQUEsS0FBQTs7Z0JBRUEsT0FBQTs7WUFFQSw0QkFBQSxTQUFBLElBQUEsU0FBQTtnQkFDQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLE1BQUEsTUFBQTt3QkFDQSxPQUFBLElBQUEsUUFBQSxZQUFBOztvQkFFQSxJQUFBLE9BQUEsUUFBQSxNQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxNQUFBLFFBQUEsWUFBQTs7b0JBRUEsSUFBQSxPQUFBLEtBQUEsUUFBQSxNQUFBLEtBQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLEtBQUEsTUFBQSxRQUFBLFlBQUE7O29CQUVBLElBQUEsT0FBQSxLQUFBLEtBQUEsUUFBQSxNQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUE7d0JBQ0EsT0FBQSxDQUFBLElBQUEsS0FBQSxLQUFBLE1BQUEsUUFBQSxZQUFBOztvQkFFQSxPQUFBLENBQUEsSUFBQSxLQUFBLEtBQUEsS0FBQSxNQUFBLFFBQUEsWUFBQTs7Z0JBRUEsT0FBQTs7WUFFQSxpQkFBQSxZQUFBO2dCQUNBLElBQUEsSUFBQTtvQkFDQSxJQUFBO29CQUNBLElBQUEsRUFBQTtvQkFDQSxJQUFBLFNBQUE7b0JBQ0EsSUFBQSxFQUFBLGNBQUEsRUFBQSxlQUFBLEVBQUE7b0JBQ0EsSUFBQSxFQUFBLGVBQUEsRUFBQSxnQkFBQSxFQUFBOztnQkFFQSxPQUFBO29CQUNBLE9BQUE7b0JBQ0EsUUFBQTs7O1lBR0EsbUJBQUEsVUFBQSxPQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLE9BQUEsSUFBQTtvQkFDQSxPQUFBLE9BQUEsSUFBQTtvQkFDQSxPQUFBLE9BQUEsSUFBQSxJQUFBLEtBQUEsT0FBQSxJQUFBO29CQUNBLGNBQUE7O2dCQUVBLElBQUEsV0FBQSxPQUFBLFNBQUE7O2dCQUVBLGNBQUEsU0FBQSxTQUFBLElBQUEsY0FBQSxZQUFBLFNBQUEsUUFBQSxLQUFBLFFBQUE7Z0JBQ0EsY0FBQSxTQUFBLFVBQUEsSUFBQSxjQUFBLFlBQUEsU0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxjQUFBLFNBQUEsWUFBQSxJQUFBLGNBQUEsWUFBQSxTQUFBLFdBQUEsS0FBQSxRQUFBO2dCQUNBLGNBQUEsY0FBQSxZQUFBLFNBQUEsV0FBQSxLQUFBOztnQkFFQSxPQUFBOztZQUVBLGNBQUEsU0FBQSxVQUFBO2dCQUNBLElBQUEsU0FBQSxDQUFBLFNBQUEsU0FBQSxVQUFBLFlBQUEsV0FBQSxTQUFBO2dCQUNBLE9BQUEsT0FBQTs7WUFFQSxNQUFBLFlBQUE7Z0JBQ0EsSUFBQSxLQUFBLE9BQUEsVUFBQTtvQkFDQSxRQUFBLEdBQUEsUUFBQTtvQkFDQSxRQUFBLEdBQUEsUUFBQTs7Z0JBRUEsSUFB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QSxlQUFBLEtBQUEsZ0JBQUEsS0FBQSxnQkFBQTtnQkFDQSxtQkFBQSxLQUFBLG9CQUFBLEtBQUEsb0JBQUE7Z0JBQ0EsS0FBQTs7OztRQUlBLElBQUEsMEJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLFFBQUEsS0FBQSxTQUFBLEtBQUEsU0FBQTtnQkFDQSxhQUFBLEtBQUEsY0FBQSxTQUFBLEtBQUEsZUFBQTtnQkFDQSxlQUFBLEtBQUEsZ0JBQUEsS0FBQSxnQkFBQTtnQkFDQSxtQkFBQSxLQUFBLG9CQUFBLEtBQUEsb0JBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBOzs7O1FBSUEsSUFBQSxpQ0FBQSxVQUFBLE1BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxPQUFBO2dCQUNBLFVBQUE7Z0JBQ0EsT0FBQTs7OztRQUlBLElBQUEsb0JBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLFNBQUEsS0FBQSxXQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLEtBQUEsWUFBQTtnQkFDQSxLQUFBOzs7O1FBSUEsSUFBQSxvQkFBQSxVQUFBLE1BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxRQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLFNBQUEsS0FBQSxhQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLFNBQUEsUUFBQSxLQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQSxPQUFBLE1BQUEsTUFBQSxLQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLE1BQUEsUUFBQSxLQUFBLFNBQUEsS0FBQSxRQUFBLENBQUEsS0FBQSxTQUFBLENBQUE7Z0JBQ0EsUUFBQSxLQUFBLFNBQUEsS0FBQSxTQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLEtBQUEsWUFBQTs7OztRQUlBLElBQUEsa0JBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLGtCQUFBLEtBQUEsbUJBQUEsS0FBQSxtQkFBQTs7OztRQUlBLElBQUEsdUJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBO2dCQUNB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QSxFQUFBLFFBQUEsT0FBQSxRQUFBLE9BQUEsUUFBQSxPQUFBLE1BQUE7WUFDQSxFQUFBLGtCQUFBLE9BQUEsa0JBQUEsT0FBQSxrQkFBQTtZQUNBLE9BQUE7OztRQUdBLElBQUEsbUJBQUEsVUFBQSxRQUFBO1lBQ0EsT0FBQTs7O1FBR0EsSUFBQSxrQkFBQSxVQUFBLE1BQUEsV0FBQSxTQUFBLE9BQUEsT0FBQSxXQUFBLFdBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQSxZQUFBLFlBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxPQUFBO2dCQUNBLE9BQUEsUUFBQSxRQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsV0FBQTs7OztRQUlBLE9BQUE7WUFDQSxTQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLFNBQUEsY0FBQTtnQkFDQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxhQUFBLGFBQUE7b0JBQ0EsUUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxnQkFBQSxVQUFBLFFBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxTQUFBLGlCQUFBO2dCQUNBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLGFBQUEsYUFBQTtvQkFDQSxRQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsS0FBQSxVQUFBLE9BQUEsWUFBQSxLQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxZQUFBLFVBQUEsUUFBQTtnQkFDQSxTQUFBLFVBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsTUFBQTtvQkFDQSxLQUFBLFlBQUEsYUFBQSxhQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFB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LEtBQUEsSUFBQTs7b0JBRUEsRUFBQSxRQUFBLFNBQUEsS0FBQSxJQUFBLElBQUE7d0JBQ0EsV0FBQTt3QkFDQSxPQUFBO3dCQUNBLElBQUE7d0JBQ0EsSUFBQTt3QkFDQSxTQUFBO3dCQUNBLE9BQUE7d0JBQ0EsUUFBQTs7b0JBRUEsRUFBQSxRQUFBLFFBQUEsR0FBQSxPQUFBLElBQUEsT0FBQSxLQUFBLElBQUEsSUFBQTs7Ozs7OztvQkFPQSxJQUFBLE9BQUEsWUFBQTtvQkFDQSxFQUFBLFFBQUEsVUFBQSxLQUFBLElBQUE7d0JBQ0EsV0FBQTt3QkFDQSxPQUFBO3dCQUNBLElBQUE7d0JBQ0EsSUFBQTt3QkFDQSxTQUFBO3dCQUNBLE9BQUE7d0JBQ0EsUUFBQTs7b0JBRUEsRUFBQSxRQUFBLE9BQUEsS0FBQSxJQUFBLElBQUEsUUFBQSxLQUFBLElBQUE7Ozs7Ozs7O2dCQVFBLElBQUEsU0FBQSxJQUFBLFFBQUE7OztnQkFHQSxPQUFBLE9BQUE7OztnQkFHQSxJQUFBLE1BQUEsSUFBQSxLQUFBLFdBQUEsTUFBQTtnQkFDQSxJQUFBLFNBQUEsRUFBQSxRQUFBO2dCQUNBLElBQUEsVUFBQSxFQUFBLFFBQUE7Z0JBQ0EsSUFBQSxRQUFBLFFBQUE7O2dCQUVBLFFBQUEsSUFBQTtnQkFDQSxRQUFBLElBQUEsSUFBQTs7O2dCQUdBLElBQUEsVUFBQSxJQUFBLElBQUE7b0JBQ0EsSUFBQSxLQUFBLFdBQUEsSUFBQSxLQUFBLE1BQUEsSUFBQSxLQUFBLE1BQUEsSUFBQSxLQUFBLE1BQUEsUUFBQTs7Ozs7Z0JBS0EsSUFBQSxlQUFBLEtBQUEsSUFBQSxDQUFBLElBQUEsR0FBQSxNQUFBLE9BQUEsQ0FBQSxJQUFBLEdBQUEsTUFBQTtnQkFDQTtxQkFDQSxVQUFBLEVBQUEsSUFBQSxHQUFBLFFBQUEsSUFBQSxHQUFBO3FCQUNBLE1BQUE7cUJBQ0EsTUFBQTs7O2dCQUdBLEVBQUEsYUFBQSxRQUFBLFNBQUEsU0FBQSxRQUFBLEtBQUEsU0FBQTs7OztnQkFJQSxLQUFBLEdBQUEsUUFBQTtnQkFDQSxJQUFBLEdBQUEs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aUJBQUEsSUFBQSxPQUFBLFNBQUE7Ozs7OztRQU1BLEdBQUEsV0FBQSxVQUFBLFVBQUEsV0FBQTtZQUNBLElBQUEsYUFBQSxDQUFBLFNBQUEsYUFBQSxTQUFBLE9BQUEsUUFBQTtZQUNBLElBQUEsWUFBQSxjQUFBLE1BQUEsU0FBQTtZQUNBLElBQUEsTUFBQSxjQUFBLFdBQUEsZUFBQSxjQUFBLGNBQUEsZ0JBQUE7WUFDQSxPQUFBLHNCQUFBLE1BQUEsT0FBQSxhQUFBLGVBQUE7OztRQUdBLEdBQUEsZ0JBQUEsVUFBQSxPQUFBLE9BQUE7WUFDQSxJQUFBLGFBQUEsQ0FBQSxDQUFBLFFBQUEsU0FBQSxLQUFBLFFBQUE7WUFDQSxPQUFBLGFBQUEsSUFBQSxZQUFBLGFBQUEsTUFBQTs7O1FBR0EsR0FBQSx1QkFBQSxVQUFBLFlBQUEsT0FBQTtZQUNBLElBQUEsVUFBQSxHQUFBO2dCQUNBLE9BQUE7O1lBRUEsT0FBQSxDQUFBLENBQUEsYUFBQSxTQUFBLEtBQUEsUUFBQSxLQUFBOzs7UUFHQSxHQUFBLGdCQUFBLFlBQUE7WUFDQSxHQUFBLFlBQUEsT0FBQTtZQUNBLGFBQUEsOEJBQUEsR0FBQTtZQUNBLEVBQUEsUUFBQSxFQUFBLE1BQUEsR0FBQSxpQkFBQSxVQUFBLE9BQUE7Z0JBQ0EsVUFBQSxPQUFBLE1BQUEsSUFBQSxNQUFBOztZQUVBLEdBQUEsVUFBQTtZQUNBOzs7UUFHQSxHQUFBLGdCQUFBLFVBQUEsT0FBQTtZQUNBLEdBQUEsZUFBQSxPQUFBLE1BQUEsU0FBQSxhQUFBLE9BQUEsTUFBQTtZQUNBLElBQUEsQ0FBQSxHQUFBLFNBQUE7Z0JBQ0EsR0FBQTs7OztRQUlBLElBQUEsYUFBQSxVQUFBLE1BQUEsU0FBQTtZQUNBLElBQUEsVUFBQTtZQUNBLEVBQUEsUUFBQSxNQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLGlCQUFBLEVBQUEsT0FBQSxRQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLE9BQUEsT0FBQSxJQUFBLEVBQUEsTUFBQTtvQkFDQSxJQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUEsSUFBQSxPQUFBLFFBQUEsU0FBQTt3QkFDQSxPQUFBOzs7Z0JBR0EsUUFBQSxLQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsZUFBQSxVQUFBLE9BQUEsSUFBQTtZQUNBLElBQUEsZUFBQSxNQUFBO2dCQUNBLGtCQUFBLE1BQUE7Z0JBQ0EsYUFBQSxNQUFBO2dCQUNBLGFBQUEsTUFBQTs7WUFFQSxJQUFBLE1BQUE7Z0JBQ0EsUUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxjQUFBLEVBQUEsSUFBQSxPQUFBO2dCQUNBLFdBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsaUJBQUEsRUFBQSxJQUFBLE9BQUE7Z0JBQ0EsTUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxZQUFBLEVBQUEsSUFBQSxPQUFBO2dCQUNBLE9BQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsWUFBQSxFQUFBLElBQUEsT0FBQTs7WUFFQSxJQUFBLGFBQUEsSUFBQSxTQUFBLElBQUEsWUFBQSxJQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsYUFBQSxZQUFBO1lBQ0EsYUFBQSw4QkFBQSxHQUFBO1lBQ0EsZUFBQSxrQkFBQSxLQUFBLFVBQUEsY0FBQTtnQkFDQSxXQUFBLEVBQUEsVUFBQSxhQUFBO2dCQUNBLEdBQUEsY0FBQSxLQUFBLGFBQUE7Z0JBQ0EsR0FBQSxnQkFBQSxFQUFBLFFBQUEsR0FBQTtnQkFDQSxHQUFBLGtCQUFBLEVBQUEsS0FBQSxHQUFBLGVBQUEsRUFBQSxNQUFBLEdBQUEsZUFBQSxXQUFBO2dCQUNBLEdBQUEsWUFBQSxhQUFBLGFBQUE7O2dCQUVBLElBQUEsZ0JBQUE7b0JBQ0EsTUFBQTtvQkFDQSxXQUFBO29CQUNBLFNBQUE7b0JBQ0EsT0FBQTtvQkFDQSxXQUFBLEdBQUEsZ0JBQUEsS0FBQSxJQUFBLENBQUEsR0FBQSxnQkFBQSxNQUFBLEVBQUEsSUFBQSxVQUFBO29CQUNBLFFBQUEsQ0FBQSxzQkFBQSx5QkFBQSxvQkFBQTtvQkFDQSxPQUFBO29CQUNBLFVBQUE7OztnQkFHQSxlQUFBLFlBQUEsZUFBQSxLQUFBLFVBQUEsTUFBQTtvQkFDQSxJQUFBLEtBQUEsUUFBQSxTQUFBLEdBQUE7d0JBQ0EsSUFBQSxhQUFBLEVBQUEsSUFBQSxLQUFBLFNBQUE7NEJBQ0EsY0FBQSxXQUFBLFlBQUE7NEJBQ0EsY0FBQSxXQUFBLGFBQUE7O3dCQUVBLEVBQUEsUUFBQSxVQUFBLFVBQUEsU0FBQTs0QkFDQSxHQUFBLGdCQUFBLEtBQUE7Z0NBQ0EsVUFBQSxRQUFBLFlBQUE7Z0NBQ0Esa0JBQUEsYUFBQSxhQUFBLFFBQUE7Z0NBQ0Esa0JBQUEsYUFBQSxhQUFBLFFBQUE7Z0NBQ0EsYUFBQSxhQUFBLFlBQUEsUUFBQTs7Ozt3QkFJQSxHQUFBLGtCQUFBLEVBQUEsWUFBQSxHQUFBLGlCQUFBLENBQUEsVUFBQSxHQUFBOzRCQUNBLElBQUEsRUFBQSxpQkFBQSxRQUFBLEdBQUE7Z0NBQ0EsT0FBQSxFQUFBLGlCQUFBLGFBQUEsRUFBQSxpQkFBQTs7NEJBRUEsT0FBQTsyQkFDQSwyQkFBQSxDQUFBLFFBQUE7O3dCQUVBLEdBQUEsWUFBQSxnQkFBQSxHQUFBLGdCQUFBO3dCQUNBLEdBQUEsWUFBQSwwQkFBQSxHQUFBLGdCQUFBO3dCQUNBLEdBQUEsWUFBQSxPQUFBLEdBQUE7OztvQkFHQSxHQUFBLFVBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsR0FBQSxVQUFBO29CQUNBLFFBQUEsSUFBQTtvQkFDQSxPQUFBLFNBQUE7Ozs7O1FBS0E7O1FBRUEsT0FBQSxPQUFBLHNCQUFBLFVBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO2dCQUNBOztZQUVBLElBQUEsR0FBQSxTQUFBO2dCQUNBLElBQUEsbUJBQUE7b0JBQ0EsR0FBQSxjQUFBOzttQkFFQTtnQkFDQSxvQkFBQSxhQUFBO2dCQUNBLEdBQUEsY0FBQTs7Ozs7QUNsTkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSxtUEFBQSxVQUFBLFFBQUEsV0FBQSxXQUFBLGFBQUEsY0FBQSxjQUFBLFlBQUEsZUFBQSxhQUFBLFlBQUEscUJBQUEsZ0JBQUEsYUFBQSxhQUFBLFFBQUE7UUFDQSxjQUFBLGVBQUE7O1FBRUEsSUFBQSxLQUFBO1lBQ0EsaUJBQUEsRUFBQSxNQUFBLFlBQUEsT0FBQSxZQUFBLFNBQUEsSUFBQSxJQUFBOztRQUVBLEdBQUEsYUFBQSxhQUFBOztRQUVBLEdBQUEsZUFBQTtRQUNBLEdBQUEsVUFBQTtRQUNBLEdBQUEsV0FBQTtRQUNBLEdBQUEsZ0JBQUEsQ0FBQTtRQUNBLEdBQUEsZUFBQTtRQUNBLEdBQUEsa0JBQUEsR0FBQSxXQUFBLGNBQUEsR0FBQSxXQUFBLGNBQUE7UUFDQSxHQUFBLGtCQUFBLFlBQUE7UUFDQSxHQUFBLG9CQUFBLEdBQUEsV0FBQSxVQUFBLEdBQUEsZ0JBQUE7UUFDQSxHQUFBLHNCQUFBLEVBQUEsSUFBQSxZQUFBLGlCQUFBO1FBQ0EsR0FBQSx3QkFBQSxHQUFBLFdBQUEsa0JBQUEsR0FBQSxvQkFBQTtRQUNBLEdBQUEsY0FBQSxZQUFBLFlBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSxvQkFBQSxPQUFBLElBQUEsR0FBQSxXQUFBLFNBQUE7UUFDQSxHQUFBLHlCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDZCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHVCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQSxPQUFBLElBQUEsR0FBQSxXQUFBLE9BQUE7UUFDQSxHQUFBLHdCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDRCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHNCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQTtZQUNBLFVBQUE7O1FBRUEsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsd0JBQUEsR0FBQSxXQUFBLFFBQUE7UUFDQSxHQUFBLFlBQUEscUJBQUEsR0FBQSxXQUFBLGFBQUEsR0FBQSxZQUFBO1FBQ0EsR0FBQSxZQUFBLE9BQUE7O1FBRUEsSUFBQSxvQkFBQSxHQUFBLFdBQUEs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LGtCQUFBLFVBQUEsUUFBQTtnQkFDQSxTQUFBLFVBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLGFBQUEsb0JBQUE7b0JBQ0EsUUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEtBQUEsVUFBQSxhQUFBLFlBQUEsS0FBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsd0JBQUEsVUFBQSxJQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBLElBQUEsWUFBQSxhQUFBLG9CQUFBLG9CQUFBLEtBQUEsS0FBQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUEsYUFBQSxZQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLFlBQUEsU0FBQSxPQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLFFBQUE7b0JBQ0EsS0FBQSxZQUFBLGFBQUEsb0JBQUEsb0JBQUEsU0FBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsUUFBQSxTQUFBLE9BQUE7Z0JBQ0EsSUFBQSxNQUFBLE9BQUEsWUFBQSxhQUFBLG9CQUFBLG9CQUFBLFNBQUE7Ozs7O2dCQUtBLElBQUEsMEJBQUEsVUFBQSxJQUFBLEdBQUE7b0JBQ0EsSUFBQTt3QkFDQSxPQUFBOzs7O2dCQUlBLElBQUEsd0JBQUEsT0FBQSxJQUFBLHlCQUFBO3dCQUNBLFFBQUE7d0JBQ0EsT0FBQSxZQUFBLGNBQUE7OztnQkFHQSxPQUFBLHNCQUFBLFFBQUEsS0FBQSxNQUFBLE1BQUEsVUFBQSxRQUFBO29CQUNBLEdBQUEsT0FBQSxVQUFBO3dCQUNBLE9BQUEsZ0JBQUEs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UUFBQSxJQUFBLE9BQUE7b0JBQ0Esb0JBQUEsT0FBQSxPQUFBLFVBQUEsSUFBQSxLQUFBLE1BQUEsTUFBQSxVQUFBLFFBQUE7O3dCQUVBLElBQUEsUUFBQTs0QkFDQSxJQUFBLE1BQUEsRUFBQSxTQUFBLElBQUEsS0FBQTs0QkFDQSxHQUFBLGFBQUEsQ0FBQSxJQUFBLGNBQUEsSUFBQSxLQUFBLG1CQUFBLElBQUEsS0FBQTs0QkFDQSxJQUFBLEdBQUEsY0FBQSxHQUFBO2dDQUNBLEdBQUEsY0FBQTs7NEJBRUEsR0FBQSxVQUFBOytCQUNBOzRCQUNBLElBQUEsT0FBQSxjQUFBLE9BQUEsZUFBQSxJQUFBO2dDQUNBLEdBQUEsb0JBQUEsT0FBQTs7NEJBRUEsT0FBQSxjQUFBOzs7OztZQUtBLE9BQUEsT0FBQSxjQUFBLFlBQUE7Z0JBQ0EsSUFBQSxHQUFBLFNBQUE7b0JBQ0EsSUFBQSxHQUFBLGVBQUEsR0FBQSxjQUFBLEdBQUE7d0JBQ0EsU0FBQSxZQUFBOzRCQUNBLEdBQUEsY0FBQTs0QkFDQSxJQUFBLGFBQUEsRUFBQSxTQUFBLElBQUEsS0FBQSxTQUFBLEtBQUE7NEJBQ0EsRUFBQSxTQUFBLElBQUEsS0FBQSxTQUFBLFVBQUE7MkJBQ0E7Ozs7OztRQU1BLEdBQUEsYUFBQSxVQUFBLE1BQUE7WUFDQSxRQUFBLElBQUE7OztRQUdBLEdBQUEsZ0JBQUEsWUFBQTtZQUNBLFFBQUEsSUFBQTs7O1FBR0E7O1FBRUEsVUFBQSxtQkFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7WUFDQSxjQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLFdBQUE7Ozs7OztBQzlEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHFFQUFBLFVBQUEsWUFBQSxRQUFBLGdCQUFBO1FBQ0EsSUFBQSxLQUFBOztRQUVBLEdBQUEsbUJBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSx1QkFBQTtRQUNBLEdBQUEsWUFBQTs7UUFFQSxJQUFBLG1CQUFBLFlBQUE7WUFDQSxlQUFBLGlCQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBLE9BQUE7Z0JBQ0EsT0FBQTtlQUNBLEtBQUEsTUFBQSxNQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLEtBQUEsV0FBQTtvQkFDQSxHQUFBLGlCQUFBO29CQUNBLEdBQUEsZ0JBQUEsS0FBQTtvQkFDQSxHQUFBLFFBQUE7b0JBQ0EsR0FBQSxTQUFBOztvQkFFQSxJQUFBLGNBQUE7d0JBQ0EsV0FBQTs7b0JBRUEsRUFBQSxRQUFBLEtBQUEsU0FBQSxVQUFBLFFBQUE7d0JBQ0EsY0FBQSxPQUFBO3dCQUNBLEdBQUEsUUFBQSxHQUFBLFFBQUEsWUFBQTt3QkFDQSxHQUFBLFNBQUEsR0FBQSxTQUFBLFlBQUE7d0JBQ0EsU0FBQSxLQUFBLE9BQUE7OztvQkFHQSxJQUFBLGNBQUE7d0JBQ0EsaUJBQUE7d0JBQ0EsZUFBQTt3QkFDQSxvQkFBQTs7b0JBRUEsRUFBQSxRQUFBLFVBQUEsVUFBQSxHQUFBO3dCQUNBLEVBQUEsUUFBQSxHQUFBLFVBQUEsTUFBQTs0QkFDQSxJQUFBLEtBQUEsV0FBQSxVQUFBO2dDQUNBLGlCQUFBLGlCQUFBLEtBQUE7bUNBQ0EsSUFBQSxLQUFBLFdBQUEsUUFBQTtnQ0FDQSxlQUFBLGVBQUEsS0FBQTttQ0FDQSxJQUFBLEtBQUEsV0FBQSxhQUFBO2dDQUNBLG9CQUFBLG9CQUFBLEtBQUE7Ozs7O29CQUtBLElBQUEsaUJBQUEsS0FBQSxlQUFBLEtBQUEsb0JBQUEsR0FBQTt3QkFDQSxJQUFBLGlCQUFBLEdBQUE7NEJBQ0EsWUFBQSxLQUFBO2dDQUNBLFFBQUE7Z0NBQ0EsT0FBQTs7O3dCQUdBLElBQUEsb0JBQUEsR0FBQTs0QkFDQSxZQUFBLEtBQUE7Z0NBQ0EsUUFBQTtnQ0FDQSxPQUFBOzs7d0JBR0EsSUFBQSxlQUFBLEdBQUE7NEJBQ0EsWUFBQSxLQUFBO2dDQUNBLFFBQUE7Z0NBQ0EsT0FBQTs7Ozs7b0JBS0EsR0FBQSxZQUFBO3dCQUNBLFdBQUEsR0FBQSxVQUFBLElBQUEsSUFBQSxNQUFBLENBQUEsQ0FBQSxH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QUFBO1lBQ0EsS0FBQSxPQUFBLG1CQUFBLFlBQUE7WUFDQSxLQUFBLFdBQUE7Ozs7UUFJQSxlQUFBLFlBQUE7Ozs7O1FBS0EsZUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxlQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsZUFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsZUFBQSxNQUFBOzs7UUFHQSxPQUFBOzs7O0FDdENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsc0JBQUEsWUFBQTtRQUNBLElBQUEscUJBQUEsVUFBQSxJQUFBLE1BQUEsV0FBQSxTQUFBLFVBQUEsZUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsZ0JBQUE7Ozs7UUFJQSxtQkFBQSxZQUFBOzs7OztRQUtBLG1CQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxtQkFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLG1CQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxtQkFBQSxNQUFBOzs7UUFHQSxPQUFBOzs7O0FDMUNBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsc0JBQUEsWUFBQTtRQUNBLElBQUEscUJBQUEsVUFBQSxNQUFBLE9BQUEsU0FBQSxVQUFBLE9BQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFFBQUE7Ozs7UUFJQSxtQkFBQSxZQUFBO1lBQ0EsVUFBQSxZQUFBO2dCQUNBLElBQUEsS0FBQTtvQkFDQSxPQUFBLEtBQUE7Z0JBQ0EsSUFBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTtnQkFDQSxJQUFBLEtBQUE7b0JBQ0EsT0FBQSxLQUFBOzs7OztRQUtBLG1CQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsbUJBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxtQkFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsbUJBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQy9DQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHVCQUFBLFlBQUE7UUFDQSxJQUFBLHNCQUFBLFVBQUEsTUFBQSxjQUFBLE9BQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLFFBQUE7Ozs7UUFJQSxvQkFBQSxZQUFBOzs7OztRQUtBLG9CQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxvQkFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLG9CQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxvQkFBQSxNQUFBOzs7UUFHQSxPQUFBOzs7O0FDcENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsNkpBQUEsVUFBQSxhQUFBLFNBQUEsY0FBQSxTQUFBLG9CQUFBLHFCQUFBLFFBQUEsZ0JBQUEsY0FBQTtRQUNBLElBQUEsYUFBQSxVQUFBLElBQUEsVUFBQSxjQUFBLE9BQUEsT0FBQTttQ0FDQSxVQUFBLFVBQUEsU0FBQSxXQUFBLGVBQUE7bUNBQ0Esa0JBQUEsbUJBQUEsU0FBQSxRQUFBLFNBQUE7bUNBQ0Esb0JBQUEsZUFBQSxNQUFBLFNBQUEsU0FBQTttQ0FDQSxRQUFBLFNBQUEsZUFBQSxxQkFBQTttQ0FDQSxtQkFBQSxZQUFBO1lBQ0EsS0FBQSxLQUFBO1lBQ0EsS0FBQSxXQUFBLFFBQUEsWUFBQTtZQUNBLEtBQUEsZUFBQTtZQUNBLEtBQUEsUUFBQSxlQUFBLFlBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxtQkFBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLE9BQUEsSUFBQSxTQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxtQkFBQSxPQUFBLElBQUEsUUFBQSxPQUFBLFlBQUEsWUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsb0JBQUEsT0FBQSxJQUFBLFNBQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGtCQUFBLE9BQUEsSUFBQSxPQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsS0FBQSxxQkFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLE9BQUE7Z0JBQ0EsWUFBQSxtQkFBQSxZQUFBLEtBQUE7Z0JBQ0EsU0FBQSxLQUFBO2dCQUNBLGFBQUEsb0JBQUEsWUFBQSxLQUFBOztZQUVBLEtBQUEsVUFBQTtnQkFDQSxhQUFBLG9CQUFBLFlBQUEsUUFBQTtnQkFDQSxTQUFBLFFBQUE7O1lBRUEsS0FBQSxVQUFBLEVBQUEsT0FBQSxPQUFBLFlBQUEsVUFBQSxDQUFBLFlBQUE7WUFDQSxLQUFBLFdBQUEsYUFBQSxZQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsc0JBQUE7WUFDQSxLQUFBLGlCQUFBO1lBQ0EsS0FBQSxvQkFBQTtZQUNBLEtBQUEsYUFBQTtZQUNBLEtBQUEsdUJBQUEsT0FBQSxJQUFBLFlBQUEsT0FBQSxZQUFBLFlBQUEsZ0JBQUE7Ozs7O1FBS0EsV0FBQSxZQUFBO1lBQ0EsYUFBQSxZQUFBO2dCQUNBLElBQUEsUUFBQSxLQUFBO29CQUNBLE1BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQSxPQUFBLE1BQUE7O2dCQUVBLE9BQUEsYUFBQSxrQkFBQSxPQUFBOztZQUVBLG9CQUFBLFVBQUE7Z0JBQ0EsSUFBQSxLQUFBLFdBQUEsSUFBQTtvQkFDQSxPQUFBLEtBQUEsU0FBQTs7Z0JBRUEsT0FBQTs7WUFFQSxnQkFBQSxVQUFBOzs7Ozs7Ozs7O2dCQVVBLE9BQUEsS0FBQSxPQUFBOzs7OztRQUtBLFdBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsV0FBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLFdBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLFdBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3JJQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHlEQUFBLFVBQUEsYUFBQSxLQUFBLE1BQUEsUUFBQTtRQUNBLElBQUEsZUFBQSxVQUFBLElBQUEsUUFBQSxtQkFBQSxTQUFBLGFBQUEsZUFBQSxlQUFBLGFBQUEsZUFBQSxlQUFBLGNBQUEsZ0JBQUEsZ0JBQUEsU0FBQSxRQUFBLFNBQUEsT0FBQSxlQUFBLEtBQUEsTUFBQSxPQUFBLGFBQUEsZ0JBQUEsZUFBQSxtQkFBQSxvQkFBQSxzQkFBQSxTQUFBLG9CQUFBLG9CQUFBLGtCQUFBO1lBQ0EsS0FBQSxLQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxvQkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLGlCQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsb0JBQUEsVUFBQSxPQUFBLElBQUEsU0FBQSxnQkFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsbUJBQUEsU0FBQSxPQUFBLElBQUEsUUFBQSxnQkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsb0JBQUEsVUFBQSxPQUFBLElBQUEsU0FBQSxnQkFBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsa0JBQUEsUUFBQSxPQUFBLElBQUEsT0FBQSxnQkFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLDBCQUFBLGdCQUFBLE9BQUEsSUFBQSxlQUFBLGdCQUFBO1lBQ0EsS0FBQSxNQUFBLElBQUEsWUFBQTtZQUNBLEtBQUEsT0FBQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGlCQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSx1QkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEscUJBQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSxtQkFBQTs7OztRQUlBLGFBQUEsWUFBQTtZQUNBLGFBQUEsWUFBQTtnQkFDQSxPQUFBLE9BQUEsSUFBQSxLQUFBLGVBQUEsS0FBQSxPQUFBLElBQUEsS0FBQTs7WUFFQSxTQUFBLFlBQUE7Z0JBQ0EsT0FBQSxLQUFBLElBQUEsUUFBQSxXQUFBLHNCQUFBLEtBQUEsSUFBQSxRQUFBLFdBQUEsU0FBQSxzQkFBQSxZQUFBLGtCQUFBOzs7OztRQUtBLGFBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsYUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLGFBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGFBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3RHQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLGtEQUFBLFVBQUEsYUFBQSxLQUFBLE1BQUE7UUFDQSxJQUFBLGtCQUFBLFVBQUEsSUFBQSxRQUFBLG1CQUFBLFNBQUEsV0FBQSxTQUFBLFFBQUEsV0FBQSxhQUFBLGVBQUEsYUFBQSxlQUFBLGNBQUEsZ0JBQUEsT0FBQSxlQUFBLEtBQUEsTUFBQSxPQUFBLGFBQUEsUUFBQSxRQUFBO1lBQ0EsS0FBQSxLQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxvQkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLE1BQUEsSUFBQSxZQUFBO1lBQ0EsS0FBQSxPQUFBLEtBQUEsWUFBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsYUFBQSxTQUFBLE9BQUEsUUFBQSxJQUFBLE9BQUEsUUFBQSxNQUFBLFlBQUE7WUFDQSxLQUFBLFNBQUE7Ozs7UUFJQSxnQkFBQSxZQUFBO1lBQ0EsUUFBQSxTQUFBLE1BQUE7Z0JBQ0EsT0FBQTs7Ozs7O1FBTUEsZ0JBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFB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b0JBQ0EsY0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7b0JBQ0EsY0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7O2dCQUVBLElBQUEsYUFBQSxFQUFBLEtBQUEsS0FBQSxlQUFBLFVBQUEsZ0JBQUEsRUFBQSxPQUFBO29CQUNBLFVBQUEsRUFBQSxJQUFBLFlBQUE7b0JBQ0EsU0FBQSxXQUFBLFNBQUEsSUFBQSxVQUFBLFdBQUEsUUFBQSxXQUFBO29CQUNBLGVBQUEsV0FBQSxJQUFBLElBQUEsTUFBQSxDQUFBLENBQUEsVUFBQSxVQUFBLEtBQUEsUUFBQTtvQkFDQSxjQUFBLEVBQUEsS0FBQSxLQUFBLGdCQUFBLFVBQUEsZ0JBQUEsRUFBQSxPQUFBO29CQUNBLFdBQUEsRUFBQSxJQUFBLGFBQUE7b0JBQ0EsVUFBQSxZQUFBLFNBQUEsSUFBQSxXQUFBLFlBQUEsUUFBQSxZQUFBO29CQUNBLGdCQUFBLFlBQUEsSUFBQSxJQUFBLE1BQUEsQ0FBQSxDQUFBLFdBQUEsV0FBQSxLQUFBLFFBQUE7b0JBQ0EsY0FBQSxFQUFBLEtBQUEsS0FBQSxnQkFBQSxVQUFBLGdCQUFBLEVBQUEsT0FBQTtvQkFDQSxXQUFBLEVBQUEsSUFBQSxhQUFBO29CQUNBLFVBQUEsWUFBQSxTQUFBLElBQUEsV0FBQSxZQUFBLFFBQUEsWUFBQTtvQkFDQSxnQkFBQSxZQUFBLElBQUEsSUFBQSxNQUFBLENBQUEsQ0FBQSxXQUFBLFdBQUEsS0FBQSxRQUFBOztnQkFFQSxPQUFBO29CQUNBLE9BQUE7d0JBQ0EsTUFBQTt3QkFDQSxRQUFBO3dCQUNBLFdBQUEsV0FBQTt3QkFDQSxPQUFBOztvQkFFQSxRQUFBO3dCQUNBLE1BQUE7d0JBQ0EsUUFBQTt3QkFDQSxXQUFBLFlBQUE7d0JBQ0EsT0FBQTs7b0JBRUEsUUFBQTt3QkFDQSxNQUFBO3dCQUNBLFFBQUE7d0JBQ0EsV0FBQSxZQUFBO3dCQUNBLE9BQUE7Ozs7WUFJQSxhQUFBLFlBQUE7Z0JBQ0EsSUFBQSxVQUFBLEVBQUEsTUFBQSxLQUFBLGVBQUEsRUFBQSxVQUFBO29CQUNBLGdCQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsU0FBQTtvQkFDQSxXQUFBLEVBQUEsTUFBQSxLQUFBLGdCQUFBLEVBQUEsVUFBQTtvQkFDQSxpQkFBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLFVBQUE7b0JBQ0EsV0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7b0JBQ0EsaUJBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxVQUFBOztnQkFFQSxJQUFBLG1CQUFBLFVBQUEsWUFBQTtvQkFDQSxJQUFBLFlBQUE7b0JBQ0EsRUFBQSxRQUFBLFlBQUEsVUFBQSxVQUFBO3dCQUNBLEVBQUEsUUFBQSxVQUFBLFVBQUEsS0FBQTs0QkFDQSxVQUFBLEtBQUEsRUFBQSxRQUFBLElBQUEsVUFBQSxPQUFBLElBQUE7OztvQkFHQSxPQUFBOzs7Z0JBR0EsT0FBQTtvQkFDQSxPQUFBLGlCQUFBO29CQUNBLFFBQUEsaUJBQUE7b0JBQ0EsUUFBQSxpQkFBQTs7Ozs7O1FBTUEsZUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTs7Z0JBRUEsSUFBQSxtQkFBQSxLQUFBLFlBQUEsS0FBQSxZQUFBLEtBQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxL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QUEsS0FBQSxFQUFBLEtBQUEsR0FBQSxTQUFBLEVBQUEsTUFBQTs7bUJBRUE7Z0JBQ0EsZ0JBQUEsS0FBQSxFQUFBLEtBQUEsR0FBQSxTQUFBLEVBQUEsTUFBQSxHQUFBOztZQUVBLEdBQUEsU0FBQSxLQUFBO2dCQUNBLFNBQUEsR0FBQSxlQUFBO2dCQUNBLE9BQUEsR0FBQSxhQUFBO2dCQUNBLFdBQUEsR0FBQTtnQkFDQSxRQUFBLEVBQUEsTUFBQSxpQkFBQTtnQkFDQSxPQUFBO2dCQUNBLFVBQUEsR0FBQTtnQkFDQSxnQkFBQTtnQkFDQSxpQkFBQTs7WUFFQSxHQUFBOzs7O1FBSUEsR0FBQSxrQkFBQSxVQUFBLGFBQUE7WUFDQSxFQUFBLE9BQUEsR0FBQSxVQUFBLFVBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsVUFBQSxTQUFBLEtBQUEsVUFBQTs7WUFFQSxHQUFBOzs7UUFHQSxHQUFBLG1CQUFBLFVBQUEsT0FBQTtZQUNBLE9BQUEsRUFBQSxLQUFBLEVBQUEsTUFBQSxHQUFBLGlCQUFBOzs7UUFHQSxHQUFBLDBCQUFBLFlBQUE7O1lBRUEsR0FBQSxpQkFBQTtZQUNBLEdBQUEsMEJBQUE7WUFDQSxHQUFBLHFCQUFBO1lBQ0EsR0FBQSxrQkFBQTtZQUNBLEdBQUEsVUFBQTs7WUFFQSxJQUFBLENBQUEsR0FBQSxpQkFBQSxRQUFBLEdBQUEsaUJBQUEsU0FBQSxJQUFBO2dCQUNBLEdBQUEsbUJBQUE7Z0JBQ0EsR0FBQTttQkFDQTtnQkFDQSxHQUFBLG1CQUFBLEdBQUE7Ozs7UUFJQSxHQUFBLG9CQUFBLFlBQUE7WUFDQSxPQUFBLEdBQUEsZUFBQSxTQUFBOzs7UUFHQSxHQUFBLHFCQUFBLFVBQUEsU0FBQTtZQUNBLEdBQUEsZUFBQTtZQUNBLEdBQUEsZUFBQSxZQUFBLFlBQUEsZ0JBQUE7WUFDQSxHQUFBLGVBQUEsWUFBQSxZQUFBLGdCQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxrQkFBQSxVQUFBLE1BQUE7WUFDQSxHQUFBLFlBQUE7WUFDQSxHQUFBLG1CQUFBLEVBQUEsV0FBQTtZQUNBLEdBQUEsV0FBQSxTQUFBLFFBQUEsZ0JBQUE7WUFDQSxHQUFBLFlBQUEsU0FBQSxTQUFBLGdCQUFBO1lBQ0EsR0FBQSxZQUFBLFNBQUEsU0FBQSxnQkFBQTtZQUNBLEdBQUEsY0FBQSxTQUFBLFdBQUEsZ0JBQUE7WUFDQSxHQUFBLGVBQUEsU0FBQSxZQUFBLGdCQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxpQkFBQSxZQUFBO1lBQ0EsR0FBQSxrQkFBQSxDQUFBLEdBQUE7WUFDQSxJQUFBLEdBQUEsaUJBQUE7Z0JBQ0EsR0FBQSxnQkFBQTttQkFDQTtnQkFDQSxHQUFBLGdCQUFBOzs7O1FBSUEsR0FBQSxhQUFBLFlBQUE7WUFDQSxXQUFBLGVBQUE7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLGVBQUEsWUFBQTtZQUNBLGVBQUEsZUFBQSxLQUFBLFVBQUEsUUFBQTtnQkFDQSxHQUFBLHFCQUFBLE9BQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsT0FBQSxTQUFBOzs7O1FBSUEsR0FBQSxjQUFBLFVBQUEsSUFBQTtZQUNBLGVBQUEsbUJBQUEsSUFBQSxLQUFBLFVBQUEsUUFBQTtnQkFDQSxHQUFBLG1DQUFBLE9BQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7Ozs7UUFJQSxHQUFBLHFCQUFBLFVBQUEsVUFBQTtZQUNBLGVBQUEsbUJBQUEsU0FBQSxNQUFBLEtBQUEsVUFBQSxRQUFBO2dCQUNBLEdBQUEsMEJBQUE7Z0JBQ0EsRUFBQSxRQUFBLE9BQUEsU0FBQSxVQUFBLFFBQUE7b0JBQ0EsR0FBQSxxQkFBQSxHQUFBLG1CQUFBLFdBQUEsSUFBQSxFQUFBLFdBQUEsT0FBQSxTQUFBLEdBQUEscUJBQUEsT0FBQSxFQUFBLFdBQUEsT0FBQTs7Z0JBRUEsR0FBQSxrQkFBQSxFQUFBLFlBQUEsT0FBQSxTQUFBLENBQUEsUUFBQSxZQUFBLENBQUEsTUFBQTs7Z0JBRUEsSUFBQSx5QkFBQTtnQkFDQSxFQUFBLFFBQUEsR0FBQSxpQkFBQSxVQUFBLFFBQUE7b0JBQ0EsdUJBQUEsS0FBQTt3QkFDQSxPQUFBLE9BQUEsVUFBQSxPQUFBLFFBQUEsTUFBQSxPQUFBLFVBQUEsT0FBQTt3QkFDQSxPQUFBLE9BQUEsVUFBQSxPQUFBLFFBQUEsTUFBQSxPQUFBLFVBQUEsT0FBQTt3QkFDQSxPQUFBLE9BQUE7OztnQkFHQSxHQUFBLHlCQUFBO2dCQUNBLEdBQUEsVUFBQSxFQUFBLFlBQUEsT0FBQSxTQUFBLENBQUEsVUFBQSxDQUFBO2dCQUNBLEdBQUEsU0FBQSxPQUFBOzs7Z0JBR0EsSUFBQSxzQkFBQTtvQkFDQSxlQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsT0FBQSxTQUFBO2dCQUNBLEVBQUEsUUFBQSxjQUFBLFVBQUEsT0FBQTtvQkFDQSxJQUFBLFNBQUE7d0JBQ0EsT0FBQSxFQUFBLEtBQUEsR0FBQSxRQUFBLEVBQUEsTUFBQSxNQUFBLE1BQUE7d0JBQ0EsVUFBQTs7b0JBRUEsRUFBQSxRQUFBLE1BQUEsSUFBQSxVQUFBLFFBQUE7d0JBQ0EsSUFBQSxRQUFBOzRCQUNBLE9BQUEsT0FBQTs0QkFDQSxPQUFBLE9BQUE7NEJBQ0EsT0FBQSxPQUFBOzt3QkFFQSxPQUFBLFNBQUEsS0FBQTs7b0JBRUEsb0JBQUEsS0FBQTs7Z0JBRUEsb0JBQUEsUUFBQTtvQkFDQSxPQUFBO29CQUNBLE9BQUE7b0JBQ0EsT0FBQTs7Z0JBRUEsR0FBQSxzQkFBQTtlQUNBLE1BQUEsVUFBQSxNQUFBO2dCQUNBLFFBQUEsSUFBQTtnQkFDQSxPQUFBLFNBQUE7Ozs7UUFJQSxHQUFBOztRQUVBLE9BQUEsT0FBQSxtQkFBQSxVQUFBLE9BQUE7WUFDQSxRQUFBLElBQUE7Ozs7UUFJQSxHQUFBLFlBQUEsWUFBQTs7O1lBR0EsWUFBQTtZQUNBLEdBQUEsZUFBQTtZQUNBLElBQUEsV0FBQTtnQkFDQSxjQUFBO1lBQ0EsRUFBQSxRQUFBLFFBQUEsVUFBQSxLQUFBLEtBQUE7Z0JBQ0EsSUFBQSxNQUFBLEdBQUE7b0JBQ0EsU0FBQSxLQUFBLElBQUE7OztZQUdBLEVBQUEsUUFBQSxHQUFBLFdBQUEsVUFBQSxHQUFBO2dCQUNBLGNBQUEsWUFBQSxPQUFBLEVBQUEsTUFBQSxFQUFBLE1BQUEsZ0JBQUE7Ozs7Z0JBSUEsSUFBQSxFQUFBLE1BQUEsZ0JBQUEsR0FBQSxjQUFBLE9BQUE7b0JBQ0EsR0FBQSxlQUFBLEdBQUEsZUFBQSxFQUFBLElBQUEsRUFBQSxRQUFBLEdBQUEsUUFBQTs7O1lBR0EsSUFBQSxHQUFBLGVBQUEsR0FBQTtnQkFDQSxHQUFBLGFBQUEsR0FBQSxVQUFBLEdBQUEsTUFBQSxnQkFBQSxHQUFBLFFBQUEsVUFBQSxPQUFBLElBQUEsR0FBQSxnQkFBQSxPQUFBLGlCQUFBLFFBQUEsT0FBQSxJQUFBLEdBQUEsY0FBQSxPQUFBLGlCQUFBLE9BQUEsR0FBQSxhQUFBLG1CQUFBO21CQUNBO2dCQUNBLEdBQUEsYUFBQSxHQUFBLFVBQUEsR0FBQSxNQUFBLGdCQUFBLEdBQUEsUUFBQSxNQUFBLE9BQUEsSUFBQSxHQUFBLGdCQUFBLE9BQUEsaUJBQUEsUUFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE9BQUE7Ozs7WUFJQSxFQUFBLFFBQUEsVUFBQSxVQUFBLFNBQUE7Z0JBQ0EsSUFBQSxhQUFBLEVBQUEsS0FBQSxhQUFBLFVBQUEsTUFBQTtvQkFDQSxPQUFBLFNBQUE7O2dCQUVBLElBQUEsQ0FBQSxZQUFBO29CQUNBLFVBQUEsS0FBQTs7Ozs7WUFLQSxTQUFBO1lBQ0EsT0FBQTtZQUNBLFdBQUE7OztZQUdBLElBQUEsVUFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE1BQUEsS0FBQSxLQUFBLE9BQUEsSUFBQSxHQUFBLGVBQUEsZUFBQSxRQUFBLE1BQUEsT0FBQTtZQUNBLEtBQUEsSUFBQSxJQUFBLEdBQUEsSUFBQSxTQUFBLEtBQUE7Z0JBQ0EsS0FBQSxLQUFBLE9BQUEsSUFBQSxHQUFBLGVBQUEsZUFBQSxRQUFBLEtBQUEsSUFBQSxHQUFBLEtBQUE7Ozs7WUFJQSxFQUFBLFFBQUEsR0FBQSxXQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLFdBQUE7b0JBQ0EsUUFBQSxLQUFBO29CQUNBLGNBQUE7b0JBQ0EsYUFBQTs7Z0JBRUEsU0FBQSxFQUFBLE1BQUEsTUFBQSxpQkFBQTs7Z0JBRUEsSUFBQSxNQUFBLGVBQUEsU0FBQSxHQUFBOztvQkFFQSxFQUFBLFFBQUEsS0FBQSxTQUFBLFVBQUEsUUFBQTt3QkFDQSxJQUFBLE9BQUEsT0FBQSxTQUFBLEdBQUE7Ozs0QkFHQSxJQUFBLGdCQUFBLEVBQUEsUUFBQSxPQUFBLFFBQUE7Z0NBQ0EsWUFBQTtnQ0FDQSxZQUFBLEVBQUEsTUFBQSxNQUFBLGdCQUFBOzs7Ozs7NEJBTUEsSUFBQSxVQUFBLFNBQUEsR0FBQTs7O2dDQUdBLEVBQUEsUUFBQSxXQUFBLFVBQUEsSUFBQTtvQ0FDQSxVQUFBLE1BQUEsRUFBQSxJQUFBLGVBQUEsSUFBQTs7bUNBRUE7Ozs7Z0NBSUEsVUFBQSxNQUFBLFVBQUEsTUFBQSxFQUFBLE1BQUEsZUFBQSxHQUFBOzs0QkFFQSxFQUFBLFFBQUEsRUFBQSxNQUFBLFlBQUEsVUFBQSxHQUFBO2dDQUNBLFdBQUE7OztnQ0FHQSxjQUFBLEVBQUEsT0FBQSxjQUFBLE1BQUEsZUFBQSxLQUFBLEVBQUEsS0FBQSxNQUFBLGdCQUFBLENBQUEsSUFBQSxTQUFBLEVBQUE7Z0NBQ0EsYUFBQSxFQUFBOzs7Z0NBR0EsRUFBQSxRQUFBLE1BQUEsVUFBQSxPQUFBO29DQUNBLElBQUEsV0FBQSxFQUFBLEtBQUEsWUFBQSxVQUFBLE9BQUE7d0NBQ0EsT0FBQSxPQUFBLElBQUEsTUFBQSxNQUFBLE9BQUEsT0FBQTs7O29DQUdBLFNBQUEsS0FBQSxXQUFBLFNBQUEsUUFBQTs7OztnQ0FJQSxTQUFBLFFBQUEsWUFBQSxPQUFBLFlBQUE7Z0NBQ0EsU0FBQSxZQUFBLE9BQUEsWUFBQSxNQUFBLFlBQUEsVUFBQSxZQUFBLFFBQUEsTUFBQSxZQUFBLFVBQUEsWUFBQTtnQ0FDQSxPQUFBLEtBQUE7Ozs7dUJBSUE7O29CQUVBLEVBQUEsUUFBQSxLQUFBLFNBQUEsVUFBQSxRQUFBOzt3QkFFQSxFQUFBLFFBQUEsTUFBQSxVQUFBLE9BQUE7NEJBQ0EsSUFBQSxXQUFBLEVBQUEsS0FBQSxPQUFBLFFBQUEsVUFBQSxPQUFBO2dDQUNBLE9BQUEsT0FBQSxJQUFBLE1BQUEsTUFBQSxPQUFBLE9BQUE7Ozs0QkFHQSxTQUFBLEtBQUEsV0FBQSxTQUFBLFFBQUE7Ozs7d0JBSUEsSUFBQSxjQUFBLE9BQUEsT0FBQSxRQUFBLGNBQUEsTUFBQSxTQUFBO3dCQUNBLFNBQUEsUUFBQTt3QkFDQSxTQUFBLGVBQUE7d0JBQ0EsT0FBQSxLQUFBOzs7Ozs7WUFNQSxJQUFBLEVBQUEsSUFBQSxFQUFBLFFBQUEsYUFBQSxHQUFBO2dCQUNBLE9BQUEsUUFBQTs7OztZQUlBLEtBQUEsUUFBQTtZQUNBLE9BQUEsUUFBQTs7WUFFQSxJQUFBLFFBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxTQUFBOztZQUVBLEVBQUEsUUFBQSxRQUFBLFVBQUEsS0FBQTtnQkFDQSxPQUFBO2dCQUNBLElBQUEsSUFBQSxPQUFBLEtBQUE7b0JBQ0EsS0FBQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLEdBQUEsaUJBQUEsV0FBQTt3QkFDQSxPQUFBLEtBQUEsSUFBQTs7O2dCQUdBLFFBQUEsT0FBQSxPQUFBOzs7WUFHQSxJQUFBLE9BQUE7O2dCQUVBLE1BQUEsT0FBQSxDQUFBO2dCQUNBLE1BQUEsS0FBQSxNQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBO29CQUNBLEdBQUEsRUFBQSxXQUFBLE9BQUE7O2dCQUVBLE1BQUEsS0FBQTtvQkFDQSxTQUFBO29CQUNBLE9BQUE7b0JBQ0EsUUFBQTs7bUJBRUE7O2dCQUVBLFFBQUEsR0FBQSxTQUFBO29CQUNBLFFBQUE7b0JBQ0EsTUFBQTt3QkFDQSxHQUFBO3dCQUNBLFNBQUE7d0JBQ0EsT0FBQTt3QkFDQSxRQUFBLENBQUE7d0JBQ0EsT0FBQTs7b0JBRUEsVUFBQTt3QkFDQSxNQUFBLEdBQUE7O29CQUVBLFlBQUE7d0JBQ0EsVUFBQTs7b0JBRUEsT0FBQTt3QkFDQSxTQUFBLFlBQUEsT0FBQTs7b0JBRUEsTUFBQTt3QkFDQSxNQUFBO3dCQUNBLEdBQUE7NEJBQ0EsTUFBQTtnQ0FDQSxRQUFBLFVBQUEsR0FBQTtvQ0FDQSxPQUFBLE9BQUEsSUFBQSxHQUFBOzs7NEJBR0EsT0FBQTtnQ0FDQSxNQUFBO2dDQUNBLFVBQUE7Ozt3QkFHQSxHQUFBOzRCQUNBLE1BQUE7Z0NBQ0EsUUFBQSxVQUFBLEdBQUE7b0NBQ0EsSUFBQSxPQUFBLE9BQUEsV0FBQTt3Q0FDQSxPQUFBLGFBQUEsa0JBQUEsT0FBQSxNQUFBLFFBQUEsTUFBQSxPQUFBLE1BQUEsUUFBQSxLQUFBLElBQUEsR0FBQTsyQ0FDQSxJQUFBLE9BQUEsT0FBQSxTQUFBO3dDQUNBLE9BQUEsYUFBQSwyQkFBQSxHQUFBOztvQ0FFQSxPQUFBOzs7NEJBR0EsT0FBQTtnQ0FDQSxNQUFBLEVBQUEsV0FBQSxPQUFBO2dDQUNBLFVBQUE7Ozs7Ozs7OztRQVNBLFFBQUEsUUFBQSxVQUFBLE1BQUEsWUFBQTs7WUFFQSxJQUFBLFdBQUEsYUFBQTtnQkFDQSxTQUFBLFlBQUE7Z0JBQ0EsaUJBQUEsU0FBQSxTQUFBOztZQUVBLEdBQUEsYUFBQSxhQUFBLGlCQUFBLHFCQUFBLGlCQUFBOzs7OztBQ25mQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDhEQUFBLFVBQUEsT0FBQSxJQUFBLFdBQUEsYUFBQTtRQUNBLElBQUEsb0JBQUEsVUFBQSxNQUFBLFdBQUEsU0FBQSxPQUFBLFdBQUEsUUFBQSxPQUFBLFVBQUE7WUFDQSxRQUFBLElBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxRQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsVUFBQTs7OztRQUlBLE9BQUE7WUFDQSxjQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsTUFBQSxJQUFBLFlBQUEsYUFBQSxhQUFBLFlBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLG9CQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxNQUFBLElBQUEsWUFBQSxhQUFBLGFBQUEsYUFBQSxLQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLG9CQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsWUFBQSxhQUFBLGFBQUEsYUFBQSxPQUFBO2dCQUNBLE1BQUEsSUFBQSxLQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxhQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLFNBQUEsVUFBQTtvQkFDQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsUUFBQTtvQkFDQSxLQUFBLFlBQUEsYUFBQSxhQUFBLGFBQUEsT0FBQSxXQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7O2dCQUdBLE9BQUEsRUFBQTs7WUFFQSxzQkFBQSxVQUFBLEtBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLElBQUEsWUFBQTtvQkFDQSxPQUFBO29CQUNBLE1BQUE7b0JBQ0EsVUFBQTtvQkFDQSxTQUFBOzs7Z0JBR0EsSUFBQSxVQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsVUFBQSxPQUFBOztnQkFFQSxFQUFBLFFBQUEsSUFBQSxNQUFBLGlCQUFBLFVBQUEsUUFBQTtvQkFDQSxJQUFBLGVBQUE7d0JBQ0EsUUFBQTt3QkFDQSxPQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsU0FBQSxPQUFBO3dCQUNBLE9BQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxPQUFBLE9B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OztlQUVBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLElBQUEsTUFBQSxRQUFBO29CQUNBLE9BQUEsU0FBQSxNQUFBO3VCQUNBO29CQUNBLE9BQUEsU0FBQTs7ZUFFQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsT0FBQSxPQUFBLDhDQUFBLFVBQUEsVUFBQTtZQUNBLElBQUEsYUFBQSxPQUFBO2dCQUNBLEdBQUEsb0JBQUEsWUFBQTttQkFDQSxJQUFBLGFBQUEsUUFBQTtnQkFDQSxHQUFBLG9CQUFBLFlBQUE7bUJBQ0EsSUFBQSxhQUFBLE1BQUE7Z0JBQ0EsR0FBQSxvQkFBQSxZQUFBOzs7O1FBSUEsT0FBQSxPQUFBLGlCQUFBLFVBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO2dCQUNBOztZQUVBLEdBQUEsYUFBQTtZQUNBLGFBQUEsd0JBQUE7WUFDQSxHQUFBLGFBQUEsR0FBQSxhQUFBLEVBQUEsVUFBQSxvQkFBQSxFQUFBLFVBQUE7OztRQUdBLElBQUEsZ0JBQUEsWUFBQTtZQUNBLEdBQUEsVUFBQTtZQUNBLGtCQUFBLGdCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsWUFBQSxRQUFBO29CQUNBLElBQUEsSUFBQTt3QkFDQSxRQUFBO3dCQUNBO29CQUNBLE9BQUEsT0FBQSxhQUFBLElBQUEsSUFBQSxLQUFBO3dCQUNBLE1BQUEsUUFBQSxhQUFBLFFBQUE7O29CQUVBLEVBQUEsT0FBQSxFQUFBLE1BQUEsUUFBQSxVQUFBLEdBQUE7d0JBQ0EsSUFBQSxFQUFBLFNBQUEsRUFBQSxJQUFBLGNBQUE7NEJBQ0EsSUFBQSxPQUFBLEtBQUEsTUFBQSxFQUFBOzRCQUNBLEdBQUEsZ0JBQUEsS0FBQTs0QkFDQSxLQUFBLEtBQUE7Ozs7Z0JBSUEsbUJBQUEsRUFBQSxPQUFBLE1BQUEsRUFBQSxhQUFBO2dCQUNBLHFCQUFBLEVBQUEsT0FBQSxNQUFBLEVBQUEsYUFBQTtnQkFDQSxHQUFBLGFBQUEsR0FBQSxhQUFBLEVBQUEsVUFBQSxvQkFBQSxFQUFBLFVBQUE7Z0JBQ0EsR0FBQSxVQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsR0FBQSxVQUFBO2dCQUNBLFFBQUEsSUFBQTs7OztRQUlBLElBQUEsYUFBQSxZQUFBO1lBQ0E7WUFDQSxHQUFBLGtCQUFBO1lBQ0EsR0FBQSxPQUFBOztZQUVBLElBQUEsYUFBQSxJQUFBO2dCQUNBLElBQUEsS0FBQSxTQUFBLGFBQUE7Z0JBQ0EsSUFBQSxPQUFBLEdBQUE7b0JBQ0EsR0FBQSxPQUFBO29CQUNBLEdBQUEsa0JBQUEsSUFBQTt1QkFDQTs7b0JBRUEsa0JBQUEsb0JBQUEsSUFBQSxLQUFBLFVBQUEsTUFBQTt3QkFDQSxHQUFBLGtCQUFBLFVBQUEsWUFBQTs7OztZQUlBLFdBQUEsZUFBQTs7O1FBR0E7O1FBRUEsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQTtnQkFDQSxxQkFBQSxTQUFBLFNBQUEsU0FBQTs7WUFFQSxHQUFBLGlCQUFBLGFBQUEscUJBQUEscUJBQUEscUJBQUE7Ozs7QUM3S0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSw2QkFBQSxVQUFBLGFBQUE7UUFDQSxJQUFBLFlBQUEsVUFBQSxJQUFBLE1BQUEsT0FBQSxhQUFBLFVBQUEsV0FBQSxXQUFBLFlBQUEsU0FBQSxVQUFBLGVBQUEsYUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsYUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGNBQUEsZUFBQSxFQUFBLFVBQUEsWUFBQSxlQUFBOzs7UUFHQSxVQUFBLFlBQUE7WUFDQSxPQUFBLFlBQUE7Z0JBQ0EsT0FBQTtvQkFDQSxNQUFBLEtBQUE7b0JBQ0EsT0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTtvQkFDQSxVQUFBLEtBQUE7b0JBQ0EsV0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTs7Ozs7O1FBTUEsVUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsVUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQSxLQUFBLElBQUEsVUFBQTs7WUFFQSxPQUFBLFVBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQzVEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLGlFQUFBLFVBQUEsT0FBQSxJQUFBLFdBQUEsYUFBQTtRQUNBLE9BQUE7WUFDQSxlQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxNQUFBLFlBQUEsYUFBQSxnQkFBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQSxFQUFBLE9BQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBLEtBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEscUJBQUEsVUFBQSxJQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLGFBQUEsZ0JBQUEsZ0JBQUEsS0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOzs7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QUE7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLFlBQUEsZ0JBQUEsVUFBQSxTQUFBOztZQUVBLEdBQUEsVUFBQTtZQUNBLEdBQUEsUUFBQSxVQUFBLEdBQUEsb0JBQUEsUUFBQSxVQUFBLEtBQUE7Z0JBQ0EsSUFBQSxHQUFBLGVBQUE7b0JBQ0EsR0FBQSxnQkFBQTt1QkFDQTtvQkFDQSxVQUFBLE9BQUE7b0JBQ0EsVUFBQSxLQUFBLFlBQUEsSUFBQSxPQUFBOzs7WUFHQSxHQUFBLFFBQUEsV0FBQSxHQUFBLGtCQUFBLFFBQUEsVUFBQSxhQUFBLFVBQUE7Z0JBQ0EsR0FBQSxZQUFBLE9BQUE7Z0JBQ0EsR0FBQSxZQUFBLFlBQUE7Z0JBQ0EsR0FBQTs7WUFFQSxHQUFBLFFBQUEsS0FBQSxHQUFBLFlBQUEsUUFBQSxVQUFBLE1BQUEsYUFBQTtnQkFDQSxFQUFBLFFBQUEsR0FBQSxRQUFBLEtBQUEsU0FBQSxVQUFBLEtBQUE7b0JBQ0EsSUFBQSxPQUFBLE9BQUEsSUFBQTs7Z0JBRUEsYUFBQSxnQkFBQSxHQUFBLFFBQUEsS0FBQSxRQUFBO2dCQUNBLElBQUEsVUFBQTtnQkFDQSxFQUFBLFFBQUEsYUFBQSxVQUFBLEtBQUE7b0JBQ0EsUUFBQSxLQUFBLElBQUEsS0FBQSxjQUFBLFNBQUEsTUFBQSxJQUFBLFFBQUEsSUFBQTs7Z0JBRUEsR0FBQSxnQkFBQTs7OztRQUlBLElBQUEsV0FBQSxZQUFBO1lBQ0EsWUFBQSxTQUFBLEdBQUEsYUFBQSxLQUFBLE1BQUEsTUFBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLFdBQUE7b0JBQ0EsR0FBQSxhQUFBO29CQUNBLEdBQUEsWUFBQSxhQUFBLEtBQUE7b0JBQ0EsR0FBQSxZQUFBLGdCQUFBLEtBQUEsUUFBQTtvQkFDQSxHQUFBLFlBQUEsMEJBQUEsS0FBQSxRQUFBO29CQUNBLEdBQUEsWUFBQSxPQUFBLEtBQUE7dUJBQ0E7b0JBQ0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxlQUFBLElBQUE7d0JBQ0EsR0FBQSxtQkFBQSxLQUFBOztvQkFFQSxHQUFBLGFBQUE7O2dCQUVB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RUEsY0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQTs7WUFFQSxVQUFBLFlBQUE7Z0JBQ0EsT0FBQSxLQUFBOzs7OztRQUtBLEtBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsS0FBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLEtBQUE7O1lBRUEsT0FBQSxLQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUN0RUEsQ0FBQSxVQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxpQkFBQSxVQUFBO1FBQ0EsSUFBQSxnQkFBQSxVQUFBLE9BQUEsV0FBQSxNQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxPQUFBOzs7O1FBSUEsY0FBQSxZQUFBOzs7Ozs7O1FBT0EsY0FBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsY0FBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLGNBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGNBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3RDQSxDQUFBLFdBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDJFQUFBLFVBQUEsYUFBQSxtQkFBQSxNQUFBLGNBQUE7UUFDQSxJQUFBLGFBQUEsVUFBQSxNQUFBLFdBQUEs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WUFBQSxlQUFBLGVBQUEsZ0JBQUEsYUFBQSxZQUFBLGFBQUEsY0FBQTtRQUNBLElBQUEsS0FBQTs7UUFFQSxHQUFBLFVBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxnQkFBQTtRQUNBLEdBQUEsd0JBQUEsU0FBQSxhQUFBO1FBQ0EsR0FBQSxtQkFBQTtRQUNBLEdBQUEsYUFBQTtRQUNBLEdBQUEsT0FBQSxJQUFBO1FBQ0EsR0FBQSxVQUFBO1FBQ0EsR0FBQSxPQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxlQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxnQkFBQTtRQUNBLEdBQUEsbUJBQUE7UUFDQSxHQUFBLGVBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxtQkFBQTtRQUNBLEdBQUEsT0FBQSxZQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxtQkFBQTs7UUFFQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsY0FBQSxlQUFBOztRQUVBLElBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0E7OztRQUdBLElBQUEsaUJBQUEsWUFBQTtZQUNBLGNBQUEsaUJBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsR0FBQSxjQUFBLEtBQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUE7b0JBQ0EsSUFBQSxJQUFBO3dCQUNBLFFBQUE7d0JBQ0E7b0JBQ0EsT0FBQSxPQUFBLGFBQUEsSUFBQSxJQUFBLEtBQUE7d0JBQ0EsTUFBQSxRQUFBLGFBQUEsUUFBQTs7b0JBRUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxRQUFBLFVBQUEsR0FBQTt3QkFDQSxJQUFBLEVBQUEsU0FBQSxFQUFBLElBQUEsZUFBQTs0QkFDQSxJQUFBLE9BQUEsS0FBQSxNQUFBLEVBQUE7NEJBQ0EsR0FBQSxpQkFBQSxLQUFBOzRCQUNBLEdBQUEsWUFBQSxLQUFB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QUEsS0FBQSxRQUFBO2dCQUNBLEdBQUEsWUFBQSwwQkFBQSxLQUFBLFFBQUE7Z0JBQ0EsR0FBQSxZQUFBLGFBQUEsS0FBQTtnQkFDQSxHQUFBLFlBQUEsT0FBQSxLQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLEdBQUEsVUFBQTs7OztRQUlBLEdBQUEsaUJBQUEsWUFBQTtZQUNBLGNBQUEsaUJBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsR0FBQSxpQkFBQSxLQUFBLEtBQUE7Z0JBQ0EsR0FBQSxtQkFBQSxFQUFBLFFBQUEsR0FBQTtnQkFDQSxHQUFBLHFCQUFBLEVBQUEsS0FBQSxHQUFBLGtCQUFBLEVBQUEsSUFBQSxHQUFBLGNBQUEsY0FBQTtnQkFDQSxHQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsR0FBQSxnQkFBQSxZQUFBO1lBQ0EsYUFBQSxpQkFBQSxHQUFBO1lBQ0EsR0FBQSxVQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxnQkFBQSxZQUFBO1lBQ0EsR0FBQSxZQUFBLGFBQUEsWUFBQSxnQkFBQSxHQUFBLFNBQUEsR0FBQTs7O1FBR0EsR0FBQSxvQkFBQSxVQUFBLFNBQUE7WUFDQSxHQUFBLGNBQUEsUUFBQSxRQUFBLFNBQUEsSUFBQSxVQUFBO1lBQ0Esa0JBQUEsUUFBQSxTQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxtQkFBQSxVQUFBLE9BQUE7WUFDQSxJQUFBLE1BQUEsT0FBQSxHQUFBLGNBQUEsU0FBQTtnQkFDQSxHQUFBLGNBQUEsT0FBQTs7WUFFQSxHQUFBLGNBQUEsVUFBQSxNQUFBLE9BQUEsSUFBQSxPQUFBLE1BQUE7WUFDQSxHQUFBLGNBQUEsWUFBQSxHQUFBLFlBQUE7WUFDQSxJQUFBLENBQUEsR0FBQSxTQUFBO2dCQUNBLEdBQUE7Ozs7UUFJQSxHQUFBLFlBQUEsZ0JBQUEsVUFBQSxTQUFBOztZQUVBLEdBQUEsVUFBQTtZQUNBLEdBQUEsUUFBQSxVQUFBLEdBQUEsb0JB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QUE7O0lBRUEsSUFBQSxjQUFBLFNBQUEsR0FBQTtFQUNBLE9BQUEsRUFBQSxTQUFBLEVBQUEsV0FBQSxFQUFBOzs7SUFHQSxJQUFBLGdCQUFBLFNBQUEsR0FBQTtFQUNBLE9BQUEsZUFBQSxFQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsRUFBQSxZQUFBOzs7SUFHQSxJQUFBLElBQUEsR0FBQSxLQUFBLFFBQUEsT0FBQSxFQUFBLGlCQUFBLGlCQUFBLE1BQUEsRUFBQSxHQUFBLFNBQUEsTUFBQTs7SUFFQSxJQUFBLElBQUEsR0FBQSxNQUFBLFVBQUEsT0FBQSxXQUFBLGdCQUFBLEVBQUEsR0FBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7O0lBRUEsSUFBQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFVBQUEsV0FBQSxHQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUE7TUFDQSxTQUFBLEdBQUEsWUFBQTs7SUFFQSxJQUFBLFFBQUEsR0FBQSxJQUFBLE9BQUEsTUFBQSxHQUFBLE9BQUEsUUFBQSxTQUFBOztJQUVBLElBQUEsaUJBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxtQkFBQSxzQkFBQTtLQUNBLElBQUEsVUFBQSxhQUFBLE1BQUEsU0FBQSxHQUFBO0VBQ0Esa0JBQUEsR0FBQSxLQUFBLElBQUEsT0FBQSxJQUFBLFFBQUEsQ0FBQTtFQUNBLGdCQUFBLEdBQUEsS0FBQSxLQUFBLE9BQUEsSUFBQSxRQUFBLENBQUE7RUFDQTs7S0FFQSxNQUFBLEtBQUEsU0FBQSxHQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBOztLQUVBLGdCQUFBLE1BQUEsTUFBQSxTQUFBLEdBQUE7S0FDQSxNQUFBLEtBQUEsU0FBQSxHQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBOztLQUVBLGtCQUFBLE1BQUEsR0FBQTs7OztJQUlBLElBQUEsV0FBQSxXQUFBO0NBQ0EsSUFBQSxHQUFBLEtBQUEsUUFBQSxPQUFBLEVBQUEsaUJBQUEsaUJBQUEsTUFBQSxFQUFBLEdBQUEsU0FBQSxNQUFBO0NBQ0EsSUFBQSxHQUFBLE1BQUEsVUFBQSxPQUFBLFdBQUEsZ0JBQUEsRUFBQSxHQUFBLFNBQUEsT0FBQSxNQUFBLE9BQUEsVUFBQTtDQUNBLFFBQUEsR0FBQSxJQUFBLE9BQUEsTUFBQSxHQUFBLE9BQUEsVUFBQSxNQUFBLEtBQUEsS0FBQSxNQUFBLE1BQUEsV0FBQSxHQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUE7R0FDQSxTQUFBLEdBQUEsWUFBQTs7Q0FFQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFFBQUEsU0FBQTs7O0lBR0EsU0FBQSxNQUFBLE9BQUE7O0NBRUEsZUFBQTtDQUNBOztDQUVBLElBQUEsTUFBQSxHQUFBLE9BQUE7RUFDQSxPQUFBO0VBQ0EsS0FBQSxTQUFBO0VBQ0EsS0FBQSxTQUFBLFFBQUEsT0FBQSxPQUFBLE9BQUE7RUFDQSxLQUFBLFVBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQTtFQUNBLE9BQUE7U0FDQSxLQUFBLFNBQUE7RUFDQSxLQUFBLFNBQUEsUUFBQSxPQUFBLE9BQUEsT0FBQTtFQUNBLEtBQUEsVUFBQSxTQUFBLE9BQUEsTUFBQSxPQUFBO0VBQ0EsS0FBQSxhQUFBLGVBQUEsT0FBQSxPQUFBLE9BQUEsT0FBQSxNQUFBOztNQUVBLElBQUEsVUFBQTtHQUNBLEtBQUEsT0FBQSxhQUFBO0dBQ0EsT0FBQTtHQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsTUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEVBQUE7TUFDQSxHQUFBLFdBQUEsRUFBQSxXQUFBLEtBQUEsRUFBQSxPQUFBO01BQ0EsT0FBQSxXQUFBLEVBQUE7O0dBRUEsS0FBQSxLQUFBO0dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7OztFQUlBLElBQUEsT0FBQTtHQUNBLEtBQUEsU0FBQTtHQUNBLEtBQUEsYUFBQSxtQkFBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7R0FDQTtHQUNBLEtBQUE7O0VBRUEsSUFBQSxPQUFBLEtBQUEsS0FBQSxTQUFBLFVBQUEsYUFBQSxLQUFBOztFQUVBLE9BQUE7O0tBRUE7O0lBRUEsTUFBQSxTQUFBLFNBQUEsT0FBQTtRQUNBLFFBQUEsSUFBQTtDQUNBLGVBQUE7Q0FDQTs7UUFFQSxJQUFBLE1BQUEsR0FBQSxPQUFBOztRQUVBLElBQUEsa0JBQUEsSUFBQSxPQUFBO1FBQ0EsSUFBQSxPQUFBLGdCQUFBLFVBQUEsUUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQTtVQUNBLE9BQUEsT0FBQTtVQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsTUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEVBQUE7TUFDQSxHQUFBLFdBQUEsRUFBQSxXQUFBLEtBQUEsRUFBQSxPQUFBO01BQ0EsT0FBQSxXQUFBLEVBQUE7O0dBRUE7R0FDQSxLQUFBLEtBQUE7R0FDQSxLQUFBLGFBQUE7R0FDQSxLQUFBLFVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO0lBQ0EsS0FBQSxTQUFBLFNBQUEsR0FBQTtNQUNBLFFBQUEsRUFBQSxFQUFBLFVBQUEsRUFBQSxFQUFBOzs7UUFHQSxLQUFBO1dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7O0NBR0EsS0FBQSxPQUFBOztDQUVBLElBQUEsT0FBQSxNQUFBLGFBQUEsS0FBQTtDQUNBLElBQUEsT0FBQSxNQUFBLGFBQUEsS0FBQTs7Q0FFQSxPQUFBOzs7SUFHQSxNQUFBLFNBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsU0FBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUEsRUFBQSxpQkFBQTtDQUNBLGtCQUFBLENBQUEsTUFBQSxJQUFBLGdCQUFBLENBQUEsTUFBQTtDQUNBLE9BQUE7Ozs7Ozs7O0lBUUEsTUFBQSxpQkFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7UUFDQSxpQkFBQTtRQUNBLE9BQUE7Ozs7SUFJQSxNQUFBLFlBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsWUFBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxhQUFBO0NBQ0EsT0FBQTs7O0NBR0EsTUFBQSxRQUFBLFNBQUEsTUFBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFFBQUE7RUFDQSxPQUFBOzs7Q0FHQSxNQUFBLFFBQUEsU0FBQSxNQUFBO0VBQ0EsR0FBQSxDQUFBLFVBQUEsT0FBQTtHQUNBLE9BQUE7O0VBRUEsUUFBQTtFQUNBLE9BQUE7OztJQUdBLE1BQUEsUUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxRQUFBLENBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLFNBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsU0FBQSxDQUFBO0NBQ0EsT0FBQTs7O0lBR0EsTUFBQSxhQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLGFBQUE7Q0FDQSxPQUFBOzs7Q0FHQSxNQUFBLFdBQUEsU0FBQSxPQUFBO0VBQ0EsR0FBQSxDQUFBLFVBQUEsT0FBQTtHQUNBLE9BQUE7O0VBRUEsV0FBQTtFQUNBLE9BQUE7Ozs7O0lBS0EsT0FBQTs7O0FDaFFBLFNBQUEsTUFBQSxpQkFBQTtBQUNBO0lBQ0EsS0FBQSxrQkFBQTs7SUFFQSxJQUFBLE9BQUE7O0lBRUEsS0FBQSxZQUFBLFNBQUE7SUFDQTtRQUNBLEtBQUEsU0FBQTs7UUFFQSxLQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsT0FBQTs7UUFFQSxLQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUEsT0FBQSxPQUFBO1FBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7UUFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTs7UUFFQSxLQUFBLE9BQUEsTUFBQSxhQUFBLGNBQUEsTUFBQSxjQUFBLE1BQUE7UUFDQSxLQUFBLE9BQUEsTUFBQSxhQUFBLGNBQUEsTUFBQSxjQUFBLE1BQUE7UUFDQSxLQUFBLE9BQUEsUUFBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUFBO1FBQ0EsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUFBOztRQUVBLEtBQUEsT0FBQSxjQUFBLGNBQUEsY0FBQTtRQUNBLEtBQUEsT0FBQSxjQUFBLGNBQUEsZUFBQTtRQUNBLEtBQUEsT0FBQSxZQUFBLGNBQUEsWUFBQTs7UUFFQSxLQUFBLE9BQUEscUJBQUEsY0FBQSxzQkFBQTs7O0lBR0EsS0FBQSxTQUFBO0lBQ0E7UUFDQSxLQUFBLE9BQUEsR0FBQSxPQUFBLE1BQUEsS0FBQTthQUNBLE9BQUE7YUFDQSxLQUFBLFNBQUE7YUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxVQUFBLEtBQUEsT0FBQTs7UUFFQSxLQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsU0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBO2FBQ0EsTUFBQSxRQUFBOzs7O1FBSUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLE1BQUEsUUFBQTthQUNBLE1BQUEsVUFBQTthQUNBLE1BQUEsZ0JBQUE7O1FBRUEsS0FBQSxJQUFBLFlBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFdBQUEsVUFBQSxNQUFBLEtBQUEsT0FBQSxXQUFBLFVBQUEsSUFBQSxLQUFBLE9BQUE7OztRQUdBLEtBQUEsSUFBQSxhQUFBLEtBQUEsT0FBQTtRQUNBO1lBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxZQUFBLFdBQUEsTUFBQSxLQUFBLE9BQUEsWUFBQSxXQUFBLElBQUEsS0FBQSxPQUFBOzs7UUFHQSxLQUFBLElBQUEsVUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxRQUFBLE1BQUEsS0FBQSxPQUFBLFNBQUEsUUFBQSxJQUFBLEtBQUEsT0FBQTs7O1FBR0EsSUFBQSxXQUFBOztRQUVBLElBQUEsYUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1lBQ0EsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBLEtBQUEsSUFBQSxXQUFBO2lCQUNBLEtBQUEsTUFBQSxXQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxNQUFBLGFBQUEsV0FBQTtpQkFDQSxNQUFBLFFBQUE7aUJBQ0EsTUFBQSxnQkFBQTs7O1FBR0EsV0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7UUFDQSxJQUFBLGFBQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLGFBQUE7UUFDQSxLQUFBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxTQUFBLEtBQUEsT0FBQSxLQUFBLFNBQUE7UUFDQTtZQUNBLElBQUEsYUFBQSxhQUFBLEtBQUEsT0FBQTtnQkFDQSxTQUFBO2dCQUNBLFNBQUE7WUFDQSxLQUFBLElBQUEsUUFBQSxRQUFBLFlBQUEsUUFBQSxLQUFBLElBQUEsUUFBQSxZQUFBLEtBQUEsT0FBQSxNQUFBLFNBQUE7WUFDQTtnQkFDQSxTQUFBLEtBQUEsYUFBQSxPQUFBO2dCQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O2dCQUVBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLE1BQUEsVUFBQTtxQkFDQSxNQUFBLGdCQUFBOzs7WUFHQSxTQUFBLEtBQUEsYUFBQSxPQUFBO1lBQ0EsU0FBQSxLQUFBLGFBQUEsT0FBQTs7WUFFQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxNQUFBLFVBQUE7aUJBQ0EsTUFBQSxnQkFBQTs7WUFFQSxJQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUE7WUFDQTtnQkFDQSxJQUFBLFFBQUEsS0FBQSxhQUFBLE9BQUE7O2dCQUVBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsS0FBQSxNQUFBO3FCQUNBLEtBQUEsS0FBQSxNQUFBO3FCQUNBLEtBQUEsTUFBQSxXQUFBO3FCQUNBLEtBQUEsZUFBQSxTQUFBLEtBQUEsT0FBQSxNQUFBLFVBQUE7cUJBQ0EsS0FBQTtxQkFDQSxNQUFBLGFBQUEsV0FBQTtxQkFDQSxNQUFBLFFBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7OztRQUlBLElBQUEsbUJBQUEsS0FBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFNBQUE7O1FBRUEsSUFBQSxXQUFBLENBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsSUFBQSxjQUFBLEtBQUEsaUJBQUE7O1FBRUEsSUFBQSxjQUFBLEdBQUEsSUFBQTthQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2FBQ0EsRUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7YUFDQSxZQUFBOztRQUVBLGlCQUFBLFVBQUE7YUFDQSxLQUFBLENBQUE7YUFDQTthQUNBLE9BQUE7YUFDQSxLQUFBLEtBQUE7YUFDQSxNQUFBLFFBQUE7O1FBRUEsaUJBQUEsT0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLE9BQUEsS0FBQSxPQUFBO2FBQ0EsTUFBQSxRQUFBOztRQUVBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsaUJBQUEsVUFBQTthQUNBLEtBQUEsQ0FBQTthQUNBO2FBQ0EsT0FBQTthQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUEsSUFBQTthQUNBLEtBQUEsTUFBQSxXQUFBO2FBQ0EsS0FBQSxlQUFBO2FBQ0EsTUFBQSxhQUFBLFdBQUE7YUFDQSxNQUFBLFFBQUE7YUFDQSxNQUFBLGdCQUFBOztRQUVBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQTs7O0lBR0EsS0FBQSxtQkFBQSxTQUFBO0lBQ0E7UUFDQSxJQUFBLFFBQUEsS0FBQSxPQUFBLFFBQUE7O1FBRUEsSUFBQSxPQUFBLGFBQUEsT0FBQTtRQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTtRQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTs7UUFFQSxJQUFBLFlBQUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxHQUFBLElBQUEsUUFBQTtRQUNBLElBQUEsT0FBQSxhQUFBLFdBQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxZQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxZQUFBLE9BQUE7O1FBRUEsT0FBQSxDQUFBLE1BQUEsT0FBQSxPQUFBLE1BQUEsT0FBQSxPQUFBOztRQUVBLFNBQUEsYUFBQSxPQUFBO1FBQ0E7WUFDQSxJQUFBLFFBQUEsS0FBQSxhQUFBLE9BQUE7WUFDQSxNQUFBLEtBQUEsS0FBQSxPQUFBO1lBQ0EsTUFBQSxLQUFBLEtBQUEsT0FBQTtZQUNBLE9BQUE7Ozs7SUFJQSxLQUFBLFdBQUEsU0FBQSxPQUFBLEtBQUE7SUFDQTtRQUNBLElBQUEsS0FB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QUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxRQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxVQUFBLFNBQUEsUUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLFVBQUEsRUFBQSxHQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsS0FBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEtBQUEsTUFBQSxhQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsS0FBQSxZQUFBLEVBQUEsS0FBQSxTQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsS0FBQSxRQUFBLEVBQUEsS0FBQSxXQUFBLEVBQUEsS0FBQSxVQUFBLEtBQUEsU0FBQSxHQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxHQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsSUFBQSxTQUFBLEdBQUEsQ0FBQSxFQUFBLFlBQUEsQ0FBQSxFQUFBLFlBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxZQUFBLEVBQUEsS0FBQSxDQUFBLFFBQUEsU0FBQSxlQUFBLEVBQUEsT0FBQSxJQUFBLENBQUEsR0FBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxRQUFBLFNBQUEsWUFBQSxFQUFBLE9BQUEsVUFBQSxTQUFBLEtBQUEsR0FBQSxHQUFBLG9CQUFBLElBQUEsRUFBQSxFQUFBLFlBQUEsRUFBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxFQUFBLE9BQUEsYUFBQSxVQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxpQkFBQSxRQUFBLFlBQUEsS0FBQSxFQUFBLGlCQUFBLEtBQUEsSUFBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLFlBQUEsT0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLGFBQUEsUUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxjQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsSUFBQSxDQUFBLElBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLFNBQUEsY0FBQSxHQUFBLENBQUEsSUFBQSxFQUFBLFVBQUEsS0FBQSxRQUFBLGVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsTUFBQSxHQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsYUFBQSxVQUFBLE9BQUEsRUFBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsUUFBQSxLQUFBLEdBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxNQUFBLEVBQUEsR0FBQSxVQUFBLE9BQUEsR0FBQSxRQUFBLFFBQUEsR0FBQSxDQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsSUFBQSxPQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsUUFBQSxHQUFBLE1BQUEsT0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLE1BQUEsT0FBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLFFBQUEsR0FBQSxHQUFBLEVBQUEsUUFBQSxPQUFBLEVBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsSUFBQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsRUFBQSxNQUFBLFFBQUEsR0FBQSxDQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLEVBQUEsS0FBQSxHQUFBLEVBQUEsSUFBQSxXQUFBLFVBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsS0FBQSxPQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxTQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLFVBQUEsT0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLFdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEtBQUEsR0FBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsYUFBQSxNQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLEVBQUEsTUFBQSxNQUFBLElBQUEsRUFBQSxPQUFBLFVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLFVBQUEsVUFBQSxhQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEtBQUEsUUFBQSxlQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxpQkFBQSxRQUFBLEVBQUEsaUJBQUEsRUFBQSxVQUFBLE9BQUEsVUFBQSxDQUFBLEdBQUEsT0FBQSxLQUFBLFVBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxLQUFBLE1BQUEsR0FBQSxFQUFBLEVBQUEsTUFBQSxRQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsSUFBQSxLQUFBLFVBQUEsRUFBQSxPQUFBLEtBQUEsV0FBQSxJQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxHQUFBLEVBQUEsWUFBQSxDQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsY0FBQSxFQUFBLE9BQUEsS0FBQSxlQUFBLEVBQUEsT0FBQSxLQUFBLGVBQUEsRUFBQSxpQkFBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEdBQUEsS0FBQSxZQUFBLEVBQUEsSUFBQSxzQkFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsR0FBQSxFQUFBLFNBQUEsUUFBQSxRQUFBLEVBQUEsUUFBQSxTQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLENBQUEsVUFBQSxPQUFBLEdBQUEsYUFBQSxVQUFBLEVBQUEsR0FBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLE9BQUEsS0FBQSxrQkFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxRQUFBLFFBQUEsS0FBQSxVQUFBLEVBQUEsS0FBQSxpQkFBQSxLQUFBLHNCQUFBLEdBQUEsQ0FBQSxJQUFBLEdBQUEsSUFBQSxFQUFBLG1CQUFBLEVBQUEsRUFBQSxNQUFBLFFBQUEsUUFBQSxHQUFBLE9BQUEsRUFBQSxHQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLFNBQUEsS0FBQSxTQUFBLGlCQUFBLEVBQUEsa0JBQUEsS0FBQSxrQkFBQSxpQkFBQSxLQUFBLGlCQUFBLHNCQUFBLEtBQUEsc0JBQUEsV0FBQSxLQUFBLFdBQUEsYUFBQSxFQUFBLGNBQUEsS0FBQSxlQUFBLE9BQUEsT0FBQSxVQUFBLFNBQUEsQ0FBQSxVQUFBLFNBQUEsRUFBQSxDQUFBLE1BQUEsQ0FBQSxTQUFBLElBQUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFVBQUEsT0FBQSxFQUFBLGNBQUEsRUFBQSxjQUFBLE1BQUEsVUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsQ0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLGtCQUFBLFNBQUEsRUFBQSxPQUFBLEVBQUEsYUFBQSxRQUFBLE1BQUEsRUFBQSxLQUFBLFdBQUEsVUFBQSxDQUFBLEVBQUEsSUFBQSxVQUFBLElBQUEsQ0FBQSxVQUFBLFNBQUEsRUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQUEsaUJBQUEsS0FBQSxFQUFBLGlCQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsS0FBQSxFQUFBLFlBQUEsS0FBQSxFQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLFlBQUEsRUFBQSxLQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsYUFBQSxFQUFBLE9BQUEsT0FBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLGVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLE9BQUEsYUFBQSxFQUFBLE9BQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsS0FBQSxPQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLFFBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLGVBQUEsS0FBQSxFQUFBLGlCQUFBLEtBQUEsRUFBQSxZQUFBLENBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxnQkFBQSxLQUFBLEVBQUEsa0JBQUEsS0FBQSxFQUFBLGFBQUEsQ0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsTUFBQSxTQUFBLEdBQUEsUUFBQSxHQUFBLE9BQUEsR0FBQSxRQUFBLEVBQUEsU0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsSUFBQSxHQUFBLEVBQUEsZUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsSUFBQSxFQUFBLElBQUEsR0FBQSxVQUFBLFlBQUEsWUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsTUFBQSxFQUFBLENBQUEsTUFBQSxFQUFBLEVBQUEsUUFBQSxTQUFBLFNBQUEsRUFBQSxNQUFBLE1BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsR0FBQSxZQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxVQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsR0FBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEVBQUEsT0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEdBQUEsQ0FBQSxFQUFBLFdBQUEsR0FBQSxNQUFBLEdBQUEsSUFBQSxTQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLE9BQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsR0FBQSxFQUFBLFNBQUEsWUFBQSxHQUFBLENBQUEsRUFBQSxTQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLFlBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxDQUFBLEdBQUEsSUFBQSxFQUFBLFdBQUEsR0FBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsR0FBQSxPQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLGFBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLFVBQUEsT0FBQSxFQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsRUFBQSxNQUFBLFNBQUEsRUFBQSxNQUFBLElBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsU0FBQSxHQUFBLENBQUEsYUFBQSxHQUFBLEVBQUEsV0FBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsVUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxVQUFBLElBQUEsRUFBQSxFQUFBLElBQUEsV0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsS0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxNQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsRUFBQSxVQUFBLENBQUEsS0FBQSxFQUFBLFFBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxLQUFBLEVBQUEsVUFBQSxRQUFBLENBQUEsU0FBQSxFQUFBLFVBQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQSxLQUFBLElBQUEsRUFBQSxLQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxhQUFBLEdBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxFQUFBLFdBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsV0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsTUFBQSxFQUFBLEtBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxRQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxJQUFBLENBQUEsR0FBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQUEsTUFBQSxFQUFBLEdBQUEsVUFBQSxHQUFBLEVBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQUEsT0FBQSxJQUFBLEVBQUEsWUFBQSxFQUFBLE1BQUEsRUFBQSxFQUFBLE1BQUEsR0FBQSxFQUFBLElBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLFdBQUEsRUFBQSxNQUFBLEVBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxFQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFlBQUEsRUFBQSxNQUFBLEdBQUEsUUFBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsTUFBQSxHQUFBLFdBQUEsR0FBQSxNQUFBLEdBQUEsUUFBQSxHQUFBLFNBQUEsR0FBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLE9BQUEsR0FBQSxPQUFBLEdBQUEsS0FBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsTUFBQSxHQUFBLE1BQUEsR0FBQSxPQUFBLEdBQUEsT0FBQSxJQUFBLFFBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLEtBQUEsSUFBQSxJQUFBLElBQUEsS0FBQSxFQUFBLENBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLEVBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxNQUFBLEVBQUEsQ0FBQSxPQUFBLE1BQUEsUUFBQSxPQUFBLFNBQUEsUUFBQSxPQUFBLE1BQUEsS0FBQSxJQUFBLElBQUEsdUJBQUEsS0FBQSxVQUFBLFVBQUEsT0FBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxHQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxVQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxhQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsRUFBQSxjQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsVUFBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLEtBQUEsS0FBQSxFQUFBLEVBQUEsVUFBQSxHQUFBLElBQUEsRUFBQSxVQUFBLFFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsSUFBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsRUFBQSxVQUFBLE1BQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxXQUFBLEdBQUEsR0FBQSxFQUFBLFVBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxLQUFBLFFBQUEsZUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLFVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxTQUFBLEVBQUEsbUJBQUEsRUFBQSxVQUFBLFVBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxXQUFBLE1BQUEsRUFBQSxZQUFBLEVBQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxJQUFBLElBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxPQUFBLEtBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxDQUFBLE9BQUEsVUFBQSxDQUFBLE9BQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxhQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLGFBQUEsT0FBQSxRQUFBLE9BQUEsVUFBQSxPQUFBLFFBQUEsR0FBQSxZQUFBLE9BQUEsUUFBQSxPQUFBLEtBQUEsT0FBQSxVQUFBLENBQUEsT0FBQSxLQUFBLE9BQUE7QUNOQSxJQUFBLENBQUEsT0FBQSxVQUFBLFVBQUE7SUFDQSxPQUFBLFVBQUEsV0FBQSxTQUFBLFFBQUEsT0FBQTtRQUNBO1FBQ0EsSUFBQSxPQUFBLFVBQUEsVUFBQTtZQUNBLFFBQUE7OztRQUdBLElBQUEsUUFBQSxPQUFBLFNBQUEsS0FBQSxRQUFBO1lBQ0EsT0FBQTtlQUNBO1lBQ0EsT0FBQSxLQUFBLFFBQUEsUUFBQSxXQUFBLENBQUE7Ozs7QUNWQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxvQkFBQSxVQUFBLFVBQUE7UUFDQSxTQUFBLFVBQUEsZ0JBQUEsUUFBQSxLQUFBLElBQUE7UUFDQSxzREFBQSxVQUFBLGNBQUEsYUFBQSxnQkFBQTs7UUFFQSxJQUFBLFVBQUEsVUFBQSxLQUFBO1lBQ0EsSUFBQSxVQUFBLElBQUE7WUFDQSxRQUFBLEtBQUEsT0FBQSxLQUFBO1lBQ0EsUUFBQSxLQUFBO1lBQ0EsT0FBQSxDQUFBLFFBQUEsUUFBQSxRQUFBLFVBQUE7OztRQUdBLElBQUEsZUFBQSxVQUFBLEtBQUE7WUFDQSxJQUFBLE1BQUE7O1lBRUEsSUFBQSxPQUFBLElBQUEsTUFBQSxLQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsS0FBQSxHQUFBLE1BQUEsS0FBQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxJQUFBLElBQUEsS0FBQSxNQUFBO3dCQUNBLElBQUEsRUFBQTt3QkFDQSxJQUFBLEVBQUEsTUFBQSxtQkFBQSxFQUFBO29CQUNBLENBQUEsS0FBQSxPQUFBLElBQUEsR0FBQSxLQUFBLEtBQUEsSUFBQSxLQUFBLENBQUE7Ozs7WUFJQSxPQUFBOzs7O1FBSUEsSUFBQSxxQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsYUFBQSxtQkFBQTtRQUNBLGFBQUEsUUFBQSxvQkFBQSxRQUFBLFlBQUE7WUFDQSxJQUFBLFVBQUEsS0FBQSxNQUFBLFFBQUEsZ0NBQUE7Z0JBQ0EsWUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUEsUUFBQSxLQUFBO2dCQUNBLFVBQUEsT0FBQSxNQUFBLElBQUEsR0FBQSxLQUFBLFFBQUEsS0FBQTtnQkFDQSxXQUFBLE9BQUEsSUFBQSxTQUFBLEtBQUEsT0FBQSxJQUFBLFlBQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLFVBQUE7O1lBRUEsRUFBQSxRQUFBLFFBQUEsU0FBQSxVQUFBLFFBQUE7Z0JBQ0EsU0FBQTs7Z0JBRUEsS0FBQSxJQUFBLElBQUEsR0FBQSxJQUFBLFVBQUEsS0FBQTtvQkFDQSxXQUFBLE9BQUEsSUFBQSxXQUFBLElBQUEsR0FBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTt3QkFDQSxNQUFBO3dCQUNBLE9BQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxNQUFBLElBQUEsTUFBQTt3QkFDQSxNQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsWUFBQSxVQUFBLE1BQUE7Ozs7Z0JBSUEsUUFBQSxLQUFBO29CQUNBLFFBQUE7b0JBQ0EsYUFBQSxPQUFBLE1BQUEsUUFBQSxLQUFBO29CQUNBLE9BQUE7b0JBQ0EsTUFBQTtvQkFDQSxRQUFBOzs7O1lBSUEsSUFBQSxPQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQTtnQkFDQSxVQUFBO2dCQUNBLFNBQUE7OztZQUdBLE9BQUEsQ0FBQSxLQUFBLE1BQUE7Ozs7UUFJQSxJQUFBLHFCQUFBO1FBQ0EsSUFBQSxlQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsYUFBQSxhQUFBLFlBQUE7UUFDQSxhQUFBLFFBQUEsY0FBQSxRQUFBLFVBQUEsUUFBQSxLQUFBO1lBQ0EsSUFBQSxZQUFBLGFBQUE7Z0JBQ0EsWUFBQSxRQUFBO2dCQUNBLFVBQUEsS0FBQSxNQUFBLFVBQUE7O1lBRUEsSUFBQSxVQUFBLFNBQUEsVUFBQSxNQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLFNBQUE7b0JBQ0EsU0FBQTtnQkFDQSxFQUFBLFFBQUEsVUFBQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFFBQUEsRUFBQSxPQUFBLE9BQUEsTUFBQSxTQUFBO3dCQUNBLFFBQUEsVUFBQSxTQUFBLFVBQUEsTUFBQSxHQUFBLFVBQUEsS0FBQSxVQUFBLE1BQUE7O29CQUVBLE9BQUEsS0FBQTtvQkFDQSxPQUFBLEtBQUE7OztnQkFHQSxRQUFBLFVBQUEsRUFBQSxZQUFBLFFBQUEsU0FBQSxRQUFBOzs7WUFHQSxJQUFBLFVBQUEsUUFBQSxVQUFBLEtBQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsT0FBQSxTQUFBLFVBQUEsS0FBQTtvQkFDQSxXQUFBLFNBQUEsVUFBQSxVQUFBOztnQkFFQSxJQUFBLFNBQUEsR0FBQTtvQkFDQSxRQUFBLFVBQUEsRUFBQSxLQUFBLFFBQUEsU0FBQTt1QkFDQTtvQkFDQSxJQUFBLFdBQUEsQ0FBQSxPQUFBLEtBQUE7d0JBQ0EsV0FBQTs7b0JBRUEsS0FBQSxJQUFBLElBQUEsVUFBQSxJQUFBLFFBQUEsUUFBQSxTQUFBLEdBQUEsS0FBQTt3QkFDQSxTQUFBLEtBQUE7OztvQkFHQSxRQUFBLFVBQUEsRUFBQSxHQUFBLFFBQUEsU0FBQTs7OztZQUlBLElBQUEsVUFBQSxRQUFBO2dCQUNBLFFBQUEsVUFBQSxFQUFBLE9BQUEsUUFBQSxTQUFBLFVBQUEsUUFBQTtvQkFDQSxPQUFBLE9BQUEsV0FBQSxVQUFBLE9BQUE7Ozs7WUFJQSxVQUFBLEtBQUEsS0FBQSxVQUFBOztZQUVBLE9BQUE7Ozs7UUFJQSxJQUFBLDJCQUFBO1FBQ0EsSUFBQSxxQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsYUFBQSxlQUFBO1FBQ0EsYUFBQSxRQUFBLG9CQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7Ozs7O1lBS0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxxQkFBQTtRQUNBLElBQUEsZUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsYUFBQSxZQUFBO1FBQ0EsYUFBQSxRQUFBLGNBQUEsUUFBQSxVQUFBLFFBQUEsS0FBQTs7WUFFQSxJQUFBLFlBQUEsYUFBQTtnQkFDQSxZQUFBLFFBQUE7Z0JBQ0EsVUFBQSxLQUFBLE1BQUEsVUFBQTs7WUFFQSxJQUFBLFVBQUEsYUFBQSxVQUFBLFVBQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsU0FBQSxDQUFBO29CQUNBLFNBQUEsQ0FBQTs7Z0JBRUEsUUFBQSxVQUFBLEVBQUEsT0FB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QUE7UUFDQSxJQUFBLHNCQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsYUFBQSxlQUFBLGlCQUFBO1FBQ0EsYUFBQSxRQUFBLHFCQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7O1lBRUEsTUFBQSxJQUFBO1lBQ0EsSUFBQSxLQUFBLElBQUEsVUFBQSxJQUFBLFVBQUEsRUFBQSxJQUFBLFlBQUEsTUFBQSxZQUFBLEtBQUEsRUFBQSxJQUFBLE9BQUE7WUFDQSw0QkFBQSxnQ0FBQSxLQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxzQkFBQTtRQUNBLElBQUEsZ0JBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxhQUFBLGVBQUEsY0FBQTtRQUNBLGFBQUEsUUFBQSxlQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7WUFDQSxJQUFBLFlBQUEsYUFBQTtnQkFDQSxZQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLE1BQUEsVUFBQTs7WUFFQSxJQUFBLFVBQUEsU0FBQSxVQUFBLE1BQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsU0FBQTtvQkFDQSxTQUFBO2dCQUNBLEVBQUEsUUFBQSxVQUFBLE9BQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsUUFBQSxFQUFBLE9BQUEsT0FBQSxNQUFBLFNBQUE7d0JBQ0EsUUFBQSxVQUFBLFNBQUEsVUFBQSxNQUFBLEdBQUEsVUFBQSxLQUFBLFVBQUEsTUFBQTs7b0JBRUEsT0FBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTs7O2dCQUdBLFNBQUEsVUFBQSxFQUFBLFlBQUEsU0FBQSxTQUFBLFFBQUE7OztZQUdBLFVBQUEsS0FBQSxLQUFBLFVBQUE7O1lBRUEsT0FBQTs7OztRQUlBLElBQUEsOEJBQUE7UUFDQSxJQUFBLHVCQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsYUFBQSxvQkFBQSxvQ0FBQTtRQUNBLGFBQUEsUUFBQSxzQkFBQSxRQUFBLFlBQUE7WUFDQSxPQUFBLFFBQUE7Ozs7UUFJQSxJQUFBLGlDQUFBO1FBQ0EsSUFBQSwyQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsb0JBQUEs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WUFBQTtRQUNBLGFBQUEsUUFBQSxjQUFBLFFBQUEsWUFBQTtZQUNBLE9BQUEsUUFBQTs7OztRQUlBLElBQUEsa0JBQUEsVUFBQSxNQUFBLElBQUE7WUFDQSxJQUFBLFNBQUEsS0FBQSxNQUFBOztZQUVBLE9BQUE7Z0JBQ0EsSUFBQSxNQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsUUFBQSxJQUFBLE1BQUE7Z0JBQ0EsTUFBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQTtnQkFDQSxhQUFBLE9BQUE7Z0JBQ0EsS0FBQTtnQkFDQSxTQUFBLElBQUEsT0FBQTtnQkFDQSxlQUFBLElBQUEsT0FBQTtnQkFDQSxlQUFBLE9BQUE7OztRQUdBLElBQUEsb0JBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsWUFBQTtRQUNBLGFBQUEsU0FBQSxtQkFBQSxRQUFBLFVBQUEsUUFBQSxLQUFBLE1BQUE7WUFDQSxJQUFBLGVBQUEsZ0JBQUE7WUFDQSxPQUFBLENBQUEsS0FBQSxLQUFBLFVBQUEsZUFBQTs7UUFFQSxhQUFBLFVBQUEsb0JBQUEsUUFBQSxVQUFBLFFBQUEsS0FBQSxNQUFBOztZQUVBLE1BQUEsSUFBQTtZQUNBLElBQUEsS0FBQSxJQUFBLFVBQUEsSUFBQSxVQUFBLEVBQUEsSUFBQSxZQUFBLE1BQUEsWUFBQSxLQUFBLEVBQUEsSUFBQSxPQUFBO1lBQ0EsSUFBQSxlQUFBLGdCQUFBLE1BQUE7WUFDQSxPQUFBLENBQUEsS0FBQSxLQUFBLFVBQUEsZUFBQTs7OztRQUlBLGFBQUEsUUFBQSxVQUFBO1FBQ0EsYUFBQSxTQUFBLFVBQUE7OztBQUdBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcsIFtcbiAgICAgICAgJ3NjYWxlQ29uZmlnTW9kdWxlJyxcbiAgICAgICAgJ25nUmVzb3VyY2UnLFxuICAgICAgICAnbmdTYW5pdGl6ZScsXG4gICAgICAgICduZ1JvdXRlJyxcbiAgICAgICAgJ2VtZ3VvLnBvbGxlcicsXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAndWkuZ3JpZCcsXG4gICAgICAgICd1aS5ncmlkLnNlbGVjdGlvbicsXG4gICAgICAgICd1aS5ncmlkLnBhZ2luYXRpb24nLFxuICAgICAgICAndWkuZ3JpZC5yZXNpemVDb2x1bW5zJyxcbiAgICAgICAgJ2NmcC5ob3RrZXlzJyxcbiAgICAgICAgJ3RvZ2dsZS1zd2l0Y2gnXG4gICAgXSk7XG5cbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkcmVzb3VyY2VQcm92aWRlciwgJHByb3ZpZGUsIHBvbGxlckNvbmZpZykge1xuICAgICAgICAvLyBGaXggc291cmNlbWFwc1xuICAgICAgICAvLyBAdXJsIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvaXNzdWVzLzUyMTcjaXNzdWVjb21tZW50LTUwOTkzNTEzXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBmdW5jdGlvbiAoJGRlbGVnYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV4Y2VwdGlvbiwgY2F1c2UpIHtcbiAgICAgICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcCBwb2xsZXJzIHdoZW4gcm91dGUgY2hhbmdlc1xuICAgICAgICBwb2xsZXJDb25maWcuc3RvcE9uUm91dGVDaGFuZ2UgPSB0cnVlO1xuICAgICAgICBwb2xsZXJDb25maWcuc21hcnQgPSB0cnVlO1xuXG4gICAgICAgIC8vIHByZXNlcnZlIHRyYWlsaW5nIHNsYXNoZXNcbiAgICAgICAgJHJlc291cmNlUHJvdmlkZXIuZGVmYXVsdHMuc3RyaXBUcmFpbGluZ1NsYXNoZXMgPSBmYWxzZTtcblxuICAgICAgICAvL3JvdXRpbmdcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdvdkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3ZlcnZpZXcvcGFydGlhbHMvb3ZUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vbG9naW4nLHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWRtaW5Mb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hZG1pbi9wYXJ0aWFscy9hZG1pbkxvZ2luVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2xvZ291dCcse1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2dvdXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvYWRtaW4vcGFydGlhbHMvYWRtaW5Mb2dpblRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9hYm91dCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWJvdXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2Fib3V0L3BhcnRpYWxzL2Fib3V0VGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2ZlZWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2ZlZWREZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL3BhcnRpYWxzL2ZlZWREZXRhaWxzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkL2luZ2VzdHMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2luZ2VzdFJlY29yZHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvaW5nZXN0UmVjb3Jkc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9pbmdlc3RzLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9wYXJ0aWFscy9pbmdlc3RSZWNvcmREZXRhaWxzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL21ldHJpY3MnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21ldHJpY3NDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL21ldHJpY3MvcGFydGlhbHMvbWV0cmljc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbm9kZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ub2Rlcy9wYXJ0aWFscy9ub2Rlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9ub2Rlcy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVEZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ub2Rlcy9wYXJ0aWFscy9ub2RlRGV0YWlsc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9sb2FkL3F1ZXVlZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9hZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbG9hZC9wYXJ0aWFscy9sb2FkVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2xvYWQvcnVubmluZycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAncXVldWVSdW5uaW5nQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9sb2FkL3BhcnRpYWxzL3F1ZXVlUnVubmluZ1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9sb2FkL2RlcHRoJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2FkRGVwdGhDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2xvYWQvcGFydGlhbHMvbG9hZERlcHRoVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL3JlY2lwZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3JlY2lwZXMvcGFydGlhbHMvcmVjaXBlc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvcmVjaXBlcy9yZWNpcGUvOmlkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVEZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9yZWNpcGVzL3BhcnRpYWxzL3JlY2lwZURldGFpbHNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvcmVjaXBlcy90eXBlcy86aWQ/Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVUeXBlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVUeXBlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9qb2JzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYnNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvam9iLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYkRldGFpbFRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9qb2JzL3R5cGVzLzppZD8nLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYlR5cGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYlR5cGVzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZmFpbHVyZS1yYXRlcycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZXNGYWlsdXJlUmF0ZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iVHlwZXNGYWlsdXJlUmF0ZXNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25zVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25EZXRhaWxUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvd29ya3NwYWNlcy86aWQ/Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd3b3Jrc3BhY2VzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy93b3Jrc3BhY2VzL3BhcnRpYWxzL3dvcmtzcGFjZXNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9zdHJpa2VzLzppZD8nLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3N0cmlrZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvc3RyaWtlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm90aGVyd2lzZSh7XG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgIC52YWx1ZSgnbW9tZW50Jywgd2luZG93Lm1vbWVudClcbiAgICAudmFsdWUoJ2xvY2FsU3RvcmFnZScsIHdpbmRvdy5sb2NhbFN0b3JhZ2UpXG4gICAgLnZhbHVlKCdYTUxIdHRwUmVxdWVzdCcsIHdpbmRvdy5YTUxIdHRwUmVxdWVzdClcbiAgICAudmFsdWUoJ3RvYXN0cicsIHdpbmRvdy50b2FzdHIpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQ29uZmlnTW9kdWxlJywgW10pLnByb3ZpZGVyKCdzY2FsZUNvbmZpZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNjYWxlQ29uZmlnID0ge30sXG4gICAgICAgICAgICBzY2FsZUNvbmZpZ0xvY2FsID0ge307XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnY29uZmlnL3NjYWxlQ29uZmlnLmpzb24nLFxuICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHNjYWxlQ29uZmlnID0gY29uZmlnLnJlc3BvbnNlSlNPTi5zY2FsZUNvbmZpZztcblxuICAgICAgICAgICAgICAgIHZhciBjb25maWdMb2NhbCA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6ICdjb25maWcvc2NhbGVDb25maWcubG9jYWwuanNvbicsXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnTG9jYWwuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVDb25maWdMb2NhbCA9IGNvbmZpZ0xvY2FsLnJlc3BvbnNlSlNPTi5zY2FsZUNvbmZpZ0xvY2FsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF8ubWVyZ2Uoc2NhbGVDb25maWcsIHNjYWxlQ29uZmlnTG9jYWwpO1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkIGZ1bmN0aW9uIGZvciBnZXRBcGlQcmVmaXhcbiAgICAgICAgICAgICAgICBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXggPSBmdW5jdGlvbihzZXJ2aWNlTmFtZSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy51cmxzLm92ZXJyaWRlcyAmJiBzY2FsZUNvbmZpZy51cmxzLm92ZXJyaWRlc1tzZXJ2aWNlTmFtZV0gPyBzY2FsZUNvbmZpZy51cmxzLm92ZXJyaWRlc1tzZXJ2aWNlTmFtZV0gOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZztcbiAgICAgICAgfVxuXG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0hlYWRlckNvbnRyb2xsZXInLCBmdW5jdGlvbihzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmN1cnJlbnRQYXRoID0gc3VibmF2U2VydmljZS5nZXRDdXJyZW50UGF0aCgpO1xuICAgIH0pXG4gICAgLmRpcmVjdGl2ZSgnYWlzSGVhZGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtaGVhZGVyIG5hbWU9e25hbWV9PjwvYWlzLWhlYWRlcj5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSGVhZGVyQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2hlYWRlci9oZWFkZXJUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogJz0nLFxuICAgICAgICAgICAgICAgIGhpZGVUaXRsZTogJz0nLFxuICAgICAgICAgICAgICAgIGxvYWRpbmc6ICc9JywgLy8gb3B0aW9uYWwgLSB3aWxsIG92ZXJsYXkgYSBsb2FkaW5nIHNwaW5uZXIgb24gdGhlIHBhZ2UgYmFzZWQgb24gdGhlIHBhc3NlZC1pbiB2YWx1ZVxuICAgICAgICAgICAgICAgIHNob3dTdWJuYXY6ICc9JyxcbiAgICAgICAgICAgICAgICBzdWJuYXZMaW5rczogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnc2NhbGVOYXZpZ2F0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9uYXZpZ2F0aW9uL3BhcnRpYWxzL25hdlRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25hdkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhYm91dENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgbmF2U2VydmljZSwgc3RhdGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLnZlcnNpb24gPSAnJztcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignYWJvdXQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc3RhdGVTZXJ2aWNlLmdldFZlcnNpb24oKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdm0udmVyc2lvbiA9IG5ld1ZhbHVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2FkbWluTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24gKCR0aW1lb3V0LCAkbG9jYXRpb24sIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmxvZ2luKCdhZG1pbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gQW55IGNvZGUgaW4gaGVyZSB3aWxsIGF1dG9tYXRpY2FsbHkgaGF2ZSBhbiAkc2NvcGUuYXBwbHkoKSBydW4gYWZ0ZXJ3YXJkc1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbG9nb3V0Q29udHJvbGxlcicsIGZ1bmN0aW9uICgkdGltZW91dCwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCB1c2VyU2VydmljZSkge1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdXNlclNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIC8vIEFueSBjb2RlIGluIGhlcmUgd2lsbCBhdXRvbWF0aWNhbGx5IGhhdmUgYW4gJHNjb3BlLmFwcGx5KCkgcnVuIGFmdGVyd2FyZHNcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzRGF0YUZlZWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgc2NhbGVDb25maWcsIGxvYWRTZXJ2aWNlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGRheXMgPSBbXSxcbiAgICAgICAgICAgIGhvdXJzID0gWzAsMSwyLDMsNCw1LDYsNyw4LDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsMTksMjAsMjEsMjIsMjNdLFxuICAgICAgICAgICAgdmFsdWVzID0ge307XG4gICAgICAgIFxuICAgICAgICB2YXIgcHJvY2Vzc05ld0ZlZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXlzID0gW107XG4gICAgICAgICAgICB2YXIgZGF5ID0gJyc7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmZlZWQpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLmZlZWQudmFsdWVzLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxkYXkgPSBtb21lbnQudXRjKHZhbC50aW1lKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGhvdXIgPSBtb21lbnQudXRjKHZhbC50aW1lKS5ob3VyKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IHZhbGRheSArICdfJyArIHZhbGhvdXI7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpZF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxkYXkgIT09IGRheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5ID0gdmFsZGF5O1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5cy5wdXNoKHZhbGRheSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBidWlsZFRhYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGJ1aWxkVGFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY3VyckRheSA9IG1vbWVudCgpLnV0YygpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXkpO1xuICAgICAgICAgICAgdmFyIGN1cnJIb3VyID0gbW9tZW50KCkudXRjKCkuaG91cigpO1xuXG4gICAgICAgICAgICB2YXIgdGFibGVfaHRtbCA9ICc8ZGl2IGNsYXNzPVwidGFibGUtcmVzcG9uc2l2ZVwiPjx0YWJsZT4nO1xuICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHRyPjx0aD5Ib3VyIChVVEMpPC90aD4nO1xuICAgICAgICAgICAgZm9yKGRheSBpbiBkYXlzKSB7XG4gICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHRkIGNsYXNzPVwiZGF5LWxhYmVsXCIgdGl0bGU9XCInICsgZGF5c1tkYXldICsgJ1wiPjxkaXYgY2xhc3M9XCJkYXktb2Ytd2Vla1wiPicgKyBzY2FsZVNlcnZpY2UuZ2V0RGF5U3RyaW5nKG1vbWVudChkYXlzW2RheV0pLmRheSgpKSArICc8L2Rpdj4nICsgbW9tZW50KGRheXNbZGF5XSkuZm9ybWF0KCdNTS9ERCcpICsgJzwvdGQ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzwvdHI+JztcbiAgICAgICAgICAgIGZvcih2YXIgaG91ciBpbiBob3Vycykge1xuICAgICAgICAgICAgICAgIGhvdXIgPSAyMy1ob3VyO1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0cj4nO1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0aCB0aXRsZT1cIicgKyBob3Vyc1tob3VyXSArICc6MDBcIj4nICsgaG91cnNbaG91cl0gKyAnPC90aD4nO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBkYXkgaW4gZGF5cykge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gIGRheXNbZGF5XSArICdfJyArIGhvdXJzW2hvdXJdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZXMgPSB2YWx1ZXNba2V5XS5maWxlcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSB2YWx1ZXNba2V5XS5zaXplO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xzID0gJ2dvb2QnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF5c1tkYXldID09PSBjdXJyRGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnNbaG91cl0gPT09IGN1cnJIb3VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzID0gJ2N1cnJlbnQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaG91cnNbaG91cl0gPiBjdXJySG91cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICdmdXR1cmUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcyA9PT0gMCAmJiBzaXplID09PSAwICYmIGNscyAhPT0gJ2N1cnJlbnQnICYmIGNscyAhPT0gJ2Z1dHVyZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICd1bmtub3duJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dGQgaWQ9XCInICsga2V5ICsgJ1wiIHRpdGxlPVwiJyArIGRheXNbZGF5XSArICcgJyArIGhvdXJzW2hvdXJdICsgJzowMFwiPic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjbHMgPT09ICdmdXR1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyBkYXlzW2RheV0gKyAnXycgKyBob3Vyc1tob3VyXSArICdcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPiZuYnNwOzwvc3Bhbj48L3RkPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzxzcGFuIGNsYXNzPVwiJyArIGNscyArICdcIiBpZD1cInNwYW5fJyArIGRheXNbZGF5XSArICdfJyArIGhvdXJzW2hvdXJdICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCI+JyArIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplLDEpICsgJyAvICcgKyBmaWxlcyArICc8L3NwYW4+PC90ZD4nO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPC90cj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPC90YWJsZT48L2Rpdj4nO1xuICAgICAgICAgICAgJCgnI2hpc3RvcnknKS5odG1sKHRhYmxlX2h0bWwpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmZWVkJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5mZWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NOZXdGZWVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzRGF0YUZlZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzRGF0YUZlZWRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvZGF0YUZlZWQvZGF0YUZlZWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGZlZWQ6ICc9JyAvLyBGZWVkIGRhdGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzRG9udXRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBjb2xEYXRhID0gW10sXG4gICAgICAgICAgICBjaGFydCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdlbkNoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG9sZERhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyByZWFzc2VtYmxlIGN1cnJlbnRseSBkaXNwbGF5ZWQgZGF0YSB0byBtYXRjaCBjb2xEYXRhXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNoYXJ0LmRhdGEoKSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgb2xkRGF0YS5wdXNoKFtkLnZhbHVlc1swXS5pZCwgZC52YWx1ZXNbMF0udmFsdWVdKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIGRldGVybWluZSB3aGljaCBlbGVtZW50cyB0byByZW1vdmVcbiAgICAgICAgICAgICAgICBfLmZvckVhY2gob2xkRGF0YSwgZnVuY3Rpb24gKG9kKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZWVwID0gXy5maW5kKGNvbERhdGEsIGZ1bmN0aW9uIChjZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNkWzBdID09PSBvZFswXTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgha2VlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzLnB1c2gob2RbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hhcnRcbiAgICAgICAgICAgICAgICBjaGFydC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdW5sb2FkOiByZW1vdmVJZHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJGVsZW1lbnRbMF0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbERhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAkc2NvcGUudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd246IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZzogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbXBsZXRlZDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERvbmU6ICcjMzY4MWJmJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBRdWV1ZTogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYWlsZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUxHT1JJVEhNOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgREFUQTogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTWVNURU06IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPZmZsaW5lOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdIaWdoIEZhaWx1cmUgUmF0ZSc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9vcmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF1c2VkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGllOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAkc2NvcGUuc2hvd0xhYmVsID8gZDMuZm9ybWF0KCcsJykgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICRzY29wZS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAkc2NvcGUubmFtZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAkc2NvcGUuc2l6ZSB8fCAzMjBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAnc3RhdGljJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdENvbHVtbkRhdGEgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIGNvbERhdGEgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5kYXRhLmZvckVhY2goZnVuY3Rpb24gKG9iail7XG4gICAgICAgICAgICAgICAgY29sRGF0YS5wdXNoKFtvYmouc3RhdHVzLG9iai5jb3VudF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbml0Q29sdW1uRGF0YSgpO1xuICAgICAgICAgICAgZ2VuQ2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgkZWxlbWVudFswXSkuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdlbkNoYXJ0KCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzRG9udXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzRG9udXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnPScsXG4gICAgICAgICAgICAgICAgc2l6ZTogJz0nLFxuICAgICAgICAgICAgICAgIHNob3dMYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnPScsXG4gICAgICAgICAgICAgICAgbmFtZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNHcmlkQ2hhcnRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsIHVzZXJTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBzdmcgPSBudWxsLFxuICAgICAgICAgICAgcmVjdCA9IG51bGwsXG4gICAgICAgICAgICBzY2FsZSA9IHBhcnNlRmxvYXQoJHNjb3BlLnNjYWxlKSxcbiAgICAgICAgICAgIHRpcCA9IGQzLnRpcCgpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXG4gICAgICAgICAgICAgICAgLm9mZnNldChbLTEwLCAwXSlcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGQuc3RhdHVzLmdldEZhaWx1cmVzKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsU3RyID0gZmFpbHVyZXMubGVuZ3RoID4gMCA/ICc8YnIgLz48YnIgLz4nIDogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBydW5uaW5nID0gZ2V0Q2VsbEFjdGl2aXR5VG90YWwoZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBnZXRDZWxsVG90YWwoZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNTdHIgPSBydW5uaW5nID4gMCB8fCBjb21wbGV0ZWQgPiAwID8gJzxiciAvPicgOiAnJztcblxuICAgICAgICAgICAgICAgICAgICBpZiAocnVubmluZyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1N0ciA9IHN0YXR1c1N0ciArICc8c3BhbiBjbGFzcz1cImxhYmVsIGxhYmVsLXJ1bm5pbmdcIj5SdW5uaW5nOiAnICsgcnVubmluZyArICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGxldGVkID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzU3RyID0gc3RhdHVzU3RyICsgJyA8c3BhbiBjbGFzcz1cImxhYmVsIGxhYmVsLWNvbXBsZXRlZFwiPkNvbXBsZXRlZDogJyArIGNvbXBsZXRlZCArICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gXy5zb3J0QnlPcmRlcihmYWlsdXJlcywgWydvcmRlciddKTtcblxuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZmFpbHVyZXMsIGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsU3RyID0gZmFpbFN0ciArICc8c3BhbiBjbGFzcz1cImxhYmVsIGxhYmVsLScgKyBmLnN0YXR1cy50b0xvd2VyQ2FzZSgpICsgJ1wiPicgKyBfLmNhcGl0YWxpemUoZi5zdGF0dXMudG9Mb3dlckNhc2UoKSkgKyAnOiAnICsgZi5jb3VudCArICc8L3NwYW4+ICc7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC50aXRsZSArICcgJyArIGQudmVyc2lvbiArICc8YnIgLz4nICsgc3RhdHVzU3RyICsgZmFpbFN0cjtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNlbGxXaWR0aCA9IDUwICogc2NhbGUsXG4gICAgICAgICAgICBjZWxsSGVpZ2h0ID0gNTAgKiBzY2FsZSxcbiAgICAgICAgICAgIGVuYWJsZVpvb20gPSB0eXBlb2YgJHNjb3BlLm1vZGUgIT09ICd1bmRlZmluZWQnID8gJHNjb3BlLm1vZGUgPT09ICd6b29tJyA6IHRydWUsXG4gICAgICAgICAgICBlbmFibGVUb29sdGlwID0gdHlwZW9mICRzY29wZS5tb2RlICE9PSAndW5kZWZpbmVkJyA/ICRzY29wZS5tb2RlID09PSAndG9vbHRpcCcgOiBmYWxzZSxcbiAgICAgICAgICAgIGVuYWJsZVJldmVhbCA9IHR5cGVvZiAkc2NvcGUucmV2ZWFsICE9PSAndW5kZWZpbmVkJyA/ICRzY29wZS5yZXZlYWwgOiB0cnVlLFxuICAgICAgICAgICAgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpLFxuICAgICAgICAgICAgZ3JpZERhdGEgPSBbXSxcbiAgICAgICAgICAgIHdpZHRoID0gJCgnLmdyaWQtY2hhcnQnKS53aWR0aCgpLFxuICAgICAgICAgICAgaGVpZ2h0ID0gKE1hdGguY2VpbCh3aWR0aCAvIGNlbGxXaWR0aCkgKiBjZWxsSGVpZ2h0KSxcbiAgICAgICAgICAgIGNvbHMgPSAwLFxuICAgICAgICAgICAgcm93cyA9IDAsXG4gICAgICAgICAgICBjZWxsRm9udExnID0gLjQsXG4gICAgICAgICAgICBjZWxsRm9udFNtID0gLjM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ucGF1c2VSZWFzb24gPSAnJztcbiAgICAgICAgdm0uZGF0YVZhbHVlcyA9IFtdO1xuICAgICAgICB2bS5ncmlkQ2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLmljb25zID09PSB0cnVlID8gJ2ljb25zJyA6ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5kYXRhVmFsdWVzJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWlnaHQgPSAoTWF0aC5jZWlsKG5ld1ZhbHVlLmxlbmd0aCAvIChNYXRoLmZsb29yKHdpZHRoIC8gY2VsbFdpZHRoKSkpICogY2VsbEhlaWdodCk7XG4gICAgICAgICAgICBpZiAoZW5hYmxlWm9vbSkge1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGhlaWdodCAqIDY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkMy5zZWxlY3QoJy5ncmlkLWNoYXJ0LWNvbnRhaW5lciBzdmcnKS5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICAgICAgZDMuc2VsZWN0KCcub3ZlcmxheScpLmF0dHIoJ2hlaWdodCcsIGhlaWdodCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBnZXREYXRhVmFsdWVzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGdyaWREYXRhID0gW107XG4gICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gW107XG4gICAgICAgICAgICBpZiAoZGF0YS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFUeXBlID0gZGF0YS5kYXRhLnRvU3RyaW5nKCkuc3BsaXQoJywnKVswXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVR5cGUgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ25hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc29jaWF0ZSBKb2JUeXBlIHdpdGggSm9iVHlwZVN0YXR1c1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZGF0YVZhbHVlcywgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsLnN0YXR1cyA9IF8uZmluZChkYXRhLnN0YXR1cywgJ2pvYl90eXBlLmlkJywgdmFsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRhdGFWYWx1ZXMgPSBfLnNvcnRCeU9yZGVyKF8udmFsdWVzKGRhdGEuZGF0YSksIFsnc3RhdHVzLmhhc19ydW5uaW5nJywgJ3N0YXR1cy5kZXNjcmlwdGlvbicsICduYW1lJ10sIFsnYXNjJywgJ2FzYycsICdhc2MnXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRhdGFWYWx1ZXMgPSBfLnZhbHVlcyhkYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAvL3ZtLmRhdGFWYWx1ZXMgPSBfLnNvcnRCeU9yZGVyKF8udmFsdWVzKGRhdGEuZGF0YSksIFsnaG9zdG5hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc29jaWF0ZSBOb2RlIHdpdGggTm9kZVN0YXR1c1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZGF0YVZhbHVlcywgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsLnN0YXR1cyA9IF8uZmluZChkYXRhLnN0YXR1cywgJ25vZGUuaWQnLCB2YWwuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy92bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcih2bS5kYXRhVmFsdWVzLCBbJ2hvc3RuYW1lJ10sIFsnYXNjJ10pOyAvLyBzb3J0IGJ5IGhvc3ROYW1lIGFzY1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRhdGFWYWx1ZXMgPSBkYXRhLmRhdGE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29scyA9ICRzY29wZS5jb2x1bW5zID8gJHNjb3BlLmNvbHVtbnMgOiBNYXRoLmZsb29yKHdpZHRoIC8gY2VsbFdpZHRoKTtcbiAgICAgICAgICAgICAgICByb3dzID0gJHNjb3BlLnJvd3MgPyAkc2NvcGUucm93cyA6IE1hdGguY2VpbCh2bS5kYXRhVmFsdWVzLmxlbmd0aCAvIGNvbHMpO1xuXG4gICAgICAgICAgICAgICAgZDMucmFuZ2Uocm93cykubWFwKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgZDMucmFuZ2UoY29scykubWFwKGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wgPD0gdm0uZGF0YVZhbHVlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFPYmogPSB2bS5kYXRhVmFsdWVzWyhjb2xzICogcm93KSArIGNvbF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFPYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YU9iai5jb29yZHMgPSBbY29sICogY2VsbEhlaWdodCwgcm93ICogY2VsbFdpZHRoXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZERhdGEucHVzaChkYXRhT2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJldmVhbERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQtZGV0YWlsJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBoaWRlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtdGV4dCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQtZGV0YWlsJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC1wYXVzZS1yZXN1bWUtaWNvbicpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb2xzID0gJHNjb3BlLmNvbHVtbnMgPyAkc2NvcGUuY29sdW1ucyA6IE1hdGguZmxvb3Iod2lkdGggLyBjZWxsV2lkdGgpO1xuICAgICAgICAgICAgcm93cyA9ICRzY29wZS5yb3dzID8gJHNjb3BlLnJvd3MgOiBNYXRoLmNlaWwodm0uZGF0YVZhbHVlcy5sZW5ndGggLyBjb2xzKTtcblxuICAgICAgICAgICAgdmFyIHRpY2tWYWx1ZXMgPSBBcnJheS5hcHBseShudWxsLCB7bGVuZ3RoOiByb3dzfSkubWFwKE51bWJlci5jYWxsLCBOdW1iZXIpO1xuXG4gICAgICAgICAgICB2YXIgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKVxuICAgICAgICAgICAgICAgIC5zY2FsZUV4dGVudChbMSwgNl0pXG4gICAgICAgICAgICAgICAgLy8uY2VudGVyKFswLCAwXSlcbiAgICAgICAgICAgICAgICAub24oJ3pvb20nLCB6b29tZWQpO1xuXG4gICAgICAgICAgICBpZiAoZW5hYmxlWm9vbSkge1xuICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgnLmdyaWQtY2hhcnQnKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoem9vbSlcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbmFibGVUb29sdGlwKSB7XG4gICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KCcuZ3JpZC1jaGFydCcpLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh0aXApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoJy5ncmlkLWNoYXJ0JykuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdmcuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnb3ZlcmxheScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodCk7XG5cbiAgICAgICAgICAgIGlmICh2bS5zaG93QXhlcykge1xuICAgICAgICAgICAgICAgIHZhciB5ID0gZDMuc2NhbGUubGluZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgcm93c10pXG4gICAgICAgICAgICAgICAgICAgIC5yYW5nZShbMCwgaGVpZ2h0LTEwXSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpXG4gICAgICAgICAgICAgICAgICAgIC5zY2FsZSh5KVxuICAgICAgICAgICAgICAgICAgICAub3JpZW50KCdsZWZ0JylcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tWYWx1ZXModGlja1ZhbHVlcyk7XG5cbiAgICAgICAgICAgICAgICBzdmcuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgMjUgKyAnLCcgKyAwICsgJyknKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3kgYXhpcycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAwICsgJywnICsgY2VsbEhlaWdodCAvIDIgKyAnKScpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2V0RGF0YVZhbHVlcyhkYXRhKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gem9vbWVkKCkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gZDMuZXZlbnQuc2NhbGU7XG5cbiAgICAgICAgICAgICAgICBpZiAoZW5hYmxlUmV2ZWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzID4gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZWFsRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZURhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocyA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNob3dBeGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB6b29tLnRyYW5zbGF0ZShbMjUsIDBdKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHpvb20udHJhbnNsYXRlKFswLCAwXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3ZnLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHpvb20udHJhbnNsYXRlKCkgKyAnKXNjYWxlKCcgKyBkMy5ldmVudC5zY2FsZSArICcpJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZHJhZ09mZnNldFggPSAwLFxuICAgICAgICAgICAgZHJhZ09mZnNldFkgPSAwLFxuICAgICAgICAgICAgY2xpY2tPZmZzZXRYID0gMCxcbiAgICAgICAgICAgIGNsaWNrT2Zmc2V0WSA9IDA7XG5cbiAgICAgICAgdmFyIGRyYWcgPSBkMy5iZWhhdmlvci5kcmFnKClcbiAgICAgICAgICAgIC5vbignZHJhZ3N0YXJ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIHRyYWNrIG9mZnNldFggYW5kIG9mZnNldFkgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBkcmFnIGFuZCBjbGlja1xuICAgICAgICAgICAgICAgIGRyYWdPZmZzZXRYID0gZDMuZXZlbnQuc291cmNlRXZlbnQubGF5ZXJYO1xuICAgICAgICAgICAgICAgIGRyYWdPZmZzZXRZID0gZDMuZXZlbnQuc291cmNlRXZlbnQubGF5ZXJZO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGdldENlbGxGaWxsID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxGaWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsVGV4dCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmdldENlbGxUZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxBY3Rpdml0eSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEFjdGl2aXR5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsUGF1c2VSZXN1bWUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbFBhdXNlUmVzdW1lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxBY3Rpdml0eVRvdGFsID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxBY3Rpdml0eVRvdGFsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxUaXRsZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmdldENlbGxUaXRsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsRXJyb3IgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ0ZhaWxlZDogVW5hdmFpbGFibGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsVG90YWwgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbFRvdGFsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ0NvbXBsZXRlZDogVW5hdmFpbGFibGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsU3RhdHVzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsU3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdTdGF0dXMgVW5hdmFpbGFibGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsSm9icyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEpvYnMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxGYWlsdXJlcyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEZhaWx1cmVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjZWxsQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICAgICAgLy8gdHJhY2sgb2Zmc2V0WCBhbmQgb2Zmc2V0WSB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGRyYWcgYW5kIGNsaWNrXG4gICAgICAgICAgICBjbGlja09mZnNldFggPSBkMy5ldmVudC5sYXllclg7XG4gICAgICAgICAgICBjbGlja09mZnNldFkgPSBkMy5ldmVudC5sYXllclk7XG4gICAgICAgICAgICBpZiAoZHJhZ09mZnNldFggPT09IGNsaWNrT2Zmc2V0WCAmJiBkcmFnT2Zmc2V0WSA9PT0gY2xpY2tPZmZzZXRZKSB7XG4gICAgICAgICAgICAgICAgLy8gb2Zmc2V0cyBhcmUgdGhlIHNhbWU7IG5vIGRyYWdnaW5nIG9jY3VycmVkOyBwcm9jZXNzIGFzIGNsaWNrIGV2ZW50XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2pvYnMnKS5zZWFyY2goJ2pvYl90eXBlX2lkJywgdGFyZ2V0LmlkKS5zZWFyY2goJ3N0YXR1cycsIHRhcmdldC5zdGF0dXMuaGFzX3J1bm5pbmcuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL25vZGVzLycgKyB0YXJnZXQuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlbGVtID0gJCgnLmNlbGwtYWN0aXZpdHktaWNvbicpO1xuICAgICAgICAgICAgVHdlZW5NYXgudG8oZWxlbSwgMSwge1xuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiAzNjAsXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnNTAlIDUwJScsXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMSxcbiAgICAgICAgICAgICAgICBlYXNlOiBMaW5lYXIuZWFzZU5vbmVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBEQVRBIEpPSU5cbiAgICAgICAgICAgIC8vIEpvaW4gbmV3IGRhdGEgd2l0aCBvbGQgZWxlbWVudHMsIGlmIGFueS5cbiAgICAgICAgICAgIGlmIChlbmFibGVUb29sdGlwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lckdyb3VwID0gc3ZnLnNlbGVjdEFsbCgnLmNlbGwtZ3JvdXAnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIHRpcC5zaG93KVxuICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgdGlwLmhpZGUpXG4gICAgICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCB0aXAuaGlkZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXJHcm91cCA9IHN2Zy5zZWxlY3RBbGwoJy5jZWxsLWdyb3VwJylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVQREFURVxuICAgICAgICAgICAgLy8gVXBkYXRlIG9sZCBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5zdG9wMScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1swXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1swXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLnN0b3AyJylcbiAgICAgICAgICAgICAgICAuYXR0cignb2Zmc2V0JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnNTAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdG9wLWNvbG9yJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzWzFdID09PSAnU1lTVEVNJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSA6IGZhaWx1cmVzWzFdID09PSAnREFUQScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9kYXRhIDogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfYWxnb3JpdGhtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuc3RvcDMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdG9wLWNvbG9yJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzWzJdID09PSAnU1lTVEVNJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSA6IGZhaWx1cmVzWzJdID09PSAnREFUQScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9kYXRhIDogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfYWxnb3JpdGhtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbCcpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGNnID0gY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1ncmFkaWVudCcpO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUZXh0KGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScgJiYgZ2V0Q2VsbEFjdGl2aXR5VG90YWwoZCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2VsbEhlaWdodCAvIDI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChjZWxsSGVpZ2h0IC8gMikgKyAxMDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10b3RhbC1hY3RpdmUnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEFjdGl2aXR5VG90YWwoZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1wYXVzZS1yZXN1bWUtaWNvbicpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFBhdXNlUmVzdW1lKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWFjdGl2aXR5LWljb24nKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10aXRsZScpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRpdGxlKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWVycm9yJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRXJyb3IoZCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtdG90YWwnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUb3RhbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1zdGF0dXMnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxTdGF0dXMoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtam9icycpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEpvYnMoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtb3ZlcmxheScpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICBjZWxsQ2xpY2tIYW5kbGVyKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEVOVEVSXG4gICAgICAgICAgICAvLyBDcmVhdGUgbmV3IGVsZW1lbnRzIGFzIG5lZWRlZC5cbiAgICAgICAgICAgIHZhciBjZWxsR3JvdXAgPSBjb250YWluZXJHcm91cC5lbnRlcigpXG4gICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZ3JvdXAnKTtcblxuICAgICAgICAgICAgdmFyIGRlZnMgPSBjZWxsR3JvdXAuYXBwZW5kKCdkZWZzJyk7XG4gICAgICAgICAgICB2YXIgZ3JhZGllbnQgPSBkZWZzLmFwcGVuZCgnbGluZWFyR3JhZGllbnQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLm5hbWU7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1ncmFkaWVudCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gxJywgMClcbiAgICAgICAgICAgICAgICAuYXR0cigneTEnLCAwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIDApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgMSk7XG4gICAgICAgICAgICBncmFkaWVudC5hcHBlbmQoJ3N0b3AnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdzdG9wMScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1swXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1swXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBncmFkaWVudC5hcHBlbmQoJ3N0b3AnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdzdG9wMicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzUwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1sxXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1sxXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBncmFkaWVudC5hcHBlbmQoJ3N0b3AnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdzdG9wMycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMl0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMl0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgY2VsbFdpZHRoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBjZWxsSGVpZ2h0KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd1cmwoIycgKyBkLm5hbWUgKyAnKSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPyAnI2ZmZicgOiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MCk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVGV4dChkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldENlbGxBY3Rpdml0eVRvdGFsKGQpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsSGVpZ2h0IC8gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoY2VsbEhlaWdodCAvIDIpICsgMTA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGxIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc2NhbGUgKiA4ICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCBlbmFibGVSZXZlYWwgPyAnYmxvY2snIDogJ25vbmUnKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdG90YWwtYWN0aXZlJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHlUb3RhbChkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgY2VsbEhlaWdodCAtIDUpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZW5hYmxlUmV2ZWFsID8gJ2Jsb2NrJyA6ICdub25lJyk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWFjdGl2aXR5JylcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1hY3Rpdml0eS1pY29uJylcbiAgICAgICAgICAgICAgICAuYXR0cignZm9udC1zaXplJywgMTEpXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eShkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdlbmQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC0gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIDEzKTtcblxuICAgICAgICAgICAgdmFyIGRldGFpbCA9IGNlbGxHcm91cC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXRleHQtZGV0YWlsJylcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKGNlbGxIZWlnaHQgKi4xNSkpIC8vIDE1JSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCBlbmFibGVSZXZlYWwgPyAnbm9uZScgOiAnYmxvY2snKTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXRpdGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKGNlbGxIZWlnaHQgKiAuMTUpKSAvLyAxNSUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBjZWxsRm9udFNtICogc2NhbGUgKyAnZW0nKVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVGl0bGUoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbCh3cmFwKTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWVycm9yJylcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKGNlbGxIZWlnaHQgKi4zKSkgLy8gMzAlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEVycm9yKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10b3RhbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICouNCkpIC8vIDQwJSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGNlbGxGb250U20gKiBzY2FsZSArICdlbScpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUb3RhbChkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKHdyYXApO1xuXG4gICAgICAgICAgICBkZXRhaWwuYXBwZW5kKCd0c3BhbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtc3RhdHVzJylcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKGNlbGxIZWlnaHQgKiAuNTUpKSAvLyA1NSUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBjZWxsRm9udExnICogc2NhbGUgKyAnZW0nKVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsU3RhdHVzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZXRhaWwuYXBwZW5kKCd0c3BhbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtam9icycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICogLjc1KSkgLy8gNzUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEpvYnMoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbCh3cmFwKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtb3ZlcmxheScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgY2VsbFdpZHRoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBjZWxsSGVpZ2h0KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjZmZmJylcbiAgICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsICcwLjI1Jyk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbC1vcGFjaXR5JywgJzAnKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBjZWxsQ2xpY2tIYW5kbGVyKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwoZHJhZyk7XG5cbiAgICAgICAgICAgIGlmICh1c2VyICYmIHVzZXIuaXNfYWRtaW4pIHtcbiAgICAgICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxQYXVzZVJlc3VtZShkKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ3N0YXJ0JylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBlbmFibGVSZXZlYWwgPyAyIDogNSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBlbmFibGVSZXZlYWwgPyAkc2NvcGUuc2NhbGUgKiA4IDogMjApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsIGVuYWJsZVJldmVhbCA/ICdub25lJyA6ICdibG9jaycpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZW5hYmxlUmV2ZWFsID8gJHNjb3BlLnNjYWxlICogNyArICdweCcgOiAnMS4zZW0nKVxuICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnY3Vyc29yJywgJ3BvaW50ZXInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ibHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICd3aGl0ZScpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRU5URVIgKyBVUERBVEVcbiAgICAgICAgICAgIC8vIEFwcGVuZGluZyB0byB0aGUgZW50ZXIgc2VsZWN0aW9uIGV4cGFuZHMgdGhlIHVwZGF0ZSBzZWxlY3Rpb24gdG8gaW5jbHVkZVxuICAgICAgICAgICAgLy8gZW50ZXJpbmcgZWxlbWVudHM7IHNvLCBvcGVyYXRpb25zIG9uIHRoZSB1cGRhdGUgc2VsZWN0aW9uIGFmdGVyIGFwcGVuZGluZyB0b1xuICAgICAgICAgICAgLy8gdGhlIGVudGVyIHNlbGVjdGlvbiB3aWxsIGFwcGx5IHRvIGJvdGggZW50ZXJpbmcgYW5kIHVwZGF0aW5nIG5vZGVzLlxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGQuY29vcmRzICsgJyknO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgdXBkYXRlQ2VsbEZpbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbCcpXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDI1MClcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPyAnI2ZmZicgOiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZVBhdXNlUmVzdW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxQYXVzZVJlc3VtZShkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgdXBkYXRlQ2VsbFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXN0YXR1cycpXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFN0YXR1cyhkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBFWElUXG4gICAgICAgICAgICAvLyBSZW1vdmUgb2xkIGVsZW1lbnRzIGFzIG5lZWRlZC5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLmV4aXQoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWV4aXQnKVxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAuZHVyYXRpb24oNzUwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsMCknKVxuICAgICAgICAgICAgICAgIC5yZW1vdmUoKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gd3JhcCAodGV4dCwgd2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0ZXh0LmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGQzLnNlbGVjdCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzID0gdGV4dC50ZXh0KCkuc3BsaXQoL1xccysvKS5yZXZlcnNlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZU51bWJlciA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gMS4xLFxuICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHRleHQuYXR0cigneScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBwYXJzZUZsb2F0KHRleHQuYXR0cignZHknKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0c3BhbiA9IHRleHQudGV4dChudWxsKS5hcHBlbmQoJ3RzcGFuJykuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpLmF0dHIoJ3knLCB5KS5hdHRyKCdkeScsIGR5ICsgJ2VtJyk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh3b3JkID0gd29yZHMucG9wKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0c3Bhbi50ZXh0KGxpbmUuam9pbignICcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHNwYW4ubm9kZSgpLmdldENvbXB1dGVkVGV4dExlbmd0aCgpID4gKGNlbGxXaWR0aCAtIDEwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0c3Bhbi50ZXh0KGxpbmUuam9pbignICcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IFt3b3JkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4gPSB0ZXh0LmFwcGVuZCgndHNwYW4nKS5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMikuYXR0cigneScsIHkpLmF0dHIoJ2R5JywgKytsaW5lTnVtYmVyICogbGluZUhlaWdodCArIGR5ICsgJ2VtJykudGV4dCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChfLmtleXMoZGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICQoJy5ncmlkLWNoYXJ0JykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJG9uKCdyZWRyYXdHcmlkJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICBnZXREYXRhVmFsdWVzKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzR3JpZENoYXJ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0dyaWRDaGFydENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy9ncmlkL2dyaWRDaGFydFRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIGljb25zOiAnPScsIC8vIGluZGljYXRlcyB3aGV0aGVyIGNlbGwtdGV4dCBpcyBlbnRpcmVseSBtYWRlIHVwIG9mIGljb25zXG4gICAgICAgICAgICAgICAgc2NhbGU6ICc9JywgLy8gbXVsdGlwbGllciB0byBpbmNyZWFzZSBjZWxsIHNpemVcbiAgICAgICAgICAgICAgICByZXZlYWw6ICc9JywgLy8gaWYgdHJ1ZSwgbGVzcyBkYXRhIHdpbGwgc2hvdyB3aGVuIHpvb21lZCBvdXRcbiAgICAgICAgICAgICAgICBtb2RlOiAnQCcsIC8vIHZhbGlkIHZhbHVlcyBhcmUgem9vbSBvciB0b29sdGlwXG4gICAgICAgICAgICAgICAgY29sdW1uczogJz0nLFxuICAgICAgICAgICAgICAgIHJvd3M6ICc9JyxcbiAgICAgICAgICAgICAgICBzaG93QXhlczogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNIZWFsdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBzY2FsZSA9ICRzY29wZS5zY2FsZSB8fCAxO1xuICAgICAgICAgICAgdm0uZG9udXRTaXplID0gMjc1ICogc2NhbGU7XG4gICAgICAgICAgICB2bS5kb251dFdpZHRoID0gMjUgKiBzY2FsZTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNIZWFsdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSGVhbHRoQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2hlYWx0aC9oZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG5hbWU6ICc9JyxcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgc2NhbGU6ICc9JyxcbiAgICAgICAgICAgICAgICBlcnJvckxhYmVsOiAnPScsXG4gICAgICAgICAgICAgICAgdHlwZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNKb2JMb2FkQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIGxvYWRTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjaGFydCA9IG51bGwsXG4gICAgICAgICAgICBjb2xBcnIgPSBbXSxcbiAgICAgICAgICAgIHhBcnIgPSBbXTtcblxuICAgICAgICB2bS5maWx0ZXJWYWx1ZSA9IDE7XG4gICAgICAgIHZtLmZpbHRlckR1cmF0aW9uID0gJ3cnO1xuICAgICAgICB2bS5maWx0ZXJEdXJhdGlvbnMgPSBbJ00nLCAndycsICdkJ107XG4gICAgICAgIHZtLnpvb21FbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHZtLnpvb21DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLnpvb21UZXh0ID0gJ0VuYWJsZSBab29tJztcbiAgICAgICAgdm0uam9iTG9hZERhdGEgPSB7fTtcbiAgICAgICAgdm0ubG9hZGluZ0pvYkxvYWQgPSB0cnVlO1xuICAgICAgICB2bS5qb2JMb2FkRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5qb2JMb2FkRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS50b3RhbCA9IDA7XG4gICAgICAgIHZtLmNoYXJ0U3R5bGUgPSAnJztcblxuICAgICAgICB2YXIgam9iTG9hZFBhcmFtcyA9IHtcbiAgICAgICAgICAgIHN0YXJ0ZWQ6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCh2bS5maWx0ZXJWYWx1ZSwgdm0uZmlsdGVyRHVyYXRpb24pLnN0YXJ0T2YoJ2QnKS50b0RhdGUoKSwgZW5kZWQ6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvRGF0ZSgpLCBqb2JfdHlwZV9pZDogbnVsbCwgam9iX3R5cGVfbmFtZTogbnVsbCwgam9iX3R5cGVfY2F0ZWdvcnk6IG51bGwsIHVybDogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnRvZ2dsZVpvb20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS56b29tRW5hYmxlZCA9ICF2bS56b29tRW5hYmxlZDtcbiAgICAgICAgICAgIGNoYXJ0Lnpvb20uZW5hYmxlKHZtLnpvb21FbmFibGVkKTtcbiAgICAgICAgICAgIGlmICh2bS56b29tRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHZtLnpvb21DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICAgICAgICAgdm0uem9vbVRleHQgPSAnRGlzYWJsZSBab29tJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0uem9vbUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgICAgICB2bS56b29tVGV4dCA9ICdFbmFibGUgWm9vbSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRDaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHhBcnIgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgeEFyciA9IF8ucGx1Y2sodm0uam9iTG9hZERhdGEucmVzdWx0cywgJ3RpbWUnKTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgICAgIHhBcnJbaV0gPSBtb21lbnQudXRjKGQpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB4QXJyLnVuc2hpZnQoJ3gnKTtcblxuICAgICAgICAgICAgdmFyIHBlbmRpbmdBcnIgPSBfLnBsdWNrKHZtLmpvYkxvYWREYXRhLnJlc3VsdHMsICdwZW5kaW5nX2NvdW50JyksXG4gICAgICAgICAgICAgICAgcXVldWVkQXJyID0gXy5wbHVjayh2bS5qb2JMb2FkRGF0YS5yZXN1bHRzLCAncXVldWVkX2NvdW50JyksXG4gICAgICAgICAgICAgICAgcnVubmluZ0FyciA9IF8ucGx1Y2sodm0uam9iTG9hZERhdGEucmVzdWx0cywgJ3J1bm5pbmdfY291bnQnKTtcblxuICAgICAgICAgICAgcGVuZGluZ0Fyci51bnNoaWZ0KCdQZW5kaW5nJyk7XG4gICAgICAgICAgICBxdWV1ZWRBcnIudW5zaGlmdCgnUXVldWVkJyk7XG4gICAgICAgICAgICBydW5uaW5nQXJyLnVuc2hpZnQoJ1J1bm5pbmcnKTtcblxuICAgICAgICAgICAgLy8gYWRkIHRvIGNvbEFyclxuICAgICAgICAgICAgY29sQXJyID0gW3hBcnIsIHBlbmRpbmdBcnIsIHF1ZXVlZEFyciwgcnVubmluZ0Fycl07XG5cbiAgICAgICAgICAgIHZhciB0eXBlcyA9IHt9LFxuICAgICAgICAgICAgICAgIHR5cGUgPSB7fSxcbiAgICAgICAgICAgICAgICBncm91cHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKGNvbEFyciwgZnVuY3Rpb24oY29sKXtcbiAgICAgICAgICAgICAgICB0eXBlID0ge307XG4gICAgICAgICAgICAgICAgaWYgKGNvbFswXSAhPT0gJ3gnKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVbY29sWzBdXSA9ICdhcmVhJztcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodHlwZXMsIHR5cGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChjaGFydCkge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmZsdXNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjaGFydCBjb25maWdcbiAgICAgICAgICAgIGNoYXJ0ID0gYzMuZ2VuZXJhdGUoe1xuICAgICAgICAgICAgICAgIGJpbmR0bzogJyNqb2ItbG9hZCcsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB4OiAneCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbEFycixcbiAgICAgICAgICAgICAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICAgICAgICAgICAgICBncm91cHM6IFtncm91cHNdLFxuICAgICAgICAgICAgICAgICAgICBjb2xvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFBlbmRpbmc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9waW5rLFxuICAgICAgICAgICAgICAgICAgICAgICAgUXVldWVkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcHVycGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgUnVubmluZzogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2JsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogNzAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMoeCkuc3RhcnRPZignaCcpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYXhpczoge1xuICAgICAgICAgICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGltZXNlcmllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWNrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JMb2FkID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYkxvYWQgPSBmdW5jdGlvbiAoc2hvd1BhZ2VMb2FkKSB7XG4gICAgICAgICAgICBpZiAoc2hvd1BhZ2VMb2FkKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JMb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpvYkxvYWRQYXJhbXMuc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCh2bS5maWx0ZXJWYWx1ZSwgdm0uZmlsdGVyRHVyYXRpb24pLnN0YXJ0T2YoJ2QnKS50b0RhdGUoKTtcbiAgICAgICAgICAgIGpvYkxvYWRQYXJhbXMuZW5kZWQgPSBtb21lbnQudXRjKGpvYkxvYWRQYXJhbXMuc3RhcnRlZCkuYWRkKDEsIHZtLmZpbHRlckR1cmF0aW9uKS5lbmRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgam9iTG9hZFBhcmFtcy5wYWdlX3NpemUgPSAxMDAwO1xuXG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRKb2JMb2FkKGpvYkxvYWRQYXJhbXMpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkxvYWREYXRhID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBpbml0Q2hhcnQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c1RleHQgJiYgcmVzdWx0LnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JMb2FkRXJyb3JTdGF0dXMgPSByZXN1bHQuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5qb2JMb2FkRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIGpvYiBsb2FkLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JMb2FkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iTG9hZFJhbmdlID0gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ29sZGVyJykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclZhbHVlKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ25ld2VyJykge1xuICAgICAgICAgICAgICAgIGlmICh2bS5maWx0ZXJWYWx1ZSA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUtLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3RvZGF5Jykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclZhbHVlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldEpvYkxvYWQodHJ1ZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uZmlsdGVyVmFsdWUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHZhciAkam9iTG9hZE5ld2VyID0gJCgnLmpvYi1sb2FkLW5ld2VyJyksXG4gICAgICAgICAgICAgICAgJGpvYkxvYWRUb2RheSA9ICQoJy5qb2ItbG9hZC10b2RheScpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWROZXdlci5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRqb2JMb2FkVG9kYXkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWROZXdlci5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRqb2JMb2FkVG9kYXkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICBpZiAoJHNjb3BlLmF1dG9IZWlnaHQpIHtcbiAgICAgICAgICAgIC8vIHNldCBjaGFydCBoZWlnaHRcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyT2Zmc2V0ID0gJCgnLmpvYi1sb2FkLWhlYWRlcicpLmhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWdlbmRPZmZzZXQgPSAkKCcuam9iLWxvYWQtbGVnZW5kLWxhYmVsJykuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlck9mZnNldCA9ICQoJy5qb2ItbG9hZC1maWx0ZXInKS5vdXRlckhlaWdodCh0cnVlKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhcnRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQgLSBoZWFkZXJPZmZzZXQgLSBsZWdlbmRPZmZzZXQgLSBmaWx0ZXJPZmZzZXQgLSA1O1xuXG4gICAgICAgICAgICAgICAgdm0uY2hhcnRTdHlsZSA9ICdoZWlnaHQ6ICcgKyBjaGFydE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNoYXJ0TWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgICAgICAgICAgZ2V0Sm9iTG9hZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnZXRKb2JMb2FkKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzSm9iTG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNKb2JMb2FkQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2pvYkxvYWQvam9iTG9hZFRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgc2hvd0ZpbHRlcjogJz0nLCAvLyBzaG93IHRpbWUgcmFuZ2UgZmlsdGVyIFVJXG4gICAgICAgICAgICAgICAgY3VsbExlZ2VuZDogJz0nLCAvLyBvbmx5IHNob3cgam9iIHR5cGVzIGluIGxlZ2VuZCB3aG9zZSB2YWx1ZSBpcyA+IDBcbiAgICAgICAgICAgICAgICBoaWRlVGl0bGU6ICc9JyxcbiAgICAgICAgICAgICAgICBhdXRvSGVpZ2h0OiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc1JhZGlhbFBlcmNlbnRhZ2VDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgdmFyIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICAgICAgZm9yZWdyb3VuZCA9ICcnLFxuICAgICAgICB0ZXh0ID0gJycsXG4gICAgICAgIGFyY1R3ZWVuID0gJycsXG4gICAgICAgIHRleHRUd2VlbiA9ICcnO1xuXG4gICAgdmFyIGdldEZvcmVncm91bmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlRmxvYXQoJHNjb3BlLnBlcmNlbnRhZ2UpO1xuICAgICAgICBpZiAodmFsdWUgPj0gNzUpIHtcbiAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JlZW47XG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCA3NSAmJiB2YWx1ZSA+PSA1MCkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3c7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gaGFuZGxlIGlucHV0IGVpdGhlciAuODMgb3IgODNcbiAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSAkc2NvcGUucGVyY2VudGFnZSB8fCAwO1xuICAgICAgICBpZiAocGVyY2VudGFnZSA+IDEpIHtcbiAgICAgICAgICAgIHBlcmNlbnRhZ2UgLz0gMTAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2l6ZSB0aGUgY2hhcnQgdG8gdGhlIHBhcmVudCBjb250YWluZXIuIEl0J3Mgc3F1YXJlLCBzbyB0YWtlIHRoZVxuICAgICAgICAvLyBzbWFsbGVyIG9mIHdpZHRoL2hlaWdodFxuICAgICAgICB2YXIgc2l6ZSA9ICRlbGVtZW50WzBdLnBhcmVudE5vZGUuY2xpZW50V2lkdGg7XG4gICAgICAgIGlmICgkZWxlbWVudFswXS5wYXJlbnROb2RlLmNsaWVudEhlaWdodCA8IHNpemUpIHtcbiAgICAgICAgICAgIHNpemUgPSAkZWxlbWVudFswXS5wYXJlbnROb2RlLmNsaWVudEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdmFyIGZvcm1hdFBlcmNlbnQgPSBkMy5mb3JtYXQoJy4wJScpO1xuXG4gICAgICAgIHZhciBhcmMgPSBkMy5zdmcuYXJjKClcbiAgICAgICAgICAgIC5zdGFydEFuZ2xlKDApXG4gICAgICAgICAgICAub3V0ZXJSYWRpdXMoc2l6ZSAqIDAuOTUgLyAyKVxuICAgICAgICAgICAgLmlubmVyUmFkaXVzKHNpemUgKiAwLjgwIC8gMik7XG5cbiAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdCgkZWxlbWVudFswXSkuYXBwZW5kKCdzdmcnKS5hdHRyKHtcbiAgICAgICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBzaXplXG4gICAgICAgIH0pLmFwcGVuZCgnZycpLmF0dHIoe1xuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGUoJyArIHNpemUgLyAyICsgJywnICsgc2l6ZSAvIDIgKyAnKScsXG4gICAgICAgICAgICAnY2xhc3MnOiAnYWlzUmFkaWFsJ1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgbWV0ZXIgPSBzdmcuYXBwZW5kKCdnJykuYXR0cih7XG4gICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgxODApJ1xuICAgICAgICB9KTtcbiAgICAgICAgbWV0ZXIuYXBwZW5kKCdwYXRoJylcbiAgICAgICAgICAgIC5kYXR1bSh7XG4gICAgICAgICAgICAgICAgZW5kQW5nbGU6ICgyICogTWF0aC5QSSksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKVxuICAgICAgICAgICAgLmF0dHIoJ2QnLCBhcmMpO1xuXG4gICAgICAgIGZvcmVncm91bmQgPSBtZXRlci5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgICAgLmRhdHVtKHtcbiAgICAgICAgICAgICAgICBlbmRBbmdsZTogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICAgICAnZCc6IGFyY1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Rm9yZWdyb3VuZCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGV4dCA9IHN2Zy5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgLmRhdHVtKHtcbiAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAuYXR0cignZHknLCAnLjM1ZW0nKTtcblxuXG4gICAgICAgIHRleHRUd2VlbiA9IGZ1bmN0aW9uICh0cmFuc2l0aW9uLCBuZXdQZXJjZW50YWdlKSB7XG4gICAgICAgICAgICB0cmFuc2l0aW9uLmF0dHJUd2VlbigndGV4dCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBkID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBkMy5pbnRlcnBvbGF0ZShkLnBlcmNlbnRhZ2UsIG5ld1BlcmNlbnRhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICBkLnBlcmNlbnRhZ2UgPSBpKHQpO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LnRleHQoZm9ybWF0UGVyY2VudChpKHQpKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBhcmNUd2VlbiA9IGZ1bmN0aW9uICh0cmFuc2l0aW9uLCBuZXdBbmdsZSkge1xuICAgICAgICAgICAgdHJhbnNpdGlvbi5hdHRyVHdlZW4oJ2QnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBpID0gZDMuaW50ZXJwb2xhdGUoZC5lbmRBbmdsZSwgbmV3QW5nbGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICBkLmVuZEFuZ2xlID0gaSh0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyYyhkKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaXNJbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgICAgcmVkcmF3KHBlcmNlbnRhZ2UpO1xuICAgIH07XG5cbiAgICB2YXIgcmVkcmF3ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmIChpc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB2YXIgcGVyY2VudGFnZSA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHBlcmNlbnRhZ2UgPiAxKSB7XG4gICAgICAgICAgICAgICAgcGVyY2VudGFnZSAvPSAxMDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvcmVncm91bmQudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Rm9yZWdyb3VuZCgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwoYXJjVHdlZW4sIChNYXRoLlBJICogMikgKiBwZXJjZW50YWdlKTtcbiAgICAgICAgICAgIHRleHQudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMDApLmNhbGwodGV4dFR3ZWVuLCBwZXJjZW50YWdlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuJHdhdGNoKCdwZXJjZW50YWdlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiAhaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVkcmF3KHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0pXG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNSYWRpYWxQZXJjZW50YWdlJywgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRyb2xsZXI6ICdhaXNSYWRpYWxQZXJjZW50YWdlQ29udHJvbGxlcicsXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBwZXJjZW50YWdlOiAnQCdcbiAgICAgICAgfVxuICAgIH07XG59KTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzVGltZWxpbmVEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBnYW50dCA9IG51bGwsXG4gICAgICAgICAgICB0YXNrTmFtZXMgPSBbXTtcblxuICAgICAgICAkZWxlbWVudFswXS5vbnJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlbGVtZW50IHJlc2l6ZScpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndGFza3MnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBkcmF3VGltZWxpbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkcmF3VGltZWxpbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnRhc2tzICYmICRzY29wZS50YXNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbJHNjb3BlLmVuZGVkXSAtIGJbJHNjb3BlLmVuZGVkXTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRhc2tOYW1lcyA9IF8oJHNjb3BlLnRhc2tzKS5wbHVjaygndGFza05hbWUnKS51bmlxKCkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGFza05hbWVzLmxlbmd0aCAqIDMwICsgMjA7XG5cbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSAkZWxlbWVudFswXS5jbGllbnRXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoIXdpZHRoIHx8IHdpZHRoID09PSAwKSB7IHdpZHRoID0gNjAwOyB9XG5cblxuICAgICAgICAgICAgICAgICRzY29wZS50YXNrcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhWyRzY29wZS5zdGFydGVkXSAtIGJbJHNjb3BlLnN0YXJ0ZWRdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBtaW5EYXRlID0gJHNjb3BlLnRhc2tzWzBdWyRzY29wZS5zdGFydGVkXTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4RGF0ZSA9ICRzY29wZS50YXNrc1skc2NvcGUudGFza3MubGVuZ3RoIC0gMV1bJHNjb3BlLmVuZGVkXTtcbiAgICAgICAgICAgICAgICB2YXIgZGF5c0RpZmYgPSBtb21lbnQudXRjKG1heERhdGUpLmRpZmYobW9tZW50LnV0YyhtaW5EYXRlKSwnZGF5cycpO1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSAnJUg6JU06JVMuJW0nO1xuICAgICAgICAgICAgICAgIGlmIChkYXlzRGlmZiA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gXCIlbS8lZC8leSAlSDolTVwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGdhbnR0ID0gZDMuZ2FudHQoKS5yZW5kZXJUbyhcIiNhaXMtdGltZWxpbmVcIikudGFza1R5cGVzKHRhc2tOYW1lcykudGFza1N0YXR1cyhzY2FsZUNvbmZpZy50YXNrU3RhdHVzU3R5bGVzKS50aWNrRm9ybWF0KGZvcm1hdCkuYmVnaW4oJHNjb3BlLnN0YXJ0ZWQpLmVuZGVkKCRzY29wZS5lbmRlZCkuaGVpZ2h0KGhlaWdodCkud2lkdGgod2lkdGgpO1xuXG4gICAgICAgICAgICAgICAgZ2FudHQudGltZURvbWFpbk1vZGUoXCJmaXRcIik7XG5cbiAgICAgICAgICAgICAgICBnYW50dCgkc2NvcGUudGFza3MpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGRhdGUpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdhaXNUaW1lbGluZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNUaW1lbGluZURpcmVjdGl2ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZVRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdGFza3M6ICc9JyxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiAnPScsXG4gICAgICAgICAgICAgICAgZW5kZWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0dyaWRQYWdpbmF0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NvbW1vbi9kaXJlY3RpdmVzL2Fpc0dyaWRQYWdpbmF0aW9uVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnXG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNNdWx0aXNlbGVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBtdWx0aXNlbGVjdERhdGFQcm92aWRlcjogJz0nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogJz0nLFxuICAgICAgICAgICAgICAgIG1heEhlaWdodDogJz0nLFxuICAgICAgICAgICAgICAgIG51bWJlckRpc3BsYXllZDogJz0nLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVTZWxlY3RBbGxPcHRpb246ICc9JyxcbiAgICAgICAgICAgICAgICBub25TZWxlY3RlZFRleHQ6ICc9JyxcbiAgICAgICAgICAgICAgICBuZ01vZGVsOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnRbMF0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCh7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogc2NvcGUuZW5hYmxlRmlsdGVyaW5nLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVDYXNlSW5zZW5zaXRpdmVGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogc2NvcGUubWF4SGVpZ2h0IHx8IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyRGlzcGxheWVkOiBzY29wZS5udW1iZXJEaXNwbGF5ZWQgfHwgMyxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVNlbGVjdEFsbE9wdGlvbjogc2NvcGUuaW5jbHVkZVNlbGVjdEFsbE9wdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbm9uU2VsZWN0ZWRUZXh0OiBzY29wZS5ub25TZWxlY3RlZFRleHQgfHwgJ05vbmUgU2VsZWN0ZWQnLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKG9wdGlvbkVsZW1lbnQsIGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmdNb2RlbCA9IGVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoQ29sbGVjdGlvbignbXVsdGlzZWxlY3REYXRhUHJvdmlkZXInLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgnZGF0YXByb3ZpZGVyJywgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZXMgdG8gdGhlIGxlbmd0aCBvZiBvdXIgc2VsZWN0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudFswXTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vZWxlbWVudC5tdWx0aXNlbGVjdCgnc2V0T3B0aW9ucycsIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAvL2VsZW1lbnQubXVsdGlzZWxlY3QoJ3JlYnVpbGQnKTtcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIFdhdGNoIGZvciBhbnkgY2hhbmdlcyBmcm9tIG91dHNpZGUgdGhlIGRpcmVjdGl2ZSBhbmQgcmVmcmVzaFxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRyaWJ1dGVzLm5nTW9kZWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgncmVmcmVzaCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ2dhdWdlRmFjdG9yeScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgR2F1Z2UgPSBmdW5jdGlvbiAocGxhY2Vob2xkZXJOYW1lLCBjb25maWd1cmF0aW9uKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyTmFtZSA9IHBsYWNlaG9sZGVyTmFtZTtcblxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOyAvLyBmb3IgaW50ZXJuYWwgZDMgZnVuY3Rpb25zXG5cbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlID0gZnVuY3Rpb24oY29uZmlndXJhdGlvbilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ3VyYXRpb247XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5zaXplID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnJhZGl1cyA9IHRoaXMuY29uZmlnLnNpemUgKiAwLjk3IC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jeCA9IHRoaXMuY29uZmlnLnNpemUgLyAyO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmN5ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5taW4gPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5taW4gPyBjb25maWd1cmF0aW9uLm1pbiA6IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWF4ID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWF4ID8gY29uZmlndXJhdGlvbi5tYXggOiAxMDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcucmFuZ2UgPSB0aGlzLmNvbmZpZy5tYXggLSB0aGlzLmNvbmZpZy5taW47XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5tYWpvclRpY2tzID0gY29uZmlndXJhdGlvbi5tYWpvclRpY2tzIHx8IDU7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWlub3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWlub3JUaWNrcyB8fCAyO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuZ3JlZW5Db2xvciBcdD0gY29uZmlndXJhdGlvbi5ncmVlbkNvbG9yIHx8ICcjOGZjYTBlJztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy55ZWxsb3dDb2xvciA9IGNvbmZpZ3VyYXRpb24ueWVsbG93Q29sb3IgfHwgJyNmZmMzMTcnO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnJlZENvbG9yIFx0PSBjb25maWd1cmF0aW9uLnJlZENvbG9yIHx8ICcjZjU0ZDM2JztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5ncmF5Q29sb3IgICA9IGNvbmZpZ3VyYXRpb24uZ3JheUNvbG9yIHx8ICcjYWFhJztcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbkR1cmF0aW9uIHx8IDUwMDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9keSA9IGQzLnNlbGVjdCgnIycgKyB0aGlzLnBsYWNlaG9sZGVyTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnc3ZnOnN2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdnYXVnZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHRoaXMuY29uZmlnLnNpemUpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCB0aGlzLmNvbmZpZy5zaXplKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpjaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnb3V0ZXItY2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeScsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigncicsIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyNjY2MnKTtcbiAgICAgICAgICAgICAgICAvKi5zdHlsZSgnc3Ryb2tlJywgJyMwMDAnKVxuICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwLjVweCcpOyovXG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6Y2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeScsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigncicsIDAuOSAqIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyNmZmYnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjZTBlMGUwJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMnB4Jyk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBncmVlbklkeCBpbiB0aGlzLmNvbmZpZy5ncmVlblpvbmVzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS50bywgc2VsZi5jb25maWcuZ3JlZW5Db2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeWVsbG93SWR4IGluIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLmZyb20sIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzW3llbGxvd0lkeF0udG8sIHNlbGYuY29uZmlnLnllbGxvd0NvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciByZWRJZHggaW4gdGhpcy5jb25maWcucmVkWm9uZXMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLnJlZFpvbmVzW3JlZElkeF0uZnJvbSwgdGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS50bywgc2VsZi5jb25maWcucmVkQ29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAodW5kZWZpbmVkICE9IHRoaXMuY29uZmlnLmxhYmVsKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyA5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOnRleHQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgdGhpcy5jb25maWcuY3kgLyAyICsgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGV4dCh0aGlzLmNvbmZpZy5sYWJlbClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZm9udFNpemUgKyAncHgnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMzMzMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMHB4Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxNik7XG4gICAgICAgICAgICAgICAgdmFyIG1ham9yRGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvICh0aGlzLmNvbmZpZy5tYWpvclRpY2tzIC0gMSk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbWFqb3IgPSB0aGlzLmNvbmZpZy5taW47IG1ham9yIDw9IHRoaXMuY29uZmlnLm1heDsgbWFqb3IgKz0gbWFqb3JEZWx0YSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5vckRlbHRhID0gbWFqb3JEZWx0YSAvIHRoaXMuY29uZmlnLm1pbm9yVGlja3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDEgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbWlub3IgPSBtYWpvciArIG1pbm9yRGVsdGE7IG1pbm9yIDwgTWF0aC5taW4obWFqb3IgKyBtYWpvckRlbHRhLCB0aGlzLmNvbmZpZy5tYXgpOyBtaW5vciArPSBtaW5vckRlbHRhKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC43NSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC44NSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpsaW5lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDEnLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDInLCBwb2ludDIueClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTInLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjNjY2JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcxcHgnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHBvaW50MSA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjcpO1xuICAgICAgICAgICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC44NSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmxpbmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gxJywgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIHBvaW50Mi54KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjMzMzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzJweCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gfHwgbWFqb3IgPT0gdGhpcy5jb25maWcubWF4KVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC42Myk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2Zzp0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneCcsIHBvaW50LngpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBwb2ludC55KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIGZvbnRTaXplIC8gMylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCBtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gPyAnc3RhcnQnIDogJ2VuZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQobWFqb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBmb250U2l6ZSArICdweCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMzMzMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzBweCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6ZycpLmF0dHIoJ2NsYXNzJywgJ3BvaW50ZXJDb250YWluZXInKTtcblxuICAgICAgICAgICAgICAgIHZhciBtaWRWYWx1ZSA9ICh0aGlzLmNvbmZpZy5taW4gKyB0aGlzLmNvbmZpZy5tYXgpIC8gMjtcblxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyUGF0aCA9IHRoaXMuYnVpbGRQb2ludGVyUGF0aChtaWRWYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlckxpbmUgPSBkMy5zdmcubGluZSgpXG4gICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueCB9KVxuICAgICAgICAgICAgICAgICAgICAueShmdW5jdGlvbihkKSB7IHJldHVybiBkLnkgfSlcbiAgICAgICAgICAgICAgICAgICAgLmludGVycG9sYXRlKCdiYXNpcycpO1xuXG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3BhdGgnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YShbcG9pbnRlclBhdGhdKVxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdzdmc6cGF0aCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkJywgcG9pbnRlckxpbmUpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjODg4Jyk7XG5cbiAgICAgICAgICAgICAgICBwb2ludGVyQ29udGFpbmVyLmFwcGVuZCgnc3ZnOmNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3knLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3InLCAwLjA3ICogdGhpcy5jb25maWcucmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzg4OCcpO1xuXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxMCk7XG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3RleHQnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YShbbWlkVmFsdWVdKVxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdzdmc6dGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgdGhpcy5jb25maWcuc2l6ZSAtIHRoaXMuY29uZmlnLmN5IC8gNCAtIGZvbnRTaXplKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignZHknLCBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGZvbnRTaXplICsgJ3B4JylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMwMDAnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwcHgnKTtcblxuICAgICAgICAgICAgICAgIHRoaXMucmVkcmF3KHRoaXMuY29uZmlnLm1pbiwgMCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLmJ1aWxkUG9pbnRlclBhdGggPSBmdW5jdGlvbih2YWx1ZSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvIDEzO1xuXG4gICAgICAgICAgICAgICAgdmFyIGhlYWQgPSB2YWx1ZVRvUG9pbnQodmFsdWUsIDAuODUpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkMSA9IHZhbHVlVG9Qb2ludCh2YWx1ZSAtIGRlbHRhLCAwLjEyKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVhZDIgPSB2YWx1ZVRvUG9pbnQodmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFpbFZhbHVlID0gdmFsdWUgLSAodGhpcy5jb25maWcucmFuZ2UgKiAoMS8oMjcwLzM2MCkpIC8gMik7XG4gICAgICAgICAgICAgICAgdmFyIHRhaWwgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlLCAwLjI4KTtcbiAgICAgICAgICAgICAgICB2YXIgdGFpbDEgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlIC0gZGVsdGEsIDAuMTIpO1xuICAgICAgICAgICAgICAgIHZhciB0YWlsMiA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gW2hlYWQsIGhlYWQxLCB0YWlsMiwgdGFpbCwgdGFpbDEsIGhlYWQyLCBoZWFkXTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHZhbHVlVG9Qb2ludCh2YWx1ZSwgZmFjdG9yKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ID0gc2VsZi52YWx1ZVRvUG9pbnQodmFsdWUsIGZhY3Rvcik7XG4gICAgICAgICAgICAgICAgICAgIHBvaW50LnggLT0gc2VsZi5jb25maWcuY3g7XG4gICAgICAgICAgICAgICAgICAgIHBvaW50LnkgLT0gc2VsZi5jb25maWcuY3k7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLmRyYXdCYW5kID0gZnVuY3Rpb24oc3RhcnQsIGVuZCwgY29sb3IpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKDAgPj0gZW5kIC0gc3RhcnQpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpwYXRoJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgY29sb3IpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkJywgZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3RhcnRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKHN0YXJ0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lbmRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKGVuZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuaW5uZXJSYWRpdXMoMC42NSAqIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vdXRlclJhZGl1cygwLjg1ICogdGhpcy5jb25maWcucmFkaXVzKSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKCkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgc2VsZi5jb25maWcuY3ggKyAnLCAnICsgc2VsZi5jb25maWcuY3kgKyAnKSByb3RhdGUoMjcwKScgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnJlZHJhdyA9IGZ1bmN0aW9uKHZhbHVlLCB0cmFuc2l0aW9uRHVyYXRpb24pXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyQ29udGFpbmVyID0gdGhpcy5ib2R5LnNlbGVjdCgnLnBvaW50ZXJDb250YWluZXInKTtcblxuICAgICAgICAgICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKCd0ZXh0JykudGV4dChwYXJzZUZsb2F0KHZhbHVlKS50b0ZpeGVkKDIpICsgJyUnKTtcblxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyID0gcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3BhdGgnKTtcbiAgICAgICAgICAgICAgICBwb2ludGVyLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAuZHVyYXRpb24odW5kZWZpbmVkICE9IHRyYW5zaXRpb25EdXJhdGlvbiA/IHRyYW5zaXRpb25EdXJhdGlvbiA6IHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbilcbiAgICAgICAgICAgICAgICAgICAgLy8uZGVsYXkoMClcbiAgICAgICAgICAgICAgICAgICAgLy8uZWFzZSgnbGluZWFyJylcbiAgICAgICAgICAgICAgICAgICAgLy8uYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHJUd2VlbigndHJhbnNmb3JtJywgZnVuY3Rpb24oKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRlclZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBzZWxmLmNvbmZpZy5tYXgpIHBvaW50ZXJWYWx1ZSA9IHNlbGYuY29uZmlnLm1heCArIDAuMDIqc2VsZi5jb25maWcucmFuZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA8IHNlbGYuY29uZmlnLm1pbikgcG9pbnRlclZhbHVlID0gc2VsZi5jb25maWcubWluIC0gMC4wMipzZWxmLmNvbmZpZy5yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRSb3RhdGlvbiA9IChzZWxmLnZhbHVlVG9EZWdyZWVzKHBvaW50ZXJWYWx1ZSkgLSA5MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFJvdGF0aW9uID0gc2VsZi5fY3VycmVudFJvdGF0aW9uIHx8IHRhcmdldFJvdGF0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fY3VycmVudFJvdGF0aW9uID0gdGFyZ2V0Um90YXRpb247XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzdGVwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3RhdGlvbiA9IGN1cnJlbnRSb3RhdGlvbiArICh0YXJnZXRSb3RhdGlvbi1jdXJyZW50Um90YXRpb24pKnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIHNlbGYuY29uZmlnLmN4ICsgJywgJyArIHNlbGYuY29uZmlnLmN5ICsgJykgcm90YXRlKCcgKyByb3RhdGlvbiArICcpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgb3V0ZXJDaXJjbGUgPSB0aGlzLmJvZHkuc2VsZWN0KCcub3V0ZXItY2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAuZHVyYXRpb24oNzUwKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID49IDAgJiYgaSA8IDc1ICYmICFpc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLmdyZWVuQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPj0gNzUgJiYgaSA8IDkwICYmICFpc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLnllbGxvd0NvbG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09PSAwICYmIGlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcucmVkQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5yZWRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlVG9EZWdyZWVzID0gZnVuY3Rpb24odmFsdWUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgLy8gdGhhbmtzIEBjbG9zZWFsZXJ0XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gdmFsdWUgLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCAtIDQ1O1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gKHRoaXMuY29uZmlnLm1pbiAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwICsgNDUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy52YWx1ZVRvUmFkaWFucyA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlVG9EZWdyZWVzKHZhbHVlKSAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlVG9Qb2ludCA9IGZ1bmN0aW9uKHZhbHVlLCBmYWN0b3IpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgXHR4OiB0aGlzLmNvbmZpZy5jeCAtIHRoaXMuY29uZmlnLnJhZGl1cyAqIGZhY3RvciAqIE1hdGguY29zKHRoaXMudmFsdWVUb1JhZGlhbnModmFsdWUpKSxcbiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5jb25maWcuY3kgLSB0aGlzLmNvbmZpZy5yYWRpdXMgKiBmYWN0b3IgKiBNYXRoLnNpbih0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSkgXHRcdH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvblxuICAgICAgICAgICAgdGhpcy5jb25maWd1cmUoY29uZmlndXJhdGlvbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNyZWF0ZUdhdWdlOiBmdW5jdGlvbiAobmFtZSwgbGFiZWwsIG1pbiwgbWF4LCBzaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSB8fCBzY2FsZUNvbmZpZy5kZWZhdWx0R2F1Z2VXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICAgICAgICAgICAgICBtaW46IG1pbiB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXg6IG1heCB8fCAxMDAsXG4gICAgICAgICAgICAgICAgICAgIG1pbm9yVGlja3M6IDVcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gY29uZmlnLm1heCAtIGNvbmZpZy5taW47XG4gICAgICAgICAgICAgICAgY29uZmlnLnllbGxvd1pvbmVzID0gW3sgZnJvbTogY29uZmlnLm1pbiArIHJhbmdlKjAuNzUsIHRvOiBjb25maWcubWluICsgcmFuZ2UqMC45IH1dO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5yZWRab25lcyA9IFt7IGZyb206IGNvbmZpZy5taW4gKyByYW5nZSowLjksIHRvOiBjb25maWcubWF4IH1dO1xuXG4gICAgICAgICAgICAgICAgdmFyIGdhdWdlID0gbmV3IEdhdWdlKG5hbWUgKyAnR2F1Z2VDb250YWluZXInLCBjb25maWcpO1xuICAgICAgICAgICAgICAgIGdhdWdlLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBnYXVnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ2dyaWRGYWN0b3J5JywgZnVuY3Rpb24gKHVpR3JpZENvbnN0YW50cykge1xuXG4gICAgICAgIHZhciBnZXRTb3J0Q29uZmlnID0gZnVuY3Rpb24gKG9yZGVyUGFyYW0pIHtcbiAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG5cbiAgICAgICAgICAgIGlmIChvcmRlclBhcmFtKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9yZGVyUGFyYW0sIGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc29ydEZpZWxkID0gcGFyYW07XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3J0RGlyZWN0aW9uID0gJ2FzYyc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLnN0YXJ0c1dpdGgocGFyYW0sICctJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnREaXJlY3Rpb24gPSAnZGVzYyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogc29ydERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBzb3J0RmllbGRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHNvcnRBcnI7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRlZmF1bHRHcmlkT3B0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVJvd1NlbGVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUm93SGVhZGVyU2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlSG9yaXpvbnRhbFNjcm9sbGJhcjogdWlHcmlkQ29uc3RhbnRzLnNjcm9sbGJhcnMuTkVWRVIsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVZlcnRpY2FsU2Nyb2xsYmFyOiB1aUdyaWRDb25zdGFudHMuc2Nyb2xsYmFycy5ORVZFUixcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlTZWxlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZUV4dGVybmFsU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdXNlRXh0ZXJuYWxGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1pblJvd3NUb1Nob3c6IDE3LFxuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uUGFnZVNpemVzOiBbMjUsIDUwLCA3NSwgMTAwXSxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvblBhZ2VTaXplOiAyNSxcbiAgICAgICAgICAgICAgICAgICAgdXNlRXh0ZXJuYWxQYWdpbmF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVQYWdpbmF0aW9uQ29udHJvbHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ3VycmVudFBhZ2U6IDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXBwbHlTb3J0Q29uZmlnOiBmdW5jdGlvbiAoY29sdW1uRGVmcywgZ3JpZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBzb3J0Q29uZmlnID0gZ2V0U29ydENvbmZpZyhncmlkUGFyYW1zLm9yZGVyKTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbmZpZywgZnVuY3Rpb24gKGNvbmZpZywgaWR4KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IF8uc3RhcnRzV2l0aChjb25maWcuZmllbGQsICctJykgPyBjb25maWcuZmllbGQuc3Vic3RyaW5nKDEpIDogY29uZmlnLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sRGVmID0gXy5maW5kKGNvbHVtbkRlZnMsIHtmaWVsZDogZmllbGR9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sRGVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xEZWYuc29ydCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGNvbmZpZy5kaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IGlkeFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW5EZWZzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdwb2xsZXJGYWN0b3J5JywgZnVuY3Rpb24gKHBvbGxlcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmV3UG9sbGVyOiBmdW5jdGlvbiAocmVzb3VyY2UsIGludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvbGxlci5nZXQocmVzb3VyY2UsIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IGludGVydmFsLFxuICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXMnLCBmdW5jdGlvbiAoU3RhdHVzTWFzdGVyLCBTdGF0dXNTY2hlZHVsZXIsIFN0YXR1c1Jlc291cmNlcykge1xuICAgICAgICB2YXIgU3RhdHVzID0gZnVuY3Rpb24gKCRyZXNvbHZlZCwgbWFzdGVyLCBzY2hlZHVsZXIsIHF1ZXVlX2RlcHRoLCByZXNvdXJjZXMpIHtcbiAgICAgICAgICAgIHRoaXMuJHJlc29sdmVkID0gJHJlc29sdmVkO1xuICAgICAgICAgICAgdGhpcy5tYXN0ZXIgPSBTdGF0dXNNYXN0ZXIudHJhbnNmb3JtZXIobWFzdGVyKTtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyID0gU3RhdHVzU2NoZWR1bGVyLnRyYW5zZm9ybWVyKHNjaGVkdWxlcik7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlX2RlcHRoID0gcXVldWVfZGVwdGg7XG4gICAgICAgICAgICB0aGlzLnJlc291cmNlcyA9IFN0YXR1c1Jlc291cmNlcy50cmFuc2Zvcm1lcihyZXNvdXJjZXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRDcHVVc2FnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQuY3B1cyAmJiB0aGlzLnJlc291cmNlcy50b3RhbC5jcHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy50b3RhbC5jcHVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmNwdXMgLyB0aGlzLnJlc291cmNlcy50b3RhbC5jcHVzKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gMC4wMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRNZW1Vc2FnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQubWVtICYmIHRoaXMucmVzb3VyY2VzLnRvdGFsLm1lbSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMudG90YWwubWVtID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSAvIHRoaXMucmVzb3VyY2VzLnRvdGFsLm1lbSkgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDAuMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RGlza1VzYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5kaXNrICYmIHRoaXMucmVzb3VyY2VzLnRvdGFsLmRpc2spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnRvdGFsLmRpc2sgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQuZGlzayAvIHRoaXMucmVzb3VyY2VzLnRvdGFsLmRpc2spICogMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwLjAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS4kcmVzb2x2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWFzdGVyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNjaGVkdWxlcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZV9kZXB0aCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXNvdXJjZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNNYXN0ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTdGF0dXNNYXN0ZXIgPSBmdW5jdGlvbiAoaXNfb25saW5lLCBob3N0bmFtZSwgcG9ydCkge1xuICAgICAgICAgICAgdGhpcy5pc19vbmxpbmUgPSBpc19vbmxpbmU7XG4gICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gaG9zdG5hbWU7XG4gICAgICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN0YXR1c01hc3Rlci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzTWFzdGVyLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNNYXN0ZXIoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb25saW5lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmhvc3RuYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvcnRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNNYXN0ZXIoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXNNYXN0ZXIudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzTWFzdGVyLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c01hc3Rlci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzTWFzdGVyO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0YXR1c1Jlc291cmNlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RhdHVzUmVzb3VyY2UgPSBmdW5jdGlvbiAoY3B1cywgbWVtLCBkaXNrKSB7XG4gICAgICAgICAgICB0aGlzLmNwdXMgPSBjcHVzO1xuICAgICAgICAgICAgdGhpcy5tZW0gPSBtZW07XG4gICAgICAgICAgICB0aGlzLmRpc2sgPSBkaXNrO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN0YXR1c1Jlc291cmNlLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzUmVzb3VyY2UoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3B1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzUmVzb3VyY2UuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzUmVzb3VyY2UuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1c1Jlc291cmNlO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0YXR1c1Jlc291cmNlcycsIGZ1bmN0aW9uIChTdGF0dXNSZXNvdXJjZSkge1xuICAgICAgICB2YXIgU3RhdHVzUmVzb3VyY2VzID0gZnVuY3Rpb24gKHRvdGFsLCBzY2hlZHVsZWQsIHVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWwgPSBTdGF0dXNSZXNvdXJjZS50cmFuc2Zvcm1lcih0b3RhbCk7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlZCA9IFN0YXR1c1Jlc291cmNlLnRyYW5zZm9ybWVyKHNjaGVkdWxlZCk7XG4gICAgICAgICAgICB0aGlzLnVzZWQgPSBTdGF0dXNSZXNvdXJjZS50cmFuc2Zvcm1lcih1c2VkKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZXMucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c1Jlc291cmNlcy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzUmVzb3VyY2VzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRvdGFsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzUmVzb3VyY2VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzUmVzb3VyY2VzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c1Jlc291cmNlcy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1c1Jlc291cmNlcztcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNTY2hlZHVsZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTdGF0dXNTY2hlZHVsZXIgPSBmdW5jdGlvbiAoaXNfb25saW5lLCBpc19wYXVzZWQsIGhvc3RuYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmlzX29ubGluZSA9IGlzX29ubGluZTtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkID0gaXNfcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3RuYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN0YXR1c1NjaGVkdWxlci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzU2NoZWR1bGVyLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNTY2hlZHVsZXIoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb25saW5lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX3BhdXNlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1NjaGVkdWxlcigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c1NjaGVkdWxlci50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXNTY2hlZHVsZXIuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzU2NoZWR1bGVyLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNTY2hlZHVsZXI7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc2NhbGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkaHR0cCwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgZnVuY3Rpb24gcGFkV2l0aFplcm8gKGlucHV0LCBsZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIENhc3QgaW5wdXQgdG8gc3RyaW5nXG4gICAgICAgICAgICBpbnB1dCA9ICcnICsgaW5wdXQ7XG5cbiAgICAgICAgICAgIHZhciBwYWRkaW5nU2l6ZSA9IE1hdGgubWF4KDAsIGxlbmd0aCAtIGlucHV0Lmxlbmd0aCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5KHBhZGRpbmdTaXplID4gMCA/IHBhZGRpbmdTaXplICsgMSA6IDApLmpvaW4oJzAnKSArIGlucHV0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYjogZnVuY3Rpb24obnVtKXtcbiAgICAgICAgICAgICAgICBpZiAobnVtID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVtIDwgMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bS50b0ZpeGVkKDIpICsgJyBNQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA+PSAxMDI0ICYmIG51bSA8IDEwMjQqMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNCkudG9GaXhlZCgyKSArICcgR0InO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNCkudG9GaXhlZCgyKSArICcgVEInO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzOiBmdW5jdGlvbihudW0sZGVjaW1hbHMpe1xuICAgICAgICAgICAgICAgIGlmIChudW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPCAxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBCeXRlcyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA+PSAxMDI0ICYmIG51bSA8IDEwMjQqMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNCkudG9GaXhlZChkZWNpbWFscykgKyAnIEtCJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobnVtID49IDEwMjQqMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQqMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNC8xMDI0KS50b0ZpeGVkKGRlY2ltYWxzKSArICcgTUInO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCoxMDI0KjEwMjQgJiYgbnVtIDwgMTAyNCoxMDI0KjEwMjQqMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNC8xMDI0LzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBHQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNC8xMDI0LzEwMjQvMTAyNCkudG9GaXhlZChkZWNpbWFscykgKyAnIFRCJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRWaWV3cG9ydFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdyA9IHdpbmRvdyxcbiAgICAgICAgICAgICAgICAgICAgZCA9IGRvY3VtZW50LFxuICAgICAgICAgICAgICAgICAgICBlID0gZC5kb2N1bWVudEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGcgPSBkb2N1bWVudC5ib2R5LFxuICAgICAgICAgICAgICAgICAgICB4ID0gdy5pbm5lcldpZHRoIHx8IGUuY2xpZW50V2lkdGggfHwgZy5jbGllbnRXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgeSA9IHcuaW5uZXJIZWlnaHQgfHwgZS5jbGllbnRIZWlnaHQgfHwgZy5jbGllbnRIZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogeCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB5XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxjdWxhdGVEdXJhdGlvbjogZnVuY3Rpb24gKHN0YXJ0LCBzdG9wKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRvID0gbW9tZW50LnV0YyhzdG9wKSxcbiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IG1vbWVudC51dGMoc3RhcnQpLFxuICAgICAgICAgICAgICAgICAgICBkaWZmID0gbW9tZW50LnV0Yyh0bykuZGlmZihtb21lbnQudXRjKGZyb20pKSxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSAnJztcblxuICAgICAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IG1vbWVudC5kdXJhdGlvbihkaWZmKTtcblxuICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24uZGF5cygpID4gMCA/IGR1cmF0aW9uU3RyICsgcGFkV2l0aFplcm8oZHVyYXRpb24uZGF5cygpLCAyKSArICdkLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvbi5ob3VycygpID4gMCA/IGR1cmF0aW9uU3RyICsgcGFkV2l0aFplcm8oZHVyYXRpb24uaG91cnMoKSwgMikgKyAnaCwgJyA6IGR1cmF0aW9uU3RyO1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24ubWludXRlcygpID4gMCA/IGR1cmF0aW9uU3RyICsgcGFkV2l0aFplcm8oZHVyYXRpb24ubWludXRlcygpLCAyKSArICdtLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLnNlY29uZHMoKSwgMikgKyAncyc7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGR1cmF0aW9uU3RyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERheVN0cmluZzogZnVuY3Rpb24oZGF5TnVtYmVyKXtcbiAgICAgICAgICAgICAgICB2YXIgZGF5QXJyID0gWydTdW5kYXknLCdNb25kYXknLCdUdWVzZGF5JywnV2VkbmVzZGF5JywnVGh1cnNkYXknLCdGcmlkYXknLCdTYXR1cmRheSddO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXlBcnJbZGF5TnVtYmVyXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0lFOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgICAgICAgICAgIG9sZElFID0gdWEuaW5kZXhPZignTVNJRScpLFxuICAgICAgICAgICAgICAgICAgICBuZXdJRSA9IHVhLmluZGV4T2YoJ1RyaWRlbnQvJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoKG9sZElFID4gLTEpIHx8IChuZXdJRSA+IC0xKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE1lZGlhVHlwZUh0bWw6IGZ1bmN0aW9uKG1lZGlhVHlwZSl7XG4gICAgICAgICAgICAgICAgdmFyIGljb25IdG1sID0gJzxpIGNsYXNzPVwiZmEgJyArICdmYS1maWxlJyArICdcIj48L2k+JztcbiAgICAgICAgICAgICAgICBpZihtZWRpYVR5cGUpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWMgPSBfLmZpbmQoc2NhbGVDb25maWcubWVkaWFUeXBlcywge21pbWVUeXBlOiBtZWRpYVR5cGV9KVxuICAgICAgICAgICAgICAgICAgICBpZihpYyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uSHRtbCA9ICc8aSBjbGFzcz1cImZhICcgKyBpYy5pY29uICsgJ1wiPjwvaT4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpY29uSHRtbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRWZXJzaW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3YnICsgc2NhbGVDb25maWcubWFqb3JWZXJzaW9uICsgJy92ZXJzaW9uLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRHcmlkSGVpZ2h0OiBmdW5jdGlvbiAob2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCB8fCBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQ7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gdGhpcy5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICAgICAgZ3JpZE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgICAgIHJldHVybiAnaGVpZ2h0OiAnICsgZ3JpZE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG92ZXJmbG93LXk6IGF1dG87JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc2NoZWR1bGVyU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBnZXRVcGRhdGVTY2hlZHVsZXJEYXRhID0gZnVuY3Rpb24gKGlzX3BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpc19wYXVzZWQ6IGlzX3BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlU2NoZWR1bGVyOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIHx8IGdldFVwZGF0ZVNjaGVkdWxlckRhdGEoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdzY2hlZHVsZXInKSArICdzY2hlZHVsZXIvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzdGF0ZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2ZXJzaW9uID0gJycsXG4gICAgICAgICAgICBqb2JzQ29sRGVmcyA9IFtdLFxuICAgICAgICAgICAgam9ic1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgam9iRXhlY3V0aW9uc1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgcmVjaXBlc0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zID0ge30sXG4gICAgICAgICAgICByZWNpcGVzUGFyYW1zID0ge30sXG4gICAgICAgICAgICBpbmdlc3RzQ29sRGVmcyA9IFtdLFxuICAgICAgICAgICAgaW5nZXN0c1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgbm9kZXNDb2xEZWZzID0gW10sXG4gICAgICAgICAgICBub2RlU3RhdHVzUGFyYW1zID0ge30sXG4gICAgICAgICAgICBzaG93QWN0aXZlV29ya3NwYWNlcyA9IHRydWUsXG4gICAgICAgICAgICBub2Rlc1BhcmFtcyA9IHt9O1xuXG4gICAgICAgIHZhciB1cGRhdGVRdWVyeXN0cmluZyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvLyBzZXQgZGVmYXVsdHNcbiAgICAgICAgICAgIGRhdGEucGFnZSA9IGRhdGEucGFnZSB8fCAxO1xuICAgICAgICAgICAgZGF0YS5wYWdlX3NpemUgPSBkYXRhLnBhZ2Vfc2l6ZSB8fCAyNTtcbiAgICAgICAgICAgIGRhdGEuc3RhcnRlZCA9IGRhdGEuc3RhcnRlZCB8fCBudWxsO1xuICAgICAgICAgICAgZGF0YS5lbmRlZCA9IGRhdGEuZW5kZWQgfHwgbnVsbDtcbiAgICAgICAgICAgIGRhdGEub3JkZXIgPSBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBudWxsO1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCBudWxsO1xuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHBhcmFtcyBpbiBxdWVyeXN0cmluZywgYW5kIHVwZGF0ZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKGRhdGEpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHBhcmFtWzBdLCBwYXJhbVsxXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGVycm9yX2NhdGVnb3J5OiBkYXRhLmVycm9yX2NhdGVnb3J5ID8gZGF0YS5lcnJvcl9jYXRlZ29yeSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGRhdGEuam9iX3R5cGVfaWQgPyBwYXJzZUludChkYXRhLmpvYl90eXBlX2lkKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogZGF0YS5qb2JfdHlwZV9uYW1lID8gZGF0YS5qb2JfdHlwZV9uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogZGF0YS5qb2JfdHlwZV9jYXRlZ29yeSA/IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVybDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBkYXRhLmpvYl90eXBlX2lkID8gcGFyc2VJbnQoZGF0YS5qb2JfdHlwZV9pZCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX25hbWU6IGRhdGEuam9iX3R5cGVfbmFtZSA/IGRhdGEuam9iX3R5cGVfbmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcnk6IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgPyBkYXRhLmpvYl90eXBlX2NhdGVnb3J5IDogbnVsbCxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBkYXRhLm5vZGVfaWQgPyBkYXRhLm5vZGVfaWQgOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSA/IGRhdGEubmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6IG51bGwsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRSZWNpcGVzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IGRhdGEuc3RhcnRlZCA/IGRhdGEuc3RhcnRlZCA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnd2Vla3MnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogZGF0YS5lbmRlZCA/IGRhdGEuZW5kZWQgOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBbJy1sYXN0X21vZGlmaWVkJ10sXG4gICAgICAgICAgICAgICAgdHlwZV9pZDogZGF0YS50eXBlX2lkID8gcGFyc2VJbnQoZGF0YS50eXBlX2lkKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgdHlwZV9uYW1lOiBkYXRhLnR5cGVfbmFtZSA/IGRhdGEudHlwZV9uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICB1cmw6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRJbmdlc3RzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IGRhdGEuc3RhcnRlZCA/IGRhdGEuc3RhcnRlZCA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnd2Vla3MnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogZGF0YS5lbmRlZCA/IGRhdGEuZW5kZWQgOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBbJy1pbmdlc3Rfc3RhcnRlZCddLFxuICAgICAgICAgICAgICAgIHN0YXR1czogZGF0YS5zdGF0dXMgPyBkYXRhLnN0YXR1cyA6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBkYXRhLmZpbGVfbmFtZSA/IGRhdGEuZmlsZV9uYW1lIDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdE5vZGVzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBbJ2hvc3RuYW1lJ10sXG4gICAgICAgICAgICAgICAgaW5jbHVkZV9pbmFjdGl2ZTogZGF0YS5pbmNsdWRlX2luYWN0aXZlID8gZGF0YS5pbmNsdWRlX2luYWN0aXZlIDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdE5vZGVTdGF0dXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDMsICdob3VycycpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGRhdGEuZW5kZWQgPyBkYXRhLmVuZGVkIDogbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFZlcnNpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmVyc2lvbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRWZXJzaW9uOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYnNDb2xEZWZzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYnNDb2xEZWZzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEpvYnNDb2xEZWZzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGpvYnNDb2xEZWZzID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhqb2JzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRKb2JzUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEpvYnNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9ic1BhcmFtcyA9IGluaXRKb2JzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKGpvYnNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYkV4ZWN1dGlvbnNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKGpvYkV4ZWN1dGlvbnNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdEpvYkV4ZWN1dGlvbnNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYkV4ZWN1dGlvbnNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Sm9iRXhlY3V0aW9uc1BhcmFtczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25zUGFyYW1zID0gaW5pdEpvYkV4ZWN1dGlvbnNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcoam9iRXhlY3V0aW9uc1BhcmFtcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMgPSBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKF8ucGFpcnMoam9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwYXJhbVswXSwgcGFyYW1bMV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlY2lwZXNDb2xEZWZzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY2lwZXNDb2xEZWZzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFJlY2lwZXNDb2xEZWZzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlY2lwZXNDb2xEZWZzID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZWNpcGVzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhyZWNpcGVzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRSZWNpcGVzUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZWNpcGVzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFJlY2lwZXNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmVjaXBlc1BhcmFtcyA9IGluaXRSZWNpcGVzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKHJlY2lwZXNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEluZ2VzdHNDb2xEZWZzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZ2VzdHNDb2xEZWZzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEluZ2VzdHNDb2xEZWZzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGluZ2VzdHNDb2xEZWZzID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbmdlc3RzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhpbmdlc3RzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRJbmdlc3RzUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpbmdlc3RzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEluZ2VzdHNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaW5nZXN0c1BhcmFtcyA9IGluaXRJbmdlc3RzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKGluZ2VzdHNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBub2Rlc0NvbERlZnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Tm9kZXNDb2xEZWZzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG5vZGVzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1c1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMobm9kZVN0YXR1c1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Tm9kZVN0YXR1c1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZVN0YXR1c1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXROb2RlU3RhdHVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG5vZGVTdGF0dXNQYXJhbXMgPSBpbml0Tm9kZVN0YXR1c1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhub2RlU3RhdHVzUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTaG93QWN0aXZlV29ya3NwYWNlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzaG93QWN0aXZlV29ya3NwYWNlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRTaG93QWN0aXZlV29ya3NwYWNlczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBzaG93QWN0aXZlV29ya3NwYWNlcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZXNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKG5vZGVzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXROb2Rlc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Tm9kZXNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbm9kZXNQYXJhbXMgPSBpbml0Tm9kZXNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcobm9kZXNQYXJhbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc3RhdHVzU2VydmljZScsIGZ1bmN0aW9uICgkcmVzb3VyY2UsIHNjYWxlQ29uZmlnLCBwb2xsZXIsIHBvbGxlckZhY3RvcnksIFN0YXR1cykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0U3RhdHVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c1Jlc291cmNlID0gJHJlc291cmNlKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnc3RhdHVzJykgKyAnc3RhdHVzLycpLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihzdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5zdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gU3RhdHVzLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCd1c2VyU2VydmljZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFVzZXJDcmVkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjcmVkcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyQ3JlZHMnKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShjcmVkcyk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcGFyc2luZyB1c2VyIGNyZWRlbnRpYWxzJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVkcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0VXNlckNyZWRzOiBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICAgICAgICAgIGlmICh1c2VyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyQ3JlZHMnLCBKU09OLnN0cmluZ2lmeSh1c2VyKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJDcmVkcycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbiAodXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBpc19hZG1pbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRVc2VyQ3JlZHModXNlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRVc2VyQ3JlZHMobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2ZlZWREZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGZlZWRTZXJ2aWNlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5mZWVkRGF0YSA9IHt9O1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmZlZWQ7XG4gICAgICAgIHZtLnVzZUluZ2VzdFRpbWUgPSAnZmFsc2UnO1xuICAgICAgICB2bS5maWx0ZXJWYWx1ZSA9IDE7XG4gICAgICAgIHZtLmZpbHRlckR1cmF0aW9uID0gJ3cnO1xuXG4gICAgICAgIHZtLmNoYW5nZUZlZWRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgIC8vZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNoYW5nZUluZ2VzdFRpbWVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgIGdldEZlZWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RmVlZFBhcmFtcyA9IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgdmFyIHN0cmlrZUlkID0gdm0uc2VsZWN0ZWRGZWVkID8gdm0uc2VsZWN0ZWRGZWVkLnN0cmlrZS5pZCA6IG51bGw7XG4gICAgICAgICAgICB2YXIgdXNlSW5nZXN0VGltZSA9IHZtLnVzZUluZ2VzdFRpbWUgPyB2bS51c2VJbmdlc3RUaW1lIDogbnVsbDtcblxuICAgICAgICAgICAgcGFyYW1zLnN0YXJ0ZWQgPSBtb21lbnQudXRjKCkuc3VidHJhY3Qodm0uZmlsdGVyVmFsdWUsIHZtLmZpbHRlckR1cmF0aW9uKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIHBhcmFtcy5lbmRlZCA9IG1vbWVudC51dGMocGFyYW1zLnN0YXJ0ZWQpLmFkZCgxLCB2bS5maWx0ZXJEdXJhdGlvbikuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpO1xuXG4gICAgICAgICAgICBpZiAoc3RyaWtlSWQgIT0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5zdHJpa2VfaWQgPSBzdHJpa2VJZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5zdHJpa2VfaWQgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXNlSW5nZXN0VGltZSAhPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKSB7XG4gICAgICAgICAgICAgICBwYXJhbXMudXNlX2luZ2VzdF90aW1lID0gdXNlSW5nZXN0VGltZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZSkge1xuICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldEZlZWRQYXJhbXMgdXNlX2luZ2VzdF90aW1lOiAnICsgJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZSk7XG4gICAgICAgICAgICAgICBwYXJhbXMudXNlX2luZ2VzdF90aW1lID0gJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RmVlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWUpIHtcbiAgICAgICAgICAgICAgICB2bS51c2VJbmdlc3RUaW1lID0gJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmZWVkUGFyYW1zID0gZ2V0RmVlZFBhcmFtcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChmZWVkUGFyYW1zKTtcbiAgICAgICAgICAgIGZlZWRTZXJ2aWNlLmdldEZlZWQoZmVlZFBhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmFsbEZlZWRzID0gXy5zb3J0QnlPcmRlcihkYXRhLnJlc3VsdHMsIFsnc3RyaWtlLm5hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmlrZUlkID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZDtcbiAgICAgICAgICAgICAgICBpZihzdHJpa2VJZCl7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBzZWxlY3RlZEZlZWQgPSBuZXcgZmVlZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZmVlZCA9IF8uZmluZCh2bS5hbGxGZWVkcywgZnVuY3Rpb24gKGZlZWQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZlZWQuc3RyaWtlLmlkID09IHN0cmlrZUlkO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRGZWVkID0gZmVlZCA/IGZlZWQgOiBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRmVlZCA9IHZtLmFsbEZlZWRzWzBdO1xuICAgICAgICAgICAgICAgICAgICBzZXRGZWVkVXJsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVGZWVkUmFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnb2xkZXInKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUrKztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnbmV3ZXInKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmZpbHRlclZhbHVlID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZS0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9kYXknKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXRGZWVkVXJsID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAvLyBzZXQgcGFyYW0gaW4gVVJMXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0RmVlZFBhcmFtcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZCcpO1xuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5maWx0ZXJWYWx1ZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyICRmZWVkTmV3ZXIgPSAkKCcuZmVlZC1uZXdlcicpLFxuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkgPSAkKCcuZmVlZC10b2RheScpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGZlZWRTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcbiAgICAgICAgdm0uc2NhbGVTZXJ2aWNlID0gc2NhbGVTZXJ2aWNlO1xuICAgICAgICB2bS5tb21lbnQgPSBtb21lbnQ7XG4gICAgICAgIHZtLmluZ2VzdFJlY29yZCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdldEluZ2VzdFJlY29yZERldGFpbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGZlZWRTZXJ2aWNlLmdldFNvdXJjZURldGFpbHMoJHJvdXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0UmVjb3JkID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZC9pbmdlc3RzJyk7XG4gICAgICAgICAgICBnZXRJbmdlc3RSZWNvcmREZXRhaWxzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2FsY3VsYXRlRmlsZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignaW5nZXN0UmVjb3Jkc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICR0aW1lb3V0LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIGZlZWRTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBncmlkRmFjdG9yeSkge1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdmZWVkL2luZ2VzdHMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmluZ2VzdHNQYXJhbXMgPSBzdGF0ZVNlcnZpY2UuZ2V0SW5nZXN0c1BhcmFtcygpO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcbiAgICAgICAgdm0uaW5nZXN0U3RhdHVzVmFsdWVzID0gc2NhbGVDb25maWcuaW5nZXN0U3RhdHVzO1xuICAgICAgICB2bS5zZWxlY3RlZEluZ2VzdFN0YXR1cyA9IHZtLmluZ2VzdHNQYXJhbXMuc3RhdHVzIHx8IHZtLmluZ2VzdFN0YXR1c1ZhbHVlc1swXTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnQgPSBtb21lbnQudXRjKHZtLmluZ2VzdHNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wID0gbW9tZW50LnV0Yyh2bS5pbmdlc3RzUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmluZ2VzdERhdGEgPSBbXTtcbiAgICAgICAgdm0uc2VhcmNoVGV4dCA9IHZtLmluZ2VzdHNQYXJhbXMuZmlsZV9uYW1lIHx8ICcnO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG5cbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uaW5nZXN0c1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSB2bS5pbmdlc3RzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLnJlZnJlc2hEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IF8uZmlsdGVyKHZtLmluZ2VzdERhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZmlsZV9uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModm0uc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IGZpbHRlcmVkRGF0YS5sZW5ndGggPiAwID8gZmlsdGVyZWREYXRhIDogdm0uZ3JpZE9wdGlvbnMuZGF0YTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeVN0YXR1cyA9IHZtLmluZ2VzdHNQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gdm0uaW5nZXN0c1BhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5jb2xEZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZmlsZV9uYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0ZpbGUgTmFtZScsXG4gICAgICAgICAgICAgICAgLy9maWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48aW5wdXQgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlYXJjaFRleHRcIiBuZy1jaGFuZ2U9XCJncmlkLmFwcFNjb3BlLnZtLnJlZnJlc2hEYXRhKClcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoXCI+PC9kaXY+J1xuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdmaWxlX3NpemUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRmlsZSBTaXplJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmZpbGVfc2l6ZV9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RyaWtlLmlkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1N0cmlrZSBQcm9jZXNzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnN0cmlrZS5pZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRJbmdlc3RTdGF0dXNcIiBuZy1vcHRpb25zPVwic3RhdHVzLnRvVXBwZXJDYXNlKCkgZm9yIHN0YXR1cyBpbiBncmlkLmFwcFNjb3BlLnZtLmluZ2VzdFN0YXR1c1ZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0cmFuc2Zlcl9zdGFydGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX3N0YXJ0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3RyYW5zZmVyX2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX2VuZGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpbmdlc3Rfc3RhcnRlZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5pbmdlc3Rfc3RhcnRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5nZXN0X2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmluZ2VzdF9lbmRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0SW5nZXN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0SW5nZXN0c09uY2Uodm0uaW5nZXN0c1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdERhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNQYXJhbXModm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5nZXRJbmdlc3RzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSW5nZXN0T3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUluZ2VzdFN0YXR1cyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZtLmluZ2VzdHNQYXJhbXMuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuc3RhdHVzID0gdmFsdWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWU7XG4gICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIGlmKHJvdy5lbnRpdHkuc291cmNlX2ZpbGUgJiYgcm93LmVudGl0eS5zb3VyY2VfZmlsZS5pZCl7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goe30pO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2ZlZWQvaW5nZXN0cy8nICsgcm93LmVudGl0eS5zb3VyY2VfZmlsZS5pZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiaW5mb1wiXSgnU291cmNlIGZpbGUgaXMgdW5kZWZpbmVkIGZvciAnICsgcm93LmVudGl0eS5maWxlX25hbWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0T3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNQYXJhbXModm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2bS5nZXRJbmdlc3RzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdmZWVkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSW5nZXN0U3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUluZ2VzdFN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5U3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlYXJjaFRleHQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKXtcbiAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuZmlsZV9uYW1lID0gdmFsdWU7XG4gICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRJbmdlc3RzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0SW5nZXN0c1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3N0cmlrZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgU3RyaWtlLCBTdHJpa2VJbmdlc3RGaWxlLCBzY2FsZUNvbmZpZywgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgc3RyaWtlU2VydmljZSwgd29ya3NwYWNlc1NlcnZpY2UsIHNjYWxlU2VydmljZSwgc3RhdGVTZXJ2aWNlLCB1c2VyU2VydmljZSwgdG9hc3RyKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjdXJyU3RyaWtlID0ge307XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLnN0cmlrZXMgPSBbXTtcbiAgICAgICAgdm0ud29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5uZXdXb3Jrc3BhY2VzID0gW107XG4gICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IHt9O1xuICAgICAgICB2bS5sb2NhbFN0cmlrZXMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlU3RyaWtlID0gbmV3IFN0cmlrZSgpO1xuICAgICAgICB2bS5hY3RpdmVTdHJpa2VJbmdlc3RGaWxlID0gbmV3IFN0cmlrZUluZ2VzdEZpbGUoKTtcbiAgICAgICAgdm0uZGF0YVR5cGUgPSAnJztcbiAgICAgICAgdm0uYXZhaWxhYmxlV29ya3NwYWNlVHlwZXMgPSBfLmNsb25lRGVlcChzY2FsZUNvbmZpZy53b3Jrc3BhY2VUeXBlcyk7XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHZtLnVzZXIgJiYgdm0udXNlci5pc19hZG1pbik7XG4gICAgICAgIHZtLkpTT04gPSBKU09OO1xuXG4gICAgICAgIHZtLmNhbmNlbENyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAvLyByZXZlcnQgYW55IGNoYW5nZXMgdG8gdGhlIHN0cmlrZVxuICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlID0gU3RyaWtlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKGN1cnJTdHJpa2UpKTtcbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQgPT09ICcwJykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZmVlZC9zdHJpa2VzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZWRpdFN0cmlrZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHN0b3JlIGEgcmVmZXJlbmNlIG9mIHRoZSBzdHJpa2UgYXMgaXQgY3VycmVudGx5IGV4aXN0cyBpbiBjYXNlIHRoZSB1c2VyIGNhbmNlbHMgdGhlIGVkaXRcbiAgICAgICAgICAgIGN1cnJTdHJpa2UgPSBTdHJpa2UudHJhbnNmb3JtZXIoXy5jbG9uZURlZXAodm0uYWN0aXZlU3RyaWtlKSk7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2VkaXQnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNhdmVTdHJpa2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdHJpa2VTZXJ2aWNlLnNhdmVTdHJpa2Uodm0uYWN0aXZlU3RyaWtlKS50aGVuKGZ1bmN0aW9uIChzdHJpa2UpIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2UgPSBTdHJpa2UudHJhbnNmb3JtZXIoc3RyaWtlKTtcbiAgICAgICAgICAgICAgICBpZiAoc2NhbGVDb25maWcuc3RhdGljKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdHJpa2UnICsgdm0uYWN0aXZlU3RyaWtlLmlkLCBKU09OLnN0cmluZ2lmeSh2bS5hY3RpdmVTdHJpa2UpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHJvdXRlLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jbGVhckxvY2FsU3RyaWtlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5sb2NhbFN0cmlrZXMsIGZ1bmN0aW9uIChzdHJpa2UpIHtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnc3RyaWtlJyArIHN0cmlrZS5pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZmVlZC9zdHJpa2VzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ubmV3U3RyaWtlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubW9kZSA9ICdhZGQnO1xuICAgICAgICAgICAgdm0ubG9hZFN0cmlrZSgwKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5sb2FkU3RyaWtlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZmVlZC9zdHJpa2VzLycgKyBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFdhcm5pbmdzSHRtbCA9IGZ1bmN0aW9uICh3YXJuaW5ncykge1xuICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9ICcnO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHdhcm5pbmdzLCBmdW5jdGlvbiAod2FybmluZykge1xuICAgICAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGI+JyArIHdhcm5pbmcuaWQgKyAnOjwvYj4gJyArIHdhcm5pbmcuZGV0YWlscyArICc8YnIgLz48YnIgLz4nO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBjbGVhclwiPkhpZGU8L2J1dHRvbj4nO1xuICAgICAgICAgICAgcmV0dXJuIHdhcm5pbmdzSHRtbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS52YWxpZGF0ZVN0cmlrZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgc3RyaWtlU2VydmljZS52YWxpZGF0ZVN0cmlrZSh2bS5hY3RpdmVTdHJpa2UpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS53YXJuaW5ncyAmJiBkYXRhLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSB0aGUgd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9IGdldFdhcm5pbmdzSHRtbChkYXRhLndhcm5pbmdzKTtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydzdWNjZXNzJ10oJ1N0cmlrZSBpcyB2YWxpZC4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnRXJyb3IgdmFsaWRhdGluZyBzdHJpa2UnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5kaXNhYmxlU2F2ZUJ0biA9IGZ1bmN0aW9uIChpbnZhbGlkKSB7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsID0gISghaW52YWxpZCAmJiB2bS5hY3RpdmVTdHJpa2UuY29uZmlndXJhdGlvbi5maWxlc190b19pbmdlc3QubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSByZXR1cm5WYWwgPyAnYnRuLWRlZmF1bHQnIDogJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkU3RyaWtlSW5nZXN0RmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChfLmtleXModm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZS5jb25maWd1cmF0aW9uLmZpbGVzX3RvX2luZ2VzdC5wdXNoKFN0cmlrZUluZ2VzdEZpbGUudHJhbnNmb3JtZXIodm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZSkpO1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZUluZ2VzdEZpbGUgPSBuZXcgU3RyaWtlSW5nZXN0RmlsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVN0cmlrZUluZ2VzdEZpbGUgPSBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgXy5yZW1vdmUodm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24uZmlsZXNfdG9faW5nZXN0LCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmVxdWFscyhmLCBmaWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERhdGFUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLmRhdGFUeXBlKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZS5kYXRhX3R5cGVzLnB1c2godm0uZGF0YVR5cGUpO1xuICAgICAgICAgICAgICAgIHZtLmRhdGFUeXBlID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVtb3ZlRGF0YVR5cGUgPSBmdW5jdGlvbiAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIF8ucmVtb3ZlKHZtLmFjdGl2ZVN0cmlrZUluZ2VzdEZpbGUuZGF0YV90eXBlcywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZCA9PT0gZGF0YVR5cGU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyaWtlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdvcmtzcGFjZU9iaiA9IF8uZmluZCh2bS53b3Jrc3BhY2VzLCB7bmFtZTogdm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24ud29ya3NwYWNlfSk7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmtzcGFjZU9iaikge1xuICAgICAgICAgICAgICAgICAgICB2bS5uZXdXb3Jrc3BhY2VzID0gXy5jbG9uZURlZXAodm0ud29ya3NwYWNlcyk7XG4gICAgICAgICAgICAgICAgICAgIF8ucmVtb3ZlKHZtLm5ld1dvcmtzcGFjZXMsIHdvcmtzcGFjZU9iaik7XG4gICAgICAgICAgICAgICAgICAgIGdldFdvcmtzcGFjZURldGFpbHMod29ya3NwYWNlT2JqLmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFdvcmtzcGFjZURldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UuZ2V0V29ya3NwYWNlRGV0YWlscyhpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVdvcmtzcGFjZS5qc29uX2NvbmZpZy5icm9rZXIudHlwZSA9PT0gJ2hvc3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZS5jb25maWd1cmF0aW9uLm1vbml0b3IudHlwZSA9ICdkaXItd2F0Y2hlcic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5hY3RpdmVXb3Jrc3BhY2UuanNvbl9jb25maWcuYnJva2VyLnR5cGUgPT09ICdzMycpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24ubW9uaXRvci50eXBlID0gJ3MzJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2UuY29uZmlndXJhdGlvbi5tb25pdG9yLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXb3Jrc3BhY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UuZ2V0V29ya3NwYWNlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS53b3Jrc3BhY2VzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS5uZXdXb3Jrc3BhY2VzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVXb3Jrc3BhY2UoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRTdHJpa2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBzdHJpa2VTZXJ2aWNlLmdldFN0cmlrZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc0tleTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IHNLZXkgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9Kc29uW3NLZXldID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oc0tleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXy5maWx0ZXIoXy5wYWlycyhvSnNvbiksIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5jb250YWlucyhvWzBdLCAnc3RyaWtlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IEpTT04ucGFyc2Uob1sxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9jYWxTdHJpa2VzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0uc3RyaWtlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgZ2V0V29ya3NwYWNlcygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0U3RyaWtlcygpO1xuICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlID0gbnVsbDtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG5cbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZSA9IG5ldyBTdHJpa2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzdHJpa2VTZXJ2aWNlLmdldFN0cmlrZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZSA9IFN0cmlrZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZC9zdHJpa2VzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gc2NhbGVTZXJ2aWNlLmdldFZpZXdwb3J0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCxcbiAgICAgICAgICAgICAgICBjb250YWluZXJNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQgKyA2MDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0ZlZWQnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEZlZWQgPSBmdW5jdGlvbiAodmFsdWUsIHN0YXR1cykge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgRmVlZC5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnRmVlZCc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEZlZWQuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZlZWQoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEZlZWQudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoRmVlZC5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBGZWVkLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBGZWVkO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnRmVlZFN0YXR1cycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgRmVlZFN0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXMpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEZlZWRTdGF0dXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0ZlZWRTdGF0dXMnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxGaWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5VG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgRmVlZFN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZFN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGZWVkU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRmVlZFN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChGZWVkU3RhdHVzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEZlZWRTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEZlZWRTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdJbmdlc3QnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSW5nZXN0ID0gZnVuY3Rpb24gKGlkLCBmaWxlX25hbWUsIHN0cmlrZSwgc3RhdHVzLCBieXRlc190cmFuc2ZlcnJlZCwgdHJhbnNmZXJfc3RhcnRlZCwgdHJhbnNmZXJfZW5kZWQsIG1lZGlhX3R5cGUsIGZpbGVfc2l6ZSwgZGF0YV90eXBlLCBpbmdlc3Rfc3RhcnRlZCwgaW5nZXN0X2VuZGVkLCBzb3VyY2VfZmlsZSwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5maWxlX25hbWUgPSBmaWxlX25hbWU7XG4gICAgICAgICAgICB0aGlzLnN0cmlrZSA9IHN0cmlrZTtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5ieXRlc190cmFuc2ZlcnJlZCA9IGJ5dGVzX3RyYW5zZmVycmVkO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zlcl9zdGFydGVkID0gdHJhbnNmZXJfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfc3RhcnRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHRyYW5zZmVyX3N0YXJ0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfZW5kZWQgPSB0cmFuc2Zlcl9lbmRlZDtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfZW5kZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0Yyh0cmFuc2Zlcl9lbmRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlID0gbWVkaWFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9zaXplID0gZmlsZV9zaXplO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemVfZm9ybWF0dGVkID0gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKGZpbGVfc2l6ZSk7XG4gICAgICAgICAgICB0aGlzLmRhdGFfdHlwZSA9IGRhdGFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X3N0YXJ0ZWQgPSBpbmdlc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X3N0YXJ0ZWRfZm9ybWF0dGVkID0gaW5nZXN0X3N0YXJ0ZWQgPyBtb21lbnQudXRjKGluZ2VzdF9zdGFydGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCkgOiAnJztcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X2VuZGVkID0gaW5nZXN0X2VuZGVkO1xuICAgICAgICAgICAgdGhpcy5pbmdlc3RfZW5kZWRfZm9ybWF0dGVkID0gaW5nZXN0X2VuZGVkID8gbW9tZW50LnV0Yyhpbmdlc3RfZW5kZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VfZmlsZSA9IHNvdXJjZV9maWxlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSW5nZXN0LnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBJbmdlc3QuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluZ2VzdChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RyaWtlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ieXRlc190cmFuc2ZlcnJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmFuc2Zlcl9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyYW5zZmVyX2VuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lZGlhX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9zaXplLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmdlc3Rfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmdlc3RfZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc291cmNlX2ZpbGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSW5nZXN0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSW5nZXN0LnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEluZ2VzdC5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSW5nZXN0LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBJbmdlc3Q7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdHJpa2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYiwgU3RyaWtlQ29uZmlndXJhdGlvbikge1xuICAgICAgICB2YXIgU3RyaWtlID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB0aXRsZSwgZGVzY3JpcHRpb24sIGpvYiwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCwgY29uZmlndXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuam9iID0gSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uID0gU3RyaWtlQ29uZmlndXJhdGlvbi50cmFuc2Zvcm1lcihjb25maWd1cmF0aW9uKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdHJpa2UucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgY2xlYW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbjogdGhpcy5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RyaWtlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2UoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdHJpa2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChTdHJpa2UuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0cmlrZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RyaWtlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RyaWtlQ29uZmlndXJhdGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgU3RyaWtlSW5nZXN0RmlsZSkge1xuICAgICAgICB2YXIgU3RyaWtlQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uICh2ZXJzaW9uLCB3b3Jrc3BhY2UsIG1vbml0b3IsIGZpbGVzX3RvX2luZ2VzdCkge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gc2NhbGVDb25maWcuc3RyaWtlQ29uZmlndXJhdGlvblZlcnNpb247XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvciA9IG1vbml0b3IgPyBtb25pdG9yIDoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICcnLFxuICAgICAgICAgICAgICAgIHJlZ2lvbl9uYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3Nfa2V5X2lkOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgc2VjcmV0X2FjY2Vzc19rZXk6ICcnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZmlsZXNfdG9faW5nZXN0ID0gZmlsZXNfdG9faW5nZXN0ID8gU3RyaWtlSW5nZXN0RmlsZS50cmFuc2Zvcm1lcihmaWxlc190b19pbmdlc3QpIDogW107XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaWtlQ29uZmlndXJhdGlvbi5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RyaWtlQ29uZmlndXJhdGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaWtlQ29uZmlndXJhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tb25pdG9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzX3RvX2luZ2VzdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlrZUNvbmZpZ3VyYXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdHJpa2VDb25maWd1cmF0aW9uLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoU3RyaWtlQ29uZmlndXJhdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RyaWtlQ29uZmlndXJhdGlvbi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RyaWtlQ29uZmlndXJhdGlvbjtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0cmlrZUluZ2VzdEZpbGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTdHJpa2VJbmdlc3RGaWxlID0gZnVuY3Rpb24gKGZpbGVuYW1lX3JlZ2V4LCBkYXRhX3R5cGVzLCBuZXdfd29ya3NwYWNlLCBuZXdfZmlsZV9wYXRoKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGVuYW1lX3JlZ2V4ID0gZmlsZW5hbWVfcmVnZXg7XG4gICAgICAgICAgICB0aGlzLmRhdGFfdHlwZXMgPSBkYXRhX3R5cGVzIHx8IFtdO1xuICAgICAgICAgICAgdGhpcy5uZXdfd29ya3NwYWNlID0gbmV3X3dvcmtzcGFjZSB8fCAnJztcbiAgICAgICAgICAgIHRoaXMubmV3X2ZpbGVfcGF0aCA9IG5ld19maWxlX3BhdGggfHwgJyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaWtlSW5nZXN0RmlsZS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RyaWtlSW5nZXN0RmlsZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5PYmogPSBuZXcgU3RyaWtlSW5nZXN0RmlsZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlbmFtZV9yZWdleCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhX3R5cGVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5ld193b3Jrc3BhY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmV3X2ZpbGVfcGF0aFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YV90eXBlcyAmJiBkYXRhLmRhdGFfdHlwZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSByZXR1cm5PYmouZGF0YV90eXBlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGVtcHR5L251bGwvdW5kZWZpbmVkIHZhbHVlcyBmcm9tIHJldHVybk9ialxuICAgICAgICAgICAgICAgIHJldHVybiBfLnBpY2socmV0dXJuT2JqLCBfLmlkZW50aXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaWtlSW5nZXN0RmlsZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0cmlrZUluZ2VzdEZpbGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChTdHJpa2VJbmdlc3RGaWxlLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdHJpa2VJbmdlc3RGaWxlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdHJpa2VJbmdlc3RGaWxlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2ZlZWRTZXJ2aWNlJywgZnVuY3Rpb24gKCRsb2NhdGlvbiwgJHRpbWVvdXQsICRxLCAkaHR0cCwgc2NhbGVDb25maWcsIEluZ2VzdCkge1xuXG4gICAgICAgIHZhciBnZXRGZWVkUGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgaWYoIXBhcmFtcykgeyBwYXJhbXMgPSB7fTsgfVxuICAgICAgICAgICAgdmFyIHAgPSB7fTtcbiAgICAgICAgICAgIHAucGFnZV9zaXplID0gMTAwMDtcbiAgICAgICAgICAgIHAuc3RhcnRlZCA9IHBhcmFtcy5zdGFydGVkID8gcGFyYW1zLnN0YXJ0ZWQgOiBtb21lbnQudXRjKCkuYWRkKC03LCdkYXlzJykuc3RhcnRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgcC5lbmRlZCA9IHBhcmFtcy5lbmRlZCA/IHBhcmFtcy5lbmRlZCA6IG1vbWVudC51dGMoKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHAudXNlX2luZ2VzdF90aW1lID0gcGFyYW1zLnVzZV9pbmdlc3RfdGltZSA/IHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgOiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHA7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEluZ2VzdHNQYXJhbXMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRTb3VyY2VQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIGlzX3BhcnNlZCwgZmlsZV9uYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUgPyBwYWdlX3NpemUgOiAxMDAwLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlciA/IG9yZGVyIDogJy1sYXN0X21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICBpc19wYXJzZWQ6IGlzX3BhcnNlZCxcbiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IGZpbGVfbmFtZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0RmVlZDogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0RmVlZFBhcmFtcyhwYXJhbXMpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2luZ2VzdHMnKSArICdpbmdlc3RzL3N0YXR1cy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbmdlc3RzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0SW5nZXN0c1BhcmFtcyhwYXJhbXMpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2luZ2VzdHMnKSArICdpbmdlc3RzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBJbmdlc3QudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTb3VyY2VzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFNvdXJjZVBhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdzb3VyY2VzJykgKyAnc291cmNlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTb3VyY2VEZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnc291cmNlcycpICsgJ3NvdXJjZXMvJyArIGlkICsgJy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc3RyaWtlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFN0cmlrZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3N0cmlrZXMvJztcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyBvcmRlcjogJy10aXRsZScgfVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFN0cmlrZURldGFpbHM6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy8nICsgaWQgKyAnLyc7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsaWRhdGVTdHJpa2U6IGZ1bmN0aW9uIChzdHJpa2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNsZWFuU3RyaWtlID0gc3RyaWtlLmNsZWFuKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3N0cmlrZXMvdmFsaWRhdGlvbi8nLCBjbGVhblN0cmlrZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlU3RyaWtlOiBmdW5jdGlvbiAoc3RyaWtlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzdHJpa2UuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdHJpa2VzLycsIHN0cmlrZS5jbGVhbigpKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucGF0Y2goc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy8nICsgc3RyaWtlLmlkICsgJy8nLCBzdHJpa2UuY2xlYW4oKSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpa2UgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoc3RyaWtlKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiLyoqXG4gKiA8c2NhbGUtZmlsZS1hbmNlc3RyeS10cmVlIC8+XG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignc2NhbGVGaWxlQW5jZXN0cnlUcmVlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5zb3VyY2UgPSAkc2NvcGUuc291cmNlO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zb3VyY2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRyYXcoKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2codm0uc291cmNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZm9ybWF0RmlsZU5hbWUoZmlsZW5hbWUpe1xuICAgICAgICAgICAgdmFyIG1heGxlbiA9IDI1O1xuICAgICAgICAgICAgdmFyIG5ld2ZuYW1lID0gZmlsZW5hbWU7XG4gICAgICAgICAgICBpZihmaWxlbmFtZS5sZW5ndGggPiAzMCl7XG4gICAgICAgICAgICAgICAgdmFyIGV4dCA9IGZpbGVuYW1lLnN1YnN0cmluZyhmaWxlbmFtZS5sYXN0SW5kZXhPZignLicpKzEpO1xuICAgICAgICAgICAgICAgIHZhciBmaXJzdHBhcnQgPSBmaWxlbmFtZS5zdWJzdHJpbmcoMCwgZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKSk7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0cGFydExlbiA9IG1heGxlbiAtIGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdmFyIG5ld2ZuYW1lID0gZmlsZW5hbWUuc3Vic3RyaW5nKDAsZmlyc3RwYXJ0TGVuLTEpICsgJy4uLicgKyBleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3Zm5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUh0bWwoZmlsZSkge1xuICAgICAgICAgICAgdmFyIGljb25IdG1sID0gc2NhbGVTZXJ2aWNlLmdldE1lZGlhVHlwZUh0bWwoZmlsZS5tZWRpYV90eXBlKTtcbiAgICAgICAgICAgIHZhciBmbmFtZSA9IGZvcm1hdEZpbGVOYW1lKGZpbGUuZmlsZV9uYW1lKTtcbiAgICAgICAgICAgIHZhciBodG1sID0gXCI8ZGl2IGNsYXNzPSdncmFwaCc+XCI7XG4gICAgICAgICAgICBodG1sICs9IFwiPHNwYW4gY2xhc3M9J25hbWUnIHRpdGxlPSdcIiArIGZpbGUuZmlsZV9uYW1lICsgXCInPlwiO1xuICAgICAgICAgICAgaHRtbCArPSBcIjxhIG5nLXNob3c9J1wiICsgZmlsZS51cmwgKyBcIicgaHJlZj0nXCIgKyBmaWxlLnVybCArIFwiJyB0YXJnZXQ9J19qb2JmaWxlJz5cIiArIGljb25IdG1sICsgXCIgXCIgKyBmbmFtZSArIFwiPC9hPlwiO1xuICAgICAgICAgICAgaHRtbCArPSBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgIGh0bWwgKz0gXCI8L2Rpdj5cIjtcblxuICAgICAgICAgICAgcmV0dXJuIGh0bWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Sm9iTm9kZUh0bWwoam9idHlwZSwgam9iaWQpe1xuICAgICAgICAgICAgdmFyIGh0bWwgPSBcIjxkaXY+XCI7XG4gICAgICAgICAgICBodG1sICs9IFwiPHNwYW4gY2xhc3M9J3N0YXR1cyc+PC9zcGFuPjxzcGFuIGNsYXNzPSdqb2ItbmFtZSc+PGEgaHJlZj0nIy9qb2JzL2pvYi9cIiArIGpvYmlkICsgXCInPlwiICsgam9idHlwZS5uYW1lICsgXCI8L2E+PC9zcGFuPlwiO1xuICAgICAgICAgICAgaHRtbCArPSBcIjwvZGl2PlwiO1xuXG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKSB7XG4gICAgICAgICAgICBpZih2bS5zb3VyY2UgJiYgdm0uc291cmNlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoXCJzdmdcIik7XG4gICAgICAgICAgICAgICAgdmFyIGlubmVyID0gc3ZnLnNlbGVjdChcImdcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdXAgem9vbSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgdmFyIHpvb20gPSBkMy5iZWhhdmlvci56b29tKClcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiem9vbVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IHpvb20gb24gV2hlZWxFdmVudCBvciBNb3VzZUV2ZW50LCBqdXN0IHdpbmRvdyBzaXppbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd6b29tZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGQzLmV2ZW50LnNvdXJjZUV2ZW50ID09PSBudWxsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgZDMuZXZlbnQudHJhbnNsYXRlICsgXCIpXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNjYWxlKFwiICsgZDMuZXZlbnQuc2NhbGUgKyBcIilcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3ZnLmNhbGwoem9vbSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVuZGVyID0gbmV3IGRhZ3JlRDMucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgLy8gTGVmdC10by1yaWdodCBsYXlvdXRcbiAgICAgICAgICAgICAgICB2YXIgZyA9IG5ldyBkYWdyZUQzLmdyYXBobGliLkdyYXBoKHttdWx0aWdyYXBoOiB0cnVlfSk7XG4gICAgICAgICAgICAgICAgZy5zZXRHcmFwaCh7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVzZXA6IDMwLFxuICAgICAgICAgICAgICAgICAgICByYW5rc2VwOiA3MCxcbiAgICAgICAgICAgICAgICAgICAgcmFua2RpcjogXCJMUlwiLFxuICAgICAgICAgICAgICAgICAgICBtYXJnaW54OiAyMCxcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2lueTogMFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9TdGFydGluZyBub2RlXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBnZXROb2RlSHRtbCh2bS5zb3VyY2UpO1xuICAgICAgICAgICAgICAgIGcuc2V0Tm9kZSgnZmlsZS0nICsgdm0uc291cmNlLmlkLCB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBodG1sLFxuICAgICAgICAgICAgICAgICAgICByeDogMTAsXG4gICAgICAgICAgICAgICAgICAgIHJ5OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTAsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyNTAsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFByb2R1Y3RzXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaWQgaW4gdm0uc291cmNlLnByb2R1Y3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9kID0gdm0uc291cmNlLnByb2R1Y3RzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpvYk5vZGVIdG1sID0gZ2V0Sm9iTm9kZUh0bWwocHJvZC5qb2JfdHlwZSwgcHJvZC5qb2IuaWQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgbm9kZSBmb3IgdGhlIGpvYlxuICAgICAgICAgICAgICAgICAgICBnLnNldE5vZGUoJ2pvYi0nICsgcHJvZC5qb2IuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogam9iTm9kZUh0bWwsXG4gICAgICAgICAgICAgICAgICAgICAgICByeDogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICByeTogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBnLnNldEVkZ2UoJ2ZpbGUtJyt2bS5zb3VyY2UuaWQsICdqb2ItJytwcm9kLmpvYi5pZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbFR5cGU6IFwiaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbDogXCI8YSBocmVmPScjL2pvYnMvam9iL1wiICsgcHJvZC5qb2IuaWQgKyBcIic+XCIgKyBwcm9kLmpvYl90eXBlLm5hbWUgKyBcIjwvYT5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgLy93aWR0aDogNDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGdldE5vZGVIdG1sKHByb2QpO1xuICAgICAgICAgICAgICAgICAgICBnLnNldE5vZGUoJ2ZpbGUtJyArIHByb2QuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ4OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ5OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI1MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGcuc2V0RWRnZSgnam9iLScrcHJvZC5qb2IuaWQsICdmaWxlLScrcHJvZC5pZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbFR5cGU6IFwiaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbDogXCI8YSBocmVmPScjL2pvYnMvam9iL1wiICsgcHJvZC5qb2IuaWQgKyBcIic+XCIgKyBwcm9kLmpvYl90eXBlLm5hbWUgKyBcIjwvYT5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgLy93aWR0aDogNDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVuZGVyID0gbmV3IGRhZ3JlRDMucmVuZGVyKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBSdW4gdGhlIHJlbmRlcmVyLiBUaGlzIGlzIHdoYXQgZHJhd3MgdGhlIGZpbmFsIGdyYXBoLlxuICAgICAgICAgICAgICAgIHJlbmRlcihpbm5lciwgZyk7XG5cbiAgICAgICAgICAgICAgICAvLyBDZW50ZXIgdGhlIGdyYXBoXG4gICAgICAgICAgICAgICAgdmFyIHZieCA9IHN2Zy5hdHRyKCd2aWV3Qm94Jykuc3BsaXQoJyAnKTtcbiAgICAgICAgICAgICAgICB2YXIgZ3dpZHRoID0gZy5ncmFwaCgpLndpZHRoO1xuICAgICAgICAgICAgICAgIHZhciBnaGVpZ2h0ID0gZy5ncmFwaCgpLmhlaWdodDtcbiAgICAgICAgICAgICAgICB2YXIgcmF0aW8gPSBnaGVpZ2h0L2d3aWR0aDtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGdoZWlnaHQpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZieFszXSk7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiBncmFwaCBpcyBzaG9ydGVyIHRoYW4gY29udGFpbmVyLCBzaHJpbmsgdGhlIGNvbnRhaW5lciBoZWlnaHRcbiAgICAgICAgICAgICAgICBpZiggZ2hlaWdodCA8IHZieFszXSApe1xuICAgICAgICAgICAgICAgICAgICBzdmcuYXR0cigndmlld0JveCcsIHZieFswXSArICcgJyArIHZieFsxXSArICcgJyArIHZieFsyXSArICcgJyArIGdoZWlnaHQqMS4xKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTY2FsZSBncmFwaCBiYXNlZCBvbiB3aWR0aCBvciBoZWlnaHQgYmFzZWQgb24gd2hpY2ggZXhjZWVkc1xuICAgICAgICAgICAgICAgIC8vIHZpZXdib3ggYnkgbW9zdCBwaXhlbHNcbiAgICAgICAgICAgICAgICB2YXIgaW5pdGlhbFNjYWxlID0gTWF0aC5taW4oKHZieFsyXSowLjk1KS9nd2lkdGgsKHZieFszXSowLjk1KS9naGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB6b29tXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2xhdGUoWyh2YnhbMl0qMC4wMiksICh2YnhbM10qMC4wMildKVxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoaW5pdGlhbFNjYWxlKVxuICAgICAgICAgICAgICAgICAgICAuZXZlbnQoc3ZnKTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCBhcHByb3ByaWF0ZSBjbGFzcyBmb3Igam9iIG5vZGVzXG4gICAgICAgICAgICAgICAgJCgnLmpvYi1uYW1lJykuY2xvc2VzdCgnLm5vZGUnKS5jaGlsZHJlbigncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2pvYicpOyAvLy5hZGRDbGFzcygnam9iJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBjbGVhciB6b29tIGhhbmRsZXIgYW5kIG1vdXNld2hlZWwgZXZlbnRzXG4gICAgICAgICAgICAgICAgLy8gc28gdGhleSBkb24ndCBpbnRlcmZlcmUgd2l0aCBzY3JvbGxpbmdcbiAgICAgICAgICAgICAgICB6b29tLm9uKCd6b29tJywgbnVsbCk7XG4gICAgICAgICAgICAgICAgc3ZnLm9uKFwibW91c2Vkb3duLnpvb21cIiwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwibW91c2V3aGVlbC56b29tXCIsIG51bGwpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlbW92ZS56b29tXCIsIG51bGwpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcIkRPTU1vdXNlU2Nyb2xsLnpvb21cIiwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiZGJsY2xpY2suem9vbVwiLCBudWxsKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJ0b3VjaHN0YXJ0Lnpvb21cIiwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwidG91Y2htb3ZlLnpvb21cIiwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwidG91Y2hlbmQuem9vbVwiLCBudWxsKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJ3aGVlbC56b29tXCIsIG51bGwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG5cbiAgICB9KS5kaXJlY3RpdmUoJ3NjYWxlRmlsZUFuY2VzdHJ5VHJlZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxzY2FsZS1maWxlLWFuY2VzdHJ5LXRyZWUgc291cmNlPVwic291cmNlXCIgLz5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnc2NhbGVGaWxlQW5jZXN0cnlUcmVlQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9kaXJlY3RpdmVzL2ZpbGVBbmNlc3RyeVRyZWVUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHNvdXJjZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkRldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHVpYk1vZGFsLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBsb2FkU2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uam9iID0ge307XG4gICAgICAgIHZtLmpvYklkID0gJHJvdXRlUGFyYW1zLmlkO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcbiAgICAgICAgdm0ubG9hZGluZ0pvYkRldGFpbCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXRlc3RFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25Mb2cgPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25EZXRhaWxzID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRFeGVjdXRpb25EZXRhaWxWYWx1ZXMgPSBudWxsO1xuICAgICAgICB2bS50aW1lbGluZSA9IFtdO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYkVycm9yQ3JlYXRlZCA9ICcnO1xuICAgICAgICB2bS5qb2JFcnJvckxhc3RNb2RpZmllZCA9ICcnO1xuICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgIHZtLnN1cGVyc2VkZWRTdGF0dXMgPSAnJztcbiAgICAgICAgdm0udHJpZ2dlck9jY3VycmVkID0gJyc7XG5cbiAgICAgICAgdm0uc2hvd0xvZyA9IGZ1bmN0aW9uIChleGVjdXRpb24pIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uRGV0YWlscyhleGVjdXRpb24uaWQpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV4ZWN1dGlvbkxvZyA9IHJlc3VsdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2hvd0xvZy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbG9nLW1vZGFsLXdpbmRvdydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNob3dFeGVjdXRpb25EZXRhaWxzID0gZnVuY3Rpb24gKGV4ZWN1dGlvbklkKSB7XG4gICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbkRldGFpbHMoZXhlY3V0aW9uSWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV4ZWN1dGlvbkRldGFpbHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXhlY3V0aW9uRGV0YWlsVmFsdWVzID0gXy5wYWlycyhkYXRhKTtcbiAgICAgICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93RXhlY3V0aW9uRGV0YWlscy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVxdWV1ZUpvYiA9IGZ1bmN0aW9uIChqb2JJZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5yZXF1ZXVlSm9icyh7IGpvYl9pZHM6IFtqb2JJZF0gfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdSZXF1ZXVlZCBKb2InKTtcbiAgICAgICAgICAgICAgICB2bS5qb2Iuc3RhdHVzID0gZGF0YS5qb2Jfc3RhdHVzO1xuICAgICAgICAgICAgICAgIGdldEpvYkRldGFpbChqb2JJZCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oJ1JlcXVldWUgcmVxdWVzdCBmYWlsZWQnKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jYW5jZWxKb2IgPSBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB2YXIgb3JpZ2luYWxTdGF0dXMgPSBqb2Iuc3RhdHVzO1xuICAgICAgICAgICAgam9iLnN0YXR1cyA9ICdDQU5DRUwnO1xuICAgICAgICAgICAgam9iU2VydmljZS51cGRhdGVKb2Ioam9iLmlkLCB7IHN0YXR1czogJ0NBTkNFTEVEJyB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnSm9iIENhbmNlbGVkJyk7XG4gICAgICAgICAgICAgICAgam9iLnN0YXR1cyA9ICdDQU5DRUxFRCc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gb3JpZ2luYWxTdGF0dXM7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZtLmNhbGN1bGF0ZUZpbGVTaXplID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoc2l6ZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYkRldGFpbCA9IGZ1bmN0aW9uIChqb2JJZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkRldGFpbCA9IHRydWU7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldEpvYkRldGFpbChqb2JJZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYiA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0udGltZWxpbmUgPSBjYWxjdWxhdGVUaW1lbGluZShkYXRhKTtcbiAgICAgICAgICAgICAgICB2bS5sYXRlc3RFeGVjdXRpb24gPSBkYXRhLmdldExhdGVzdEV4ZWN1dGlvbigpO1xuICAgICAgICAgICAgICAgIHZtLmpvYkVycm9yQ3JlYXRlZCA9IGRhdGEuZXJyb3IgPyBtb21lbnQudXRjKGRhdGEuZXJyb3IuY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6ICcnO1xuICAgICAgICAgICAgICAgIHZtLmxhc3RTdGF0dXNDaGFuZ2UgPSBkYXRhLmxhc3Rfc3RhdHVzX2NoYW5nZSA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICAgICAgdm0uc3VwZXJzZWRlZENoYW5nZSA9IGRhdGEuc3VwZXJzZWRlZCA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGRhdGEuc3VwZXJzZWRlZCkuZGlmZihtb21lbnQudXRjKCkpKS5odW1hbml6ZSh0cnVlKSA6ICcnO1xuICAgICAgICAgICAgICAgIHZtLnRyaWdnZXJPY2N1cnJlZCA9IGRhdGEuZXZlbnQub2NjdXJyZWQgPyBtb21lbnQuZHVyYXRpb24obW9tZW50LnV0YyhkYXRhLmV2ZW50Lm9jY3VycmVkKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICAgICAgdm0uaW5wdXRzID0gZGF0YS5pbnB1dHM7XG4gICAgICAgICAgICAgICAgdm0ub3V0cHV0cyA9IGRhdGEub3V0cHV0cztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JEZXRhaWwgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjYWxjdWxhdGVUaW1lbGluZSA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgIHZhciB0bCA9IFtdO1xuICAgICAgICAgICAgdGwucHVzaCh7IHRhc2tOYW1lOiAnQ3JlYXRlZCcsIHN0YXJ0ZWQ6IGpvYi5jcmVhdGVkID8gbW9tZW50LnV0Yyhqb2IuY3JlYXRlZCkudG9EYXRlKCkgOiBqb2IuY3JlYXRlZCwgZW5kZWQ6IGpvYi5xdWV1ZWQgPyBtb21lbnQudXRjKGpvYi5xdWV1ZWQpLnRvRGF0ZSgpIDogam9iLnF1ZXVlZCB9KTtcbiAgICAgICAgICAgIHRsLnB1c2goeyB0YXNrTmFtZTogJ1F1ZXVlZCcsIHN0YXJ0ZWQ6IGpvYi5xdWV1ZWQgPyBtb21lbnQudXRjKGpvYi5xdWV1ZWQpLnRvRGF0ZSgpIDogam9iLnF1ZXVlZCwgZW5kZWQ6IGpvYi5zdGFydGVkID8gbW9tZW50LnV0Yyhqb2Iuc3RhcnRlZCkudG9EYXRlKCkgOiBqb2Iuc3RhcnRlZCB9KTtcbiAgICAgICAgICAgIHRsLnB1c2goeyB0YXNrTmFtZTogJ0V4ZWN1dGVkJywgc3RhcnRlZDogam9iLnN0YXJ0ZWQgPyBtb21lbnQudXRjKGpvYi5zdGFydGVkKS50b0RhdGUoKSA6IGpvYi5zdGFydGVkLCBlbmRlZDogam9iLmVuZGVkID8gbW9tZW50LnV0Yyhqb2IuZW5kZWQpLnRvRGF0ZSgpIDogam9iLmVuZGVkIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHVzZXIgJiYgdXNlci5pc19hZG1pbik7XG4gICAgICAgICAgICBnZXRKb2JEZXRhaWwodm0uam9iSWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgbmF2U2VydmljZSwgam9iRXhlY3V0aW9uU2VydmljZSwgbm9kZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSB7fTtcbiAgICAgICAgdm0uam9iRXhlY3V0aW9uSWQgPSAkcm91dGVQYXJhbXMuaWQ7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMvcnVucycpO1xuXG4gICAgICAgIHZhciBnZXRKb2JFeGVjdXRpb25EZXRhaWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbkRldGFpbChpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IGRhdGE7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldEpvYkV4ZWN1dGlvbkRldGFpbCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdqb2JFeGVjdXRpb25zQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgbmF2U2VydmljZSwgc3RhdGVTZXJ2aWNlLCBncmlkRmFjdG9yeSwgdXNlclNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCB1aUdyaWRDb25zdGFudHMsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgam9iVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbnNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbam9iVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGUgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkID8gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCA6IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICB2bS5qb2JTdGF0dXNWYWx1ZXMgPSBzY2FsZUNvbmZpZy5qb2JTdGF0dXM7XG4gICAgICAgIHZtLnNlbGVjdGVkSm9iU3RhdHVzID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGF0dXMgfHwgdm0uam9iU3RhdHVzVmFsdWVzWzBdO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnQgPSBtb21lbnQudXRjKHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wID0gbW9tZW50LnV0Yyh2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeUpvYlR5cGUgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5jb2xEZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iX3R5cGUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LmpvYl90eXBlLmdldEljb24oKVwiPjwvc3Bhbj4ge3sgcm93LmVudGl0eS5qb2JfdHlwZS50aXRsZSB9fSB7eyByb3cuZW50aXR5LmpvYl90eXBlLnZlcnNpb24gfX08L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JUeXBlXCIgbmctb3B0aW9ucz1cImpvYlR5cGUgYXMgKGpvYlR5cGUudGl0bGUgKyBcXCcgXFwnICsgam9iVHlwZS52ZXJzaW9uKSBmb3Igam9iVHlwZSBpbiBncmlkLmFwcFNjb3BlLnZtLmpvYlR5cGVWYWx1ZXNcIj48L3NlbGVjdD48L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdDcmVhdGVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5jcmVhdGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdsYXN0X21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xhc3QgTW9kaWZpZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5Lmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2R1cmF0aW9uJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMjAsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyB0ZXh0LXJpZ2h0XCI+e3sgcm93LmVudGl0eS5nZXREdXJhdGlvbigpIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3N0YXR1cycsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDE1MCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PGRpdiBjbGFzcz1cInB1bGwtcmlnaHRcIj48YnV0dG9uIG5nLXNob3c9XCIoKCFncmlkLmFwcFNjb3BlLnZtLnJlYWRvbmx5KSAmJiAocm93LmVudGl0eS5zdGF0dXMgPT09IFxcJ0ZBSUxFRFxcJyB8fCByb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnQ0FOQ0VMRURcXCcpKVwiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5yZXF1ZXVlSm9icyh7IGpvYl9pZHM6IFtyb3cuZW50aXR5LmlkXSB9KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiIHRpdGxlPVwiUmVxdWV1ZSBKb2JcIj48aSBjbGFzcz1cImZhIGZhLXJlcGVhdFwiPjwvaT48L2J1dHRvbj4gPGJ1dHRvbiBuZy1zaG93PVwiIWdyaWQuYXBwU2NvcGUudm0ucmVhZG9ubHkgJiYgcm93LmVudGl0eS5zdGF0dXMgIT09IFxcJ0NPTVBMRVRFRFxcJyAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ0FOQ0VMRURcXCdcIiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uY2FuY2VsSm9iKHJvdy5lbnRpdHkpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJDYW5jZWwgSm9iXCI+PGkgY2xhc3M9XCJmYSBmYS1iYW5cIj48L2k+PC9idXR0b24+PC9kaXY+IHt7IHJvdy5lbnRpdHkuc3RhdHVzIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iU3RhdHVzXCI+PG9wdGlvbiBuZy1zZWxlY3RlZD1cInt7IGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzWyRpbmRleF0gPT0gZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlN0YXR1cyB9fVwiIHZhbHVlPVwie3sgZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSB9fVwiIG5nLXJlcGVhdD1cInN0YXR1cyBpbiBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlcyB0cmFjayBieSAkaW5kZXhcIj57eyBzdGF0dXMudG9VcHBlckNhc2UoKSB9fTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdMb2cnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgc29ydGFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiA2MCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtY2VudGVyXCI+PGJ1dHRvbiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uc2hvd0xvZyhyb3cuZW50aXR5KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiPjxpIGNsYXNzPVwiZmEgZmEtZmlsZS10ZXh0XCI+PC9pPjwvYnV0dG9uPjwvZGl2PidcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICB2bS5nZXRKb2JFeGVjdXRpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iRXhlY3V0aW9uU2VydmljZS5nZXRKb2JFeGVjdXRpb25zKHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMucHVzaChkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0uam9iVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHsgaWQ6IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQgfSkgfHwgam9iVHlwZVZpZXdBbGw7XG4gICAgICAgICAgICAgICAgdm0uZ2V0Sm9iRXhlY3V0aW9ucygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNob3dMb2cgPSBmdW5jdGlvbiAoam9iRXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAvLyBzaG93IGxvZyBtb2RhbFxuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSBqb2JFeGVjdXRpb247XG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2hvd0xvZy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdsZycsXG4gICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdsb2ctbW9kYWwtd2luZG93J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JzUGFyYW1zKHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMpO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB2bS5nZXRKb2JzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0uam9iRXhlY3V0aW9uc1BhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iT3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5pZCAhPT0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCkge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy9qb2IvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYkV4ZWN1dGlvbnNQYXJhbXModm0uam9iRXhlY3V0aW9uc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHVzZXIgJiYgdXNlci5pc19hZG1pbik7XG4gICAgICAgICAgICB2bS5nZXRKb2JUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icy9leGVjdXRpb25zJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSm9iVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHtpZDogcGFyc2VJbnQodmFsdWUpfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSAhYW5ndWxhci5lcXVhbHModmFsdWUsIGpvYlR5cGVWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlN0YXR1cycsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHZhbHVlICE9PSAnVklFVyBBTEwnO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0YXJ0JywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXJ0ZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RvcCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5lbmRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldEpvYnNDb2xEZWZzKCknLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmNvbERlZnMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRKb2JzUGFyYW1zKCknLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iVHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sIGhvdGtleXMsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlLCBub2RlU2VydmljZSwgbG9jYWxTdG9yYWdlLCB1c2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgdm0ucmVxdWVzdGVkSm9iVHlwZUlkID0gcGFyc2VJbnQoJHJvdXRlUGFyYW1zLmlkKTtcbiAgICAgICAgdm0uam9iVHlwZXMgPSBbXTtcbiAgICAgICAgdm0uam9iVHlwZUlkcyA9IFtdO1xuICAgICAgICB2bS5qb2JUeXBlQ291bnQgPSAwO1xuICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRGV0YWlscyA9IHt9O1xuICAgICAgICB2bS5hY3RpdmVKb2JUeXBlSW50ZXJmYWNlVmFsdWVzID0gW107XG4gICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVFcnJvcnMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZVN0YXRzID0ge307XG4gICAgICAgIHZtLnNob3dKb2JUeXBlRXJyb3JzID0gZmFsc2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5hY3RpdmVKb2JUeXBlID0gbnVsbDtcbiAgICAgICAgdm0uaGVhbHRoRGF0YTYgPSB7fTtcbiAgICAgICAgdm0uaGVhbHRoRGF0YTEyID0ge307XG4gICAgICAgIHZtLmhlYWx0aERhdGEyNCA9IHt9O1xuICAgICAgICB2bS5hY3Rpdml0eUljb24gPSAnPGkgY2xhc3M9XCJmYSBmYS1wdWxzZVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5hY3Rpdml0eUljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICB2bS5qb2JEZXRhaWxzQ2xhc3MgPSAnaGlkZGVuJztcbiAgICAgICAgdm0ucGF1c2VCdG5DbGFzcyA9ICdmYS1wYXVzZSc7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzL3R5cGVzJyk7XG5cbiAgICAgICAgdm0udmlld0RldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUgPSBfLmZpbmQodm0uam9iVHlwZXMsICdpZCcsIGlkKTtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUuY3JlYXRlZCA9IGZvcm1hdERhdGVUaW1lKHZtLmFjdGl2ZUpvYlR5cGUuY3JlYXRlZCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlLmxhc3RNb2RpZmllZCA9IGZvcm1hdERhdGVUaW1lKHZtLmFjdGl2ZUpvYlR5cGUubGFzdE1vZGlmaWVkKTtcblxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2pvYnMvdHlwZXMvJyArIGlkKTtcblxuICAgICAgICAgICAgZ2V0Sm9iVHlwZURldGFpbHModm0uYWN0aXZlSm9iVHlwZS5pZCk7XG5cbiAgICAgICAgICAgIHZtLmpvYkRldGFpbHNDbGFzcyA9ICd2aXNpYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVQYXVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkID0gIXZtLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkO1xuICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMuaXNfcGF1c2VkID0gdm0uYWN0aXZlSm9iVHlwZS5pc19wYXVzZWQ7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLnVwZGF0ZUpvYlR5cGUodm0uYWN0aXZlSm9iVHlwZURldGFpbHMpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSB2bS5nZXRQYXVzZUJ1dHRvbkNsYXNzKHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzLmlzX3BhdXNlZCk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0UGF1c2VCdXR0b25DbGFzcyA9IGZ1bmN0aW9uKGlzX3BhdXNlZCl7XG4gICAgICAgICAgICByZXR1cm4gaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRKb2JUeXBlTGlzdEl0ZW1DbGFzcyA9IGZ1bmN0aW9uKGpvYlR5cGUpe1xuICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGUuaXNfcGF1c2VkID8gJ3BhdXNlZCcgOiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0RGF0ZVRpbWUgPSBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGR0KS50b0lTT1N0cmluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlcyA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlSWRzID0gXy5wbHVjayh2bS5qb2JUeXBlcywgJ2lkJyk7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZUNvdW50ID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICBpZiAodm0ucmVxdWVzdGVkSm9iVHlwZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnZpZXdEZXRhaWxzKHZtLnJlcXVlc3RlZEpvYlR5cGVJZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBob3RrZXlzLmJpbmRUbygkc2NvcGUpXG4gICAgICAgICAgICAgICAgICAgIC5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK3VwJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUHJldmlvdXMgSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYWN0aXZlSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKHZtLmpvYlR5cGVJZHMsIHZtLmFjdGl2ZUpvYlR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udmlld0RldGFpbHModm0uam9iVHlwZUlkc1tpZHggLSAxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLmFkZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21ibzogJ2N0cmwrZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ05leHQgSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYWN0aXZlSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKHZtLmpvYlR5cGVJZHMsIHZtLmFjdGl2ZUpvYlR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4IDwgKHZtLmpvYlR5cGVJZHMubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZpZXdEZXRhaWxzKHZtLmpvYlR5cGVJZHNbaWR4ICsgMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRGV0YWlscyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZUludGVyZmFjZVZhbHVlcyA9IF8ucGFpcnMoZGF0YS5qb2JfdHlwZV9pbnRlcmZhY2UpO1xuICAgICAgICAgICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSB2bS5nZXRQYXVzZUJ1dHRvbkNsYXNzKHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzLmlzX3BhdXNlZCk7XG4gICAgICAgICAgICAgICAgLy8gZm9ybWF0IGVycm9yIG1hcHBpbmdcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgdm0uc2hvd0pvYlR5cGVFcnJvcnMgPSBfLmtleXMoZGF0YS5lcnJvcl9tYXBwaW5nLmV4aXRfY29kZXMpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgaWYgKHZtLnNob3dKb2JUeXBlRXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLmVycm9yX21hcHBpbmcuZXhpdF9jb2RlcywgZnVuY3Rpb24gKGVycm9yX25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IF8uZmluZChkYXRhLmVycm9ycywgJ25hbWUnLCBlcnJvcl9uYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0Q29kZSA9IF8uaW52ZXJ0KGRhdGEuZXJyb3JfbWFwcGluZy5leGl0X2NvZGVzKVtlcnJvcl9uYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVFcnJvcnMucHVzaCh7Y29kZTogZXhpdENvZGUsIGRhdGE6IGVycm9yfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBqb2IgdHlwZSBzdGF0c1xuICAgICAgICAgICAgICAgIHZhciBwZXJmb3JtYW5jZSA9IGRhdGEuZ2V0UGVyZm9ybWFuY2UoKSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZXMgPSBkYXRhLmdldEZhaWx1cmVzKCk7XG5cbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlU3RhdHMgPSBwZXJmb3JtYW5jZTtcblxuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGE2ID0ge1xuICAgICAgICAgICAgICAgICAgICBnYXVnZURhdGE6IHBlcmZvcm1hbmNlLmhvdXI2LnJhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZXMuaG91cjZcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGExMiA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyMTIucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyMTJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGEyNCA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyMjQucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyMjRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRKb2JUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0O1xuXG4gICAgICAgICAgICB2bS5jb250YWluZXJTdHlsZSA9ICdoZWlnaHQ6ICcgKyBjb250YWluZXJNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBjb250YWluZXJNYXhIZWlnaHQgKyAncHg7JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iVHlwZXNGYWlsdXJlUmF0ZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc3RhdGVTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBtZXRyaWNzU2VydmljZSwgZ3JpZEZhY3RvcnksIEpvYlR5cGUsIHRvYXN0ciwgbW9tZW50KSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBqb2JUeXBlVmlld0FsbCA9IHsgbmFtZTogJ1ZJRVcgQUxMJywgdGl0bGU6ICdWSUVXIEFMTCcsIHZlcnNpb246ICcnLCBpZDogMCB9O1xuXG4gICAgICAgIHZtLmpvYlR5cGVzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKCk7XG5cbiAgICAgICAgdmFyIGpvYlR5cGVzID0gW10sXG4gICAgICAgICAgICBzdGFydGVkID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KDMwLCAnZGF5cycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgZW5kZWQgPSBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSB2bS5qb2JUeXBlc1BhcmFtcy5uYW1lID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0uc2NhbGVTZXJ2aWNlID0gc2NhbGVTZXJ2aWNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uZGF0ZXMgPSBbXTtcbiAgICAgICAgdm0ucGVyZm9ybWFuY2VEYXRhID0gW107XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbam9iVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGUgPSB2bS5qb2JUeXBlc1BhcmFtcy5uYW1lID8gdm0uam9iVHlwZXNQYXJhbXMubmFtZSA6IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMvZmFpbHVyZS1yYXRlcycpO1xuXG4gICAgICAgIHZhciBkZWZhdWx0Q29sdW1uRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2pvYl90eXBlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5qb2JfdHlwZS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5qb2JfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iVHlwZVwiIG5nLW9wdGlvbnM9XCJqb2JUeXBlIGFzIChqb2JUeXBlLnRpdGxlICsgXFwnIFxcJyArIGpvYlR5cGUudmVyc2lvbikgZm9yIGpvYlR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5qb2JUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3R3ZW50eWZvdXJfaG91cnMnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnMjQgSG91cnMnLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgaGVhZGVyQ2VsbFRlbXBsYXRlOiAnZ3JpZEhlYWRlci5odG1sJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICdncmlkUm93Lmh0bWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZm9ydHllaWdodF9ob3VycycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICc0OCBIb3VycycsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBoZWFkZXJDZWxsVGVtcGxhdGU6ICdncmlkSGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2dyaWRSb3cuaHRtbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0aGlydHlfZGF5cycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICczMCBEYXlzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGhlYWRlckNlbGxUZW1wbGF0ZTogJ2dyaWRIZWFkZXIuaHRtbCcsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnZ3JpZFJvdy5odG1sJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBkZWZhdWx0Q29sdW1uRGVmcztcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWN0aW9uQ2xpY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzL3R5cGVzLycgKyByb3cuZW50aXR5LmpvYl90eXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5zZXRTdHlsZSA9IGZ1bmN0aW9uIChjb2xGaWVsZCwgZXJyb3JUeXBlKSB7XG4gICAgICAgICAgICB2YXIgZXJyb3JWYWx1ZSA9IChjb2xGaWVsZFtlcnJvclR5cGVdIC8gY29sRmllbGQudG90YWwpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICB2YXIgdGV4dENvbG9yID0gZXJyb3JWYWx1ZSA+PSAwLjUgPyAnI2ZmZicgOiAnIzAwMCc7XG4gICAgICAgICAgICB2YXIgcmdiID0gZXJyb3JUeXBlID09PSAnc3lzdGVtJyA/ICcxMDMsIDAsIDEzJyA6IGVycm9yVHlwZSA9PT0gJ2FsZ29yaXRobScgPyAnMjAzLCAyNCwgMjknIDogJzI0MSwgMTA1LCAxOSc7XG4gICAgICAgICAgICByZXR1cm4gJ2JhY2tncm91bmQ6IHJnYmEoJyArIHJnYiArICcsICcgKyBlcnJvclZhbHVlICsgJyk7IGNvbG9yOiAnICsgdGV4dENvbG9yO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZhaWxSYXRlU3R5bGUgPSBmdW5jdGlvbiAoZXJyb3IsIHRvdGFsKSB7XG4gICAgICAgICAgICB2YXIgcGVyY2VudGFnZSA9ICgoZXJyb3IgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMCk7XG4gICAgICAgICAgICByZXR1cm4gcGVyY2VudGFnZSA+IDAgPyAnd2lkdGg6ICcgKyBwZXJjZW50YWdlICsgJyUnIDogJ2Rpc3BsYXk6IG5vbmUnO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uZ2V0UGVyY2VudGFnZU9mVG90YWwgPSBmdW5jdGlvbiAoZXJyb3JUb3RhbCwgdG90YWwpIHtcbiAgICAgICAgICAgIGlmICh0b3RhbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICgoZXJyb3JUb3RhbCAvIHRvdGFsKSAqIDEwMCkudG9GaXhlZCgwKSArICclJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKHZtLmpvYlR5cGVzUGFyYW1zKTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKHZtLmpvYlR5cGVzUGFyYW1zKSwgZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwYXJhbVswXSwgcGFyYW1bMV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcy5uYW1lID0gdmFsdWUubmFtZSA9PT0gJ1ZJRVcgQUxMJyA/IG51bGwgOiB2YWx1ZS5uYW1lO1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBmb3JtYXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIG51bURheXMpIHtcbiAgICAgICAgICAgIHZhciBkYXRhQXJyID0gW107XG4gICAgICAgICAgICBfLmZvckVhY2goZGF0YSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZFJlc3VsdCA9IF8uZmlsdGVyKHJlc3VsdCwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQudXRjKGQuZGF0ZSwgJ1lZWVktTU0tREQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vbWVudC51dGMoKS5kaWZmKG1vbWVudC51dGMoZGF0ZSksICdkJykgPD0gbnVtRGF5cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkYXRhQXJyLnB1c2goZmlsdGVyZWRSZXN1bHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YUFycjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0Q29sdW1uID0gZnVuY3Rpb24gKGNEYXRhLCBpZCkge1xuICAgICAgICAgICAgdmFyIHN5c3RlbUVycm9ycyA9IGNEYXRhWzBdLFxuICAgICAgICAgICAgICAgIGFsZ29yaXRobUVycm9ycyA9IGNEYXRhWzFdLFxuICAgICAgICAgICAgICAgIGRhdGFFcnJvcnMgPSBjRGF0YVsyXSxcbiAgICAgICAgICAgICAgICB0b3RhbENvdW50ID0gY0RhdGFbM107XG5cbiAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgc3lzdGVtOiBfLnN1bShfLm1hcChfLmZpbHRlcihzeXN0ZW1FcnJvcnMsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSksXG4gICAgICAgICAgICAgICAgYWxnb3JpdGhtOiBfLnN1bShfLm1hcChfLmZpbHRlcihhbGdvcml0aG1FcnJvcnMsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSksXG4gICAgICAgICAgICAgICAgZGF0YTogXy5zdW0oXy5tYXAoXy5maWx0ZXIoZGF0YUVycm9ycywgeyBpZDogaWQgfSksICd2YWx1ZScpKSxcbiAgICAgICAgICAgICAgICB0b3RhbDogXy5zdW0oXy5tYXAoXy5maWx0ZXIodG90YWxDb3VudCwgeyBpZDogaWQgfSksICd2YWx1ZScpKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG9iai5lcnJvclRvdGFsID0gb2JqLnN5c3RlbSArIG9iai5hbGdvcml0aG0gKyBvYmouZGF0YTtcblxuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcyh2bS5qb2JUeXBlc1BhcmFtcyk7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChqb2JUeXBlc0RhdGEpIHtcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IF8uY2xvbmVEZWVwKGpvYlR5cGVzRGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzLnB1c2goam9iVHlwZXNEYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0uam9iVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHsgbmFtZTogdm0uam9iVHlwZXNQYXJhbXMubmFtZSB9KSB8fCBqb2JUeXBlVmlld0FsbDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gam9iVHlwZXNEYXRhLmNvdW50O1xuXG4gICAgICAgICAgICAgICAgdmFyIG1ldHJpY3NQYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2U6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IHZtLnNlbGVjdGVkSm9iVHlwZS5pZCA+IDAgPyBbdm0uc2VsZWN0ZWRKb2JUeXBlLmlkXSA6IF8ubWFwKGpvYlR5cGVzLCAnaWQnKSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBbJ2Vycm9yX3N5c3RlbV9jb3VudCcsICdlcnJvcl9hbGdvcml0aG1fY291bnQnLCAnZXJyb3JfZGF0YV9jb3VudCcsICd0b3RhbF9jb3VudCddLFxuICAgICAgICAgICAgICAgICAgICBncm91cDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqb2ItdHlwZXMnXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldFBsb3REYXRhKG1ldHJpY3NQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YTMwRGF5cyA9IF8ubWFwKGRhdGEucmVzdWx0cywgJ3ZhbHVlcycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE0OEhvdXJzID0gZm9ybWF0RGF0YShkYXRhMzBEYXlzLCAyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhMjRIb3VycyA9IGZvcm1hdERhdGEoZGF0YTQ4SG91cnMsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goam9iVHlwZXMsIGZ1bmN0aW9uIChqb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucGVyZm9ybWFuY2VEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZTogSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JUeXBlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHdlbnR5Zm91cl9ob3VyczogZm9ybWF0Q29sdW1uKGRhdGEyNEhvdXJzLCBqb2JUeXBlLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ydHllaWdodF9ob3VyczogZm9ybWF0Q29sdW1uKGRhdGE0OEhvdXJzLCBqb2JUeXBlLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcnR5X2RheXM6IGZvcm1hdENvbHVtbihkYXRhMzBEYXlzLCBqb2JUeXBlLmlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBlcmZvcm1hbmNlRGF0YSA9IF8uc29ydEJ5T3JkZXIodm0ucGVyZm9ybWFuY2VEYXRhLCBbZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC50d2VudHlmb3VyX2hvdXJzLnRvdGFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC50d2VudHlmb3VyX2hvdXJzLmVycm9yVG90YWwgLyBkLnR3ZW50eWZvdXJfaG91cnMudG90YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgJ3R3ZW50eWZvdXJfaG91cnMudG90YWwnXSwgWydkZXNjJywgJ2Rlc2MnXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSB2bS5wZXJmb3JtYW5jZURhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSB2bS5wZXJmb3JtYW5jZURhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IHZtLnBlcmZvcm1hbmNlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlR5cGUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUobmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSBuZXdWYWx1ZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JUeXBlKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9ic0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICR1aWJNb2RhbCwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgc3RhdGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCB1c2VyU2VydmljZSwgam9iU2VydmljZSwgam9iRXhlY3V0aW9uU2VydmljZSwgam9iVHlwZVNlcnZpY2UsIGxvYWRTZXJ2aWNlLCBncmlkRmFjdG9yeSwgdG9hc3RyKSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgam9iVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5qb2JzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbam9iVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGUgPSB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID8gdm0uam9ic1BhcmFtcy5qb2JfdHlwZV9pZCA6IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICB2bS5qb2JTdGF0dXNWYWx1ZXMgPSBzY2FsZUNvbmZpZy5qb2JTdGF0dXM7XG4gICAgICAgIHZtLnNlbGVjdGVkSm9iU3RhdHVzID0gdm0uam9ic1BhcmFtcy5zdGF0dXMgfHwgdm0uam9iU3RhdHVzVmFsdWVzWzBdO1xuICAgICAgICB2bS5lcnJvckNhdGVnb3J5VmFsdWVzID0gXy5tYXAoc2NhbGVDb25maWcuZXJyb3JDYXRlZ29yaWVzLCAnbmFtZScpO1xuICAgICAgICB2bS5zZWxlY3RlZEVycm9yQ2F0ZWdvcnkgPSB2bS5qb2JzUGFyYW1zLmVycm9yX2NhdGVnb3J5IHx8IHZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXNbMF07XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydCA9IG1vbWVudC51dGModm0uam9ic1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLmpvYnNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uam9ic1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLmpvYnNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgIHZhciBmaWx0ZXJlZEJ5Sm9iVHlwZSA9IHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iU3RhdHVzID0gdm0uam9ic1BhcmFtcy5zdGF0dXMgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5RXJyb3JDYXRlZ29yeSA9IHZtLmpvYnNQYXJhbXMuZXJyb3JfY2F0ZWdvcnkgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSB2bS5qb2JzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlR5cGVcIiBuZy1vcHRpb25zPVwiam9iVHlwZSBhcyAoam9iVHlwZS50aXRsZSArIFxcJyBcXCcgKyBqb2JUeXBlLnZlcnNpb24pIGZvciBqb2JUeXBlIGluIGdyaWQuYXBwU2NvcGUudm0uam9iVHlwZVZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0NyZWF0ZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTGFzdCBNb2RpZmllZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZHVyYXRpb24nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDEyMCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RhdHVzJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTUwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwdWxsLXJpZ2h0XCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiBuZy1zaG93PVwiKCghZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSAmJiAhcm93LmVudGl0eS5pc19zdXBlcnNlZGVkKSAmJiAocm93LmVudGl0eS5zdGF0dXMgPT09IFxcJ0ZBSUxFRFxcJyB8fCByb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnQ0FOQ0VMRURcXCcpKVwiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5yZXF1ZXVlSm9icyh7IGpvYl9pZHM6IFtyb3cuZW50aXR5LmlkXSB9KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiIHRpdGxlPVwiUmVxdWV1ZSBKb2JcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1yZXBlYXRcIj48L2k+PC9idXR0b24+ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gbmctc2hvdz1cIiFncmlkLmFwcFNjb3BlLnZtLnJlYWRvbmx5ICYmICFyb3cuZW50aXR5LmlzX3N1cGVyc2VkZWQgJiYgcm93LmVudGl0eS5zdGF0dXMgIT09IFxcJ0NPTVBMRVRFRFxcJyAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ0FOQ0VMRURcXCdcIiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uY2FuY2VsSm9iKHJvdy5lbnRpdHkpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJDYW5jZWwgSm9iXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtYmFuXCI+PC9pPjwvYnV0dG9uPicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+IHt7IHJvdy5lbnRpdHkuc3RhdHVzIH19IDxzcGFuIHR5cGU9XCJidXR0b25cIiAgbmctaWY9XCJyb3cuZW50aXR5LmlzX3N1cGVyc2VkZWRcIiBjbGFzcz1cImxhYmVsIGxhYmVsLWluZm8gcHVsbC1yaWdodFwiIHRvb2x0aXAtYXBwZW5kLXRvLWJvZHk9XCJ0cnVlXCIgdWliLXRvb2x0aXA9XCJTdXBlcnNlZGVkXCI+Uzwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JTdGF0dXNcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlc1skaW5kZXhdIH19XCIgbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2Vycm9yLmNhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTUwLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRXJyb3IgQ2F0ZWdvcnknLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRFcnJvckNhdGVnb3J5XCI+PG9wdGlvbiBuZy1zZWxlY3RlZD1cInt7IGdyaWQuYXBwU2NvcGUudm0uZXJyb3JDYXRlZ29yeVZhbHVlc1skaW5kZXhdID09IGdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRFcnJvckNhdGVnb3J5IH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXNbJGluZGV4XSB9fVwiIG5nLXJlcGVhdD1cImVycm9yIGluIGdyaWQuYXBwU2NvcGUudm0uZXJyb3JDYXRlZ29yeVZhbHVlcyB0cmFjayBieSAkaW5kZXhcIj57eyBlcnJvci50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2Vycm9yLnRpdGxlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PGRpdiB1aWItdG9vbHRpcD1cInt7IHJvdy5lbnRpdHkuZXJyb3IuZGVzY3JpcHRpb24gfX1cIiB0b29sdGlwLWFwcGVuZC10by1ib2R5PVwidHJ1ZVwiPnt7IHJvdy5lbnRpdHkuZXJyb3IudGl0bGUgfX08L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xvZycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDYwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1jZW50ZXJcIj48YnV0dG9uIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5zaG93TG9nKHJvdy5lbnRpdHkuaWQpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCI+PGkgY2xhc3M9XCJmYSBmYS1maWxlLXRleHRcIj48L2k+PC9idXR0b24+PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdldEpvYnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldEpvYnNPbmNlKHZtLmpvYnNQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMucHVzaChkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0uam9iVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHsgaWQ6IHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgfSkgfHwgam9iVHlwZVZpZXdBbGw7XG4gICAgICAgICAgICAgICAgdm0uZ2V0Sm9icygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNob3dMb2cgPSBmdW5jdGlvbiAoam9iSWQpIHtcbiAgICAgICAgICAgIC8vIHNob3cgbG9nIG1vZGFsXG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0Sm9iRGV0YWlsKGpvYklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gZGF0YS5nZXRMYXRlc3RFeGVjdXRpb24oKTtcbiAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbkRldGFpbHModm0uam9iRXhlY3V0aW9uLmlkKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ2xvZy1tb2RhbC13aW5kb3cnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXF1ZXVlSm9icyA9IGZ1bmN0aW9uIChqb2JzUGFyYW1zKSB7XG4gICAgICAgICAgICBpZiAoIWpvYnNQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBqb2JzUGFyYW1zID0gdm0uam9ic1BhcmFtcyA/IHZtLmpvYnNQYXJhbXMgOiB7IHN0YXJ0ZWQ6IHZtLmxhc3RNb2RpZmllZFN0YXJ0LnRvSVNPU3RyaW5nKCksIGVuZGVkOiB2bS5sYXN0TW9kaWZpZWRTdG9wLnRvSVNPU3RyaW5nKCkgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5yZXF1ZXVlSm9icyhqb2JzUGFyYW1zKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnUmVxdWV1ZSBTdWNjZXNzZnVsJyk7XG4gICAgICAgICAgICAgICAgdm0uZ2V0Sm9icygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKCdSZXF1ZXVlIHJlcXVlc3QgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2FuY2VsSm9iID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFN0YXR1cyA9IGpvYi5zdGF0dXM7XG4gICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTCc7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLnVwZGF0ZUpvYihqb2IuaWQsIHsgc3RhdHVzOiAnQ0FOQ0VMRUQnIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdKb2IgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTEVEJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgam9iLnN0YXR1cyA9IG9yaWdpbmFsU3RhdHVzO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXModm0uam9ic1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldEpvYnMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5qb2JzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgPSB2YWx1ZS5pZCA9PT0gMCA/IG51bGwgOiB2YWx1ZS5pZDtcbiAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZV9zaXplID0gdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZtLmpvYnNQYXJhbXMuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMuc3RhdHVzID0gdmFsdWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWU7XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVFcnJvckNhdGVnb3J5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gdm0uam9ic1BhcmFtcy5lcnJvcl9jYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLmVycm9yX2NhdGVnb3J5ID0gdmFsdWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWU7XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uYWN0aW9uQ2xpY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzL2pvYi8nICsgcm93LmVudGl0eS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuY29yZS5vbi5zb3J0Q2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChncmlkLCBzb3J0Q29sdW1ucykge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb2wuY29sRGVmLnNvcnQgPSBjb2wuc29ydDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic1BhcmFtcyh2bS5qb2JzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIHZtLmdldEpvYlR5cGVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSm9iVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHtpZDogcGFyc2VJbnQodmFsdWUpfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSAhYW5ndWxhci5lcXVhbHModmFsdWUsIGpvYlR5cGVWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlN0YXR1cycsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHZhbHVlICE9PSAnVklFVyBBTEwnO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkRXJyb3JDYXRlZ29yeScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUVycm9yQ2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlRXJyb3JDYXRlZ29yeSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5RXJyb3JDYXRlZ29yeSA9IHZhbHVlICE9PSAnVklFVyBBTEwnO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUVycm9yQ2F0ZWdvcnkodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRKb2JzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Sm9ic1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2pvYkV4ZWN1dGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHBvbGxlciwgc2NhbGVDb25maWcsIEpvYkV4ZWN1dGlvbiwgSm9iRXhlY3V0aW9uTG9nKSB7XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cywgam9iX3R5cGVfaWQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX2NhdGVnb3J5LCBub2RlX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lOiBqb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3J5OiBqb2JfdHlwZV9jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBub2RlX2lkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25zOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JFeGVjdXRpb24udHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25EZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TG9nT25jZTogZnVuY3Rpb24oZXhlY0lkKXtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycgKyBleGVjSWQgKyAnL2xvZ3MvY29tYmluZWQvJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRMb2c6IGZ1bmN0aW9uKGV4ZWNJZCl7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHVybCB8fCBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi1leGVjdXRpb25zJykgKyAnam9iLWV4ZWN1dGlvbnMvJyArIGV4ZWNJZCArICcvbG9ncy9jb21iaW5lZC8nO1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHZpZXcuIFNpbmNlIGEgcHJvbWlzZSBjYW4gb25seSBiZSByZXNvbHZlZCBvciByZWplY3RlZCBvbmNlIGJ1dCB3ZSB3YW50XG4gICAgICAgICAgICAgICAgLy8gdG8ga2VlcCB0cmFjayBvZiBhbGwgcmVxdWVzdHMsIHBvbGxlciBzZXJ2aWNlIHVzZXMgdGhlIG5vdGlmeUNhbGxiYWNrLiBCeSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgLy8gcG9sbGVyIG9ubHkgZ2V0cyBub3RpZmllZCBvZiBzdWNjZXNzIHJlc3BvbnNlcy5cbiAgICAgICAgICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUmVzb3VyY2UgPSAkcmVzb3VyY2UodXJsLHt9LHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0OntcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDonR0VUJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUG9sbGVyID0gcG9sbGVyLmdldChqb2JFeGVjdXRpb25Mb2dSZXNvdXJjZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYkV4ZWN1dGlvbkxvZ1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JFeGVjdXRpb25Mb2dQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LiRyZXNvbHZlZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXhlY3V0aW9uX2xvZyA9IEpvYkV4ZWN1dGlvbkxvZy50cmFuc2Zvcm1lcihyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmV4ZWN1dGlvbl9sb2cuc3RhdHVzID09PSAnQ09NUExFVEVEJyB8fCByZXN1bHQuZXhlY3V0aW9uX2xvZy5zdGF0dXMgPT09ICdGQUlMRUQnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25Mb2dQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2pvYlNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcsIEpvYiwgSm9iRGV0YWlscywgUnVubmluZ0pvYiwgcG9sbGVyLCBwb2xsZXJGYWN0b3J5KSB7XG5cbiAgICAgICAgdmFyIGdldEpvYnNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cywgam9iX3R5cGVfaWQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX2NhdGVnb3J5LCB1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGpvYl90eXBlX2lkLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX25hbWU6IGpvYl90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcnk6IGpvYl90eXBlX2NhdGVnb3J5LFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JVcGRhdGVEYXRhID0gZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1c1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Sm9iczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2JzJykgKyAnam9icy8nO1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYnNSZXNvdXJjZSA9ICRyZXNvdXJjZShwYXJhbXMudXJsLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9ic1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYnMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYnNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2JzJykgKyAnam9icy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JDb3VudHNCeVN0YXR1czogZnVuY3Rpb24gKGhvdXIpIHtcbiAgICAgICAgICAgICAgICBob3VyID0gaG91ciB8fCAzO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmdldEpvYkNvdW50c0J5U3RhdHVzKGhvdXIpKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9icycpICsgJ2pvYnMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShKb2JEZXRhaWxzLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UnVubmluZ0pvYnM6IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHJ1bm5pbmdKb2JzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvcnVubmluZy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBydW5uaW5nSm9ic1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKHJ1bm5pbmdKb2JzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMucnVubmluZ0pvYnMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ1bm5pbmdKb2JzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJ1bm5pbmdKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bm5pbmdKb2JzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSdW5uaW5nSm9ic09uY2U6IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzL3J1bm5pbmcvJywgcGFyYW1zKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJ1bm5pbmdKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVKb2I6IGZ1bmN0aW9uIChpZCwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIHx8IGdldEpvYlVwZGF0ZURhdGEoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2JzJykgKyAnam9icy8nICsgaWQgKyAnLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2pvYlR5cGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBwb2xsZXIsIHBvbGxlckZhY3RvcnksIHNjYWxlQ29uZmlnLCBqb2JTZXJ2aWNlLCBKb2JUeXBlLCBKb2JUeXBlRGV0YWlscywgSm9iVHlwZVN0YXR1cykge1xuICAgICAgICAvKnZhciB0b3RhbEpvYlR5cGVzID0gNTtcblxuICAgICAgICB2YXIgZ2V0VG90YWxKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0b3RhbEpvYlR5cGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXRUb3RhbEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdG90YWxKb2JUeXBlcyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyMCAtIDEgKyAxKSkgKyAxO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNldFRvdGFsSm9iVHlwZXMoKTtcbiAgICAgICAgfSwgMzEwMCk7Ki9cblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZVBhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBuYW1lLCBjYXRlZ29yeSwgb3JkZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSA/IHBhZ2Vfc2l6ZSA6IDEwMDAsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyID8gb3JkZXIgOiBbJ3RpdGxlJywgJ3ZlcnNpb24nXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZVN0YXR1c1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUgPyBwYWdlX3NpemUgOiAxMDAwLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JUeXBlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JUeXBlUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgLy8gdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAvLyAgICAgb3JkZXI6IG9yZGVyIHx8IFsnbmFtZScsJ3ZlcnNpb24nXVxuICAgICAgICAgICAgICAgIC8vIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iVHlwZXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlc1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKGpvYlR5cGVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iVHlwZXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qdmFyIHJldHVyblJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVzb2x2ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3R5cGVzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZ2V0VG90YWxKb2JUeXBlcygpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQuam9iX3R5cGVzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfc3lzdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhdXNlZFwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkaXNrXCI6IDY0LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRvY2tlcl9pbWFnZVwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmNoaXZlZFwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VzX2RvY2tlclwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJpb3JpdHlcIjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZlcnNpb25cIjogXCIxLjBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvbl9jb2RlXCI6IHNjYWxlQ29uZmlnLmpvYlR5cGVzW2kgLSAxXS5jb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIkluZ2VzdHMgYSBzb3VyY2UgZmlsZSBpbnRvIGEgd29ya3NwYWNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lbVwiOiA2NC4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19hY3RpdmVcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3B1c1wiOiAxLjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RfbW9kaWZpZWRcIjogXCIyMDE1LTAzLTExVDAwOjAwOjAwWlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtYXhfdHJpZXNcIjogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfcGF1c2VkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IHNjYWxlQ29uZmlnLmpvYlR5cGVzW2kgLSAxXS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZFwiOiBcIjIwMTUtMDMtMTFUMDA6MDA6MDBaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpbWVvdXRcIjogMTgwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfbG9uZ19ydW5uaW5nXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXR1cm5SZXN1bHQ7Ki9cblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JUeXBlc1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JUeXBlUGFyYW1zKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYlR5cGUudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JUeXBlU3RhdHVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVTdGF0dXNQYXJhbXMoKTtcblxuICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlU3RhdHVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvc3RhdHVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYlR5cGVTdGF0dXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JUeXBlU3RhdHVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iVHlwZVN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iVHlwZVN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKnZhciByZXR1cm5kYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9zdGF0czogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdldFRvdGFsSm9iVHlwZXMoKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuZGF0YS5qb2JfdHlwZV9zdGF0cy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImljb25fY29kZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZlcnNpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2NvbXBsZXRlZFwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjAwMDAgLSAxMDAwMCArIDEpKSArIDEwMDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fY2FuY2VsZWRcIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMCAtIDIwICsgMSkpICsgMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9lcnJvcl9EQVRBXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5MDAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2Vycm9yX1NZU1RFTVwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOTAwMCAtIDIwICsgMSkpICsgMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9lcnJvcl9BTEdPUklUSE1cIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkwMDAgLSAyMCArIDEpKSArIDIwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gcmV0dXJuZGF0YTsqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JUeXBlU3RhdHVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JUeXBlU3RhdHVzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JUeXBlU3RhdHVzUGFyYW1zKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvc3RhdHVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZURldGFpbHM6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShKb2JUeXBlRGV0YWlscy50cmFuc2Zvcm1lcihkYXRhKSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUpvYlR5cGU6IGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlZEpvYlR5cGUgPSBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21hcHBpbmdzOiBkYXRhLmVycm9yX21hcHBpbmdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNfcGF1c2VkOiBkYXRhLmlzX3BhdXNlZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWREYXRhID0gdXBkYXRlZEpvYlR5cGUoZGF0YSk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzLycgKyBkYXRhLmlkICsgJy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHVwZGF0ZWREYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShKb2JUeXBlRGV0YWlscy50cmFuc2Zvcm1lcihyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbG9hZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGxvYWRTZXJ2aWNlLCB1aUdyaWRDb25zdGFudHMsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlLCBRdWV1ZVN0YXR1cywgZ3JpZEZhY3RvcnkpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgdm0ucXVldWVTdGF0dXNFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLnRvdGFsUXVldWVkID0gMDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5sb2FkO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdsb2FkL3F1ZXVlZCcpO1xuICAgICAgICBcbiAgICAgICAgdmFyIGpvYnNQYXJhbXMgPSBzdGF0ZVNlcnZpY2UuZ2V0Sm9ic1BhcmFtcygpO1xuXG4gICAgICAgIHZtLmdldFBhZ2UgPSBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgbG9hZFNlcnZpY2UuZ2V0UXVldWVTdGF0dXMocGFnZU51bWJlciAtIDEsIHBhZ2VTaXplKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0RhdGEucHVzaChkYXRhLmpvYnNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gbmV3RGF0YS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBuZXdEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gbmV3RGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHZtLnN0YXR1cyA9ICdVbmFibGUgdG8gbG9hZCBxdWV1ZSBzdGF0dXM6ICcgKyBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3Iodm0uc3RhdHVzKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmVuYWJsZVNvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2pvYl90eXBlLnRpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LmpvYl90eXBlLmdldEljb24oKVwiPjwvc3Bhbj4ge3sgcm93LmVudGl0eS5qb2JfdHlwZS50aXRsZSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdqb2JfdHlwZS52ZXJzaW9uJywgZGlzcGxheU5hbWU6ICdWZXJzaW9uJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdoaWdoZXN0X3ByaW9yaXR5JywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdsb25nZXN0UXVldWVkJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEdXJhdGlvbiBvZiBMb25nZXN0IFF1ZXVlZCBKb2InLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnY291bnQnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAgICAgZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXMoe2pvYl90eXBlX2lkOiByb3cuZW50aXR5LmpvYl90eXBlLmlkLCBzdGF0dXM6ICdRVUVVRUQnLCBwYWdlOiBqb2JzUGFyYW1zLnBhZ2UsIHBhZ2Vfc2l6ZTogam9ic1BhcmFtcy5wYWdlX3NpemUsIG9yZGVyOiBqb2JzUGFyYW1zLm9yZGVyfSk7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRBcGkucGFnaW5hdGlvbi5vbi5wYWdpbmF0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChjdXJyZW50UGFnZSwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ2V0UGFnZShjdXJyZW50UGFnZSwgcGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRRdWV1ZVN0YXR1cygwLCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSByZXN1bHQucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gcmVzdWx0LnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gcmVzdWx0LnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSByZXN1bHQucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsUXVldWVkID0gXy5zdW0ocmVzdWx0LnJlc3VsdHMsICdjb3VudCcpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncXVldWUgc3RhdHVzIHVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c1RleHQgJiYgcmVzdWx0LnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yU3RhdHVzID0gcmVzdWx0LnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0ucXVldWVTdGF0dXNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgcXVldWUgc3RhdHVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2xvYWQnKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbG9hZERlcHRoQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgbmF2U2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MubG9hZDtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnbG9hZC9kZXB0aCcpO1xuXG4gICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2xvYWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdxdWV1ZVJ1bm5pbmdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIHNjYWxlU2VydmljZSwgc3RhdGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBqb2JTZXJ2aWNlLCBncmlkRmFjdG9yeSwgdWlHcmlkQ29uc3RhbnRzLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5ydW5uaW5nSm9ic0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0udG90YWxSdW5uaW5nID0gMDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5sb2FkO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdsb2FkL3J1bm5pbmcnKTtcblxuICAgICAgICB2YXIgam9ic1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uZ2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSl7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0UnVubmluZ0pvYnNPbmNlKHBhZ2VOdW1iZXIgLSAxLCBwYWdlU2l6ZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gW107XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGRhdGEucmVzdWx0c1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBuZXdEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IG5ld0RhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBuZXdEYXRhO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0uc3RhdHVzID0gJ1VuYWJsZSB0byBsb2FkIHF1ZXVlIHJ1bm5pbmcgc3RhdHVzOiAnICsgZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHZtLnN0YXR1cyk7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5lbmFibGVTb3J0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICd0aXRsZScsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudGl0bGUgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7ZmllbGQ6ICdqb2JfdHlwZS52ZXJzaW9uJywgZGlzcGxheU5hbWU6ICdWZXJzaW9uJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZX0sXG4gICAgICAgICAgICAgICAge2ZpZWxkOiAnY291bnQnLCBkaXNwbGF5TmFtZTogJ051bWJlciBvZiBKb2JzJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZX0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2xvbmdlc3RSdW5uaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEdXJhdGlvbiBvZiBMb25nZXN0IFJ1bm5pbmcgSm9iJyxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyB0ZXh0LXJpZ2h0XCI+e3sgcm93LmVudGl0eS5nZXREdXJhdGlvbigpIH19PC9kaXY+J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICAgICAvLyBzZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgICAgIGdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JzUGFyYW1zKHtqb2JfdHlwZV9pZDogcm93LmVudGl0eS5qb2JfdHlwZS5pZCwgc3RhdHVzOiAnUlVOTklORycsIHBhZ2U6IGpvYnNQYXJhbXMucGFnZSwgcGFnZV9zaXplOiBqb2JzUGFyYW1zLnBhZ2Vfc2l6ZSwgb3JkZXI6IGpvYnNQYXJhbXMub3JkZXJ9KTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5nZXRQYWdlKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldFJ1bm5pbmdKb2JzKDAsIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0udG90YWxSdW5uaW5nID0gXy5zdW0oZGF0YS5yZXN1bHRzLCAnY291bnQnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3J1bm5pbmcgam9icyB1cGRhdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5ydW5uaW5nSm9ic0Vycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIHJ1bm5pbmcgam9icy4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2xvYWQnKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUXVldWVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgSm9iVHlwZSkge1xuICAgICAgICB2YXIgUXVldWVTdGF0dXMgPSBmdW5jdGlvbiAoam9iX3R5cGUsIGNvdW50LCBsb25nZXN0X3F1ZXVlZCwgaGlnaGVzdF9wcmlvcml0eSkge1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgdGhpcy5sb25nZXN0X3F1ZXVlZCA9IGxvbmdlc3RfcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5oaWdoZXN0X3ByaW9yaXR5ID0gaGlnaGVzdF9wcmlvcml0eTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBRdWV1ZVN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuam9iX3R5cGUuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMubG9uZ2VzdF9xdWV1ZWQsIG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUXVldWVTdGF0dXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFF1ZXVlU3RhdHVzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxvbmdlc3RfcXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmhpZ2hlc3RfcHJpb3JpdHlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWV1ZVN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFF1ZXVlU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFF1ZXVlU3RhdHVzLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBRdWV1ZVN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUXVldWVTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdsb2FkU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgcG9sbGVyLCBwb2xsZXJGYWN0b3J5LCBRdWV1ZVN0YXR1cykge1xuICAgICAgICB2YXIgZ2V0Sm9iTG9hZFBhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgc3RhdHVzLCBqb2JfdHlwZV9pZCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfY2F0ZWdvcnksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iX3R5cGVfaWQsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogam9iX3R5cGVfY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiAxMDAwLFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZXF1ZXVlSm9ic1BhcmFtcyA9IGZ1bmN0aW9uIChzdGFydGVkLCBlbmRlZCwgam9iX3N0YXR1cywgam9iX3R5cGVfaWRzLCBqb2JfdHlwZV9uYW1lcywgam9iX3R5cGVfY2F0ZWdvcmllcywgcHJpb3JpdHksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzOiBqb2Jfc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpvYl9pZHM6IGpvYl9pZHMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWRzOiBqb2JfdHlwZV9pZHMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZXM6IGpvYl90eXBlX25hbWVzLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3JpZXM6IGpvYl90eXBlX2NhdGVnb3JpZXMsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5LFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRRdWV1ZVN0YXR1czogZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZV9udW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZVNpemVcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXVlU3RhdHVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdxdWV1ZScpICsgJ3F1ZXVlL3N0YXR1cy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZVN0YXR1c1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKHF1ZXVlU3RhdHVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMucXVldWVTdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXVlU3RhdHVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVzdWx0cyA9IFF1ZXVlU3RhdHVzLnRyYW5zZm9ybWVyKHJlc3VsdC5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlU3RhdHVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFF1ZXVlU3RhdHVzT25jZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3F1ZXVlJykgKyAncXVldWUvc3RhdHVzLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUXVldWVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcXVldWVKb2JzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFJlcXVldWVKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdxdWV1ZScpICsgJ3F1ZXVlL3JlcXVldWUtam9icy8nO1xuXG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChwYXJhbXMudXJsLCBwYXJhbXMpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iTG9hZDogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JMb2FkUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdsb2FkJykgKyAnbG9hZC8nO1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYkxvYWRSZXNvdXJjZSA9ICRyZXNvdXJjZShwYXJhbXMudXJsLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JMb2FkUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9iTG9hZFJlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYkxvYWQpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYkxvYWRQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkxvYWRQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYkxvYWRPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkxvYWRQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2xvYWQnKSArICdsb2FkLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iRXhlY3V0aW9uTG9nQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJGVsZW1lbnQsICR0aW1lb3V0LCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5mb3JjZVNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICB2bS5qb2JMb2dFcnJvciA9IG51bGw7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2V4ZWN1dGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmV4ZWN1dGlvbikge1xuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXMgPSAkc2NvcGUuZXhlY3V0aW9uLnN0YXR1cy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZXhlY3V0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgam9iRXhlY3V0aW9uU2VydmljZS5nZXRMb2coJHNjb3BlLmV4ZWN1dGlvbi5pZCkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZGlmZmVyZW5jZSBvZiBtYXggc2Nyb2xsIGxlbmd0aCBhbmQgY3VycmVudCBzY3JvbGwgbGVuZ3RoLnZhciAgPSByZXN1bHQuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGl2ID0gJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zY3JvbGxEaWZmID0gKGRpdi5zY3JvbGxUb3AoKSArIGRpdi5wcm9wKCdvZmZzZXRIZWlnaHQnKSkgLSBkaXYucHJvcCgnc2Nyb2xsSGVpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnNjcm9sbERpZmYgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5mb3JjZVNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmV4ZWNMb2cgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzVGV4dCAmJiByZXN1bHQuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uam9iTG9nRXJyb3JTdGF0dXMgPSByZXN1bHQuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmpvYkxvZ0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBqb2IgbG9ncy4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmV4ZWNMb2cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmV4ZWNMb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmZvcmNlU2Nyb2xsIHx8IHZtLnNjcm9sbERpZmYgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZvcmNlU2Nyb2xsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjcmxIZWlnaHQgPSAkKCRlbGVtZW50WzBdKS5maW5kKCcuYmFzaCcpLnByb3AoJ3Njcm9sbEhlaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJGVsZW1lbnRbMF0pLmZpbmQoJy5iYXNoJykuc2Nyb2xsVG9wKHNjcmxIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2Nyb2xsaXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpdGVtKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zdGRvdXRDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0ZG91dCBjaGFuZ2VkLicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgIH0pLmRpcmVjdGl2ZSgnam9iRXhlY3V0aW9uTG9nJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbkxvZ0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvZGlyZWN0aXZlcy9qb2JFeGVjdXRpb25Mb2dUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGV4ZWN1dGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNKb2JIZWFsdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgam9iVHlwZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmdKb2JIZWFsdGggPSB0cnVlO1xuICAgICAgICB2bS5qb2JIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLmpvYkhlYWx0aEVycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0uam9iSGVhbHRoID0ge307XG5cbiAgICAgICAgdmFyIGdldEpvYlR5cGVTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlU3RhdHVzKHtcbiAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiAkc2NvcGUuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgZW5kZWQ6IG51bGxcbiAgICAgICAgICAgIH0pLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uam9iSGVhbHRoRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2bS5qb2JUeXBlU3RhdHVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICB2bS50b3RhbCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZtLmZhaWxlZCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmZvcm1hbmNlID0ge30sXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLnJlc3VsdHMsIGZ1bmN0aW9uIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlID0gc3RhdHVzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS50b3RhbCA9IHZtLnRvdGFsICsgcGVyZm9ybWFuY2UudG90YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5mYWlsZWQgPSB2bS5mYWlsZWQgKyBwZXJmb3JtYW5jZS5mYWlsZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcy5wdXNoKHN0YXR1cy5nZXRGYWlsdXJlcygpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVEYXRhID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW1GYWlsdXJlcyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhRmFpbHVyZXMgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxnb3JpdGhtRmFpbHVyZXMgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmYWlsdXJlcywgZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmLCBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLnN0YXR1cyA9PT0gJ1NZU1RFTScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtRmFpbHVyZXMgPSBzeXN0ZW1GYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlLnN0YXR1cyA9PT0gJ0RBVEEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFGYWlsdXJlcyA9IGRhdGFGYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlLnN0YXR1cyA9PT0gJ0FMR09SSVRITScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxnb3JpdGhtRmFpbHVyZXMgPSBhbGdvcml0aG1GYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1GYWlsdXJlcyA+IDAgfHwgZGF0YUZhaWx1cmVzID4gMCB8fCBhbGdvcml0aG1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnU1lTVEVNJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHN5c3RlbUZhaWx1cmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxnb3JpdGhtRmFpbHVyZXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbHVyZURhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ0FMR09SSVRITScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBhbGdvcml0aG1GYWlsdXJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFGYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnREFUQScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBkYXRhRmFpbHVyZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkhlYWx0aCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdWdlRGF0YTogdm0udG90YWwgPT09IDAgPyAwIDogMTAwIC0gKCh2bS5mYWlsZWQgLyB2bS50b3RhbCkgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgICAgICBkb251dERhdGE6IGZhaWx1cmVEYXRhXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5icm9hZGNhc3REYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2pvYlR5cGVTdGF0dXMnLCB2bS5qb2JUeXBlU3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uam9iSGVhbHRoRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0uam9iSGVhbHRoRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIGpvYiBzdGF0aXN0aWNzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JIZWFsdGggPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGdldEpvYlR5cGVTdGF0dXMoKTtcbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc0pvYkhlYWx0aCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1qb2ItaGVhbHRoIC8+XG4gICAgICAgICAqKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNKb2JIZWFsdGhDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL2RpcmVjdGl2ZXMvam9iSGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgIGJyb2FkY2FzdERhdGE6ICc9JywgLy8gc2V0IHRvIHRydWUgd2hlbiB1c2luZyBhbm90aGVyIHdpZGdldCBpbiB0aGUgc2FtZSB2aWV3IHRoYXQgYWxzbyBjYWxscyBnZXRKb2JUeXBlU3RhdHVzXG4gICAgICAgICAgICAgICAgc2hvd0Rlc2NyaXB0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdqb2JUeXBlSW50ZXJmYWNlRGlyZWN0aXZlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsIGpvYlR5cGVTZXJ2aWNlKSB7XG5cbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc0pvYlR5cGVJbnRlcmZhY2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtam9iLWhlYWx0aCAvPlxuICAgICAgICAgKiovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZUludGVyZmFjZURpcmVjdGl2ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvZGlyZWN0aXZlcy9qb2JUeXBlSW50ZXJmYWNlVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBqb2JUeXBlSW50ZXJmYWNlOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iVHlwZSwgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBKb2IgPSBmdW5jdGlvbiAoaWQsIGpvYl90eXBlLCBqb2JfdHlwZV9yZXYsIGV2ZW50LCBlcnJvciwgc3RhdHVzLCBwcmlvcml0eSwgbnVtX2V4ZXMsIHRpbWVvdXQsIG1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfaW5fcmVxdWlyZWQsIGRpc2tfb3V0X3JlcXVpcmVkLCBjcmVhdGVkLCBxdWV1ZWQsIHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kZWQsIGxhc3Rfc3RhdHVzX2NoYW5nZSwgbGFzdF9tb2RpZmllZCwgaXNfc3VwZXJzZWRlZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9yZXYgPSBqb2JfdHlwZV9yZXY7XG4gICAgICAgICAgICB0aGlzLmV2ZW50ID0gZXZlbnQ7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMubnVtX2V4ZXMgPSBudW1fZXhlcztcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgICAgICB0aGlzLm1heF90cmllcyA9IG1heF90cmllcztcbiAgICAgICAgICAgIHRoaXMuY3B1c19yZXF1aXJlZCA9IGNwdXNfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9yZXF1aXJlZCA9IG1lbV9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19pbl9yZXF1aXJlZCA9IGRpc2tfaW5fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X3JlcXVpcmVkID0gZGlza19vdXRfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWQgPSBxdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSBzdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X3N0YXR1c19jaGFuZ2UgPSBsYXN0X3N0YXR1c19jaGFuZ2U7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5pc19zdXBlcnNlZGVkID0gaXNfc3VwZXJzZWRlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2IucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGVuZCA9IHRoaXMuZW5kZWQgPyB0aGlzLmVuZGVkIDogbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbihzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfcmV2LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV2ZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5udW1fZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX2luX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfc3VwZXJzZWRlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2IuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2I7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JEZXRhaWxFdmVudCcsIGZ1bmN0aW9uIChKb2JEZXRhaWxFdmVudFJ1bGUpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbEV2ZW50ID0gZnVuY3Rpb24gKGlkLCB0eXBlLCBydWxlLCBvY2N1cnJlZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMucnVsZSA9IEpvYkRldGFpbEV2ZW50UnVsZS50cmFuc2Zvcm1lcihydWxlKTtcbiAgICAgICAgICAgIHRoaXMub2NjdXJyZWQgPSBvY2N1cnJlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxFdmVudC5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlsRXZlbnQuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbEV2ZW50KFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucnVsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5vY2N1cnJlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbEV2ZW50KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlsRXZlbnQudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsRXZlbnQuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlsRXZlbnQuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsRXZlbnRSdWxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgSm9iRGV0YWlsRXZlbnRSdWxlID0gZnVuY3Rpb24gKGlkLCB0eXBlLCBpc19hY3RpdmUsIGNyZWF0ZWQsIGFyY2hpdmVkLCBsYXN0X21vZGlmaWVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxFdmVudFJ1bGUucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbEV2ZW50UnVsZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsRXZlbnRSdWxlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbEV2ZW50UnVsZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbEV2ZW50UnVsZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JEZXRhaWxFdmVudFJ1bGUuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlsRXZlbnRSdWxlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxFdmVudFJ1bGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JEZXRhaWxJbnB1dERhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxJbnB1dERhdGEgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUsIGZpbGVfaWQsIGZpbGVfaWRzLCBmaWxlcykge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9pZCA9IGZpbGVfaWQ7XG4gICAgICAgICAgICB0aGlzLmZpbGVfaWRzID0gZmlsZV9pZHM7XG4gICAgICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsSW5wdXREYXRhLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbGVfaWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVfaWQ7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZmlsZV9pZHMpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVfaWRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxJbnB1dERhdGEuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbElucHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9pZHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxJbnB1dERhdGEoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxJbnB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsSW5wdXREYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbElucHV0RGF0YS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlsSW5wdXREYXRhO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsT3V0cHV0RGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbE91dHB1dERhdGEgPSBmdW5jdGlvbiAobmFtZSwgd29ya3NwYWNlX2lkLCBmaWxlcykge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlX2lkID0gd29ya3NwYWNlX2lkO1xuICAgICAgICAgICAgdGhpcy5maWxlcyA9IGZpbGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbE91dHB1dERhdGEucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbE91dHB1dERhdGEuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbE91dHB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS53b3Jrc3BhY2VfaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxPdXRwdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JEZXRhaWxPdXRwdXREYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbE91dHB1dERhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbE91dHB1dERhdGE7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JEZXRhaWxzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBKb2JFeGVjdXRpb24sIFByb2R1Y3QsIEpvYkRldGFpbElucHV0RGF0YSwgSm9iRGV0YWlsT3V0cHV0RGF0YSwgUmVjaXBlLCBKb2JEZXRhaWxFdmVudCwgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxzID0gZnVuY3Rpb24gKGlkLCBqb2JfdHlwZSwgam9iX3R5cGVfcmV2LCBldmVudCwgZXJyb3IsIHN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHksIG51bV9leGVzLCB0aW1lb3V0LCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlza19pbl9yZXF1aXJlZCwgZGlza19vdXRfcmVxdWlyZWQsIGNyZWF0ZWQsIHF1ZXVlZCwgc3RhcnRlZCwgZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3Rfc3RhdHVzX2NoYW5nZSwgbGFzdF9tb2RpZmllZCwgZGF0YSwgcmVzdWx0cywgcmVjaXBlcywgam9iX2V4ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0cywgb3V0cHV0cywgaXNfc3VwZXJzZWRlZCwgcm9vdF9zdXBlcnNlZGVkX2pvYiwgc3VwZXJzZWRlZF9qb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyc2VkZWRfYnlfam9iLCBzdXBlcnNlZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX3JldiA9IGpvYl90eXBlX3JldjtcbiAgICAgICAgICAgIHRoaXMuZXZlbnQgPSBKb2JEZXRhaWxFdmVudC50cmFuc2Zvcm1lcihldmVudCk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMubnVtX2V4ZXMgPSBudW1fZXhlcztcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgICAgICB0aGlzLm1heF90cmllcyA9IG1heF90cmllcztcbiAgICAgICAgICAgIHRoaXMuY3B1c19yZXF1aXJlZCA9IGNwdXNfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9yZXF1aXJlZCA9IG1lbV9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19pbl9yZXF1aXJlZCA9IGRpc2tfaW5fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X3JlcXVpcmVkID0gZGlza19vdXRfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhxdWV1ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Yyk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSBzdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoc3RhcnRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhlbmRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9zdGF0dXNfY2hhbmdlID0gbGFzdF9zdGF0dXNfY2hhbmdlO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhOiBKb2JEZXRhaWxJbnB1dERhdGEudHJhbnNmb3JtZXIoZGF0YS5pbnB1dF9kYXRhKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgb3V0cHV0X2RhdGE6IEpvYkRldGFpbE91dHB1dERhdGEudHJhbnNmb3JtZXIoZGF0YS5vdXRwdXRfZGF0YSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0X2RhdGE6IEpvYkRldGFpbE91dHB1dERhdGEudHJhbnNmb3JtZXIocmVzdWx0cy5vdXRwdXRfZGF0YSksXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogcmVzdWx0cy52ZXJzaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVzID0gXy5zb3J0QnkoUmVjaXBlLnRyYW5zZm9ybWVyKHJlY2lwZXMpLCBbJ2NyZWF0ZWQnXSkucmV2ZXJzZSgpO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlcyA9IEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lcihqb2JfZXhlcyk7XG4gICAgICAgICAgICB0aGlzLmlucHV0cyA9IGlucHV0cztcbiAgICAgICAgICAgIHRoaXMub3V0cHV0cyA9IG91dHB1dHM7XG4gICAgICAgICAgICB0aGlzLmlzX3N1cGVyc2VkZWQgPSBpc19zdXBlcnNlZGVkO1xuICAgICAgICAgICAgdGhpcy5yb290X3N1cGVyc2VkZWRfam9iID0gcm9vdF9zdXBlcnNlZGVkX2pvYjtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZF9qb2IgPSBzdXBlcnNlZGVkX2pvYjtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZF9ieV9qb2IgPSBzdXBlcnNlZGVkX2J5X2pvYjtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZCA9IHN1cGVyc2VkZWQ7XG4gICAgICAgICAgICB0aGlzLnN1cGVyc2VkZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhzdXBlcnNlZGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpOztcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbHMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGVuZCA9IHRoaXMuZW5kZWQgPyB0aGlzLmVuZGVkIDogbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldExhdGVzdEV4ZWN1dGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5udW1fZXhlcyA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmpvYl9leGVzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTdGF0dXNDbGFzczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAvLyBpZih0aGlzLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcpe1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJ2xhYmVsLXN1Y2Nlc3MnO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICAvLyBlbHNlIGlmKCB0aGlzLnN0YXR1cyA9PT0gJ0ZBSUxFRCcpe1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJ2xhYmVsLWRlZmF1bHQnOy8vICAgIHJldHVybiAnbGFiZWwtZGFuZ2VyJztcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgLy8gZWxzZXtcbiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICdsYWJlbC1kZWZhdWx0JztcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdHVzLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbHMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbHMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfcmV2LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV2ZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5udW1fZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX2luX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2V4ZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW5wdXRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm91dHB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfc3VwZXJzZWRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yb290X3N1cGVyc2VkZWRfam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN1cGVyc2VkZWRfam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN1cGVyc2VkZWRfYnlfam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN1cGVyc2VkZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlscy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JEZXRhaWxzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbHMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbHM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JFeGVjdXRpb24nLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYiwgTm9kZSwgbW9tZW50KSB7XG4gICAgICAgIHZhciBKb2JFeGVjdXRpb24gPSBmdW5jdGlvbiAoaWQsIHN0YXR1cywgY29tbWFuZF9hcmd1bWVudHMsIHRpbWVvdXQsIHByZV9zdGFydGVkLCBwcmVfY29tcGxldGVkLCBwcmVfZXhpdF9jb2RlLCBqb2Jfc3RhcnRlZCwgam9iX2NvbXBsZXRlZCwgam9iX2V4aXRfY29kZSwgcG9zdF9zdGFydGVkLCBwb3N0X2NvbXBsZXRlZCwgcG9zdF9leGl0X2NvZGUsIGNyZWF0ZWQsIHF1ZXVlZCwgc3RhcnRlZCwgZW5kZWQsIGxhc3RfbW9kaWZpZWQsIGpvYiwgbm9kZSwgZXJyb3IsIGVudmlyb25tZW50LCBjcHVzX3NjaGVkdWxlZCwgbWVtX3NjaGVkdWxlZCwgZGlza19pbl9zY2hlZHVsZWQsIGRpc2tfb3V0X3NjaGVkdWxlZCwgZGlza190b3RhbF9zY2hlZHVsZWQsIHJlc3VsdHMsIGN1cnJlbnRfc3Rkb3V0X3VybCwgY3VycmVudF9zdGRlcnJfdXJsLCByZXN1bHRzX21hbmlmZXN0KSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZF9hcmd1bWVudHMgPSBjb21tYW5kX2FyZ3VtZW50cztcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgICAgICB0aGlzLnByZV9zdGFydGVkID0gcHJlX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9jb21wbGV0ZWQgPSBwcmVfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5wcmVfZXhpdF9jb2RlID0gcHJlX2V4aXRfY29kZTtcbiAgICAgICAgICAgIHRoaXMuam9iX3N0YXJ0ZWQgPSBqb2Jfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvbXBsZXRlZCA9IGpvYl9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGl0X2NvZGUgPSBqb2JfZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5wb3N0X3N0YXJ0ZWQgPSBwb3N0X3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnBvc3RfY29tcGxldGVkID0gcG9zdF9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnBvc3RfZXhpdF9jb2RlID0gcG9zdF9leGl0X2NvZGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IGNyZWF0ZWQgPyBtb21lbnQudXRjKGNyZWF0ZWQpLnRvSVNPU3RyaW5nKCkgOiBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWQgPSBxdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZF9mb3JtYXR0ZWQgPSBxdWV1ZWQgPyBtb21lbnQudXRjKHF1ZXVlZCkudG9JU09TdHJpbmcoKSA6IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWRfZm9ybWF0dGVkID0gc3RhcnRlZCA/IG1vbWVudC51dGMoc3RhcnRlZCkudG9JU09TdHJpbmcoKSA6IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmVuZGVkID0gZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmVuZGVkX2Zvcm1hdHRlZCA9IGVuZGVkID8gbW9tZW50LnV0YyhlbmRlZCkudG9JU09TdHJpbmcoKSA6IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS50b0lTT1N0cmluZygpIDogbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iID0gSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgICAgICB0aGlzLm5vZGUgPSBOb2RlLnRyYW5zZm9ybWVyKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50O1xuICAgICAgICAgICAgdGhpcy5jcHVzX3NjaGVkdWxlZCA9IGNwdXNfc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fc2NoZWR1bGVkID0gbWVtX3NjaGVkdWxlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19pbl9zY2hlZHVsZWQgPSBkaXNrX2luX3NjaGVkdWxlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfc2NoZWR1bGVkID0gZGlza19vdXRfc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX3RvdGFsX3NjaGVkdWxlZCA9IGRpc2tfdG90YWxfc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5yZXN1bHRzID0gcmVzdWx0cztcbiAgICAgICAgICAgIHRoaXMuY3VycmVudF9zdGRvdXRfdXJsID0gY3VycmVudF9zdGRvdXRfdXJsO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N0ZGVycl91cmwgPSBjdXJyZW50X3N0ZGVycl91cmw7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHNfbWFuaWZlc3QgPSByZXN1bHRzX21hbmlmZXN0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkV4ZWN1dGlvbi5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHRoaXMuam9iX2NvbXBsZXRlZCkuZGlmZihtb21lbnQudXRjKHRoaXMuam9iX3N0YXJ0ZWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuam9iLmpvYlR5cGUuaWNvbkNvZGUgPyAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyB0aGlzLmpvYi5qb2JUeXBlLmljb25Db2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JFeGVjdXRpb24uYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZF9hcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmVfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmVfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhpdF9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3Rfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3N0X2NvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3N0X2V4aXRfY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnF1ZXVlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5vZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW52aXJvbm1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3B1c19zY2hlZHVsZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX2luX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9zY2hlZHVsZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza190b3RhbF9zY2hlZHVsZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXJyZW50X3N0ZG91dF91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3VycmVudF9zdGRlcnJfdXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHNfbWFuaWZlc3RcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JFeGVjdXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JFeGVjdXRpb24udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRXhlY3V0aW9uLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkV4ZWN1dGlvbi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRXhlY3V0aW9uO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRXhlY3V0aW9uTG9nJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2IsIE5vZGUpIHtcbiAgICAgICAgdmFyIEpvYkV4ZWN1dGlvbkxvZyA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBjb21tYW5kX2FyZ3VtZW50cywgdGltZW91dCwgZXhpdF9jb2RlLCBjcmVhdGVkLCBxdWV1ZWQsIHNjaGVkdWxlZCwgcHJlX3N0YXJ0ZWQsIHByZV9jb21wbGV0ZWQsIGpvYl9zdGFydGVkLCBqb2JfY29tcGxldGVkLCBwb3N0X3N0YXJ0ZWQsIHBvc3RfY29tcGxldGVkLCBlbmRlZCwgbGFzdF9tb2RpZmllZCwgam9iLCBub2RlLCBlcnJvciwgaXNfZmluaXNoZWQsIHN0ZG91dCwgc3RkZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZF9hcmd1bWVudHMgPSBjb21tYW5kX2FyZ3VtZW50cztcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgICAgICB0aGlzLmV4aXRfY29kZSA9IGV4aXRfY29kZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZCA9IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkID0gc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5wcmVfc3RhcnRlZCA9IHByZV9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5wcmVfY29tcGxldGVkID0gcHJlX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3N0YXJ0ZWQgPSBqb2Jfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvbXBsZXRlZCA9IGpvYl9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnBvc3Rfc3RhcnRlZCA9IHBvc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9jb21wbGV0ZWQgPSBwb3N0X2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmpvYiA9IEpvYi50cmFuc2Zvcm1lcihqb2IpO1xuICAgICAgICAgICAgdGhpcy5ub2RlID0gTm9kZS50cmFuc2Zvcm1lcihub2RlKTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIHRoaXMuaXNfZmluaXNoZWQgPSBpc19maW5pc2hlZDtcbiAgICAgICAgICAgIHRoaXMuc3Rkb3V0ID0gc3Rkb3V0O1xuICAgICAgICAgICAgdGhpcy5zdGRvdXRIdG1sID0gc3Rkb3V0ID8gc3Rkb3V0LnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxyP1xcbicsJ2cnKSwgJzxiciAvPicpIDogJyc7XG4gICAgICAgICAgICB0aGlzLnN0ZGVyciA9IHN0ZGVycjtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JFeGVjdXRpb25Mb2cucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9IdG1sOiBmdW5jdGlvbihpbnN0cil7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluc3RyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRXhlY3V0aW9uTG9nLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JFeGVjdXRpb25Mb2coXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbW1hbmRfYXJndW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXhpdF9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmVfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmVfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5vZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfZmluaXNoZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3Rkb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0ZGVyclxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbkxvZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkV4ZWN1dGlvbkxvZy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JFeGVjdXRpb25Mb2cuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRXhlY3V0aW9uTG9nLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JFeGVjdXRpb25Mb2c7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW50ZXJmYWNlKSB7XG4gICAgICAgIHZhciBKb2JUeXBlID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB0aXRsZSwgdmVyc2lvbiwgZGVzY3JpcHRpb24sIGlzX3N5c3RlbSwgaXNfbG9uZ19ydW5uaW5nLCBpc19hY3RpdmUsIGlzX29wZXJhdGlvbmFsLCBpc19wYXVzZWQsIHVzZXNfZG9ja2VyLCBkb2NrZXJfcHJpdmlsZWdlZCwgZG9ja2VyX2ltYWdlLCBwcmlvcml0eSwgdGltZW91dCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLCBkaXNrX291dF9tdWx0X3JlcXVpcmVkLCBpY29uX2NvZGUsIGNyZWF0ZWQsIGFyY2hpdmVkLCBwYXVzZWQsIGxhc3RfbW9kaWZpZWQsIGpvYl90eXBlX2ludGVyZmFjZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmlzX3N5c3RlbSA9IGlzX3N5c3RlbTtcbiAgICAgICAgICAgIHRoaXMuaXNfbG9uZ19ydW5uaW5nID0gaXNfbG9uZ19ydW5uaW5nO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmlzX29wZXJhdGlvbmFsID0gaXNfb3BlcmF0aW9uYWw7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMudXNlc19kb2NrZXIgPSB1c2VzX2RvY2tlcjtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX3ByaXZpbGVnZWQgPSBkb2NrZXJfcHJpdmlsZWdlZDtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX2ltYWdlID0gZG9ja2VyX2ltYWdlO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9jb25zdF9yZXF1aXJlZCA9IGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9tdWx0X3JlcXVpcmVkID0gZGlza19vdXRfbXVsdF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuaWNvbl9jb2RlID0gaWNvbl9jb2RlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfaW50ZXJmYWNlID0gSm9iVHlwZUludGVyZmFjZS50cmFuc2Zvcm1lcihqb2JfdHlwZV9pbnRlcmZhY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0pvYlR5cGUnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pY29uX2NvZGUgPyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyB0aGlzLmljb25fY29kZSArICc8L2k+JyA6ICc8aSBjbGFzcz1cImZhIGZhLWZ3XCI+JiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljb25fY29kZSA/ICcmI3gnICsgdGhpcy5pY29uX2NvZGUgKyAnOycgOiAnJiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc7JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aXRsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfc3lzdGVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2xvbmdfcnVubmluZyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb3BlcmF0aW9uYWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXNfZG9ja2VyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9wcml2aWxlZ2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9pbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9jb25zdF9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9tdWx0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmljb25fY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBhdXNlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmludGVyZmFjZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JUeXBlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGUuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlRGV0YWlscycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iVHlwZUludGVyZmFjZSwgSm9iVHlwZUVycm9yTWFwcGluZywgSm9iVHlwZUVycm9yLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVEZXRhaWxzID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB2ZXJzaW9uLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhdGVnb3J5LCBhdXRob3JfbmFtZSwgYXV0aG9yX3VybCwgaXNfc3lzdGVtLCBpc19sb25nX3J1bm5pbmcsIGlzX2FjdGl2ZSwgaXNfb3BlcmF0aW9uYWwsIGlzX3BhdXNlZCwgaWNvbl9jb2RlLCB1c2VzX2RvY2tlciwgZG9ja2VyX3ByaXZpbGVnZWQsIGRvY2tlcl9pbWFnZSwgcmV2aXNpb25fbnVtLCBwcmlvcml0eSwgdGltZW91dCwgbWF4X3NjaGVkdWxlZCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLCBkaXNrX291dF9tdWx0X3JlcXVpcmVkLCBjcmVhdGVkLCBhcmNoaXZlZCwgcGF1c2VkLCBsYXN0X21vZGlmaWVkLCBqb2JfdHlwZV9pbnRlcmZhY2UsIGVycm9yX21hcHBpbmcsIHRyaWdnZXJfcnVsZSwgZXJyb3JzLCBqb2JfY291bnRzXzZoLCBqb2JfY291bnRzXzEyaCwgam9iX2NvdW50c18yNGgpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5jYXRlZ29yeSA9IGNhdGVnb3J5O1xuICAgICAgICAgICAgdGhpcy5hdXRob3JfbmFtZSA9IGF1dGhvcl9uYW1lO1xuICAgICAgICAgICAgdGhpcy5hdXRob3JfdXJsID0gYXV0aG9yX3VybDtcbiAgICAgICAgICAgIHRoaXMuaXNfc3lzdGVtID0gaXNfc3lzdGVtO1xuICAgICAgICAgICAgdGhpcy5pc19sb25nX3J1bm5pbmcgPSBpc19sb25nX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkID0gaXNfcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy5pY29uX2NvZGUgPSBpY29uX2NvZGU7XG4gICAgICAgICAgICB0aGlzLnVzZXNfZG9ja2VyID0gdXNlc19kb2NrZXI7XG4gICAgICAgICAgICB0aGlzLmRvY2tlcl9wcml2aWxlZ2VkID0gZG9ja2VyX3ByaXZpbGVnZWQ7XG4gICAgICAgICAgICB0aGlzLmRvY2tlcl9pbWFnZSA9IGRvY2tlcl9pbWFnZTtcbiAgICAgICAgICAgIHRoaXMucmV2aXNpb25fbnVtID0gcmV2aXNpb25fbnVtO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3NjaGVkdWxlZCA9IG1heF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLm1heF90cmllcyA9IG1heF90cmllcztcbiAgICAgICAgICAgIHRoaXMuY3B1c19yZXF1aXJlZCA9IGNwdXNfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9yZXF1aXJlZCA9IG1lbV9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkX2Zvcm1hdHRlZCA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIobWVtX3JlcXVpcmVkKTtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfY29uc3RfcmVxdWlyZWQgPSBkaXNrX291dF9jb25zdF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfY29uc3RfcmVxdWlyZWRfZm9ybWF0dGVkID0gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYihkaXNrX291dF9jb25zdF9yZXF1aXJlZCk7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X211bHRfcmVxdWlyZWQgPSBkaXNrX291dF9tdWx0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfaW50ZXJmYWNlID0gam9iX3R5cGVfaW50ZXJmYWNlO1xuICAgICAgICAgICAgdGhpcy5lcnJvcl9tYXBwaW5nID0gSm9iVHlwZUVycm9yTWFwcGluZy50cmFuc2Zvcm1lcihlcnJvcl9tYXBwaW5nKTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICAgICAgdGhpcy5lcnJvcnMgPSBKb2JUeXBlRXJyb3IudHJhbnNmb3JtZXIoZXJyb3JzKTtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c182aCA9IGpvYl9jb3VudHNfNmg7XG4gICAgICAgICAgICB0aGlzLmpvYl9jb3VudHNfMTJoID0gam9iX2NvdW50c18xMmg7XG4gICAgICAgICAgICB0aGlzLmpvYl9jb3VudHNfMjRoID0gam9iX2NvdW50c18yNGg7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZURldGFpbHMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljb25fY29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuaWNvbl9jb2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBlcmZvcm1hbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZDZBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c182aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDEyQXJyID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHNfMTJoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMjRBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c18yNGgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBsZXRlZDYgPSBfLmZpbmQodGhpcy5qb2JfY291bnRzXzZoLCAnc3RhdHVzJywgJ0NPTVBMRVRFRCcpIHx8IHsgY291bnQ6IDAgfSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkNiA9IF8uc3VtKGZhaWxlZDZBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDYgPSBmYWlsZWQ2QXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQ2ICsgY29tcGxldGVkNi5jb3VudCA6IGNvbXBsZXRlZDYuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlNiA9IHRvdGFsNiA9PT0gMCA/IDAgOiAxMDAgLSAoKGZhaWxlZDYgLyB0b3RhbDYpICogMTAwKS50b0ZpeGVkKDIpLFxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQxMiA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHNfMTJoLCAnc3RhdHVzJywgJ0NPTVBMRVRFRCcpIHx8IHsgY291bnQ6IDAgfSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMTIgPSBfLnN1bShmYWlsZWQxMkFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsMTIgPSBmYWlsZWQxMkFyci5sZW5ndGggPiAwID8gZmFpbGVkMTIgKyBjb21wbGV0ZWQxMi5jb3VudCA6IGNvbXBsZXRlZDEyLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzUmF0ZTEyID0gdG90YWwxMiA9PT0gMCA/IDAgOiAxMDAgLSAoKGZhaWxlZDEyIC8gdG90YWwxMikgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDI0ID0gXy5maW5kKHRoaXMuam9iX2NvdW50c18yNGgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQyNCA9IF8uc3VtKGZhaWxlZDI0QXJyLCAnY291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwyNCA9IGZhaWxlZDI0QXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQyNCArIGNvbXBsZXRlZDI0LmNvdW50IDogY29tcGxldGVkMjQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlMjQgPSB0b3RhbDI0ID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkMjQgLyB0b3RhbDI0KSAqIDEwMCkudG9GaXhlZCgyKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXI2OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBzdWNjZXNzUmF0ZTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZDYsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZDYuY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWw2XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGhvdXIxMjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogc3VjY2Vzc1JhdGUxMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkMTIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZDEyLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsMTJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjI0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBzdWNjZXNzUmF0ZTI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBmYWlsZWQyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkMjQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWwyNFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGYWlsdXJlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWQ2ID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHNfNmgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQ2VmFsdWVzID0gXy52YWx1ZXMoXy5ncm91cEJ5KGZhaWxlZDYsICdjYXRlZ29yeScpKSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMTIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c18xMmgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMlZhbHVlcyA9IF8udmFsdWVzKF8uZ3JvdXBCeShmYWlsZWQxMiwgJ2NhdGVnb3J5JykpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQyNCA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzI0aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0VmFsdWVzID0gXy52YWx1ZXMoXy5ncm91cEJ5KGZhaWxlZDI0LCAnY2F0ZWdvcnknKSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZ2V0RmFpbHVyZUNvdW50cyA9IGZ1bmN0aW9uIChjYXRlZ29yaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5BcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3JpZXMsIGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3J5LCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyLnB1c2goeyBzdGF0dXM6IHZhbC5jYXRlZ29yeSwgY291bnQ6IHZhbC5jb3VudCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkFycjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaG91cjY6IGdldEZhaWx1cmVDb3VudHMoZmFpbGVkNlZhbHVlcyksXG4gICAgICAgICAgICAgICAgICAgIGhvdXIxMjogZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWQxMlZhbHVlcyksXG4gICAgICAgICAgICAgICAgICAgIGhvdXIyNDogZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWQyNFZhbHVlcylcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlRGV0YWlscy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IGNoYW5nZSBwcm9wZXJ0eSByZXR1cm5lZCBieSBBUEkgZnJvbSBcImludGVyZmFjZVwiIHRvIFwiam9iX3R5cGVfaW50ZXJmYWNlXCIgYmVjYXVzZSBcImludGVyZmFjZVwiIGlzIGEgcmVzZXJ2ZWQgd29yZCBpbiBKU1xuICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlSW50ZXJmYWNlID0gZGF0YS5pbnRlcmZhY2UgPyBkYXRhLmludGVyZmFjZSA6IGRhdGEuam9iX3R5cGVfaW50ZXJmYWNlO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZURldGFpbHMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmF1dGhvcl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmF1dGhvcl91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfc3lzdGVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2xvbmdfcnVubmluZyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb3BlcmF0aW9uYWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmljb25fY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VzX2RvY2tlcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kb2NrZXJfcHJpdmlsZWdlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kb2NrZXJfaW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmV2aXNpb25fbnVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tYXhfdHJpZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3B1c19yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZW1fcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfY29uc3RfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfbXVsdF9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBhdXNlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlSW50ZXJmYWNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yX21hcHBpbmcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJpZ2dlcl9ydWxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9ycyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY291bnRzXzZoLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNfMTJoLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNfMjRoXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZURldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JUeXBlRGV0YWlscy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlRGV0YWlscy5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZURldGFpbHMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVEZXRhaWxzO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVFcnJvcicsIGZ1bmN0aW9uIChtb21lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBKb2JUeXBlRXJyb3IgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IGNyZWF0ZWQgPyBtb21lbnQudXRjKGNyZWF0ZWQpLnRvSVNPU3RyaW5nKCkgOiBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS50b0lTT1N0cmluZygpIDogbGFzdF9tb2RpZmllZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlRXJyb3IucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVFcnJvci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUVycm9yLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVFcnJvci5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3IuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvcjtcbiAgICB9KVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVFcnJvck1hcHBpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JUeXBlRXJyb3JNYXBwaW5nID0gZnVuY3Rpb24gKHZlcnNpb24sIGV4aXRfY29kZXMpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmV4aXRfY29kZXMgPSBleGl0X2NvZGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVFcnJvck1hcHBpbmcoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5leGl0X2NvZGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yTWFwcGluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUVycm9yTWFwcGluZy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3JNYXBwaW5nLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3JNYXBwaW5nO1xuICAgIH0pXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUlucHV0RGF0YScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgSm9iVHlwZUlucHV0RGF0YSA9IGZ1bmN0aW9uIChtZWRpYV90eXBlcywgcmVxdWlyZWQsIHR5cGUsIG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWFfdHlwZXMgPSBtZWRpYV90eXBlcztcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWQgPSByZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVJbnB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUlucHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUlucHV0RGF0YS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZUlucHV0RGF0YS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZUlucHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlSW50ZXJmYWNlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW5wdXREYXRhLCBKb2JUeXBlT3V0cHV0RGF0YSkge1xuICAgICAgICB2YXIgSm9iVHlwZUludGVyZmFjZSA9IGZ1bmN0aW9uICh2ZXJzaW9uLCBjb21tYW5kLCBjb21tYW5kX2FyZ3VtZW50cywgaW5wdXRfZGF0YSwgb3V0cHV0X2RhdGEpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmQgPSBjb21tYW5kO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy5pbnB1dF9kYXRhID0gSm9iVHlwZUlucHV0RGF0YS50cmFuc2Zvcm1lcihpbnB1dF9kYXRhKTtcbiAgICAgICAgICAgIHRoaXMub3V0cHV0X2RhdGEgPSBKb2JUeXBlT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihvdXRwdXRfZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUludGVyZmFjZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbkNvZGUgPyAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyB0aGlzLmljb25Db2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW50ZXJmYWNlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kX2FyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dF9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm91dHB1dF9kYXRhXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUludGVyZmFjZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVJbnRlcmZhY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUludGVyZmFjZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlSW50ZXJmYWNlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZU91dHB1dERhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JUeXBlT3V0cHV0RGF0YSA9IGZ1bmN0aW9uIChuYW1lLCB0eXBlLCByZXF1aXJlZCwgbWVkaWFfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLnJlcXVpcmVkID0gcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lZGlhX3R5cGUgPSBtZWRpYV90eXBlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlT3V0cHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZU91dHB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lZGlhX3R5cGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlT3V0cHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlT3V0cHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlU3RhdHVzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBKb2JFeGVjdXRpb24pIHtcbiAgICAgICAgdmFyIEpvYlR5cGVTdGF0dXMgPSBmdW5jdGlvbiAoam9iX3R5cGUsIGpvYl9jb3VudHMpIHtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50cyA9IGpvYl9jb3VudHM7XG4gICAgICAgICAgICB0aGlzLmhhc19ydW5uaW5nID0gXy5maW5kKGpvYl9jb3VudHMsICdzdGF0dXMnLCAnUlVOTklORycpO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKS5yYXRlRGVzY3JpcHRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZVN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnSm9iVHlwZVN0YXR1cyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGVyZm9ybWFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkQXJyID0gXy5zb3J0QnlPcmRlcihfLmZpbHRlcih0aGlzLmpvYl9jb3VudHMsIHsgc3RhdHVzOiAnRkFJTEVEJyB9KSwgWydjb3VudCddLCBbJ2Rlc2MnXSksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHMsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQgPSBfLnN1bShmYWlsZWRBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWRDYXRlZ29yeSA9IGZhaWxlZEFyci5sZW5ndGggPiAwID8gZmFpbGVkQXJyWzBdLmNhdGVnb3J5IDogJycsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsID0gZmFpbGVkQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQgKyBjb21wbGV0ZWQuY291bnQgOiBjb21wbGV0ZWQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlID0gdG90YWwgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnc3VjY2Vzcyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc1JhdGUgPD0gMzAgJiYgdG90YWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnZXJyb3InO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VjY2Vzc1JhdGUgPiAzMCAmJiBzdWNjZXNzUmF0ZSA8PSA2MCAmJiB0b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICd3YXJuaW5nJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvdGFsID09PSAwICYmICF0aGlzLmhhc19ydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnel9pbmFjdGl2ZSc7IC8vIHByZXBlbmQgd2l0aCAnel8nIGZvciBvcmRlcmluZyBwdXJwb3Nlc1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlLFxuICAgICAgICAgICAgICAgICAgICByYXRlRGVzY3JpcHRpb246IHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWRDYXRlZ29yeTogZmFpbGVkQ2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJ1bm5pbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5maW5kKHRoaXMuam9iX2NvdW50cywgJ3N0YXR1cycsICdSVU5OSU5HJykgfHwgeyBjb3VudDogMCB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZCA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmYWlsZWQsIGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IF8uZmluZChzY2FsZUNvbmZpZy5lcnJvckNhdGVnb3JpZXMsIHsgbmFtZTogZi5jYXRlZ29yeSB9KTtcbiAgICAgICAgICAgICAgICAgICAgZi5vcmRlciA9IGNhdGVnb3J5ID8gY2F0ZWdvcnkub3JkZXIgOiAnJztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBmYWlsZWRWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkLCAnb3JkZXInKSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZ2V0RmFpbHVyZUNvdW50cyA9IGZ1bmN0aW9uIChjYXRlZ29yaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5BcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3JpZXMsIGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3J5LCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyLnB1c2goeyBzdGF0dXM6IHZhbC5jYXRlZ29yeSwgY291bnQ6IHZhbC5jb3VudCwgb3JkZXI6IHZhbC5vcmRlciB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uc29ydEJ5T3JkZXIocmV0dXJuQXJyLCBbJ29yZGVyJ10sIFsnZGVzYyddKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZhaWx1cmVDb3VudHMoZmFpbGVkVmFsdWVzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmlsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cy5yYXRlRGVzY3JpcHRpb24gPT09ICd6X2luYWN0aXZlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyYXlfZGFyaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZyA9IHRoaXMuZ2V0UnVubmluZygpO1xuICAgICAgICAgICAgICAgIGlmIChydW5uaW5nLmNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyYjeCcgKyBzY2FsZUNvbmZpZy5hY3Rpdml0eUljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5VG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgPiAwID8gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgOiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6ICcgKyAocGVyZm9ybWFuY2UuZmFpbGVkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLmNvbXBsZXRlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsUGF1c2VSZXN1bWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8ubWFwKHRoaXMuZ2V0RmFpbHVyZXMoKSwgJ3N0YXR1cycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlU3RhdHVzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlU3RhdHVzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZVN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlU3RhdHVzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1Byb2R1Y3QnLCBmdW5jdGlvbiAoSm9iVHlwZSwgc2NhbGVTZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgUHJvZHVjdCA9IGZ1bmN0aW9uIChpZCwgd29ya3NwYWNlLCBmaWxlX25hbWUsIG1lZGlhX3R5cGUsIGZpbGVfc2l6ZSwgZGF0YV90eXBlLCBpc19kZWxldGVkLCB1dWlkLCB1cmwsIGNyZWF0ZWQsIGRlbGV0ZWQsIGRhdGFfc3RhcnRlZCwgZGF0YV9lbmRlZCwgZ2VvbWV0cnksIGNlbnRlcl9wb2ludCwgbWV0YV9kYXRhLCBjb3VudHJpZXMsIGxhc3RfbW9kaWZpZWQsIGlzX29wZXJhdGlvbmFsLCBpc19wdWJsaXNoZWQsIHB1Ymxpc2hlZCwgdW5wdWJsaXNoZWQsIGpvYl90eXBlLCBqb2IsIGpvYl9leGUsIHVwZGF0ZSwgc291cmNlX2ZpbGVzKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9uYW1lID0gZmlsZV9uYW1lO1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlID0gbWVkaWFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9zaXplID0gZmlsZV9zaXplO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemVfcmVhZGFibGUgPSB0aGlzLmdldFJlYWRhYmxlRmlsZVNpemUoKTtcbiAgICAgICAgICAgIHRoaXMuZGF0YV90eXBlID0gZGF0YV90eXBlO1xuICAgICAgICAgICAgdGhpcy5pc19kZWxldGVkID0gaXNfZGVsZXRlZDtcbiAgICAgICAgICAgIHRoaXMudXVpZCA9IHV1aWQ7XG4gICAgICAgICAgICB0aGlzLnVybCA9IHVybDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZWQgPSBkZWxldGVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhX3N0YXJ0ZWQgPSBkYXRhX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGFfZW5kZWQgPSBkYXRhX2VuZGVkO1xuICAgICAgICAgICAgdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgICAgICAgICAgdGhpcy5jZW50ZXJfcG9pbnQgPSBjZW50ZXJfcG9pbnQ7XG4gICAgICAgICAgICB0aGlzLm1ldGFfZGF0YSA9IG1ldGFfZGF0YTtcbiAgICAgICAgICAgIHRoaXMuY291bnRyaWVzID0gY291bnRyaWVzO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS50b0lTT1N0cmluZygpIDogbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWxfbGFiZWwgPSBpc19vcGVyYXRpb25hbCA/ICdPcGVyYXRpb25hbCcgOiAnUiZhbXA7RCc7XG4gICAgICAgICAgICB0aGlzLmlzX3B1Ymxpc2hlZCA9IGlzX3B1Ymxpc2hlZDtcbiAgICAgICAgICAgIHRoaXMucHVibGlzaGVkID0gcHVibGlzaGVkO1xuICAgICAgICAgICAgdGhpcy51bnB1Ymxpc2hlZCA9IHVucHVibGlzaGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBqb2I7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGUgPSBqb2JfZXhlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUgPSB1cGRhdGU7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZV9maWxlcyA9IHNvdXJjZV9maWxlcztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBQcm9kdWN0LnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModGhpcy5sYXN0X21vZGlmaWVkKS5kaWZmKG1vbWVudC51dGModGhpcy5jcmVhdGVkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVhZGFibGVGaWxlU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXModGhpcy5maWxlX3NpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBQcm9kdWN0LmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9kdWN0KFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2RlbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhX2VuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmdlb21ldHJ5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNlbnRlcl9wb2ludCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZXRhX2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnRyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb3BlcmF0aW9uYWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcHVibGlzaGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51bnB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2V4ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51cGRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc291cmNlX2ZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvZHVjdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFByb2R1Y3QudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUHJvZHVjdC5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9kdWN0LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBQcm9kdWN0O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUnVubmluZ0pvYicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBKb2JUeXBlKSB7XG4gICAgICAgIHZhciBSdW5uaW5nSm9iID0gZnVuY3Rpb24gKGNvdW50LCBsb25nZXN0X3J1bm5pbmcsIGpvYl90eXBlKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB0aGlzLmxvbmdlc3RfcnVubmluZyA9IGxvbmdlc3RfcnVubmluZztcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSdW5uaW5nSm9iLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmxvbmdlc3RfcnVubmluZywgbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IHRoaXMuam9iX3R5cGUuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmEgZmEtZndcIj4mI3gnICsgdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGljb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJ1bm5pbmdKb2IuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJ1bm5pbmdKb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9uZ2VzdF9ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUnVubmluZ0pvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJ1bm5pbmdKb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUnVubmluZ0pvYi5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSdW5uaW5nSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSdW5uaW5nSm9iO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N5c3RlbUZhaWx1cmUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgU3lzdGVtRmFpbHVyZSA9IGZ1bmN0aW9uIChjb3VudCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfdmVyc2lvbiwgZXJyb3JfbmFtZSwgZmlyc3RfZXJyb3IsIGxhc3RfZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfbmFtZSA9IGpvYl90eXBlX25hbWU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX3ZlcnNpb24gPSBqb2JfdHlwZV92ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy5lcnJvcl9uYW1lID0gZXJyb3JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RfZXJyb3IgPSBmaXJzdF9lcnJvcjtcbiAgICAgICAgICAgIHRoaXMubGFzdF9lcnJvciA9IGxhc3RfZXJyb3I7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3lzdGVtRmFpbHVyZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5maXJzdF9lcnJvciwgdGhpcy5sYXN0X2Vycm9yKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZ0pvYlR5cGUgPSBfLmZpbmQoc2NhbGVDb25maWcuam9iVHlwZXMsICd0aXRsZScsIHRoaXMuam9iX3R5cGVfbmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ0pvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ0pvYlR5cGUuaWNvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTeXN0ZW1GYWlsdXJlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTeXN0ZW1GYWlsdXJlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfdmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpcnN0X2Vycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfZXJyb3JcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTeXN0ZW1GYWlsdXJlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3lzdGVtRmFpbHVyZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTeXN0ZW1GYWlsdXJlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN5c3RlbUZhaWx1cmUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN5c3RlbUZhaWx1cmU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdtZXRyaWNzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgbWV0cmljc1NlcnZpY2UsIG1vbWVudCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY2hhcnQgPSBudWxsLFxuICAgICAgICAgICAgY29sQXJyID0gW10sXG4gICAgICAgICAgICBjb2xOYW1lcyA9IHt9LFxuICAgICAgICAgICAgeEFyciA9IFtdLFxuICAgICAgICAgICAgcmVtb3ZlSWRzID0gW10sXG4gICAgICAgICAgICB5VW5pdHMgPSBbXTtcblxuICAgICAgICB2bS5fID0gXztcbiAgICAgICAgdm0ubW9tZW50ID0gbW9tZW50O1xuICAgICAgICB2bS5sb2FkaW5nTWV0cmljcyA9IGZhbHNlO1xuICAgICAgICB2bS5jaGFydEFyciA9IFtdO1xuICAgICAgICB2bS5jaGFydERhdGEgPSBbXTtcbiAgICAgICAgdm0uY2hhcnRTdHlsZSA9ICcnO1xuICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlID0ge307XG4gICAgICAgIHZtLmlucHV0U3RhcnREYXRlID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICdNJykudG9EYXRlKCk7XG4gICAgICAgIHZtLmlucHV0RW5kRGF0ZSA9IG1vbWVudC51dGMoKS50b0RhdGUoKTtcbiAgICAgICAgdm0ub3BlbklucHV0U3RhcnQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5pbnB1dFN0YXJ0T3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uaW5wdXRTdGFydE9wZW5lZCA9IGZhbHNlO1xuICAgICAgICB2bS5vcGVuSW5wdXRFbmQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5pbnB1dEVuZE9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmlucHV0RW5kT3BlbmVkID0gZmFsc2U7XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGFUeXBlRmlsdGVyVGV4dCA9ICcnO1xuICAgICAgICB2bS5maWx0ZXJzQXBwbGllZCA9IFtdO1xuICAgICAgICB2bS5maWx0ZXJlZENob2ljZXMgPSBbXTtcbiAgICAgICAgdm0uZmlsdGVyZWRDaG9pY2VzT3B0aW9ucyA9IFtdO1xuICAgICAgICB2bS5zZWxlY3RlZE1ldHJpY3MgPSBbXTtcbiAgICAgICAgdm0uY29sdW1uR3JvdXBzT3B0aW9ucyA9IFtdO1xuICAgICAgICB2bS5jb2x1bW5zID0gW107XG4gICAgICAgIHZtLmdyb3VwcyA9IFtdO1xuICAgICAgICB2bS5jaGFydFRpdGxlID0gJyc7XG4gICAgICAgIHZtLmNoYXJ0RGlzcGxheSA9ICdzdGFja2VkJztcbiAgICAgICAgdm0uc3RhY2tlZENsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uZ3JvdXBlZENsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0uc3ViY2hhcnRDbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLnN1YmNoYXJ0RW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB2bS5jaGFydFR5cGUgPSAnYmFyJztcbiAgICAgICAgdm0uY2hhcnRUeXBlRGlzcGxheSA9ICdCYXInO1xuICAgICAgICB2bS5iYXJDbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFyZWFDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLmxpbmVDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLnNwbGluZUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0uc2NhdHRlckNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0ubWV0cmljc1RvdGFsID0gMDtcblxuICAgICAgICB2bS5nZXRQbG90RGF0YVBhcmFtcyA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogbnVsbCxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogb2JqLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IG9iai5lbmRlZCxcbiAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IG9iai5jaG9pY2VfaWQsXG4gICAgICAgICAgICAgICAgY29sdW1uOiBvYmouY29sdW1uLFxuICAgICAgICAgICAgICAgIGdyb3VwOiBvYmouZ3JvdXAsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IG9iai5kYXRhVHlwZS5uYW1lXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlc2V0U2VsZWN0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmlucHV0U3RhcnREYXRlID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICdNJykudG9EYXRlKCk7XG4gICAgICAgICAgICB2bS5pbnB1dEVuZERhdGUgPSBtb21lbnQudXRjKCkudG9EYXRlKCk7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlID0ge307XG4gICAgICAgICAgICB2bS5jaGFuZ2VEYXRhVHlwZVNlbGVjdGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uY2hhcnREYXRhID0gW107XG4gICAgICAgICAgICBpZiAodm0uY2hhcnRBcnIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gbm90aGluZyB0byBzaG93IG9uIGNoYXJ0XG4gICAgICAgICAgICAgICAgY2hhcnQuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIGNoYXJ0ID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbGxJbml0ID0gXy5hZnRlcih2bS5jaGFydEFyci5sZW5ndGgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gb25seSBpbml0Q2hhcnQgYWZ0ZXIgdGhpcyBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQgZm9yIGFsbCBkYXRhc2V0cyBpbiBjaGFydEFyclxuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nTWV0cmljcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2bS5pbml0Q2hhcnQoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5jaGFydEFyciwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gdm0uZ2V0UGxvdERhdGFQYXJhbXMob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgbWV0cmljc1NlcnZpY2UuZ2V0UGxvdERhdGEocGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbWV0cmljc1NlcnZpY2UuZ2V0R2VuZXJhdGVkUGxvdERhdGEoe3F1ZXJ5OiBvYmosIHBhcmFtczogcGFyYW1zfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2hhcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBvYmosXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogZGF0YS5yZXN1bHRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxJbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZ01ldHJpY3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZFRvQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5jaGFydEFyciA9IFtdOyAvLyBjb21tZW50IHRoaXMgb3V0IGlmIGFsbG93aW5nIG11bHRpcGxlIGFkZHNcbiAgICAgICAgICAgIHZtLmxvYWRpbmdNZXRyaWNzID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZENob2ljZXMgPSBbXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMgPSBbXTtcbiAgICAgICAgICAgIC8vIGZpbmQgdGhlIGZpbHRlciBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBjaG9zZW4gZmlsdGVyIElEc1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmZpbHRlcnNBcHBsaWVkLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZENob2ljZXMucHVzaChfLmZpbmQodm0uZmlsdGVyZWRDaG9pY2VzLCB7IGlkOiBwYXJzZUludChpZCkgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KHZtLnNlbGVjdGVkTWV0cmljcykpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uc2VsZWN0ZWRNZXRyaWNzLCBmdW5jdGlvbiAobWV0cmljKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucy5wdXNoKF8uZmluZCh2bS5jb2x1bW5zLCB7IG5hbWU6IG1ldHJpYyB9KSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucy5wdXNoKF8uZmluZCh2bS5jb2x1bW5zLCB7IG5hbWU6IHZtLnNlbGVjdGVkTWV0cmljcyB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jaGFydEFyci5wdXNoKHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiB2bS5pbnB1dFN0YXJ0RGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiB2bS5pbnB1dEVuZERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IHZtLmZpbHRlcnNBcHBsaWVkLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogXy5wbHVjayhzZWxlY3RlZENvbHVtbnMsICduYW1lJyksXG4gICAgICAgICAgICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IHZtLnNlbGVjdGVkRGF0YVR5cGUsXG4gICAgICAgICAgICAgICAgZmlsdGVyc0FwcGxpZWQ6IGZpbHRlcmVkQ2hvaWNlcyxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZE1ldHJpY3M6IHNlbGVjdGVkQ29sdW1uc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS51cGRhdGVDaGFydCgpO1xuICAgICAgICAgICAgLy92bS5yZXNldFNlbGVjdGlvbnMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5kZWxldGVGcm9tQ2hhcnQgPSBmdW5jdGlvbiAob2JqVG9EZWxldGUpIHtcbiAgICAgICAgICAgIF8ucmVtb3ZlKHZtLmNoYXJ0QXJyLCBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaikgPT09IEpTT04uc3RyaW5naWZ5KG9ialRvRGVsZXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0udXBkYXRlQ2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRGaWx0ZXJPcHRpb25zID0gZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICByZXR1cm4gXy51bmlxKF8ucGx1Y2sodm0uZmlsdGVyZWRDaG9pY2VzLCBwYXJhbSkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNoYW5nZURhdGFUeXBlU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gcmVzZXQgb3B0aW9uc1xuICAgICAgICAgICAgdm0uZmlsdGVyc0FwcGxpZWQgPSBbXTtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGVPcHRpb25zID0gW107XG4gICAgICAgICAgICB2bS5kYXRhVHlwZUZpbHRlclRleHQgPSAnJztcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkTWV0cmljcyA9IFtdO1xuICAgICAgICAgICAgdm0uY29sdW1ucyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkRGF0YVR5cGUubmFtZSB8fCB2bS5zZWxlY3RlZERhdGFUeXBlLm5hbWUgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgIHZtLmdldERhdGFUeXBlcygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5nZXREYXRhVHlwZU9wdGlvbnModm0uc2VsZWN0ZWREYXRhVHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYXJlRmlsdGVyc0FwcGxpZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdm0uZmlsdGVyc0FwcGxpZWQubGVuZ3RoID4gMDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDaGFydERpc3BsYXkgPSBmdW5jdGlvbiAoZGlzcGxheSkge1xuICAgICAgICAgICAgdm0uY2hhcnREaXNwbGF5ID0gZGlzcGxheTtcbiAgICAgICAgICAgIHZtLnN0YWNrZWRDbGFzcyA9IGRpc3BsYXkgPT09ICdzdGFja2VkJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uZ3JvdXBlZENsYXNzID0gZGlzcGxheSA9PT0gJ2dyb3VwZWQnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5pbml0Q2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDaGFydFR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgICAgdm0uY2hhcnRUeXBlID0gdHlwZTtcbiAgICAgICAgICAgIHZtLmNoYXJ0VHlwZURpc3BsYXkgPSBfLmNhcGl0YWxpemUodHlwZSk7XG4gICAgICAgICAgICB2bS5iYXJDbGFzcyA9IHR5cGUgPT09ICdiYXInID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5hcmVhQ2xhc3MgPSB0eXBlID09PSAnYXJlYScgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLmxpbmVDbGFzcyA9IHR5cGUgPT09ICdsaW5lJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uc3BsaW5lQ2xhc3MgPSB0eXBlID09PSAnc3BsaW5lJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uc2NhdHRlckNsYXNzID0gdHlwZSA9PT0gJ3NjYXR0ZXInID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5pbml0Q2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVTdWJjaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnN1YmNoYXJ0RW5hYmxlZCA9ICF2bS5zdWJjaGFydEVuYWJsZWQ7XG4gICAgICAgICAgICBpZiAodm0uc3ViY2hhcnRFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdm0uc3ViY2hhcnRDbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnN1YmNoYXJ0Q2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdtZXRyaWNzJyk7XG4gICAgICAgICAgICB2bS5nZXREYXRhVHlwZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXREYXRhVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXREYXRhVHlwZXMoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVEYXRhVHlwZXMgPSByZXN1bHQucmVzdWx0cztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0RGF0YVR5cGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldERhdGFUeXBlTWV0cmljcyhpZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZUF2YWlsYWJsZU1ldHJpY3MgPSByZXN1bHQubWV0cmljcztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldERhdGFUeXBlT3B0aW9ucyA9IGZ1bmN0aW9uIChkYXRhVHlwZSkge1xuICAgICAgICAgICAgbWV0cmljc1NlcnZpY2UuZ2V0RGF0YVR5cGVPcHRpb25zKGRhdGFUeXBlLm5hbWUpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGVPcHRpb25zID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChyZXN1bHQuZmlsdGVycywgZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVHlwZUZpbHRlclRleHQgPSB2bS5kYXRhVHlwZUZpbHRlclRleHQubGVuZ3RoID09PSAwID8gXy5jYXBpdGFsaXplKGZpbHRlci5wYXJhbSkgOiB2bS5kYXRhVHlwZUZpbHRlclRleHQgKyAnLCAnICsgXy5jYXBpdGFsaXplKGZpbHRlci5wYXJhbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyZWRDaG9pY2VzID0gXy5zb3J0QnlPcmRlcihyZXN1bHQuY2hvaWNlcywgWyd0aXRsZScsJ3ZlcnNpb24nXSwgWydhc2MnLCdhc2MnXSk7XG4gICAgICAgICAgICAgICAgLy8gZm9ybWF0IGZpbHRlcmVkQ2hvaWNlcyBmb3IgdXNlIHdpdGggbXVsdGlzZWxlY3QgZGlyZWN0aXZlXG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkQ2hvaWNlc09wdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZmlsdGVyZWRDaG9pY2VzLCBmdW5jdGlvbiAoY2hvaWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQ2hvaWNlc09wdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogY2hvaWNlLnZlcnNpb24gPyBjaG9pY2UudGl0bGUgKyAnICcgKyBjaG9pY2UudmVyc2lvbiA6IGNob2ljZS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBjaG9pY2UudmVyc2lvbiA/IGNob2ljZS50aXRsZSArICcgJyArIGNob2ljZS52ZXJzaW9uIDogY2hvaWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNob2ljZS5pZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJlZENob2ljZXNPcHRpb25zID0gZmlsdGVyZWRDaG9pY2VzT3B0aW9ucztcbiAgICAgICAgICAgICAgICB2bS5jb2x1bW5zID0gXy5zb3J0QnlPcmRlcihyZXN1bHQuY29sdW1ucywgWyd0aXRsZSddLCBbJ2FzYyddKTtcbiAgICAgICAgICAgICAgICB2bS5ncm91cHMgPSByZXN1bHQuZ3JvdXBzO1xuXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGFuIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyBncm91cGVkIGNvbHVtbnNcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uR3JvdXBzT3B0aW9ucyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5Hcm91cHMgPSBfLnBhaXJzKF8uZ3JvdXBCeShyZXN1bHQuY29sdW1ucywgJ2dyb3VwJykpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChjb2x1bW5Hcm91cHMsIGZ1bmN0aW9uIChncm91cCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IF8uZmluZCh2bS5ncm91cHMsIHsgbmFtZTogZ3JvdXBbMF0gfSkudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGdyb3VwWzFdLCBmdW5jdGlvbiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNvbHVtbi50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY29sdW1uLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjb2x1bW4ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbkdyb3Vwc09wdGlvbnMucHVzaChvcHRpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbHVtbkdyb3Vwc09wdGlvbnMudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTm9uZSBTZWxlY3RlZCcsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTm9uZSBTZWxlY3RlZCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLmNvbHVtbkdyb3Vwc09wdGlvbnMgPSBjb2x1bW5Hcm91cHNPcHRpb25zO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5pbnB1dEVuZERhdGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVlKVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgdXAgY2hhcnRcbiAgICAgICAgdm0uaW5pdENoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbWFyayBhbnkgZXhpc3RpbmcgZGF0YSBmb3IgcmVtb3ZhbFxuICAgICAgICAgICAgLy8gY29tcGFyZSBjdXJyQ29scyAoY29sdW1ucyBjdXJyZW50bHkgaW4gdGhlIGNoYXJ0KSB3aXRoIGRpc3BsYXlDb2xzIChjb2x1bW5zIHRvIGRpc3BsYXkpXG4gICAgICAgICAgICByZW1vdmVJZHMgPSBbXTtcbiAgICAgICAgICAgIHZtLm1ldHJpY3NUb3RhbCA9IDA7XG4gICAgICAgICAgICB2YXIgY3VyckNvbHMgPSBbXSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29scyA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGNvbEFyciwgZnVuY3Rpb24gKGNvbCwgaWR4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VyckNvbHMucHVzaChjb2xbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmNoYXJ0RGF0YSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29scyA9IGRpc3BsYXlDb2xzLmNvbmNhdChfLnBsdWNrKGQucXVlcnkuZmlsdGVyc0FwcGxpZWQsICduYW1lJykpO1xuICAgICAgICAgICAgICAgIC8vIGluY3JlYXNlIG1ldHJpY3MgdG90YWwgaWYgc2VsZWN0ZWQgbWV0cmljIHByb2R1Y2VzIGEgc3VtXG4gICAgICAgICAgICAgICAgLy8gZm9yIG5vdyBpdCBpcyBvbmx5IHBvc3NpYmxlIHRvIHNlbGVjdCBvbmUgbWV0cmljIGF0IGEgdGltZVxuICAgICAgICAgICAgICAgIC8vIHNvIGp1c3QgY2hlY2sgdGhlIGZpcnN0IGVsZW1lbnQgZnJvbSBzZWxlY3RlZE1ldHJpY3NcbiAgICAgICAgICAgICAgICBpZiAoZC5xdWVyeS5zZWxlY3RlZE1ldHJpY3NbMF0uYWdncmVnYXRlID09PSAnc3VtJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5tZXRyaWNzVG90YWwgPSB2bS5tZXRyaWNzVG90YWwgKyBfLnN1bShkLnJlc3VsdHNbMF0udmFsdWVzLCAndmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh2bS5tZXRyaWNzVG90YWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgdm0uY2hhcnRUaXRsZSA9IHZtLmNoYXJ0RGF0YVswXS5xdWVyeS5zZWxlY3RlZE1ldHJpY3NbMF0udGl0bGUgKyAnIGZvciAnICsgbW9tZW50LnV0Yyh2bS5pbnB1dFN0YXJ0RGF0ZSkuZm9ybWF0KCdERCBNTU0gWVlZWScpICsgJyAtICcgKyBtb21lbnQudXRjKHZtLmlucHV0RW5kRGF0ZSkuZm9ybWF0KCdERCBNTU0gWVlZWScpICsgJyAoJyArIHZtLm1ldHJpY3NUb3RhbC50b0xvY2FsZVN0cmluZygpICsgJyknO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5jaGFydFRpdGxlID0gdm0uY2hhcnREYXRhWzBdLnF1ZXJ5LnNlbGVjdGVkTWV0cmljc1swXS50aXRsZSArICcgJyArIG1vbWVudC51dGModm0uaW5wdXRTdGFydERhdGUpLmZvcm1hdCgnREQgTU1NIFlZWVknKSArICcgLSAnICsgbW9tZW50LnV0Yyh2bS5pbnB1dEVuZERhdGUpLmZvcm1hdCgnREQgTU1NIFlZWVknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRldGVybWluZSB0aGUgZXhhY3QgZGlmZmVyZW5jZXMgYmV0d2VlbiBjdXJyQ29scyBhbmQgZGlzcGxheUNvbHNcbiAgICAgICAgICAgIC8vIGlmIG5vbmUgYXJlIGZvdW5kLCB0aGVuIHJlbW92ZUlkcyBzdGF5cyBlbXB0eVxuICAgICAgICAgICAgXy5mb3JFYWNoKGN1cnJDb2xzLCBmdW5jdGlvbiAoY3VyckNvbCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5Q29sID0gXy5maW5kKGRpc3BsYXlDb2xzLCBmdW5jdGlvbiAoZENvbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZENvbCA9PT0gY3VyckNvbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWRpc3BsYXlDb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzLnB1c2goY3VyckNvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluaXQgd2l0aCBuZXcgZGF0YVxuICAgICAgICAgICAgY29sQXJyID0gW107XG4gICAgICAgICAgICB4QXJyID0gW107XG4gICAgICAgICAgICBjb2xOYW1lcyA9IHt9O1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgeEFyclxuICAgICAgICAgICAgdmFyIG51bURheXMgPSBtb21lbnQudXRjKHZtLmlucHV0RW5kRGF0ZSkuZW5kT2YoJ2QnKS5kaWZmKG1vbWVudC51dGModm0uaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSkuc3RhcnRPZignZCcpLCAnZCcpICsgMTsgLy8gYWRkIDEgdG8gaW5jbHVkZSBzdGFydGluZyBkYXkgaW4gY291bnRcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRGF5czsgaSsrKSB7XG4gICAgICAgICAgICAgICAgeEFyci5wdXNoKG1vbWVudC51dGModm0uaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSkuc3RhcnRPZignZCcpLmFkZChpLCAnZCcpLnRvRGF0ZSgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGRhdGF0eXBlcyBhbmQgYWRkIHZhbHVlcyB0byBjb2xBcnJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5jaGFydERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlQXJyID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZGF0YS5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlGaWx0ZXIgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlEYXRlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgeVVuaXRzID0gXy5wbHVjayhxdWVyeS5zZWxlY3RlZE1ldHJpY3MsICd1bml0cycpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmlsdGVycyB3ZXJlIGFwcGxpZWQsIHNvIGJ1aWxkIGRhdGEgc291cmNlIGFjY29yZGluZ2x5XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLnJlc3VsdHMsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXMgZm9yIGFsbCBmaWx0ZXJzIGFyZSByZXR1cm5lZCBpbiBvbmUgYXJyYXkgb2YgYXJyYXlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIGdyb3VwIHJlc3VsdHMgYnkgaWQgdG8gaXNvbGF0ZSBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwZWRSZXN1bHQgPSBfLmdyb3VwQnkocmVzdWx0LnZhbHVlcywgJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJJZHMgPSBfLnBsdWNrKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCAnaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0cnkgdG8gZ2V0IGVhY2ggZmlsdGVyIGlkIGZyb20gZ3JvdXBlZFJlc3VsdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIHVuZGVmaW5lZCwgYW4gZW1wdHkgYXJyYXkgd2lsbCBiZSByZXR1cm5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgYWxsb3dzIGEgemVyb2VkIGFycmF5IHRvIGFwcGVhciBpbiB0aGUgY2hhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ugd2Ugd2FudCB0byBpbmNsdWRlIGFsbCBmaWx0ZXJzIHNlbGVjdGVkIGJ5IHRoZSB1c2VyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVnYXJkbGVzcyBvZiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJJZHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIG1vcmUgdGhhbiBvbmUgZmlsdGVyIGlzIHJlcXVlc3RlZCwgdGhlbiBhbiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBwcmVzZW50IHdpdGhpbiBkYXRhLnJlc3VsdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZpbHRlcklkcywgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbaWRdID0gXy5nZXQoZ3JvdXBlZFJlc3VsdCwgaWQsIFtdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBvbmUgZmlsdGVyIGlzIHJlcXVlc3RlZCwgbm8gaWQgdmFsdWUgaXMgaW5jbHVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gZGF0YS5yZXN1bHRzLCBzbyBidWlsZCByZXN1bHRPYmogd2l0aCB0aGUgb3RoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5mbyB3ZSBoYXZlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtxdWVyeS5jaG9pY2VfaWRbMF1dID0gXy5wYWlycyhncm91cGVkUmVzdWx0KVswXVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKF8ucGFpcnMocmVzdWx0T2JqKSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZFswXSB3aWxsIGJlIGNob2ljZSBpZCwgZFsxXSB3aWxsIGJlIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSBmaWx0ZXIgd2FzIHNlbGVjdGVkLCBkWzBdIHdpbGwgcmV0dXJuIGFzIHN0cmluZyAndW5kZWZpbmVkJyBzaW5jZSBubyBpZCBpcyBpbmNsdWRlZCBpbiB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlGaWx0ZXIgPSBkWzBdID09PSAndW5kZWZpbmVkJyA/IHF1ZXJ5LmZpbHRlcnNBcHBsaWVkWzBdIDogXy5maW5kKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCB7aWQ6IHBhcnNlSW50KGRbMF0pfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5RGF0ZXMgPSBkWzFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCByZXN1bHQgdmFsdWVzIHRvIHZhbHVlQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoeERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZU9iaiA9IF8uZmluZChxdWVyeURhdGVzLCBmdW5jdGlvbiAocURhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhxRGF0ZS5kYXRlKS5pc1NhbWUoeERhdGUsICdkYXknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHVzaCAwIGlmIGRhdGEgZm9yIHhEYXRlIGlzIG5vdCBwcmVzZW50IGluIHF1ZXJ5RGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyLnB1c2godmFsdWVPYmogPyB2YWx1ZU9iai52YWx1ZSA6IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVwZW5kIHZhbHVlQXJyIHdpdGggZmlsdGVyIHRpdGxlLCBhbmQgcHVzaCBvbnRvIGNvbEFyclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyci51bnNoaWZ0KHF1ZXJ5RmlsdGVyLm5hbWUgKyBxdWVyeUZpbHRlci5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE5hbWVzW3F1ZXJ5RmlsdGVyLm5hbWUgKyBxdWVyeUZpbHRlci5pZF0gPSBxdWVyeUZpbHRlci52ZXJzaW9uID8gcXVlcnlGaWx0ZXIudGl0bGUgKyAnICcgKyBxdWVyeUZpbHRlci52ZXJzaW9uIDogcXVlcnlGaWx0ZXIudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbEFyci5wdXNoKHZhbHVlQXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZmlsdGVycyB3ZXJlIGFwcGxpZWQsIHNvIHNob3cgYWdncmVnYXRlIHN0YXRpc3RpY3NcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHJlc3VsdCB2YWx1ZXMgdG8gdmFsdWVBcnJcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoeERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVPYmogPSBfLmZpbmQocmVzdWx0LnZhbHVlcywgZnVuY3Rpb24gKHFEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHFEYXRlLmRhdGUpLmlzU2FtZSh4RGF0ZSwgJ2RheScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHB1c2ggMCBpZiBkYXRhIGZvciB4RGF0ZSBpcyBub3QgcHJlc2VudCBpbiByZXN1bHQudmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIucHVzaCh2YWx1ZU9iaiA/IHZhbHVlT2JqLnZhbHVlIDogMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGVuZCB2YWx1ZUFyciB3aXRoIGZpbHRlciB0aXRsZSwgYW5kIHB1c2ggb250byBjb2xBcnJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5MYWJlbCA9IHJlc3VsdC5jb2x1bW4udGl0bGUgKyAnIGZvciBhbGwgJyArIHF1ZXJ5LmRhdGFUeXBlLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIudW5zaGlmdChjb2x1bW5MYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xOYW1lc1snYWdncmVnYXRlJ10gPSBjb2x1bW5MYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEFyci5wdXNoKHZhbHVlQXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluZm9ybSB0aGUgdXNlciBpZiB0aGUgbWV0cmljcyB0aGV5IHNlbGVjdGVkIGFyZSBlbXB0eVxuICAgICAgICAgICAgaWYgKF8uc3VtKF8uZmxhdHRlbihjb2xBcnIpKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnaW5mbyddKCdUaGVyZSBpcyBubyBkYXRhIHRvIGRpc3BsYXkuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHByZXBlbmQgeEFyciB3aXRoIGFuICd4JyBsYWJlbCBhbmQgYWRkIHRvIGNvbEFyclxuICAgICAgICAgICAgeEFyci51bnNoaWZ0KCd4Jyk7XG4gICAgICAgICAgICBjb2xBcnIudW5zaGlmdCh4QXJyKTtcblxuICAgICAgICAgICAgdmFyIHR5cGVzID0ge30sXG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9LFxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtdO1xuXG4gICAgICAgICAgICBfLmZvckVhY2goY29sQXJyLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgIGlmIChjb2xbMF0gIT09ICd4Jykge1xuICAgICAgICAgICAgICAgICAgICB0eXBlW2NvbFswXV0gPSB2bS5jaGFydFR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5jaGFydERpc3BsYXkgPT09ICdzdGFja2VkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0eXBlcywgdHlwZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hhcnQgYWxyZWFkeSBleGlzdHMsIHNvIHVwZGF0ZSB2YWx1ZXNcbiAgICAgICAgICAgICAgICBjaGFydC5ncm91cHMoW2dyb3Vwc10pO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEubmFtZXMoY29sTmFtZXMpO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmF4aXMubGFiZWxzKHtcbiAgICAgICAgICAgICAgICAgICAgeTogXy5jYXBpdGFsaXplKHlVbml0c1swXSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjaGFydC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIHVubG9hZDogcmVtb3ZlSWRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5vIGNoYXJ0IHlldCwgc28gc2V0IGl0IHVwXG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJyNtZXRyaWNzJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogJ3gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbZ3JvdXBzXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBjb2xOYW1lc1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWJjaGFydDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogdm0uc3ViY2hhcnRFbmFibGVkXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46IHNjYWxlQ29uZmlnLmNvbG9ycy5wYXR0ZXJuRDMyMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBheGlzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGltZXNlcmllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGF0ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ291dGVyLWNlbnRlcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHlVbml0c1swXSA9PT0gJ3NlY29uZHMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbihtb21lbnQudXRjKCkuc3RhcnRPZignZCcpLCBtb21lbnQudXRjKCkuc3RhcnRPZignZCcpLmFkZChkLCAncycpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeVVuaXRzWzBdID09PSAnYnl0ZXMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhkLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfLmNhcGl0YWxpemUoeVVuaXRzWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdvdXRlci1taWRkbGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc2V0IGNoYXJ0IGhlaWdodFxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY2hhcnRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQ7XG5cbiAgICAgICAgICAgIHZtLmNoYXJ0U3R5bGUgPSAnaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBjaGFydE1heEhlaWdodCArICdweDsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ21ldHJpY3NTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgZ2V0UGxvdERhdGFQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgY2hvaWNlX2lkLCBjb2x1bW4sIGdyb3VwLCBkYXRhVHlwZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coY2hvaWNlX2lkKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IGNob2ljZV9pZCxcbiAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcbiAgICAgICAgICAgICAgICBncm91cDogZ3JvdXAsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXREYXRhVHlwZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERhdGFUeXBlTWV0cmljczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ21ldHJpY3MnKSArICdtZXRyaWNzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERhdGFUeXBlT3B0aW9uczogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvJyArIG5hbWUgKyAnLyc7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBsb3REYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRQbG90RGF0YVBhcmFtcygpLFxuICAgICAgICAgICAgICAgICAgICBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ21ldHJpY3MnKSArICdtZXRyaWNzLycgKyBwYXJhbXMuZGF0YVR5cGUgKyAnL3Bsb3QtZGF0YS8nLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEdlbmVyYXRlZFBsb3REYXRhOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJldHVybk9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IDI4LFxuICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91czogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW11cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIG51bURheXMgPSBtb21lbnQudXRjKG9iai5wYXJhbXMuZW5kZWQpLmRpZmYobW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLCAnZCcpICsgMTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChvYmoucXVlcnkuc2VsZWN0ZWRNZXRyaWNzLCBmdW5jdGlvbiAobWV0cmljKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5SZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IG1ldHJpYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbl94OiBtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCkuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhfeDogbW9tZW50LnV0YyhvYmoucGFyYW1zLmVuZGVkKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbl95OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3k6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURheXM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5xdWVyeS5maWx0ZXJzQXBwbGllZC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9iai5xdWVyeS5maWx0ZXJzQXBwbGllZCwgZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLmFkZChpLCAnZCcpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAwIC0gMSArIDEpKSArIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsdGVyLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCkuYWRkKGksICdkJykuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMCAtIDEgKyAxKSkgKyAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqLnJlc3VsdHMucHVzaChyZXR1cm5SZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybk9iaik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbmF2Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkd2luZG93LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzY2FsZUNvbmZpZy5jb2xvcnMubmF2X2JnO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udmVyc2lvbiA9ICcnO1xuICAgICAgICB2bS5hY3RpdmVQYWdlID0gJ292ZXJ2aWV3JztcbiAgICAgICAgdm0uZG9jc1VybCA9IHNjYWxlQ29uZmlnLnVybHMuZG9jdW1lbnRhdGlvbjtcblxuICAgICAgICB2bS5nb3RvID0gZnVuY3Rpb24obG9jKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCcnKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGxvYyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGxvY2F0aW9uVXBkYXRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uYWN0aXZlUGFnZSA9IG5hdlNlcnZpY2UubG9jYXRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UucmVnaXN0ZXJPYnNlcnZlcihsb2NhdGlvblVwZGF0ZWQpO1xuXG4gICAgICAgICAgICBzY2FsZVNlcnZpY2UuZ2V0VmVyc2lvbigpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS52ZXJzaW9uID0gZGF0YS52ZXJzaW9uO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRWZXJzaW9uKGRhdGEudmVyc2lvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8qKlxuICAgICAqIFNlZTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjU3Njc5OC9hbmd1bGFyanMtaG93LXRvLXdhdGNoLXNlcnZpY2UtdmFyaWFibGVzLzE3NTU4ODg1IzE3NTU4ODg1XG4gICAgICogRG9pbmcgdGhpbmdzIHRoaXMgd2F5IHNvIHRoYXQgc3NOYXZiYXJDb250cm9sbGVyIGNhbiBnZXQgbm90aWZpZWRcbiAgICAgKiB3aGVuIHRoZSBsb2NhdGlvbiBjaGFuZ2VzLiBUaGVuLCBvdXIgY29udHJvbGxlcnMganVzdCBuZWVkIHRvIGNhbGwgaW50b1xuICAgICAqIHRoaXMgc2VydmljZSB0byB1cGRhdGVMb2NhdGlvbi5cbiAgICAgKlxuICAgICAqIFRoZSBvbmx5IHRoaW5nIEkgZG9uJ3QgbGlrZSBhYm91dCB0aGlzIGlzIHRoYXQgdGhlIGluZGl2aWR1YWxcbiAgICAgKiBjb250cm9sbGVycyBoYXZlIHRvIGNhbGwgaW4gYW5kIHRlbGwgdGhlIHNzTmF2aWdhdGlvblNlcnZpY2Ugd2hhdFxuICAgICAqIHBhZ2UgdGhleSBhcmUgc2hvd2luZy5cbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCduYXZTZXJ2aWNlJywgZnVuY3Rpb24gKCRsb2NhdGlvbikge1xuXG4gICAgICAgIHRoaXMubG9jYXRpb24gPSAnb3ZlcnZpZXcnOyAvLyB3aGVyZSB0aGUgYXBwIHN0YXJ0c1xuXG4gICAgICAgIHZhciBvYnNlcnZlcnMgPSBbXTtcblxuICAgICAgICB0aGlzLnJlZ2lzdGVyT2JzZXJ2ZXIgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgb2JzZXJ2ZXJzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubm90aWZ5T2JzZXJ2ZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gob2JzZXJ2ZXJzLCBmdW5jdGlvbihvYnNlcnZlcikge1xuICAgICAgICAgICAgICAgIG9ic2VydmVyKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnVwZGF0ZUxvY2F0aW9uID0gZnVuY3Rpb24obG9jYXRpb25Jbikge1xuICAgICAgICAgICAgdGhpcy5sb2NhdGlvbiA9IGxvY2F0aW9uSW47XG4gICAgICAgICAgICB0aGlzLm5vdGlmeU9ic2VydmVycygpO1xuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzdWJuYXZTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgY3VycmVudFBhdGggPSAnJztcblxuICAgICAgICB0aGlzLnNldEN1cnJlbnRQYXRoID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gcGF0aDtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdldEN1cnJlbnRQYXRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQYXRoO1xuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3dvcmtzcGFjZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsICRyb3V0ZVBhcmFtcywgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHdvcmtzcGFjZXNTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIGdyaWRGYWN0b3J5LCBXb3Jrc3BhY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY3VycldvcmtzcGFjZSA9IHt9LFxuICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IFtdLFxuICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gW107XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLnNob3dBY3RpdmUgPSBzdGF0ZVNlcnZpY2UuZ2V0U2hvd0FjdGl2ZVdvcmtzcGFjZXMoKTtcbiAgICAgICAgdm0ud29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5sb2NhbFdvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0ge307XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHZtLnVzZXIgJiYgdm0udXNlci5pc19hZG1pbik7XG4gICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZVR5cGVzID0gXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXMpO1xuXG4gICAgICAgIHZtLmNhbmNlbENyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAvLyByZXZlcnQgYW55IGNoYW5nZXMgdG8gdGhlIHdvcmtzcGFjZVxuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKGN1cnJXb3Jrc3BhY2UpKTtcbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQgPT09ICcwJykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvd29ya3NwYWNlcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmVkaXRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzdG9yZSBhIHJlZmVyZW5jZSBvZiB0aGUgd29ya3NwYWNlIGFzIGl0IGN1cnJlbnRseSBleGlzdHMgaW4gY2FzZSB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0XG4gICAgICAgICAgICBjdXJyV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgdm0ubW9kZSA9ICdlZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zYXZlV29ya3NwYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2Uuc2F2ZVdvcmtzcGFjZSh2bS5hY3RpdmVXb3Jrc3BhY2UpLnRoZW4oZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcih3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3dvcmtzcGFjZScgKyB2bS5hY3RpdmVXb3Jrc3BhY2UuaWQsIEpTT04uc3RyaW5naWZ5KHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgICAgIGdldFdvcmtzcGFjZXMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNsZWFyTG9jYWxXb3Jrc3BhY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxvY2FsV29ya3NwYWNlcywgZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd3b3Jrc3BhY2UnICsgd29ya3NwYWNlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy93b3Jrc3BhY2VzJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5uZXdXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICB2bS5sb2FkV29ya3NwYWNlKDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmxvYWRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCd3b3Jrc3BhY2VzLycgKyBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFdhcm5pbmdzSHRtbCA9IGZ1bmN0aW9uICh3YXJuaW5ncykge1xuICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9ICcnO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHdhcm5pbmdzLCBmdW5jdGlvbiAod2FybmluZykge1xuICAgICAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGI+JyArIHdhcm5pbmcuaWQgKyAnOjwvYj4gJyArIHdhcm5pbmcuZGV0YWlscyArICc8YnIgLz48YnIgLz4nO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBjbGVhclwiPkhpZGU8L2J1dHRvbj4nO1xuICAgICAgICAgICAgcmV0dXJuIHdhcm5pbmdzSHRtbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS52YWxpZGF0ZVdvcmtzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UudmFsaWRhdGVXb3Jrc3BhY2Uodm0uYWN0aXZlV29ya3NwYWNlKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEud2FybmluZ3MgJiYgZGF0YS53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwoZGF0YS53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdXb3Jrc3BhY2UgaXMgdmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yLmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmFjdGl2ZVdvcmtzcGFjZS5qc29uX2NvbmZpZy5icm9rZXIudHlwZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSAnbmZzJykge1xuICAgICAgICAgICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gc2NhbGVDb25maWcubmZzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlID09PSAnaG9zdCcpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLmhvc3RCcm9rZXJEZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUgPT09ICdzMycpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLnMzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNob3dBY3RpdmUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLnNob3dBY3RpdmUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRTaG93QWN0aXZlV29ya3NwYWNlcyhuZXdWYWx1ZSk7XG4gICAgICAgICAgICB2bS53b3Jrc3BhY2VzID0gdm0uc2hvd0FjdGl2ZSA/IF8uY2xvbmVEZWVwKGFjdGl2ZVdvcmtzcGFjZXMpIDogXy5jbG9uZURlZXAoaW5hY3RpdmVXb3Jrc3BhY2VzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGdldFdvcmtzcGFjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc0tleTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IHNLZXkgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9Kc29uW3NLZXldID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oc0tleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXy5maWx0ZXIoXy5wYWlycyhvSnNvbiksIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5jb250YWlucyhvWzBdLCAnd29ya3NwYWNlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IEpTT04ucGFyc2Uob1sxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9jYWxXb3Jrc3BhY2VzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IF8uZmlsdGVyKGRhdGEsIHsgJ2lzX2FjdGl2ZSc6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gXy5maWx0ZXIoZGF0YSwgeyAnaXNfYWN0aXZlJzogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgdm0ud29ya3NwYWNlcyA9IHZtLnNob3dBY3RpdmUgPyBfLmNsb25lRGVlcChhY3RpdmVXb3Jrc3BhY2VzKSA6IF8uY2xvbmVEZWVwKGluYWN0aXZlV29ya3NwYWNlcyk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0V29ya3NwYWNlcygpO1xuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gbnVsbDtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG5cbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYWN0aXZlV29ya3NwYWNlID0gd29ya3NwYWNlIGRldGFpbHMgZm9yIGlkXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignd29ya3NwYWNlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0ICsgNjA7XG5cbiAgICAgICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJ2hlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdXb3Jrc3BhY2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIFdvcmtzcGFjZSA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBiYXNlX3VybCwgaXNfYWN0aXZlLCB1c2VkX3NpemUsIHRvdGFsX3NpemUsIGNyZWF0ZWQsIGFyY2hpdmVkLCBsYXN0X21vZGlmaWVkLCBqc29uX2NvbmZpZykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuYmFzZV91cmwgPSBiYXNlX3VybDtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy51c2VkX3NpemUgPSB1c2VkX3NpemU7XG4gICAgICAgICAgICB0aGlzLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmpzb25fY29uZmlnID0ganNvbl9jb25maWcgfHwgXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXNbMF0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIFdvcmtzcGFjZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBjbGVhbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBiYXNlX3VybDogdGhpcy5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICAgICAgaXNfYWN0aXZlOiB0aGlzLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAganNvbl9jb25maWc6IHRoaXMuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBXb3Jrc3BhY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmtzcGFjZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmJhc2VfdXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VkX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWxfc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBXb3Jrc3BhY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChXb3Jrc3BhY2UuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFdvcmtzcGFjZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gV29ya3NwYWNlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnd29ya3NwYWNlc1NlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRXb3Jrc3BhY2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3dvcmtzcGFjZXMnKSArICd3b3Jrc3BhY2VzLyc7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgb3JkZXI6ICctdGl0bGUnIH1cbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRXb3Jrc3BhY2VEZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJyArIGlkICsgJy8nO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbGlkYXRlV29ya3NwYWNlOiBmdW5jdGlvbiAod29ya3NwYWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjbGVhbldvcmtzcGFjZSA9IHdvcmtzcGFjZS5jbGVhbigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3dvcmtzcGFjZXMnKSArICd3b3Jrc3BhY2VzL3ZhbGlkYXRpb24vJywgY2xlYW5Xb3Jrc3BhY2UpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2F2ZVdvcmtzcGFjZTogZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgIGlmICghd29ya3NwYWNlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCd3b3Jrc3BhY2VzJykgKyAnd29ya3NwYWNlcy8nLCB3b3Jrc3BhY2UuY2xlYW4oKSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBhdGNoKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJyArIHdvcmtzcGFjZS5pZCArICcvJywgd29ya3NwYWNlLmNsZWFuKCkpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHdvcmtzcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZURldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHRpbWVvdXQsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5ub2RlSWQgPSAkcm91dGVQYXJhbXMuaWQ7XG4gICAgICAgIHZtLnNjYWxlU2VydmljZSA9IHNjYWxlU2VydmljZTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZURldGFpbHMgPSBmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2RlKG5vZGVJZCkudGhlbiggZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5ub2RlID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdub2RlcycpO1xuICAgICAgICAgICAgZ2V0Tm9kZURldGFpbHModm0ubm9kZUlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdub2Rlc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHRpbWVvdXQsICR1aWJNb2RhbCwgbmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIGdyaWRGYWN0b3J5LCB0b2FzdHIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5ub2Rlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXROb2Rlc1BhcmFtcygpO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0ubm9kZVN0YXR1cyA9IFtdO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgdm0ubm9kZXNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLm5vZGVzRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5zdGF0dXNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLnN0YXR1c0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uQ3VycmVudFBhZ2UgPSB2bS5ub2Rlc1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLm5vZGVzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICAkc2NvcGUucGF1c2VSZWFzb24gPSAnJztcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeU9yZGVyID0gdm0ubm9kZXNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgdm0uY29sRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2hvc3RuYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0hvc3RuYW1lJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48ZGl2IGNsYXNzPVwicHVsbC1yaWdodFwiIG5nLXNob3c9XCIhZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSAmJiBncmlkLmFwcFNjb3BlLnZtLm5vZGVTdGF0dXMubGVuZ3RoID4gMFwiPjxidXR0b24gY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnZtLnBhdXNlTm9kZShyb3cuZW50aXR5KVwiPjxpIGNsYXNzPVwiZmFcIiBuZy1jbGFzcz1cInsgXFwnZmEtcGF1c2VcXCc6ICFyb3cuZW50aXR5LmlzX3BhdXNlZCwgXFwnZmEtcGxheVxcJzogcm93LmVudGl0eS5pc19wYXVzZWQgfVwiPjwvaT48L2J1dHRvbj48L2Rpdj4ge3sgcm93LmVudGl0eS5ob3N0bmFtZSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpc19vbmxpbmUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU3RhdHVzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIiBuZy1zaG93PVwicm93LmVudGl0eS5zdGF0dXNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LnN0YXR1c0xhYmVsXCI+PC9zcGFuPjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTdGF0aXN0aWNzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIiBuZy1zaG93PVwicm93LmVudGl0eS5zdGF0dXNcIj57eyByb3cuZW50aXR5LnN0YXR1cy5nZXRDZWxsRXJyb3IoKSB9fSAvIHt7IHJvdy5lbnRpdHkuc3RhdHVzLmdldENlbGxUb3RhbCgpIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0N1cnJlbnQgSm9icycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCIgbmctc2hvdz1cInJvdy5lbnRpdHkuc3RhdHVzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5zdGF0dXMuZ2V0Q2VsbEpvYnMoKVwiPjwvc3Bhbj48L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IHZtLmNvbERlZnM7XG5cbiAgICAgICAgdm0ucGF1c2VOb2RlID0gZnVuY3Rpb24gKGVudGl0eSkge1xuICAgICAgICAgICAgJHNjb3BlLnBhdXNlUmVhc29uID0gJyc7XG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBpZCA9IGVudGl0eS5pZDtcbiAgICAgICAgICAgIHZhciBub2RlU3RhdHVzID0gXy5maW5kKHZtLm5vZGVTdGF0dXMsIHsgbm9kZTogeyBpZDogaWQgfSB9KTtcbiAgICAgICAgICAgIHZhciBjdXJyX3N0YXRlID0gZW50aXR5LmlzX3BhdXNlZDtcblxuICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZVJlYXNvbiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5wYXVzZVJlYXNvbiA9IHZhbHVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhdXNlUmVzdW1lID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgbm9kZVN0YXR1cy5wYXVzZVJlc3VtZUNlbGwoJHNjb3BlLnBhdXNlUmVhc29uKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBfLmZpbmQodm0uZ3JpZE9wdGlvbnMuZGF0YSwgeyBpZDogcmVzdWx0LmlkIH0pO1xuICAgICAgICAgICAgICAgICAgICBlbnRpdHkuaXNfcGF1c2VkID0gcmVzdWx0LmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICAgICAgbm9kZVN0YXR1cy5ub2RlLmlzX3BhdXNlZCA9IGVudGl0eS5pc19wYXVzZWQ7XG4gICAgICAgICAgICAgICAgICAgIGVudGl0eS5zdGF0dXNMYWJlbCA9IHZtLmdldFN0YXR1c0xhYmVsKG5vZGVTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3Vycl9zdGF0ZSA9PT0gZW50aXR5LmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcoZW50aXR5Lmhvc3RuYW1lICsgJyBTdGF0dXMgVW5jaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZW50aXR5LmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmluZm8obm9kZS5ob3N0bmFtZSArICcgUGF1c2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbyhub2RlLmhvc3RuYW1lICsgJyBSZXN1bWVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIG9ubHkgcHJvbXB0IGZvciByZWFzb24gd2hlbiBwYXVzaW5nIChub3QgcmVzdW1pbmcpXG4gICAgICAgICAgICBpZiAoIW5vZGVTdGF0dXMubm9kZS5pc19wYXVzZWQgJiYgIW5vZGVTdGF0dXMubm9kZS5pc19wYXVzZWRfZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXVzZURpYWxvZy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdXNlUmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhdXNlUmVzdW1lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0U3RhdHVzTGFiZWwgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICB2YXIgb25saW5lID0gc3RhdHVzLmlzX29ubGluZSA/ICc8c3BhbiBjbGFzcz1cImxhYmVsIGxhYmVsLW9ubGluZVwiPk9ubGluZTwvc3Bhbj4nIDogJzxzcGFuIGNsYXNzPVwibGFiZWwgbGFiZWwtb2ZmbGluZVwiPk9mZmxpbmU8L3NwYW4+JztcbiAgICAgICAgICAgIHZhciBwYXVzZWQgPSBzdGF0dXMubm9kZS5pc19wYXVzZWQgPyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1wYXVzZWRcIj5QYXVzZWQ8L3NwYW4+JyA6ICcnO1xuICAgICAgICAgICAgdmFyIHBhdXNlZEVycm9ycyA9IHN0YXR1cy5ub2RlLmlzX3BhdXNlZF9lcnJvcnMgPyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1wYXVzZWQtZXJyb3JzXCI+UGF1c2VkIHdpdGggRXJyb3JzPC9zcGFuPicgOiAnJztcbiAgICAgICAgICAgIHJldHVybiBvbmxpbmUgKyAnICcgKyBwYXVzZWQgKyAnICcgKyBwYXVzZWRFcnJvcnM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXROb2Rlc1BhcmFtcyh2bS5ub2Rlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGdldE5vZGVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0ubm9kZXNQYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZU5vZGVPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIGlmICh2bS5hY3Rpb25DbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHt9KTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ub2Rlcy8nICsgcm93LmVudGl0eS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0ubm9kZXNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLm5vZGVzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2VTaXplO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5jb3JlLm9uLnNvcnRDaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGdyaWQsIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyaWRBcGkuZ3JpZC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jb2xEZWYuc29ydCA9IGNvbC5zb3J0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXROb2Rlc0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVOb2RlT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2Rlcyh2bS5ub2Rlc1BhcmFtcykudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVzRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIG5vZGVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE5vZGVTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2RlU3RhdHVzKG51bGwsIG51bGwsICdQVDNIJywgbnVsbCkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXNFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVTdGF0dXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXNFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgbm9kZSBzdGF0dXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Tm9kZXNQYXJhbXModm0ubm9kZXNQYXJhbXMpO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICAgICAgdmFyIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgICAgIHZtLnJlYWRvbmx5ID0gISh1c2VyICYmIHVzZXIuaXNfYWRtaW4pO1xuICAgICAgICAgICAgZ2V0Tm9kZXMoKTtcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ25vZGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Tm9kZXNDb2xEZWZzKCknLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmNvbERlZnMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXROb2Rlc1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0ubm9kZVN0YXR1cycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyaWRPcHRpb25zLmRhdGEsIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IF8uZmluZChuZXdWYWx1ZSwgeyBub2RlOiB7IGlkOiBub2RlLmlkIH0gfSk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBub2RlLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXR1cyBjaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc3RhdHVzTGFiZWwgPSB2bS5nZXRTdGF0dXNMYWJlbChzdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc05vZGVIZWFsdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZXNPZmZsaW5lID0gMDtcbiAgICAgICAgdm0ubm9kZXNQYXVzZWRFcnJvcnMgPSAwO1xuICAgICAgICB2bS5ub2Rlc1BhdXNlZCA9IDA7XG4gICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCA9IDA7XG4gICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZEVycm9ycyA9IDA7XG4gICAgICAgIHZtLmhlYWx0aHlOb2RlcyA9IDA7XG4gICAgICAgIHZtLnRvdGFsTm9kZXMgPSAwO1xuXG4gICAgICAgIHZhciBnZXROb2RlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0udG90YWxOb2RlcyA9IHZtLm5vZGVzLmxlbmd0aDtcblxuICAgICAgICAgICAgdmFyIG5vZGVzT2ZmbGluZSA9IFtdLFxuICAgICAgICAgICAgICAgIG5vZGVzUGF1c2VkRXJyb3JzID0gW10sXG4gICAgICAgICAgICAgICAgbm9kZXNQYXVzZWQgPSBbXSxcbiAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnMgPSBbXSxcbiAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWQgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLm5vZGVzLCBmdW5jdGlvbiAobikge1xuICAgICAgICAgICAgICAgIGlmICghbi5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBpcyBvZmZsaW5lXG4gICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobi5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmUucHVzaChuKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgaXMgb25saW5lXG4gICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNQYXVzZWRFcnJvcnMucHVzaChuKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuLm5vZGUuaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BhdXNlZC5wdXNoKG4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZtLm5vZGVzT2ZmbGluZSA9IG5vZGVzT2ZmbGluZS5sZW5ndGg7XG4gICAgICAgICAgICB2bS5ub2Rlc1BhdXNlZEVycm9ycyA9IG5vZGVzUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgIHZtLm5vZGVzUGF1c2VkID0gbm9kZXNQYXVzZWQubGVuZ3RoO1xuICAgICAgICAgICAgdm0ubm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzID0gbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCA9IG5vZGVzT2ZmbGluZUFuZFBhdXNlZC5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIGFkZCB0aGUgbGVuZ3RoIG9mIG5vZGVzIGJvdGggb2ZmbGluZSBhbmQgcGF1c2VkIHRvIHByb2R1Y2UgYW4gYWNjdXJhdGUgaGVhbHRoeSBjb3VudFxuICAgICAgICAgICAgdm0uaGVhbHRoeU5vZGVzID0gdm0udG90YWxOb2RlcyAtIHZtLm5vZGVzT2ZmbGluZSAtIHZtLm5vZGVzUGF1c2VkRXJyb3JzIC0gdm0ubm9kZXNQYXVzZWQgLSB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWQgLSB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnM7XG5cbiAgICAgICAgICAgIHZhciBkb251dERhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHBlcmNlbnRhZ2Ugb2YgaGVhbHRoeSBub2RlcywgYW5kIGJyZWFrZG93biBvZiB3aHkgbm9kZXMgYXJlIHVuaGVhbHRoeVxuICAgICAgICAgICAgdmFyIGdhdWdlRGF0YSA9IHZtLnRvdGFsTm9kZXMgPiAwID8gKCh2bS5oZWFsdGh5Tm9kZXMgLyB2bS50b3RhbE5vZGVzKSAqIDEwMCkudG9GaXhlZCgyKSA6IDAuMDA7XG5cbiAgICAgICAgICAgIGlmICh2bS5ub2Rlc09mZmxpbmUgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPZmZsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZtLm5vZGVzT2ZmbGluZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNQYXVzZWRFcnJvcnMgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdIaWdoIEZhaWx1cmUgUmF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB2bS5ub2Rlc1BhdXNlZEVycm9yc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNQYXVzZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdQYXVzZWQnLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdm0ubm9kZXNQYXVzZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCkge1xuICAgICAgICAgICAgICAgIGRvbnV0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnT2ZmbGluZSBhbmQgUGF1c2VkJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPZmZsaW5lIGFuZCBQYXVzZWQgZHVlIHRvIEVycm9ycycsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdm0ubm9kZUhlYWx0aCA9IHtcbiAgICAgICAgICAgICAgICBnYXVnZURhdGE6IGdhdWdlRGF0YSxcbiAgICAgICAgICAgICAgICBkb251dERhdGE6IGRvbnV0RGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICB2bS5ub2RlcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1cygpO1xuICAgICAgICB9KTtcbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc05vZGVIZWFsdGgnLCBmdW5jdGlvbigpe1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtbm9kZS1oZWFsdGggLz5cbiAgICAgICAgICoqL1xuICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzTm9kZUhlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvZGlyZWN0aXZlcy9ub2RlSGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgIHNob3dEZXNjcmlwdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgICBsb2FkaW5nOiAnPSdcbiAgICAgICAgICAgICB9XG4gICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZVN0YXR1c0dyaWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjZWxsU2l6ZSA9ICRzY29wZS5jZWxsU2l6ZSB8fCAnMTBweCc7XG5cbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0uaG91cnMgPSAkc2NvcGUuaG91cnMgfHwgMztcbiAgICAgICAgdm0uY2VsbFN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IGNlbGxTaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBjZWxsU2l6ZVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldE5vZGVDbGFzcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0Tm9kZUNsYXNzJyk7XG4gICAgICAgICAgICBpZiAoIW5vZGUuaXNfb25saW5lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdvZmZsaW5lJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdpcy1wYXVzZWQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdpcy1wYXVzZWQtZXJyb3JzJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ29ubGluZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udmlld05vZGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdub2Rlcy8nICsgaWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF8uZm9yRWFjaChuZXdWYWx1ZSwgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUuaXNfb25saW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnb2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnaXMtcGF1c2VkJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jbGFzcyA9ICdpcy1wYXVzZWQtZXJyb3JzJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnb25saW5lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0ubm9kZXMgPSBuZXdWYWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNOb2RlU3RhdHVzR3JpZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdub2RlU3RhdHVzR3JpZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL25vZGVzL2RpcmVjdGl2ZXMvbm9kZVN0YXR1c0dyaWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICBob3VyczogJz0nLFxuICAgICAgICAgICAgICAgIGNlbGxTaXplOiAnQCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZScsIGZ1bmN0aW9uIChOb2RlUmVzb3VyY2VzLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIE5vZGUgPSBmdW5jdGlvbiAoaWQsIGhvc3RuYW1lLCBwb3J0LCBzbGF2ZV9pZCwgaXNfcGF1c2VkLCBpc19wYXVzZWRfZXJyb3JzLCBpc19hY3RpdmUsIGFyY2hpdmVkLCBjcmVhdGVkLCBsYXN0X29mZmVyLCBsYXN0X21vZGlmaWVkLCBqb2JfZXhlc19ydW5uaW5nLCByZXNvdXJjZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgICAgICB0aGlzLnNsYXZlX2lkID0gc2xhdmVfaWQ7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkX2Vycm9ycyA9IGlzX3BhdXNlZF9lcnJvcnM7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3Rfb2ZmZXIgPSBsYXN0X29mZmVyO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4ZXNfcnVubmluZyA9IGpvYl9leGVzX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLnJlc291cmNlcyA9IE5vZGVSZXNvdXJjZXMudHJhbnNmb3JtZXIocmVzb3VyY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vZGUnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgdXNlZCByZXZlYWwgPSB0cnVlIG9uIGdyaWRDaGFydCBkaXJlY3RpdmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1BhdXNlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzX3BhdXNlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3J0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNsYXZlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX3BhdXNlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWRfZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3Rfb2ZmZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlc19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc291cmNlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb2RlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKE5vZGUuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZVJlc291cmNlcycsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBOb2RlUmVzb3VyY2VzID0gZnVuY3Rpb24gKHRvdGFsLCBzY2hlZHVsZWQsIHVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWwgPSB0b3RhbDtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkID0gc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gdXNlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgLy8gZ2V0RHVyYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVSZXNvdXJjZXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOb2RlUmVzb3VyY2VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgTm9kZVJlc291cmNlcy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChOb2RlUmVzb3VyY2VzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ05vZGVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIG5vZGVVcGRhdGVTZXJ2aWNlLCBOb2RlLCBKb2JFeGVjdXRpb24pIHtcbiAgICAgICAgdmFyIE5vZGVTdGF0dXMgPSBmdW5jdGlvbiAobm9kZSwgaXNfb25saW5lLCBqb2JfZXhlX2NvdW50cywgam9iX2V4ZXNfcnVubmluZykge1xuICAgICAgICAgICAgdGhpcy5ub2RlID0gTm9kZS50cmFuc2Zvcm1lcihub2RlKTtcbiAgICAgICAgICAgIHRoaXMuaXNfb25saW5lID0gaXNfb25saW5lO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlX2NvdW50cyA9IGpvYl9leGVfY291bnRzO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlc19ydW5uaW5nID0gSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGpvYl9leGVzX3J1bm5pbmcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcbiAgICAgICAgTm9kZVN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnTm9kZVN0YXR1cyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q29tcGxldGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbXBsZXRlZCA9IF8uZmluZCh0aGlzLmpvYl9leGVfY291bnRzLCAnc3RhdHVzJywgJ0NPTVBMRVRFRCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZWQgPyBjb21wbGV0ZWQuY291bnQgOiAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWQgPSBfLmZpbmQodGhpcy5qb2JfZXhlX2NvdW50cywgJ3N0YXR1cycsICdGQUlMRUQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbGVkID8gZmFpbGVkLmNvdW50IDogMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmlsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9ICcnO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X29yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5vZGUuaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3c7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yID0gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJ1bm5pbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBjb3VudDogMCB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnRmFpbGVkOiAnICsgdGhpcy5nZXRGYWlsZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0NvbXBsZXRlZDogJyArIHRoaXMuZ2V0Q29tcGxldGVkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFN0YXR1czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnSGlnaCBGYWlsdXJlIFJhdGUnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUGF1c2VkJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnT25saW5lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnT2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxKb2JzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSAnJztcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godGhpcy5qb2JfZXhlc19ydW5uaW5nLCBmdW5jdGlvbiAoam9iRXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBqb2JFeGVjdXRpb24uam9iLmpvYl90eXBlLmljb25fY29kZSA/XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKyAnICcgKyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBqb2JFeGVjdXRpb24uam9iLmpvYl90eXBlLmljb25fY29kZSArICc8L2k+JyA6XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKyAnICcgKyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFBhdXNlUmVzdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5pc19wYXVzZWQgPyAnJiN4ZjA0YjsnIDogJyYjeGYwNGM7JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZVJlc3VtZUNlbGw6IGZ1bmN0aW9uIChwYXVzZV9yZWFzb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGF1c2VfcmVhc29uOiBwYXVzZV9yZWFzb24gfHwgJycsXG4gICAgICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogIXRoaXMubm9kZS5pc19wYXVzZWRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBub2RlVXBkYXRlU2VydmljZS51cGRhdGVOb2RlKHRoaXMubm9kZS5pZCwgdXBkYXRlRGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOb2RlLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlX2NvdW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlc19ydW5uaW5nXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIE5vZGVTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoTm9kZVN0YXR1cy5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gTm9kZVN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gTm9kZVN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ25vZGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgTm9kZSwgTm9kZVN0YXR1cywgcG9sbGVyLCBwb2xsZXJGYWN0b3J5KSB7XG4gICAgICAgIHZhciBnZXROb2Rlc1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgaW5jbHVkZV9pbmFjdGl2ZSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVfaW5hY3RpdmU6IGluY2x1ZGVfaW5hY3RpdmUsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE5vZGVTdGF0dXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuXG4gICAgICAgICAgICBpZihwYWdlKSB7IHBhcmFtcy5wYWdlID0gcGFnZTsgfVxuICAgICAgICAgICAgaWYocGFnZV9zaXplKSB7IHBhcmFtcy5wYWdlX3NpemUgPSBwYWdlX3NpemU7IH1cbiAgICAgICAgICAgIGlmKHN0YXJ0ZWQpIHsgcGFyYW1zLnN0YXJ0ZWQgPSBzdGFydGVkOyB9XG4gICAgICAgICAgICBpZihlbmRlZCkgeyBwYXJhbXMuZW5kZWQgPSBlbmRlZDsgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXROb2RlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXROb2Rlc1BhcmFtcygpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy51cmwgPSBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbm9kZXMnKSArICdub2Rlcy8nO1xuXG4gICAgICAgICAgICAgICAgdmFyIG5vZGVzUmVzb3VyY2UgPSAkcmVzb3VyY2UocGFyYW1zLnVybCwgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgbm9kZXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihub2Rlc1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLm5vZGVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBub2Rlc1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZXNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldE5vZGVzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IE5vZGUudHJhbnNmb3JtZXIoZGF0YS5ub2Rlcyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXR1cm5EYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlOiBmdW5jdGlvbiAoc2xhdmVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycgKyBzbGF2ZUlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gTm9kZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlU3RhdHVzOiBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBnZXROb2RlU3RhdHVzUGFyYW1zKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG5vZGVTdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ25vZGVzJykgKyAnbm9kZXMvc3RhdHVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIG5vZGVTdGF0dXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihub2RlU3RhdHVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMubm9kZVN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZVN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlU3RhdHVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlU3RhdHVzT25jZTogZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldE5vZGVTdGF0dXNQYXJhbXMocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCk7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbm9kZXMnKSArICdub2Rlcy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IE5vZGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlRGF0YTogZnVuY3Rpb24gKHNsYXZlSWQsIHNpbmNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICBzaW5jZSA9IHNpbmNlIHx8ICdQVDNIJztcblxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldE5vZGVzKCkudGhlbihmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2RlcyA9IG5vZGVzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROb2RlU3RhdHVzKHNpbmNlKS50aGVuKGZ1bmN0aW9uIChzdGF0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0cyA9IHN0YXRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdub2RlVXBkYXRlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsIHNjYWxlQ29uZmlnLCBOb2RlKSB7XG4gICAgICAgIHZhciBnZXROb2RlVXBkYXRlRGF0YSA9IGZ1bmN0aW9uIChwYXVzZV9yZWFzb24sIGlzX3BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYXVzZV9yZWFzb246IHBhdXNlX3JlYXNvbixcbiAgICAgICAgICAgICAgICBpc19wYXVzZWQ6IGlzX3BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlTm9kZTogZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwgZ2V0Tm9kZVVwZGF0ZURhdGEoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShOb2RlLnRyYW5zZm9ybWVyKHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdvdkNvbnRyb2xsZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBqb2JTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgc3RhdHVzU2VydmljZSwgZ2F1Z2VGYWN0b3J5LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzY2hlZHVsZXJTZXJ2aWNlLCB1c2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHZtLmpvYkVycm9yID0gbnVsbDtcbiAgICAgICAgdm0uam9iRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5sb2FkaW5nSm9icyA9IHRydWU7XG4gICAgICAgIHZtLmxvYWRpbmdOb2RlSGVhbHRoID0gdHJ1ZTtcbiAgICAgICAgdm0uam9iVHlwZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yID0gbnVsbDtcbiAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yU3RhdHVzID0gJyc7XG4gICAgICAgIHZtLmhvdXJWYWx1ZSA9IDM7XG4gICAgICAgIHZtLmpvYkRhdGEgPSB7XG4gICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgc3RhdHVzOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIHZtLmpvYkVycm9yQnJlYWtkb3duID0gW107XG4gICAgICAgIHZtLnN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLnN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgICAgIHZtLm1hc3RlclN0YXR1cyA9ICcnO1xuICAgICAgICB2bS5tYXN0ZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1zdWNjZXNzJztcbiAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzID0gJyc7XG4gICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LXN1Y2Nlc3MnO1xuICAgICAgICB2bS5tZW1DYWxjID0gJyc7XG4gICAgICAgIHZtLmRpc2tDYWxjID0gJyc7XG4gICAgICAgIHZtLnNjaGVkdWxlcklzUGF1c2VkID0gZmFsc2U7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0uc2NoZWR1bGVyQ29udGFpbmVyQ2xhc3MgPSB2bS51c2VyID8gdm0udXNlci5pc19hZG1pbiA/ICdjb2wteHMtOCBjb2wtbGctMTAnIDogJ2NvbC14cy0xMicgOiAnY29sLXhzLTEyJztcbiAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSAnZmEtcGF1c2UnO1xuXG4gICAgICAgIHZtLnRvZ2dsZVNjaGVkdWxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlcklzUGF1c2VkID0gIXZtLnNjaGVkdWxlcklzUGF1c2VkO1xuICAgICAgICAgICAgdmFyIHNjaGVkdWxlckRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaXNfcGF1c2VkOiB2bS5zY2hlZHVsZXJJc1BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNjaGVkdWxlclNlcnZpY2UudXBkYXRlU2NoZWR1bGVyKHNjaGVkdWxlckRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXMgPSBkYXRhLmlzX3BhdXNlZCA/ICdQYXVzZWQnIDogJ1J1bm5pbmcnO1xuICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gZGF0YS5pc19wYXVzZWQgPyAnYWxlcnQtd2FybmluZycgOiAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSBkYXRhLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVkcmF3R3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdHcmlkJywgdm0uam9iRGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXMoKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uam9iRGF0YS5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5qb2JFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIHR5cGVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JzID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0U3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNwdUdhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCdjcHUnLCAnQ1BVJywgMCwgMTAwLCAxODApLFxuICAgICAgICAgICAgICAgIG1lbUdhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCdtZW1vcnknLCAnTWVtb3J5JywgMCwgMTAwLCAxODApLFxuICAgICAgICAgICAgICAgIGRpc2tHYXVnZSA9IGdhdWdlRmFjdG9yeS5jcmVhdGVHYXVnZSgnZGlzaycsICdEaXNrJywgMCwgMTAwLCAxODApO1xuXG4gICAgICAgICAgICBzdGF0dXNTZXJ2aWNlLmdldFN0YXR1cygpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBjcHVHYXVnZS5yZWRyYXcocmVzdWx0LmdldENwdVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBtZW1HYXVnZS5yZWRyYXcocmVzdWx0LmdldE1lbVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBkaXNrR2F1Z2UucmVkcmF3KHJlc3VsdC5nZXREaXNrVXNhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIHZtLm1hc3RlclN0YXR1cyA9IHJlc3VsdC5tYXN0ZXIuaXNfb25saW5lID8gJ01hc3RlciBpcyBPbmxpbmUnIDogJ01hc3RlciBpcyBPZmZsaW5lJztcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzQ2xhc3MgPSByZXN1bHQubWFzdGVyLmlzX29ubGluZSA/ICdhbGVydC1zdWNjZXNzJyA6ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnNjaGVkdWxlci5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ1NjaGVkdWxlciBpcyBQYXVzZWQnIDogJ1NjaGVkdWxlciBpcyBSdW5uaW5nJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnYWxlcnQtd2FybmluZycgOiAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJJc1BhdXNlZCA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXMgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdTY2hlZHVsZXIgaXMgT2ZmbGluZTsgUGF1c2VkJyA6ICdTY2hlZHVsZXIgaXMgT2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVySXNQYXVzZWQgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlckJ0bkNsYXNzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnZmEtcGxheScgOiAnZmEtcGF1c2UnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVzb3VyY2VzLnNjaGVkdWxlZC5tZW0gJiYgcmVzdWx0LnJlc291cmNlcy50b3RhbC5tZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm1lbUNhbGMgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSkgKyAnIC8gJyArIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy50b3RhbC5tZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVzb3VyY2VzLnNjaGVkdWxlZC5kaXNrICYmIHJlc3VsdC5yZXNvdXJjZXMudG90YWwuZGlzaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGlza0NhbGMgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2spICsgJyAvICcgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMudG90YWwuZGlzayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXNFcnJvciA9IHJlc3VsdC5zdGF0dXNUZXh0ICYmIHJlc3VsdC5zdGF0dXNUZXh0ICE9PSAnJyA/IHJlc3VsdC5zdGF0dXNUZXh0IDogJ1VuYWJsZSB0byByZXRyaWV2ZSBjbHVzdGVyIHN0YXR1cy4nO1xuICAgICAgICAgICAgICAgICAgICBjcHVHYXVnZS5yZWRyYXcoLTEpO1xuICAgICAgICAgICAgICAgICAgICBtZW1HYXVnZS5yZWRyYXcoLTEpO1xuICAgICAgICAgICAgICAgICAgICBkaXNrR2F1Z2UucmVkcmF3KC0xKTtcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzID0gJ01hc3RlciBTdGF0dXMgaXMgVW5rbm93bic7XG4gICAgICAgICAgICAgICAgICAgIHZtLm1hc3RlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlckNvbnRhaW5lckNsYXNzID0gJ2NvbC14cy0xMic7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9ICdTY2hlZHVsZXIgU3RhdHVzIGlzIFVua25vd24nO1xuICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nU3RhdHVzID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5vZGVTZXJ2aWNlLmdldE5vZGVTdGF0dXMobnVsbCwgbnVsbCwgJ1BUM0gnLCBudWxsKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVIZWFsdGhFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgbm9kZXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ05vZGVIZWFsdGggPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdqb2JUeXBlU3RhdHVzJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS5qb2JEYXRhLnN0YXR1cyA9IGRhdGE7XG4gICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIGdldFN0YXR1cygpO1xuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1cygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignb3ZlcnZpZXcnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdyZWNpcGVEZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCBuYXZTZXJ2aWNlLCByZWNpcGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnJlY2lwZSA9IHt9O1xuICAgICAgICB2bS5yZWNpcGVJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5yZWNpcGVzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdyZWNpcGVzJyk7XG4gICAgICAgIHZtLmxvYWRpbmdSZWNpcGVEZXRhaWwgPSB0cnVlO1xuICAgICAgICB2bS5hY3RpdmVUYWIgPSAnc3RhdHVzJztcbiAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9ICcnO1xuXG4gICAgICAgIHZtLmdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uIChyZWNpcGVJZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IHRydWU7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZURldGFpbHMocmVjaXBlSWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZURldGFpbChkYXRhLnJlY2lwZV90eXBlLmlkKS50aGVuKGZ1bmN0aW9uKHJlY2lwZVR5cGUpe1xuICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVUeXBlID0gcmVjaXBlVHlwZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZURldGFpbCh2bS5yZWNpcGVJZCk7XG4gICAgICAgIH07XG5cblxuXG4gICAgICAgIHZtLnN3aXRjaFRhYiA9IGZ1bmN0aW9uICh0YWIpIHtcbiAgICAgICAgICAgICQoJyMnICsgdm0uYWN0aXZlVGFiKS5oaWRlKCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVUYWIgPSB0YWI7XG4gICAgICAgICAgICAkKCcjJyArIHZtLmFjdGl2ZVRhYikuc2hvdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZVR5cGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkdWliTW9kYWwsIGhvdGtleXMsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgcmVjaXBlU2VydmljZSwgc3VibmF2U2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCB1c2VyU2VydmljZSwgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgdm0ucmVjaXBlVHlwZXMgPSBbXTtcbiAgICAgICAgdm0ucmVjaXBlVHlwZUlkcyA9IFtdO1xuICAgICAgICB2bS5yZXF1ZXN0ZWRSZWNpcGVUeXBlSWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbnVsbDtcbiAgICAgICAgdm0ucGVyY2VudGFnZSA9IDczO1xuICAgICAgICB2bS5kYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdm0ucmVjaXBlcyA9IG51bGw7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7IC8vIHZhbGlkIHZhbHVlcyBhcmUgYWRkLCB2aWV3LCBhbmQgZWRpdFxuICAgICAgICB2bS5hZGRCdG5UZXh0ID0gJ05ldyBSZWNpcGUnO1xuICAgICAgICB2bS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB2bS5lZGl0QnRuVGV4dCA9ICdFZGl0JztcbiAgICAgICAgdm0uZWRpdEJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgdm0uZWRpdEJ0bkljb24gPSAnZmEtZWRpdCc7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbXTtcbiAgICAgICAgdm0uaXNSZWNpcGVNb2RpZmllZCA9IGZhbHNlO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9ICdjb2wteHMtMyc7XG4gICAgICAgIHZtLmRldGFpbENsYXNzID0gJ2NvbC14cy05JztcbiAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBmYWxzZTtcbiAgICAgICAgdm0ubWluaW1pemVCdG5DbGFzcyA9ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLmxvY2FsUmVjaXBlVHlwZXMgPSBbXTtcblxuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLnJlY2lwZXM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMvdHlwZXMnKTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzKCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb0pzb24gPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNLZXk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBzS2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbltzS2V5XSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHNLZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF8uZmlsdGVyKF8ucGFpcnMob0pzb24pLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMob1swXSwgJ3JlY2lwZVR5cGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gSlNPTi5wYXJzZShvWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2NhbFJlY2lwZVR5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZXMucHVzaCh0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVJZHMgPSBfLnBsdWNrKGRhdGEsICdpZCcpO1xuICAgICAgICAgICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsKHZtLnJlcXVlc3RlZFJlY2lwZVR5cGVJZCk7XG4gICAgICAgICAgICAgICAgaG90a2V5cy5iaW5kVG8oJHNjb3BlKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvOiAnY3RybCt1cCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1ByZXZpb3VzIFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRSZWNpcGVUeXBlKHZtLnJlY2lwZVR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICh2bS5yZWNpcGVUeXBlSWRzLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSh2bS5yZWNpcGVUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jbGVhckxvY2FsUmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfLmZvckVhY2godm0ubG9jYWxSZWNpcGVUeXBlcywgZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncmVjaXBlVHlwZScgKyB0eXBlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ubmV3UmVjaXBlVHlwZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvMCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKHJlY2lwZVR5cGVJZCkge1xuICAgICAgICAgICAgaWYgKHJlY2lwZVR5cGVJZCA+IDApIHtcbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVEZXRhaWwocmVjaXBlVHlwZUlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVJlY2lwZVR5cGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmKCByZWNpcGVUeXBlSWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbmV3IFJlY2lwZVR5cGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUgJiYgdm0uYWN0aXZlUmVjaXBlVHlwZS5tb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyBpZCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYW5jZWxcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvJyArIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29uZmlybUNoYW5nZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb25maXJtRGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBtb2RhbEluc3RhbmNlLnJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVNYXN0ZXIgPSBmdW5jdGlvbiAobWluaW1pemVNYXN0ZXIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbWluaW1pemVNYXN0ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBtaW5pbWl6ZU1hc3RlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSAhdm0ubWluaW1pemVNYXN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9IHZtLm1pbmltaXplTWFzdGVyID8gJ2NvbC14cy0xIG1pbmltaXplZCcgOiAnY29sLXhzLTMnO1xuICAgICAgICAgICAgdm0uZGV0YWlsQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdjb2wteHMtMTEnIDogJ2NvbC14cy05JztcbiAgICAgICAgICAgIHZtLm1pbmltaXplQnRuQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdmYSBmYS1jaGV2cm9uLXJpZ2h0JyA6ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd0b2dnbGVFZGl0JywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS50b2dnbGVNYXN0ZXIoZGF0YSA9PT0gJ2VkaXQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdyZWNpcGVNb2RpZmllZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmlzUmVjaXBlTW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0uc2F2ZUJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGdyaWRGYWN0b3J5KSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgcmVjaXBlVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5yZWNpcGVzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldFJlY2lwZXNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWNpcGVUeXBlVmFsdWVzID0gW3JlY2lwZVR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVUeXBlID0gdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkID8gdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkIDogcmVjaXBlVHlwZVZpZXdBbGw7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MucmVjaXBlcztcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnQgPSBtb21lbnQudXRjKHZtLnJlY2lwZXNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wID0gbW9tZW50LnV0Yyh2bS5yZWNpcGVzUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLnJlY2lwZXNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSB2bS5yZWNpcGVzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSB2bS5yZWNpcGVzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdyZWNpcGVfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSZWNpcGUgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkucmVjaXBlX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5yZWNpcGVfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkUmVjaXBlVHlwZVwiIG5nLW9wdGlvbnM9XCJyZWNpcGVUeXBlIGFzIChyZWNpcGVUeXBlLnRpdGxlICsgXFwnIFxcJyArIHJlY2lwZVR5cGUudmVyc2lvbikgZm9yIHJlY2lwZVR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5yZWNpcGVUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2NyZWF0ZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQ3JlYXRlZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuY3JlYXRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnbGFzdF9tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdMYXN0IE1vZGlmaWVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdkdXJhdGlvbicsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTIwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1yaWdodFwiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjb21wbGV0ZWQnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5jb21wbGV0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdldFJlY2lwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZXModm0ucmVjaXBlc1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMucHVzaChkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0ucmVjaXBlVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVUeXBlID0gXy5maW5kKHZtLnJlY2lwZVR5cGVWYWx1ZXMsIHsgaWQ6IHZtLnJlY2lwZXNQYXJhbXMudHlwZV9pZCB9KSB8fCByZWNpcGVUeXBlVmlld0FsbDtcbiAgICAgICAgICAgICAgICB2bS5nZXRSZWNpcGVzKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNQYXJhbXModm0ucmVjaXBlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5yZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVSZWNpcGVPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvcmVjaXBlLycgKyByb3cuZW50aXR5LmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlUmVjaXBlT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNQYXJhbXModm0ucmVjaXBlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2bS5nZXRSZWNpcGVUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbigncmVjaXBlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZFJlY2lwZVR5cGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChwYXJzZUludCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IF8uZmluZCh2bS5yZWNpcGVUeXBlVmFsdWVzLCB7aWQ6IHBhcnNlSW50KHZhbHVlKX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlSZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVSZWNpcGVUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlSZWNpcGVUeXBlID0gIWFuZ3VsYXIuZXF1YWxzKHZhbHVlLCByZWNpcGVUeXBlVmlld0FsbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZVJlY2lwZVR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0UmVjaXBlc0NvbERlZnMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY29sRGVmcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldFJlY2lwZXNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiLyoqXG4gKiA8YWlzLXNjYWxlLXJlY2lwZS12aWV3ZXIgLz5cbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgcmVjaXBlU2VydmljZSwgd29ya3NwYWNlc1NlcnZpY2UsIFJlY2lwZVR5cGUsIFJlY2lwZVR5cGVEZXRhaWwsIEpvYlR5cGUsIGxvY2FsU3RvcmFnZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0udmVydGljZXMgPSBbXTtcbiAgICAgICAgdm0uZWRnZXMgPSBbXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICB2bS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBudWxsO1xuICAgICAgICB2bS5tb2RlID0gbnVsbDtcbiAgICAgICAgdm0uZWRpdE1vZGUgPSBudWxsO1xuICAgICAgICB2bS5kZXBlbmRlbmN5QnRuQ2xhc3MgPSAnZmEtcGx1cyc7XG4gICAgICAgIHZtLmFkZEJ0blRleHQgPSAnTmV3IFJlY2lwZSc7XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLmVkaXRCdG5UZXh0ID0gJ0VkaXQnO1xuICAgICAgICB2bS5lZGl0QnRuQ2xhc3MgPSAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICB2bS5lZGl0QnRuSWNvbiA9ICdmYS1lZGl0JztcbiAgICAgICAgdm0uam9iVHlwZVZhbHVlcyA9IFtdO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5zYXZpbmdSZWNpcGUgPSBmYWxzZTtcbiAgICAgICAgdm0ud2FybmluZ3MgPSBbXTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSB0cnVlO1xuICAgICAgICB2bS5kZXRhaWxNYXhIZWlnaHQgPSAwO1xuICAgICAgICB2bS5yZWNpcGVUeXBlVHJpZ2dlciA9IHsgZGF0YVR5cGVzOiAnJyB9O1xuICAgICAgICB2bS5kZXRhaWxDb250YWluZXJTdHlsZSA9ICcnO1xuICAgICAgICB2bS5jb250YWluZXJDbGFzcyA9ICRzY29wZS5oYXNDb250YWluZXIgPyAnJyA6ICdkZXRhaWwtY29udGFpbmVyIG5vLXRhYnMnO1xuICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0ucmVjaXBlSW5wdXRUeXBlcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncHJvcGVydHknLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAgICAgIGZpZWxkczogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2ZpbGUnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRmlsZScsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdtZWRpYV90eXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ01lZGlhIFR5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmlsZXMnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRmlsZXMnLFxuICAgICAgICAgICAgICAgIGZpZWxkczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbWVkaWFfdHlwZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdNZWRpYSBUeXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgdm0uYXZhaWxhYmxlVHJpZ2dlclR5cGVzID0gc2NhbGVDb25maWcudHJpZ2dlclR5cGVzO1xuICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZSA9IHt9O1xuICAgICAgICB2bS5yZWNpcGVJbnB1dCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5pc0lFID0gc2NhbGVTZXJ2aWNlLmlzSUUoKTtcblxuICAgICAgICB2YXIgc3RhcnRKb2IgPSBudWxsO1xuICAgICAgICB2YXIgem9vbVNjYWxlID0gMDtcblxuICAgICAgICAvLyBEYWdyZSB2YXJpYWJsZXNcbiAgICAgICAgdmFyIHN2ZyA9IG51bGw7XG4gICAgICAgIHZhciBpbm5lciA9IG51bGw7XG4gICAgICAgIHZhciBncmFwaCA9IG51bGw7XG4gICAgICAgIHZhciB6b29tID0gbnVsbDtcbiAgICAgICAgdmFyIHJlbmRlciA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdldENsb3Nlc3ROb2RlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmZpbHRlcihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkID09PSBuYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE90aGVyTm9kZXMgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGQzLnNlbGVjdEFsbCgnLm5vZGVSZWN0JykuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQgIT09IG5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVzZXRFZGl0QnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZWRpdEJ0blRleHQgPSB2bS5tb2RlID09PSAnZWRpdCcgPyAnQ2FuY2VsIEVkaXQnIDogJ0VkaXQnO1xuICAgICAgICAgICAgdm0uZWRpdEJ0bkNsYXNzID0gdm0ubW9kZSA9PT0gJ2VkaXQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgICAgICB2bS5lZGl0QnRuSWNvbiA9IHZtLm1vZGUgPT09ICdlZGl0JyA/ICdmYS1jbG9zZScgOiAnZmEtZWRpdCc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJlc2V0QWRkQnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uYWRkQnRuVGV4dCA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ0NhbmNlbCcgOiAnTmV3IFJlY2lwZSc7XG4gICAgICAgICAgICB2bS5hZGRCdG5DbGFzcyA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICAgICB2bS5hZGRCdG5JY29uID0gdm0ubW9kZSA9PT0gJ2FkZCcgPyAnZmEtY2xvc2UnIDogJ2ZhLXBsdXMtY2lyY2xlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdG9nZ2xlQWRkUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubW9kZSA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ3ZpZXcnIDogJ2FkZCc7XG4gICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0b2dnbGVFZGl0UmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLm1vZGUgPT09ICdlZGl0Jykge1xuICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCgkc2NvcGUucmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAnZWRpdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgcmVzZXRFZGl0QnRuKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGVuYWJsZVNhdmVSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZS5tb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkaXNhYmxlU2F2ZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQ7J1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjb25maXJtQ2hhbmdlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB2bS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbmZpcm1EaWFsb2cuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBzaXplOiAnc20nXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG1vZGFsSW5zdGFuY2UucmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlSm9iQ2xhc3NOYW1lID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgLy8gZGVmYXVsdCB0byAnbm9zdGF0dXMnXG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJ25vc3RhdHVzJztcbiAgICAgICAgICAgIC8vIGZpbmQgdGhlIGFzc29jaWF0ZWQgam9iIGluIHRoZSByZWNpcGUuam9ic1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBlam9iID0gXy5maW5kKCRzY29wZS5yZWNpcGUuam9icyx7am9iX25hbWU6IGpvYi5uYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlY2lwZWpvYikge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSByZWNpcGVqb2Iuam9iLnN0YXR1cy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVEZXRhaWwoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBkYXRhO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUubW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICBjb25maXJtQ2hhbmdlUmVjaXBlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE9LXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc2V0QWRkQnRuKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWwoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbmNlbFxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRWRpdFJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICAgICAgICAgIGdldFJlY2lwZURldGFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgICAgIC8vJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWNpcGVNb2RpZmllZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm5vZGVDbGljayA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uIGNsYXNzXG4gICAgICAgICAgICAvLyQoJ2RpdicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIC8vIGZpbmQgdGhlIGpvYiBpbiB0aGUgcmVjaXBlIGRlZmluaXRpb25cbiAgICAgICAgICAgIHZhciBqb2IgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCB7IG5hbWU6IG5hbWUgfSk7XG5cbiAgICAgICAgICAgIGlmIChuYW1lID09PSAnc3RhcnQnKSB7XG4gICAgICAgICAgICAgICAgam9iID0gc3RhcnRKb2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgJG5hbWUgPSAkKCcjJyArIG5hbWUpO1xuICAgICAgICAgICAgdmFyIHBvcyA9ICRuYW1lLnBvc2l0aW9uKCk7XG5cbiAgICAgICAgICAgIC8vIGNsaWNrIG5vZGUgZGlmZmVyZW50IGZyb20gc2VsZWN0ZWRKb2JcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRKb2IgfHwgam9iLm5hbWUgIT09IHZtLnNlbGVjdGVkSm9iLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGREZXBlbmRlbmN5Jykge1xuICAgICAgICAgICAgICAgICAgICBhZGREZXBlbmRlbmN5KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5lZGl0TW9kZSA9PT0gJ2FkZElucHV0Jykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFN0ciA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoam9iLm5hbWUgPT09ICdzdGFydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSAnPHVsIGNsYXNzPVwibGlzdC1ncm91cFwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5pbnB1dF9kYXRhLCBmdW5jdGlvbiAocmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW1cIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxhIG9uY2xpY2s9XCJtYXBJbnB1dFJlY2lwZUlucHV0KFxcJycgKyByZWNpcGVJbnB1dC5uYW1lICsgJ1xcJylcIj4nICsgcmVjaXBlSW5wdXQubmFtZSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjaXBlSW5wdXQubWVkaWFfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGRpdiBjbGFzcz1cImlucHV0LW1lZGlhLXR5cGVzXCI+JyArIHJlY2lwZUlucHV0Lm1lZGlhX3R5cGVzLmpvaW4oJywnKSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L2xpPic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzwvdWw+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlbGVjdCBwcm92aWRlci9vdXRwdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLm91dHB1dF9kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gJzx1bCBjbGFzcz1cImxpc3QtZ3JvdXBcIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLm91dHB1dF9kYXRhLCBmdW5jdGlvbiAoam9iT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxhIG9uY2xpY2s9XCJtYXBJbnB1dChcXCcnICsgam9iLm5hbWUgKyAnXFwnLCBcXCcnICsgam9iT3V0cHV0Lm5hbWUgKyAnXFwnKVwiPicgKyBqb2JPdXRwdXQubmFtZSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYk91dHB1dC5tZWRpYV90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8ZGl2IGNsYXNzPVwiaW5wdXQtbWVkaWEtdHlwZXNcIj4nICsgam9iT3V0cHV0Lm1lZGlhX3R5cGUgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L2xpPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPC91bD4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdib2R5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTZWxlY3QgcHJvdmlkZXIvb3V0cHV0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGRPdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIgPSBqb2I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9ICc8dWwgY2xhc3M9XCJsaXN0LWdyb3VwXCI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGEgb25jbGljaz1cIm1hcE91dHB1dChcXCcnICsgam9iLm5hbWUgKyAnXFwnLCBcXCcnICsgam9iSW5wdXQubmFtZSArICdcXCcpXCI+JyArIGpvYklucHV0Lm5hbWUgKyAnPC9hPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYklucHV0Lm1lZGlhX3R5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxkaXYgY2xhc3M9XCJpbnB1dC1tZWRpYS10eXBlc1wiPicgKyBqb2JJbnB1dC5tZWRpYV90eXBlcy5qb2luKCcsJykgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPC9saT4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L3VsPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbmFtZS5wb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdib2R5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50U3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTZWxlY3QgcmVjZWl2ZXIvaW5wdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgc2VsZWN0ZWQgam9iXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iID0gam9iO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVKb2IgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZS5qb2JzLCB7IGpvYl9uYW1lOiBqb2IubmFtZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBhcHBseSB0aGUgc2VsZWN0ZWQtbm9kZSBjbGFzc1xuICAgICAgICAgICAgICAgICAgICAvLyRuYW1lLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdldENsb3Nlc3ROb2RlKG5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHsgLy8gY2xpY2sgc2VsZWN0ZWQgbm9kZVxuICAgICAgICAgICAgICAgIC8vJCgnZGl2JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlSm9iID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICAgICAgdm0uZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLXBsdXMnO1xuXG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKG5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEpvYikge1xuICAgICAgICAgICAgICAgIC8vJCgnIycgKyB2bS5zZWxlY3RlZEpvYi5uYW1lKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZScpO1xuICAgICAgICAgICAgICAgIGdldENsb3Nlc3ROb2RlKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdm0udG9nZ2xlRWRpdE1vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCgkc2NvcGUucmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd0b2dnbGVFZGl0Jywgdm0ubW9kZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ub3BlbkFkZEpvYiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhZGRKb2JDb250ZW50Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHModm0uc2VsZWN0ZWRKb2JUeXBlLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hZGRKb2JUeXBlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm9wZW5FZGl0VHJpZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGl0VHJpZ2dlci5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnIHx8IHZtLm1vZGUgPT09ICdhZGQnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzID0gdm0ucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzID8gdm0ucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzLnNwbGl0KCcsJykgOiBbXTtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKGlucHV0TmFtZSkge1xuICAgICAgICAgICAgdmFyIHJlbW92ZWRSZWNpcGVJbnB1dCA9IF8ucmVtb3ZlKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uaW5wdXRfZGF0YSwgZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY2lwZUlucHV0Lm5hbWUgPT09IGlucHV0TmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZWQgJyArIHJlbW92ZWRSZWNpcGVJbnB1dC5sZW5ndGggKyAnIHJlY2lwZSBpbnB1dHMuJyk7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm9wZW5BZGRJbnB1dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhZGRJbnB1dC5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGZpZWxkcyBhbmQgYWRkIGFzIG5lY2Vzc2FyeVxuICAgICAgICAgICAgICAgIGlmICggdm0uc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUuZmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkQXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZS5maWVsZHMsIGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZpZWxkLnZhbHVlLnNwbGl0KCcsJyksIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQXJyLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVJbnB1dFtmaWVsZC5uYW1lXSA9IGZpZWxkQXJyO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5wdXQgdG8gcmVjaXBlIHR5cGUgZGVmaW5pdGlvblxuICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uaW5wdXRfZGF0YS5wdXNoKHZtLnJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2IucmVjaXBlX2lucHV0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYi5yZWNpcGVfaW5wdXRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogdm0ucmVjaXBlSW5wdXQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6IHZtLnJlY2lwZUlucHV0Lm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZ2V0SW9NYXBwaW5ncygpO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgZm9ybSBmaWVsZHNcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVJbnB1dCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUgPSB7fTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNoYW5nZUlucHV0VHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlID0gXy5maW5kKHZtLnJlY2lwZUlucHV0VHlwZXMsIHsnbmFtZSc6IHZtLnJlY2lwZUlucHV0LnR5cGV9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V2FybmluZ3NIdG1sID0gZnVuY3Rpb24gKHdhcm5pbmdzKSB7XG4gICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gJyc7XG4gICAgICAgICAgICBfLmZvckVhY2god2FybmluZ3MsIGZ1bmN0aW9uICh3YXJuaW5nKSB7XG4gICAgICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8Yj4nICsgd2FybmluZy5pZCArICc6PC9iPiAnICsgd2FybmluZy5kZXRhaWxzICsgJzxiciAvPjxiciAvPic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgYnRuLXhzIGNsZWFyXCI+SGlkZTwvYnV0dG9uPic7XG4gICAgICAgICAgICByZXR1cm4gd2FybmluZ3NIdG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZhbGlkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UudmFsaWRhdGVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uICh2YWxpZGF0aW9uUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wic3VjY2Vzc1wiXSgnUmVjaXBlIGlzIHZhbGlkLicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvci5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiZXJyb3JcIl0oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbXCJlcnJvclwiXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgICAgIHZtLnNhdmVSZWNpcGVUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uc2F2aW5nUmVjaXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UudmFsaWRhdGVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uICh2YWxpZGF0aW9uUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2Uuc2F2ZVJlY2lwZVR5cGUoJHNjb3BlLnJlY2lwZVR5cGUpLnRoZW4oZnVuY3Rpb24gKHNhdmVSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKHNhdmVSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZWNpcGVUeXBlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlY2lwZVR5cGUnICsgJHNjb3BlLnJlY2lwZVR5cGUuaWQsIEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZWNpcGVUeXBlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcmVjaXBlcy90eXBlcy8nICsgJHNjb3BlLnJlY2lwZVR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRpc2FibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkSm9iVHlwZSA9IGZ1bmN0aW9uIChzZWxlY3RlZEpvYlR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkSm9iVHlwZS5uYW1lKTtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uYWRkSm9iKHNlbGVjdGVkSm9iVHlwZSk7XG4gICAgICAgICAgICAvLyRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdSZWNpcGVzJyk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dCA9IGZ1bmN0aW9uIChwcm92aWRlck5hbWUsIHByb3ZpZGVyT3V0cHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiBpbnB1dCB0byAnICsgcHJvdmlkZXJOYW1lICsgJy4nICsgcHJvdmlkZXJPdXRwdXQpO1xuICAgICAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogcHJvdmlkZXJOYW1lfSk7XG5cbiAgICAgICAgICAgIGlmIChkZXBlbmRlbmN5ICYmIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbm4gPSBfLmZpbmQoZGVwZW5kZW5jeS5jb25uZWN0aW9ucywgeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIGlmICghY29ubikge1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLnB1c2goeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiBwcm92aWRlck5hbWUsIGNvbm5lY3Rpb25zOiBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dfTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaChkZXBlbmRlbmN5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgPSBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IuZGVwU3RhcnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gbnVsbDtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dFJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiB0byByZWNpcGUgaW5wdXQgJyArIHJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgIHZhciBleGlzdGluZ0lucHV0ID0gXy5maW5kKHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMsIHsgam9iX2lucHV0OiB2bS5zZWxlY3RlZEpvYklucHV0Lm5hbWUgfSk7XG4gICAgICAgICAgICBpZiAoIGV4aXN0aW5nSW5wdXQgJiYgZXhpc3RpbmdJbnB1dC5yZWNpcGVfbmFtZSAhPT0gcmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRcbiAgICAgICAgICAgICAgICBleGlzdGluZ0lucHV0LnJlY2lwZV9pbnB1dCA9IHJlY2lwZUlucHV0O1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoICFleGlzdGluZ0lucHV0ICkge1xuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpdFxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6IHJlY2lwZUlucHV0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iSW5wdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRJbnB1dFByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBPdXRwdXQgPSBmdW5jdGlvbiAocmVjZWl2ZXJOYW1lLCByZWNlaXZlcklucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IF8uZmluZCh2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcGVuZGVuY2llcywge25hbWU6IHZtLnNlbGVjdGVkSm9iLm5hbWV9KTtcblxuICAgICAgICAgICAgaWYgKGRlcGVuZGVuY3kgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucyAmJiBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubiA9IF8uZmluZChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCB7IG91dHB1dDogdm0uc2VsZWN0ZWRKb2JPdXRwdXQubmFtZSwgaW5wdXQ6IHJlY2VpdmVySW5wdXQgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMucHVzaCh7b3V0cHV0OiB2bS5zZWxlY3RlZEpvYk91dHB1dC5uYW1lLCBpbnB1dDogcmVjZWl2ZXJJbnB1dH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lLCBjb25uZWN0aW9uczogW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV19O1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIuZGVwZW5kZW5jaWVzLnB1c2goZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zID0gW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcFN0YXJ0ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JPdXRwdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRPdXRwdXRSZWNlaXZlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkRGVwZW5kZW5jeScpIHtcbiAgICAgICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZERlcGVuZGVuY3kgbW9kZScpO1xuICAgICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJ2FkZERlcGVuZGVuY3knO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1yZW1vdmUnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRJbnB1dCA9IGZ1bmN0aW9uIChqb2JpbnB1dCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkSW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gam9iaW5wdXQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBhZGRJbnB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkSW5wdXQnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRPdXRwdXQgPSBmdW5jdGlvbiAoam9ib3V0cHV0KSB7XG4gICAgICAgICAgICBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGRPdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYk91dHB1dCA9IGpvYm91dHB1dDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZE91dHB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkT3V0cHV0JztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIC8vJCgnLnJlY2lwZU5vZGU6bm90KFwiLnNlbGVjdGVkLW5vZGVcIiknKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVtb3ZlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChkZXBOYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlZERlcHMgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIGZ1bmN0aW9uIChkZXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVwLm5hbWUgPT09IGRlcE5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVkICcgKyByZW1vdmVkRGVwcy5sZW5ndGggKyAnIGRlcGVuZGVuY2llcy4nKTtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlbW92ZUlucHV0TWFwcGluZyA9IGZ1bmN0aW9uIChkZXBOYW1lLCBkZXBPdXRwdXQpIHtcbiAgICAgICAgICAgIGlmICggZGVwTmFtZSA9PT0gJ3JlY2lwZScgKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gc2VsZWN0ZWRKb2IucmVjaXBlX2lucHV0c1xuICAgICAgICAgICAgICAgIHZhciBkZXAgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5yZWNpcGVfaW5wdXRzLCB7IHJlY2lwZV9pbnB1dDogZGVwT3V0cHV0IH0pO1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZCh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIHtuYW1lOiBkZXBOYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKGRlcCAmJiBkZXAuY29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBhbiBpbnB1dCBmcm9tIGFub3RoZXIgam9iXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbm4ub3V0cHV0ID09PSBkZXBPdXRwdXQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIGlucHV0IGNvbm5lY3Rpb25zLicpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVJlY2lwZUpvYiA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICAvLyByZW1vdmUgZGVwZW5kZW50IGNvbm5lY3Rpb25zXG4gICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgXy5yZW1vdmUoam9iLmRlcGVuZGVuY2llcywge25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGpvYiBmcm9tIGRlZmluaXRpb24uam9ic1xuICAgICAgICAgICAgXy5yZW1vdmUoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCB7IG5hbWU6IGpvYk5hbWUgfSk7XG4gICAgICAgICAgICAvLyBlbmFibGUgc2F2ZSBhbmQgcmVkcmF3XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZW1vdmVPdXRwdXRNYXBwaW5nID0gZnVuY3Rpb24gKGpvYk5hbWUsIGRlcE91dHB1dCkge1xuICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byByZW1vdmUgb3V0cHV0IG1hcHBpbmcgZnJvbSB0aGUgam9iIHdoZXJlIHRoZSBkZXBlbmRlbmN5IGlzIGRlZmluZWRcbiAgICAgICAgICAgIHZhciByZWNlaXZlciA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMse25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpdCBmcm9tIHJlY2VpdmVyLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZChyZWNlaXZlci5kZXBlbmRlbmNpZXMsIHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lfSk7XG4gICAgICAgICAgICBpZiAoZGVwICYmIGRlcC5jb25uZWN0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29ubi5vdXRwdXQgPT09IGRlcE91dHB1dDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIG91dHB1dCBjb25uZWN0aW9ucy4nKTtcbiAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgdm0ucmVkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2VsZWN0Sm9iVHlwZVRvQWRkID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IGl0ZW07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3UmVjaXBlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zZWxlY3RlZEpvYi5uYW1lICsgJy0+JyArIGpvYk5hbWUpO1xuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBleGlzdGluZ0RlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogam9iTmFtZX0pO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nRGVwZW5kZW5jeSkgeyB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaCh7bmFtZTogam9iTmFtZX0pOyB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBTdGFydCA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJb01hcHBpbmdzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBjdXJyZW50IGpvYlR5cGVcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgdGhpc0pvYlR5cGUgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzLHtpZDogam9iLmpvYl90eXBlX2lkfSk7XG4gICAgICAgICAgICAgICAgICAgIGpvYi5qb2JfdHlwZSA9IHRoaXNKb2JUeXBlOyovXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZmluZCBkZXBlbmRlbnRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUgJiYgam9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2Uub3V0cHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JPdXRwdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2JPdXRwdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlcHMgPSBnZXREZXBlbmRlbnRzKGpvYi5uYW1lLGpvYk91dHB1dC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iT3V0cHV0LmRlcGVuZGVudHMgPSBkZXBzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGRlcGVuZGVuY3kgbWFwcGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JJbnB1dCwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYklucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dE1hcHBpbmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2IuZGVwZW5kZW5jaWVzLCBmdW5jdGlvbiAoZGVwZW5kZW5jeSxrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubixrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubi5pbnB1dCA9PT0gam9iSW5wdXQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dE1hcHBpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZGVwZW5kZW5jeS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiBjb25uLm91dHB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBjb25uLmlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5yZWNpcGVfaW5wdXRzLCBmdW5jdGlvbiAocmVjaXBlSW5wdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2lwZUlucHV0LmpvYl9pbnB1dCA9PT0gam9iSW5wdXQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0TWFwcGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdyZWNpcGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6IHJlY2lwZUlucHV0LnJlY2lwZV9pbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IHJlY2lwZUlucHV0LmpvYl9pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iSW5wdXQuZGVwZW5kZW5jaWVzID0gaW5wdXRNYXBwaW5ncztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UuZ2V0V29ya3NwYWNlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVXb3Jrc3BhY2VzID0gZGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCdyZWNpcGVUeXBlJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLnJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBuZXcgUmVjaXBlVHlwZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgJHNjb3BlLnJlY2lwZVR5cGUuaWQgPT09ICd1bmRlZmluZWQnIHx8ICRzY29wZS5yZWNpcGVUeXBlLmlkID09PSBudWxsIHx8ICRzY29wZS5yZWNpcGVUeXBlLmlkID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAnYWRkJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodm0ubW9kZSAhPT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgZnVuY3Rpb24gKGpvYiwgaWR4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgham9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZSAmJiAkc2NvcGUucmVjaXBlVHlwZS5qb2JfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlRGF0YSA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5qb2JfdHlwZXMsIHtuYW1lOiBqb2Iuam9iX3R5cGUubmFtZSwgdmVyc2lvbjogam9iLmpvYl90eXBlLnZlcnNpb259KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9ic1tpZHhdLmpvYl90eXBlID0gam9iVHlwZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNldHVwIHN0cmluZyB0byBiaW5kIGNvbW1hIGRlbGltaXRlZCBsaXN0IG9mIHRyaWdnZXIgcnVsZSBjb25maWd1cmF0aW9uIGNvbmRpdGlvbiBkYXRhIHR5cGVzXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUuY29uZmlndXJhdGlvbi5jb25kaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uLmRhdGFfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzID0gJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uLmRhdGFfdHlwZXMuam9pbignLCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluaXRHcmFwaCgpO1xuICAgICAgICAgICAgICAgIGdldElvTWFwcGluZ3MoKTtcbiAgICAgICAgICAgICAgICBkcmF3R3JhcGgoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCRzY29wZS4kcGFyZW50LnZtLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWFkb25seSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0R3JhcGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyAqKioqKipcbiAgICAgICAgICAgIC8vIHNldHVwIEQzIGNvbnRhaW5lciBhbmQgR3JhcGhcbiAgICAgICAgICAgIC8vICoqKioqKlxuICAgICAgICAgICAgLy92bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgICAgICBmdW5jdGlvbiBjbGlja2VkKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gZDMuZXZlbnQ7XG4gICAgICAgICAgICAgICAgdmFyIHggPSBkMy5ldmVudC54O1xuICAgICAgICAgICAgICAgIHZhciB5ID0gZDMuZXZlbnQueTtcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBwYXJzZUludChzdmcuc3R5bGUoXCJ3aWR0aFwiKS5yZXBsYWNlKC9weC8sIFwiXCIpKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gcGFyc2VJbnQoc3ZnLnN0eWxlKFwiaGVpZ2h0XCIpLnJlcGxhY2UoL3B4LywgXCJcIikpO1xuXG4gICAgICAgICAgICAgICAgaW5uZXIuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHdpZHRoIC8gMiArIFwiLFwiICsgaGVpZ2h0IC8gMiArIFwiKXNjYWxlKDIpdHJhbnNsYXRlKFwiICsgLXggKyBcIixcIiArIC15ICsgXCIpXCIpO1xuXG4gICAgICAgICAgICAgICAgLy9pbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDUwcHgsIDUwcHgpc2NhbGUoMiwzKVwiKTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoXCJzdmdcIik7XG4gICAgICAgICAgICBpbm5lciA9IHN2Zy5zZWxlY3QoXCJnXCIpOyAvLy5vbihcImNsaWNrXCIsIGNsaWNrZWQpO1xuICAgICAgICAgICAgLy8gU2V0IHVwIHpvb20gc3VwcG9ydFxuICAgICAgICAgICAgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKS5vbihcInpvb21cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHpvb21TY2FsZSA9IGQzLmV2ZW50LnNjYWxlO1xuICAgICAgICAgICAgICAgIGlubmVyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBkMy5ldmVudC50cmFuc2xhdGUgKyBcIilcIiArXG4gICAgICAgICAgICAgICAgICAgIFwic2NhbGUoXCIgKyB6b29tU2NhbGUgKyBcIilcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHN2Zy5jYWxsKHpvb20pO1xuXG4gICAgICAgICAgICByZW5kZXIgPSBuZXcgZGFncmVEMy5yZW5kZXIoKTtcblxuICAgICAgICAgICAgLy8gTGVmdC10by1yaWdodCBsYXlvdXRcbiAgICAgICAgICAgIGdyYXBoID0gbmV3IGRhZ3JlRDMuZ3JhcGhsaWIuR3JhcGgoKTtcbiAgICAgICAgICAgIGdyYXBoLnNldEdyYXBoKHtcbiAgICAgICAgICAgICAgICBub2Rlc2VwOiA3MCxcbiAgICAgICAgICAgICAgICByYW5rc2VwOiA1MCxcbiAgICAgICAgICAgICAgICByYW5rZGlyOiBcIlRCXCIsXG4gICAgICAgICAgICAgICAgbWFyZ2lueDogMjAsXG4gICAgICAgICAgICAgICAgbWFyZ2lueTogMjBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGRyYXdHcmFwaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGdsb2JhbHMgYmVjYXVzZSBkYWdyZSBuZWVkcyBhIHJlZmVyZW5jZSB0byBhbmd1bGFyIHNjb3BlXG4gICAgICAgICAgICB3aW5kb3cubm9kZUNsaWNrID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXZpZXdlcicpKS5zY29wZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZtLm5vZGVDbGljayhuYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHdpbmRvdy5tYXBJbnB1dCA9IGZ1bmN0aW9uIChqb2JOYW1lLCBqb2JPdXRwdXQpIHtcbiAgICAgICAgICAgICAgICAkKCcjJyArIGpvYk5hbWUpLnBvcG92ZXIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXZpZXdlcicpKS5zY29wZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZtLm1hcElucHV0KGpvYk5hbWUsIGpvYk91dHB1dCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB3aW5kb3cubWFwSW5wdXRSZWNpcGVJbnB1dCA9IGZ1bmN0aW9uIChyZWNpcGVJbnB1dE5hbWUpIHtcbiAgICAgICAgICAgICAgICAkKCcjc3RhcnQnKS5wb3BvdmVyKCdkZXN0cm95Jyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNpcGV2aWV3ZXInKSkuc2NvcGUoKTtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS52bS5tYXBJbnB1dFJlY2lwZUlucHV0KHJlY2lwZUlucHV0TmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB3aW5kb3cubWFwT3V0cHV0ID0gZnVuY3Rpb24gKGpvYk5hbWUsIGpvYklucHV0KSB7XG4gICAgICAgICAgICAgICAgJCgnIycgKyBqb2JOYW1lKS5wb3BvdmVyKCdkZXN0cm95Jyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNpcGV2aWV3ZXInKSkuc2NvcGUoKTtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS52bS5tYXBPdXRwdXQoam9iTmFtZSwgam9iSW5wdXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGUpIHtcbiAgICAgICAgICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJHNjb3BlLnJlY2lwZS5sYXN0X21vZGlmaWVkID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMoJHNjb3BlLnJlY2lwZS5sYXN0X21vZGlmaWVkKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBqb2JzID0gW107XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgICAgIGpvYnMgPSAkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY2hpbGRDb3VudHMgPSBbXTtcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBncmFwaCBvYmplY3RzXG4gICAgICAgICAgICBmb3IgKHZhciBpZHggaW4gam9icykge1xuICAgICAgICAgICAgICAgIHZhciBqb2IgPSBqb2JzW2lkeF07XG5cbiAgICAgICAgICAgICAgICBpZiAoam9iLmRlcGVuZGVuY2llcyA9PT0gdW5kZWZpbmVkIHx8IGpvYi5kZXBlbmRlbmNpZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBqb2IuZGVwU3RhcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gZ2V0UmVjaXBlVHlwZUpvYkNsYXNzTmFtZShqb2IpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz1cInJlY2lwZU5vZGVcIj4nO1xuICAgICAgICAgICAgICAgIC8vdmFyIGh0bWwgPSBcIjxkaXYgb25jbGljaz1cXFwiY29uc29sZS5sb2coJ1wiICsgam9iLmpvYl90eXBlLm5hbWUgKyBcIicpXFxcIj5cIjtcbiAgICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lICE9PSAnbm9zdGF0dXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxzcGFuIGNsYXNzPVwic3RhdHVzXCI+PC9zcGFuPic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vICAgaHRtbCArPSBcIjxzcGFuIGNsYXNzPWNvbnN1bWVycz5cIit3b3JrZXIuY29uc3VtZXJzK1wiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxzcGFuIGNsYXNzPVwibmFtZVwiPic7XG4gICAgICAgICAgICAgICAgaWYgKGpvYi5qb2JfdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGpvYi5qb2JUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBpZD1cIicgKyBqb2IubmFtZSArICdcIiBjbGFzcz1cIlwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnJyArIGpvYi5uYW1lICsgJ1xcJylcIj48c3BhbiBjbGFzcz1cIm5hbWVcIj4nICsgam9iLmpvYl90eXBlLmdldEljb24oKSArICcgJyArIGpvYi5uYW1lICsgJzwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAvL2lmIChqb2JUeXBlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaHRtbCArPSAnPGRpdiBpZD1cIicgKyBqb2IubmFtZSArICdcIiBjbGFzcz1cInJlY2lwZU5vZGVcIiBvbmNsaWNrPVwibm9kZUNsaWNrKFxcJycgKyBqb2IubmFtZSArICdcXCcpXCI+PHNwYW4gY2xhc3M9XCJuYW1lXCI+JyArIGpvYlR5cGUuZ2V0SWNvbigpICsgJyAnICsgam9iVHlwZS50aXRsZSArICc8L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgLy99IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICBodG1sICs9ICc8ZGl2IGlkPVwiJyArIGpvYi5uYW1lICsgJ1wiIGNsYXNzPVwicmVjaXBlTm9kZVwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnJyArIGpvYi5uYW1lICsgJ1xcJylcIj48c3BhbiBjbGFzcz1cIm5hbWVcIj4nICsgam9iVHlwZS5nZXRJY29uKCkgKyAnICcgKyBqb2IubmFtZSArICc8L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgLy99XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgLy8gICBodG1sICs9IFwiPHNwYW4gY2xhc3M9cXVldWU+PHNwYW4gY2xhc3M9Y291bnRlcj5cIit3b3JrZXIuY291bnQrXCI8L3NwYW4+PC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgZ3JhcGguc2V0Tm9kZShqb2IubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGh0bWwsXG4gICAgICAgICAgICAgICAgICAgIHJ4OiA1LFxuICAgICAgICAgICAgICAgICAgICByeTogNSxcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IGNsYXNzTmFtZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIHNldHVwIGVkZ2VzXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZCBpbiBqb2IuZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZXAgPSBqb2IuZGVwZW5kZW5jaWVzW2RdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXAubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGguc2V0RWRnZShkZXAubmFtZSwgam9iLm5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWw6IGRlcC5uYW1lICsgJy0tPicgKyBqb2IubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjBcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRDb3VudHNbZGVwLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRDb3VudHNbZGVwLm5hbWVdICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkQ291bnRzW2RlcC5uYW1lXSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNldCBzdGFydCBub2RlIGFuZCBlZGdlc1xuICAgICAgICAgICAgZ3JhcGguc2V0Tm9kZSgnc3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICc8ZGl2IGlkPVwic3RhcnRcIiBjbGFzcz1cInJlY2lwZU5vZGVcIiBvbmNsaWNrPVwibm9kZUNsaWNrKFxcJ3N0YXJ0XFwnKVwiPjxzcGFuIGNsYXNzPW5hbWU+U3RhcnQ8L3NwYW4+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICByeDogNSxcbiAgICAgICAgICAgICAgICByeTogNSxcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHN0YXJ0Sm9iID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzdGFydCcsXG4gICAgICAgICAgICAgICAgam9iX3R5cGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTdGFydCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6ICRzY29wZS5yZWNpcGVUeXBlLmlucHV0X2RhdGFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgbm9EZXBzID0gXy5maWx0ZXIoam9icywgJ2RlcFN0YXJ0JywgdHJ1ZSk7XG4gICAgICAgICAgICBmb3IgKHZhciBuIGluIG5vRGVwcykge1xuICAgICAgICAgICAgICAgIGdyYXBoLnNldEVkZ2UoJ3N0YXJ0Jywgbm9EZXBzW25dLm5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNldCBlbmQgbm9kZSBhbmQgZWRnZXNcbiAgICAgICAgICAgIGdyYXBoLnNldE5vZGUoJ2VuZCcsIHtcbiAgICAgICAgICAgICAgICBsYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJzxkaXYgY2xhc3M9XCJyZWNpcGVOb2RlXCI+PHNwYW4gY2xhc3M9XCJuYW1lXCI+RW5kPC9zcGFuPjwvZGl2PicsXG4gICAgICAgICAgICAgICAgcng6IDUsXG4gICAgICAgICAgICAgICAgcnk6IDUsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgbm9DaGlsZHJlbiA9Xy5maWx0ZXIoam9icywgZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAhY2hpbGRDb3VudHNbam9iLm5hbWVdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKHZhciBvIGluIG5vQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBncmFwaC5zZXRFZGdlKG5vQ2hpbGRyZW5bb10ubmFtZSwgJ2VuZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHdhaXQgZm9yIGN1cnJlbnQgY2FsbCBzdGFjayB0byBjbGVhclxuICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaW5uZXIuY2FsbChyZW5kZXIsIGdyYXBoKTtcbiAgICAgICAgICAgICAgICB6b29tLmV2ZW50KGQzLnNlbGVjdChcInN2Z1wiKSk7XG5cbiAgICAgICAgICAgICAgICAkKCcubm9kZSByZWN0JykuYXR0cignY2xhc3MnLCAnbm9kZVJlY3QnKTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCBzZWxlY3RlZCBjbGFzcyB0byBhcHByb3ByaWF0ZSBub2RlXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkSm9iKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vJCgnIycgKyB2bS5zZWxlY3RlZEpvYi5uYW1lKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZScpO1xuICAgICAgICAgICAgICAgICAgICBnZXRDbG9zZXN0Tm9kZSh2bS5zZWxlY3RlZEpvYi5uYW1lKS5jbGFzc2VkKCdzZWxlY3RlZC1ub2RlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldERlcGVuZGVudHMgPSBmdW5jdGlvbiAobmFtZSxvdXRwdXROYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuXG4gICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iLCBrZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAoam9iLm5hbWUgIT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5kZXBlbmRlbmNpZXMsIGZ1bmN0aW9uIChkZXBlbmRlbmN5LCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXBlbmRlbmN5Lm5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGVwZW5kZW5jeS5jb25uZWN0aW9ucywgZnVuY3Rpb24gKGNvbm4sIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubi5vdXRwdXQgPT09IG91dHB1dE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogam9iLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiBjb25uLm91dHB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogY29ubi5pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc1NjYWxlUmVjaXBlR3JhcGhWaWV3ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLXNjYWxlLXJlY2lwZS12aWV3ZXIgcmVjaXBlPVwicmVjaXBlXCIgLz5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzU2NhbGVSZWNpcGVHcmFwaFZpZXdlckNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3JlY2lwZXMvcGFydGlhbHMvcmVjaXBlR3JhcGhWaWV3ZXJUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHJlY2lwZVR5cGU6ICc9JyxcbiAgICAgICAgICAgICAgICByZWNpcGU6ICc9JyxcbiAgICAgICAgICAgICAgICBpc01vZGlmaWVkOiAnPW1vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICBhbGxvd0VkaXQ6ICc9JyxcbiAgICAgICAgICAgICAgICBoYXNDb250YWluZXI6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFJlY2lwZVR5cGUsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgUmVjaXBlID0gZnVuY3Rpb24gKGlkLCBjcmVhdGVkLCBjb21wbGV0ZWQsIGxhc3RfbW9kaWZpZWQsIHJlY2lwZV90eXBlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZF9mb3JtYXR0ZWQgPSBjb21wbGV0ZWQgPyBtb21lbnQudXRjKGNvbXBsZXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpIDogJyc7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5sYXN0X3N0YXR1c19jaGFuZ2UgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkuZGlmZihtb21lbnQudXRjKCkpKS5odW1hbml6ZSh0cnVlKSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZSA9IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIocmVjaXBlX3R5cGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFJlY2lwZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5jcmVhdGVkLCB0aGlzLmxhc3RfbW9kaWZpZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJlY2lwZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVEYXRhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgUmVjaXBlRGF0YSA9IGZ1bmN0aW9uIChpbnB1dF9kYXRhLCB2ZXJzaW9uLCB3b3Jrc3BhY2VfaWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRfZGF0YSA9IGlucHV0X2RhdGE7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2VfaWQgPSB3b3Jrc3BhY2VfaWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZURhdGEuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW5wdXRfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZV9pZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURhdGEoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVEYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJlY2lwZURhdGEuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlRGF0YS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlRGF0YTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVEZXRhaWxzJywgZnVuY3Rpb24gKFJlY2lwZURhdGEsIFJlY2lwZVR5cGVEZWZpbml0aW9uLCBSZWNpcGVUeXBlLCBSZWNpcGVUeXBlRGV0YWlsLCBSZWNpcGVKb2JDb250YWluZXIsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBSZWNpcGVEZXRhaWxzID0gZnVuY3Rpb24gKGlkLCBjcmVhdGVkLCBjb21wbGV0ZWQsIGxhc3RfbW9kaWZpZWQsIGRhdGEsIHJlY2lwZV90eXBlLCByZWNpcGVfdHlwZV9yZXYsIGpvYnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3N1cGVyc2VkZWQsIHJvb3Rfc3VwZXJzZWRlZF9yZWNpcGUsIHN1cGVyc2VkZWRfcmVjaXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBlcnNlZGVkX2J5X3JlY2lwZSwgc3VwZXJzZWRlZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkID0gY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRfZm9ybWF0dGVkID0gdGhpcy5jb21wbGV0ZWQgPyBtb21lbnQudXRjKHRoaXMuY29tcGxldGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpIDogdGhpcy5jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gUmVjaXBlRGF0YS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX3R5cGUgPSBSZWNpcGVUeXBlLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlKTtcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX3R5cGVfcmV2ID0gUmVjaXBlVHlwZURldGFpbC50cmFuc2Zvcm1lcihyZWNpcGVfdHlwZV9yZXYpO1xuICAgICAgICAgICAgdGhpcy5qb2JzID0gUmVjaXBlSm9iQ29udGFpbmVyLnRyYW5zZm9ybWVyKGpvYnMpO1xuICAgICAgICAgICAgdGhpcy5pc19zdXBlcnNlZGVkID0gaXNfc3VwZXJzZWRlZDtcbiAgICAgICAgICAgIHRoaXMucm9vdF9zdXBlcnNlZGVkX3JlY2lwZSA9IHJvb3Rfc3VwZXJzZWRlZF9yZWNpcGU7XG4gICAgICAgICAgICB0aGlzLnN1cGVyc2VkZWRfcmVjaXBlID0gc3VwZXJzZWRlZF9yZWNpcGU7XG4gICAgICAgICAgICB0aGlzLnN1cGVyc2VkZWRfYnlfcmVjaXBlID0gc3VwZXJzZWRlZF9ieV9yZWNpcGU7XG4gICAgICAgICAgICB0aGlzLnN1cGVyc2VkZWQgPSBzdXBlcnNlZGVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVEZXRhaWxzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEZXRhaWxzKFxuICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgIGRhdGEuY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgZGF0YS5yZWNpcGVfdHlwZSxcbiAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlX3R5cGVfcmV2LFxuICAgICAgICAgICAgICAgICAgZGF0YS5qb2JzLFxuICAgICAgICAgICAgICAgICAgZGF0YS5pc19zdXBlcnNlZGVkLFxuICAgICAgICAgICAgICAgICAgZGF0YS5yb290X3N1cGVyc2VkZWRfcmVjaXBlLFxuICAgICAgICAgICAgICAgICAgZGF0YS5zdXBlcnNlZGVkX3JlY2lwZSxcbiAgICAgICAgICAgICAgICAgIGRhdGEuc3VwZXJzZWRlZF9ieV9yZWNpcGUsXG4gICAgICAgICAgICAgICAgICBkYXRhLnN1cGVyc2VkZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEZXRhaWxzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlRGV0YWlscy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlRGV0YWlscy5idWlsZClcbiAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlRGV0YWlscztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZUpvYicsIGZ1bmN0aW9uIChKb2JUeXBlKSB7XG4gICAgICAgIHZhciBSZWNpcGVKb2IgPSBmdW5jdGlvbiAoaWQsIHN0YXR1cywgam9iX3R5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVKb2IuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVKb2IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVKb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlSm9iLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZUpvYi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlSm9iO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZUpvYkNvbnRhaW5lcicsIGZ1bmN0aW9uIChSZWNpcGVKb2IpIHtcbiAgICAgICAgdmFyIFJlY2lwZUpvYkNvbnRhaW5lciA9IGZ1bmN0aW9uIChqb2JfbmFtZSwgam9iKSB7XG4gICAgICAgICAgICB0aGlzLmpvYl9uYW1lID0gam9iX25hbWU7XG4gICAgICAgICAgICB0aGlzLmpvYiA9IFJlY2lwZUpvYi50cmFuc2Zvcm1lcihqb2IpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVKb2JDb250YWluZXIuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYkNvbnRhaW5lcihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVKb2JDb250YWluZXIoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVKb2JDb250YWluZXIudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlSm9iQ29udGFpbmVyLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZUpvYkNvbnRhaW5lci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlSm9iQ29udGFpbmVyO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFJlY2lwZVR5cGVEZWZpbml0aW9uKSB7XG4gICAgICAgIHZhciBSZWNpcGVUeXBlID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB2ZXJzaW9uLCB0aXRsZSwgZGVzY3JpcHRpb24sIGlzX2FjdGl2ZSwgZGVmaW5pdGlvbiwgcmV2aXNpb25fbnVtLCBjcmVhdGVkLCAgbGFzdF9tb2RpZmllZCwgYXJjaGl2ZWQsIHRyaWdnZXJfcnVsZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5pdGlvbiA9IGRlZmluaXRpb24gPyBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lcihkZWZpbml0aW9uKSA6IG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5yZXZpc2lvbl9udW0gPSByZXZpc2lvbl9udW07XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIGlmICh0cmlnZ2VyX3J1bGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHRyaWdnZXJfcnVsZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICcnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgaXNfYWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFfdHlwZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YV90eXBlczogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlX25hbWU6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0X2RhdGFfbmFtZTogJydcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJldmlzaW9uX251bSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJpZ2dlcl9ydWxlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZVR5cGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChSZWNpcGVUeXBlLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVUeXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZURlZmluaXRpb24nLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLCBKb2JUeXBlSW5wdXREYXRhKSB7XG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAvLyBwcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIFJlY2lwZVR5cGVEZWZpbml0aW9uID0gZnVuY3Rpb24gKGlucHV0X2RhdGEsIHZlcnNpb24sIGpvYnMpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRfZGF0YSA9IGlucHV0X2RhdGEgPyBKb2JUeXBlSW5wdXREYXRhLnRyYW5zZm9ybWVyKGlucHV0X2RhdGEpIDogW107XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uIHx8ICcxLjAnO1xuICAgICAgICAgICAgdGhpcy5qb2JzID0gam9icyA/IFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLnRyYW5zZm9ybWVyKGpvYnMpIDogW107XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYk5hbWUgPSBmdW5jdGlvbihqb2JzLCBqb2JOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGVOYW1lID0gam9iTmFtZTtcbiAgICAgICAgICAgIHZhciBleGlzdGluZyA9IF8uZmluZChqb2JzLCB7ICduYW1lJzogam9iTmFtZSB9KTtcbiAgICAgICAgICAgIHZhciBpZHggPSAyO1xuICAgICAgICAgICAgd2hpbGUoZXhpc3Rpbmcpe1xuICAgICAgICAgICAgICAgIHRoZU5hbWUgPSBqb2JOYW1lICsgJy0nICsgaWR4O1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nID0gXy5maW5kKGpvYnMsIHsgJ25hbWUnOiB0aGVOYW1lIH0pO1xuICAgICAgICAgICAgICAgIGlkeCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoZU5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb24ucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgYWRkSm9iOiBmdW5jdGlvbiAoam9iVHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBqbmFtZSA9IGdldEpvYk5hbWUodGhpcy5qb2JzLCBqb2JUeXBlLm5hbWUpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGpuYW1lKTtcbiAgICAgICAgICAgICAgICB2YXIgam9iID0ge1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXRzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogam5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JUeXBlLmlkLFxuICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZTogam9iVHlwZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5qb2JzLnB1c2goam9iKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb24uYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYoZGF0YSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dF9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9ic1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb24udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZURlZmluaXRpb24uYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGVmaW5pdGlvbjtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iVHlwZURldGFpbHMpIHtcbiAgICAgICAgLy8gcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYiA9IGZ1bmN0aW9uIChyZWNpcGVfaW5wdXRzLCBuYW1lLCBqb2JfdHlwZSwgZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICB0aGlzLnJlY2lwZV9pbnB1dHMgPSByZWNpcGVfaW5wdXRzO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBqb2JfdHlwZTtcbiAgICAgICAgICAgIC8vdGhpcy5qb2JfdHlwZSA9IHtcbiAgICAgICAgICAgIC8vICAgIG5hbWU6IGpvYl90eXBlLm5hbWUsXG4gICAgICAgICAgICAvLyAgICB2ZXJzaW9uOiBqb2JfdHlwZS52ZXJzaW9uXG4gICAgICAgICAgICAvL307XG4gICAgICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcyB8fCBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV9pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXBlbmRlbmNpZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYjtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZURldGFpbCcsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb24sIEpvYlR5cGVEZXRhaWxzKSB7XG4gICAgICAgIHZhciBSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB2ZXJzaW9uLCB0aXRsZSwgZGVzY3JpcHRpb24sIGlzX2FjdGl2ZSwgZGVmaW5pdGlvbiwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCwgYXJjaGl2ZWQsIHRyaWdnZXJfcnVsZSwgam9iX3R5cGVzKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gUmVjaXBlVHlwZURlZmluaXRpb24udHJhbnNmb3JtZXIoZGVmaW5pdGlvbik7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZXMgPSBKb2JUeXBlRGV0YWlscy50cmFuc2Zvcm1lcihqb2JfdHlwZXMpO1xuICAgICAgICAgICAgdGhpcy5tb2RpZmllZCA9IGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlRGV0YWlsLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGV0YWlsKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVmaW5pdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJpZ2dlcl9ydWxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZXRhaWwoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJlY2lwZVR5cGVEZXRhaWwuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZXRhaWwuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZXRhaWw7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlVmFsaWRhdGlvbicsIGZ1bmN0aW9uIChSZWNpcGVUeXBlRGVmaW5pdGlvbikge1xuXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlVmFsaWRhdGlvbkpvYnMgPSBmdW5jdGlvbiAoam9icykge1xuICAgICAgICAgICAgdmFyIGpvYnNPdXQgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChqb2JzLCBmdW5jdGlvbihqb2Ipe1xuICAgICAgICAgICAgICAgam9ic091dC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXRzOiBqb2IucmVjaXBlX2lucHV0cyxcbiAgICAgICAgICAgICAgICAgICBuYW1lOiBqb2IubmFtZSxcbiAgICAgICAgICAgICAgICAgICBqb2JfdHlwZToge1xuICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBqb2Iuam9iX3R5cGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogam9iLmpvYl90eXBlLnZlcnNpb25cbiAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogam9iLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGpvYnNPdXQ7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgUmVjaXBlVHlwZVZhbGlkYXRpb24gPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgZGVmaW5pdGlvbiwgdHJpZ2dlcl9ydWxlKSB7XG4gICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhOiBkZWZpbml0aW9uLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgam9iczogZ2V0UmVjaXBlVHlwZVZhbGlkYXRpb25Kb2JzKGRlZmluaXRpb24uam9icylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHRyaWdnZXJfcnVsZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVWYWxpZGF0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyaWdnZXJfcnVsZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVWYWxpZGF0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZVZhbGlkYXRpb24udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVWYWxpZGF0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlVmFsaWRhdGlvbjtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdyZWNpcGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHRpbWVvdXQsIHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCBSZWNpcGVUeXBlRGV0YWlsLCBSZWNpcGUsIFJlY2lwZURldGFpbHMsIFJlY2lwZVR5cGVWYWxpZGF0aW9uKSB7XG4gICAgICAgIHZhciBnZXRSZWNpcGVzUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBjb21wbGV0ZWQsIHJlY2lwZV90eXBlX2lkLCByZWNpcGVfdHlwZV9uYW1lLCB1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgcmVjaXBlX3R5cGVfaWQ6IHJlY2lwZV90eXBlX2lkLFxuICAgICAgICAgICAgICAgIHJlY2lwZV90eXBlX25hbWU6IHJlY2lwZV90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFJlY2lwZVR5cGVzUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyID8gb3JkZXIgOiBbJ3RpdGxlJywgJ3ZlcnNpb24nXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0UmVjaXBlVHlwZXM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0UmVjaXBlVHlwZXNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVEZXRhaWw6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGdldFJlY2lwZXM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0UmVjaXBlc1BhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlcycpICsgJ3JlY2lwZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJlY2lwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlcycpICsgJ3JlY2lwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnZXRSZWNpcGVEZXRhaWxzJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRldGFpbHMpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gUmVjaXBlRGV0YWlscy50cmFuc2Zvcm1lcihkZXRhaWxzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2F2ZVJlY2lwZVR5cGU6IGZ1bmN0aW9uIChyZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjbGVhblJlY2lwZVR5cGUgPSBSZWNpcGVUeXBlVmFsaWRhdGlvbi50cmFuc2Zvcm1lcihyZWNpcGVUeXBlKTtcblxuICAgICAgICAgICAgICAgIGlmICghY2xlYW5SZWNpcGVUeXBlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvJywgY2xlYW5SZWNpcGVUeXBlKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBhdGNoKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzLycgKyBjbGVhblJlY2lwZVR5cGUuaWQgKyAnLycsIGNsZWFuUmVjaXBlVHlwZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNpcGVUeXBlID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlY2lwZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB2YWxpZGF0ZVJlY2lwZVR5cGU6IGZ1bmN0aW9uIChyZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjbGVhblJlY2lwZVR5cGUgPSBSZWNpcGVUeXBlVmFsaWRhdGlvbi50cmFuc2Zvcm1lcihyZWNpcGVUeXBlKTtcblxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvdmFsaWRhdGlvbi8nLCBjbGVhblJlY2lwZVR5cGUpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiLyoqXG4gKiBAYXV0aG9yIERpbWl0cnkgS3VkcmF5dnRzZXZcbiAqIEB2ZXJzaW9uIDIuMVxuICovXG5cbiB2YXIgdXBkYXRlV2luZG93ID0gZnVuY3Rpb24oKXtcbiAgICAvLyAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGg7XG4gICAgLy8gIHkgPSB3LmlubmVySGVpZ2h0fHwgZS5jbGllbnRIZWlnaHR8fCBnLmNsaWVudEhlaWdodDtcbiAgICAgLy9cbiAgICAvLyAgc3ZnLmF0dHIoXCJ3aWR0aFwiLCB4KS5hdHRyKFwiaGVpZ2h0XCIsIHkpO1xuICAgIGNvbnNvbGUubG9nKCdyZXNpemUnKTtcbiB9O1xuXG4gd2luZG93Lm9ucmVzaXplID0gdXBkYXRlV2luZG93O1xuXG5kMy5nYW50dCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBGSVRfVElNRV9ET01BSU5fTU9ERSA9IFwiZml0XCI7XG4gICAgdmFyIEZJWEVEX1RJTUVfRE9NQUlOX01PREUgPSBcImZpeGVkXCI7XG5cbiAgICB2YXIgbWFyZ2luID0ge1xuXHRcdHRvcCA6IDIwLFxuXHRcdHJpZ2h0IDogMjAsXG5cdFx0Ym90dG9tIDogMjAsXG5cdFx0bGVmdCA6IDYwXG4gICAgfTtcbiAgICB2YXIgdGltZURvbWFpblN0YXJ0ID0gZDMudGltZS5kYXkub2Zmc2V0KG5ldyBEYXRlKCksLTMpO1xuICAgIHZhciB0aW1lRG9tYWluRW5kID0gZDMudGltZS5ob3VyLm9mZnNldChuZXcgRGF0ZSgpLCszKTtcbiAgICB2YXIgdGltZURvbWFpbk1vZGUgPSBGSVRfVElNRV9ET01BSU5fTU9ERTsvLyBmaXhlZCBvciBmaXRcbiAgICB2YXIgdGFza1R5cGVzID0gW107XG4gICAgdmFyIHRhc2tTdGF0dXMgPSBbXTtcbiAgICB2YXIgaGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbS01O1xuICAgIHZhciB3aWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggLSBtYXJnaW4ucmlnaHQgLSBtYXJnaW4ubGVmdC01O1xuXHR2YXIgcmVuZGVyVG8gPSBcImJvZHlcIjtcblx0dmFyIGJlZ2luID0gJyc7XG5cdHZhciBlbmRlZCA9ICcnO1xuXG4gICAgdmFyIHRpY2tGb3JtYXQgPSBcIiVIOiVNOiVTXCI7XG5cbiAgICB2YXIga2V5RnVuY3Rpb24gPSBmdW5jdGlvbihkKSB7XG5cdFx0cmV0dXJuIGRbYmVnaW5dICsgZC50YXNrTmFtZSArIGRbZW5kZWRdO1xuICAgIH07XG5cbiAgICB2YXIgcmVjdFRyYW5zZm9ybSA9IGZ1bmN0aW9uKGQpIHtcblx0XHRyZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyB4KGRbYmVnaW5dKSArIFwiLFwiICsgeShkLnRhc2tOYW1lKSArIFwiKVwiO1xuICAgIH07XG5cbiAgICB2YXIgeCA9IGQzLnRpbWUuc2NhbGUoKS5kb21haW4oWyB0aW1lRG9tYWluU3RhcnQsIHRpbWVEb21haW5FbmQgXSkucmFuZ2UoWyAwLCB3aWR0aCBdKS5jbGFtcCh0cnVlKTtcblxuICAgIHZhciB5ID0gZDMuc2NhbGUub3JkaW5hbCgpLmRvbWFpbih0YXNrVHlwZXMpLnJhbmdlUm91bmRCYW5kcyhbIDAsIGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tIF0sIC4xKTtcblxuICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkub3JpZW50KFwiYm90dG9tXCIpLnRpY2tGb3JtYXQoZDMudGltZS5mb3JtYXQodGlja0Zvcm1hdCkpLnRpY2tTdWJkaXZpZGUodHJ1ZSlcblx0ICAgIC50aWNrU2l6ZSg4KS50aWNrUGFkZGluZyg4KTtcblxuICAgIHZhciB5QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeSkub3JpZW50KFwibGVmdFwiKS50aWNrU2l6ZSgwKTtcblxuICAgIHZhciBpbml0VGltZURvbWFpbiA9IGZ1bmN0aW9uKHRhc2tzKSB7XG5cdGlmICh0aW1lRG9tYWluTW9kZSA9PT0gRklUX1RJTUVfRE9NQUlOX01PREUpIHtcblx0ICAgIGlmICh0YXNrcyA9PT0gdW5kZWZpbmVkIHx8IHRhc2tzLmxlbmd0aCA8IDEpIHtcblx0XHR0aW1lRG9tYWluU3RhcnQgPSBkMy50aW1lLmRheS5vZmZzZXQobmV3IERhdGUoKSwgLTMpO1xuXHRcdHRpbWVEb21haW5FbmQgPSBkMy50aW1lLmhvdXIub2Zmc2V0KG5ldyBEYXRlKCksICszKTtcblx0XHRyZXR1cm47XG5cdCAgICB9XG5cdCAgICB0YXNrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRyZXR1cm4gYVtlbmRlZF0gLSBiW2VuZGVkXTtcblx0ICAgIH0pO1xuXHQgICAgdGltZURvbWFpbkVuZCA9IHRhc2tzW3Rhc2tzLmxlbmd0aCAtIDFdW2VuZGVkXTtcblx0ICAgIHRhc2tzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdHJldHVybiBhW2JlZ2luXSAtIGJbYmVnaW5dO1xuXHQgICAgfSk7XG5cdCAgICB0aW1lRG9tYWluU3RhcnQgPSB0YXNrc1swXVtiZWdpbl07XG5cdH1cbiAgICB9O1xuXG4gICAgdmFyIGluaXRBeGlzID0gZnVuY3Rpb24oKSB7XG5cdHggPSBkMy50aW1lLnNjYWxlKCkuZG9tYWluKFsgdGltZURvbWFpblN0YXJ0LCB0aW1lRG9tYWluRW5kIF0pLnJhbmdlKFsgMCwgd2lkdGggXSkuY2xhbXAodHJ1ZSk7XG5cdHkgPSBkMy5zY2FsZS5vcmRpbmFsKCkuZG9tYWluKHRhc2tUeXBlcykucmFuZ2VSb3VuZEJhbmRzKFsgMCwgaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20gXSwgLjEpO1xuXHR4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkub3JpZW50KFwiYm90dG9tXCIpLnRpY2tzKE1hdGguY2VpbCh3aWR0aC8xNTApKS50aWNrRm9ybWF0KGQzLnRpbWUuZm9ybWF0KHRpY2tGb3JtYXQpKS50aWNrU3ViZGl2aWRlKHRydWUpXG5cdFx0LnRpY2tTaXplKDgpLnRpY2tQYWRkaW5nKDgpO1xuXG5cdHlBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh5KS5vcmllbnQoXCJsZWZ0XCIpLnRpY2tTaXplKDApO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnYW50dCh0YXNrcykge1xuXG5cdGluaXRUaW1lRG9tYWluKHRhc2tzKTtcblx0aW5pdEF4aXMoKTtcblxuXHR2YXIgc3ZnID0gZDMuc2VsZWN0KHJlbmRlclRvKVxuXHQuYXBwZW5kKFwic3ZnXCIpXG5cdC5hdHRyKFwiY2xhc3NcIiwgXCJjaGFydFwiKVxuXHQuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG5cdC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuXHQuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZ2FudHQtY2hhcnRcIilcblx0LmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuXHQuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcblx0LmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdCArIFwiLCBcIiArIG1hcmdpbi50b3AgKyBcIilcIik7XG5cbiAgICAgIHN2Zy5zZWxlY3RBbGwoXCIuY2hhcnRcIilcblx0IC5kYXRhKHRhc2tzLCBrZXlGdW5jdGlvbikuZW50ZXIoKVxuXHQgLmFwcGVuZChcInJlY3RcIilcblx0IC5hdHRyKFwicnhcIiwgNSlcbiAgICAgICAgIC5hdHRyKFwicnlcIiwgNSlcblx0IC5hdHRyKFwiY2xhc3NcIiwgZnVuY3Rpb24oZCl7XG5cdCAgICAgaWYodGFza1N0YXR1c1tkLnN0YXR1c10gPT0gbnVsbCl7IHJldHVybiBcImJhclwiO31cblx0ICAgICByZXR1cm4gdGFza1N0YXR1c1tkLnN0YXR1c107XG5cdCAgICAgfSlcblx0IC5hdHRyKFwieVwiLCAwKVxuXHQgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgcmVjdFRyYW5zZm9ybSlcblx0IC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHkucmFuZ2VCYW5kKCk7IH0pXG5cdCAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uKGQpIHtcblx0ICAgICByZXR1cm4gKHgoZFtlbmRlZF0pIC0geChkW2JlZ2luXSkpO1xuXHQgICAgIH0pO1xuXG5cblx0IHN2Zy5hcHBlbmQoXCJnXCIpXG5cdCAuYXR0cihcImNsYXNzXCIsIFwieCBheGlzXCIpXG5cdCAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLCBcIiArIChoZWlnaHQgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSkgKyBcIilcIilcblx0IC50cmFuc2l0aW9uKClcblx0IC5jYWxsKHhBeGlzKTtcblxuXHQgc3ZnLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIFwieSBheGlzXCIpLnRyYW5zaXRpb24oKS5jYWxsKHlBeGlzKTtcblxuXHQgcmV0dXJuIGdhbnR0O1xuXG4gICAgfTtcblxuICAgIGdhbnR0LnJlZHJhdyA9IGZ1bmN0aW9uKHRhc2tzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZWRyYXcnKTtcblx0aW5pdFRpbWVEb21haW4odGFza3MpO1xuXHRpbml0QXhpcygpO1xuXG4gICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoXCJzdmdcIik7XG5cbiAgICAgICAgdmFyIGdhbnR0Q2hhcnRHcm91cCA9IHN2Zy5zZWxlY3QoXCIuZ2FudHQtY2hhcnRcIik7XG4gICAgICAgIHZhciByZWN0ID0gZ2FudHRDaGFydEdyb3VwLnNlbGVjdEFsbChcInJlY3RcIikuZGF0YSh0YXNrcywga2V5RnVuY3Rpb24pO1xuXG4gICAgICAgIHJlY3QuZW50ZXIoKVxuICAgICAgICAgLmluc2VydChcInJlY3RcIixcIjpmaXJzdC1jaGlsZFwiKVxuICAgICAgICAgLmF0dHIoXCJyeFwiLCA1KVxuICAgICAgICAgLmF0dHIoXCJyeVwiLCA1KVxuXHQgLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbihkKXtcblx0ICAgICBpZih0YXNrU3RhdHVzW2Quc3RhdHVzXSA9PSBudWxsKXsgcmV0dXJuIFwiYmFyXCI7fVxuXHQgICAgIHJldHVybiB0YXNrU3RhdHVzW2Quc3RhdHVzXTtcblx0ICAgICB9KVxuXHQgLnRyYW5zaXRpb24oKVxuXHQgLmF0dHIoXCJ5XCIsIDApXG5cdCAuYXR0cihcInRyYW5zZm9ybVwiLCByZWN0VHJhbnNmb3JtKVxuXHQgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geS5yYW5nZUJhbmQoKTsgfSlcblx0ICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uKGQpIHtcblx0ICAgICByZXR1cm4gKHgoZFtlbmRlZF0pIC0geChkW2JlZ2luXSkpO1xuXHQgICAgIH0pO1xuXG4gICAgICAgIHJlY3QudHJhbnNpdGlvbigpXG4gICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgcmVjdFRyYW5zZm9ybSlcblx0IC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHkucmFuZ2VCYW5kKCk7IH0pXG5cdCAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uKGQpIHtcblx0ICAgICByZXR1cm4gKHgoZFtlbmRlZF0pIC0geChkW2JlZ2luXSkpO1xuXHQgICAgIH0pO1xuXG5cdHJlY3QuZXhpdCgpLnJlbW92ZSgpO1xuXG5cdHN2Zy5zZWxlY3QoXCIueFwiKS50cmFuc2l0aW9uKCkuY2FsbCh4QXhpcyk7XG5cdHN2Zy5zZWxlY3QoXCIueVwiKS50cmFuc2l0aW9uKCkuY2FsbCh5QXhpcyk7XG5cblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC5tYXJnaW4gPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gbWFyZ2luO1xuXHRtYXJnaW4gPSB2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC50aW1lRG9tYWluID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIFsgdGltZURvbWFpblN0YXJ0LCB0aW1lRG9tYWluRW5kIF07XG5cdHRpbWVEb21haW5TdGFydCA9ICt2YWx1ZVswXSwgdGltZURvbWFpbkVuZCA9ICt2YWx1ZVsxXTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ31cbiAgICAgKiAgICAgICAgICAgICAgICB2YWxlIFRoZSB2YWx1ZSBjYW4gYmUgXCJmaXRcIiAtIHRoZSBkb21haW4gZml0cyB0aGUgZGF0YSBvclxuICAgICAqICAgICAgICAgICAgICAgIFwiZml4ZWRcIiAtIGZpeGVkIGRvbWFpbi5cbiAgICAgKi9cbiAgICBnYW50dC50aW1lRG9tYWluTW9kZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0aW1lRG9tYWluTW9kZTtcbiAgICAgICAgdGltZURvbWFpbk1vZGUgPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIGdhbnR0O1xuXG4gICAgfTtcblxuICAgIGdhbnR0LnRhc2tUeXBlcyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0YXNrVHlwZXM7XG5cdHRhc2tUeXBlcyA9IHZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0LnRhc2tTdGF0dXMgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gdGFza1N0YXR1cztcblx0dGFza1N0YXR1cyA9IHZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuXHRnYW50dC5iZWdpbiA9IGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRpZighYXJndW1lbnRzLmxlbmd0aCl7XG5cdFx0XHRyZXR1cm4gYmVnaW47XG5cdFx0fVxuXHRcdGJlZ2luID0gdmFsdWU7XG5cdFx0cmV0dXJuIGdhbnR0O1xuXHR9O1xuXG5cdGdhbnR0LmVuZGVkID0gZnVuY3Rpb24odmFsdWUpe1xuXHRcdGlmKCFhcmd1bWVudHMubGVuZ3RoKXtcblx0XHRcdHJldHVybiBlbmRlZDtcblx0XHR9XG5cdFx0ZW5kZWQgPSB2YWx1ZTtcblx0XHRyZXR1cm4gZ2FudHQ7XG5cdH07XG5cbiAgICBnYW50dC53aWR0aCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB3aWR0aDtcblx0d2lkdGggPSArdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQuaGVpZ2h0ID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIGhlaWdodDtcblx0aGVpZ2h0ID0gK3ZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0LnRpY2tGb3JtYXQgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gdGlja0Zvcm1hdDtcblx0dGlja0Zvcm1hdCA9IHZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuXHRnYW50dC5yZW5kZXJUbyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0aWYoIWFyZ3VtZW50cy5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuIHJlbmRlclRvO1xuXHRcdH1cblx0XHRyZW5kZXJUbyA9IHZhbHVlO1xuXHRcdHJldHVybiBnYW50dDtcblx0fTtcblxuXG5cbiAgICByZXR1cm4gZ2FudHQ7XG59O1xuIiwiZnVuY3Rpb24gR2F1Z2UocGxhY2Vob2xkZXJOYW1lLCBjb25maWd1cmF0aW9uKVxue1xuICAgIHRoaXMucGxhY2Vob2xkZXJOYW1lID0gcGxhY2Vob2xkZXJOYW1lO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzOyAvLyBmb3IgaW50ZXJuYWwgZDMgZnVuY3Rpb25zXG5cbiAgICB0aGlzLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uKGNvbmZpZ3VyYXRpb24pXG4gICAge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ3VyYXRpb247XG5cbiAgICAgICAgdGhpcy5jb25maWcuc2l6ZSA9IHRoaXMuY29uZmlnLnNpemUgKiAwLjk7XG5cbiAgICAgICAgdGhpcy5jb25maWcucmFkdWlzID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTcgLyAyO1xuICAgICAgICB0aGlzLmNvbmZpZy5jeCA9IHRoaXMuY29uZmlnLnNpemUgLyAyO1xuICAgICAgICB0aGlzLmNvbmZpZy5jeSA9IHRoaXMuY29uZmlnLnNpemUgLyAyO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLm1pbiA9IHVuZGVmaW5lZCAhPSBjb25maWd1cmF0aW9uLm1pbiA/IGNvbmZpZ3VyYXRpb24ubWluIDogMDtcbiAgICAgICAgdGhpcy5jb25maWcubWF4ID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWF4ID8gY29uZmlndXJhdGlvbi5tYXggOiAxMDA7XG4gICAgICAgIHRoaXMuY29uZmlnLnJhbmdlID0gdGhpcy5jb25maWcubWF4IC0gdGhpcy5jb25maWcubWluO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLm1ham9yVGlja3MgPSBjb25maWd1cmF0aW9uLm1ham9yVGlja3MgfHwgNTtcbiAgICAgICAgdGhpcy5jb25maWcubWlub3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWlub3JUaWNrcyB8fCAyO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLmdyZWVuQ29sb3IgXHQ9IGNvbmZpZ3VyYXRpb24uZ3JlZW5Db2xvciB8fCBcIiM4ZmNhMGVcIjtcbiAgICAgICAgdGhpcy5jb25maWcueWVsbG93Q29sb3IgPSBjb25maWd1cmF0aW9uLnllbGxvd0NvbG9yIHx8IFwiI2ZmYzMxN1wiO1xuICAgICAgICB0aGlzLmNvbmZpZy5yZWRDb2xvciBcdD0gY29uZmlndXJhdGlvbi5yZWRDb2xvciB8fCBcIiNmNTRkMzZcIjtcblxuICAgICAgICB0aGlzLmNvbmZpZy50cmFuc2l0aW9uRHVyYXRpb24gPSBjb25maWd1cmF0aW9uLnRyYW5zaXRpb25EdXJhdGlvbiB8fCA1MDA7XG4gICAgfTtcblxuICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24oKVxuICAgIHtcbiAgICAgICAgdGhpcy5ib2R5ID0gZDMuc2VsZWN0KFwiI1wiICsgdGhpcy5wbGFjZWhvbGRlck5hbWUpXG4gICAgICAgICAgICAuYXBwZW5kKFwic3ZnOnN2Z1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhdWdlXCIpXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHRoaXMuY29uZmlnLnNpemUpXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCB0aGlzLmNvbmZpZy5zaXplKTtcblxuICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOmNpcmNsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIm91dGVyLWNpcmNsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAuYXR0cihcInJcIiwgdGhpcy5jb25maWcucmFkdWlzICogMC45NSlcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjY2NjXCIpO1xuICAgICAgICAgICAgLyouc3R5bGUoXCJzdHJva2VcIiwgXCIjMDAwXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIwLjVweFwiKTsqL1xuXG4gICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6Y2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgIC5hdHRyKFwiclwiLCAwLjkgKiB0aGlzLmNvbmZpZy5yYWR1aXMpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI2ZmZlwiKVxuICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiI2UwZTBlMFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMnB4XCIpO1xuXG4gICAgICAgIGZvciAodmFyIGdyZWVuSWR4IGluIHRoaXMuY29uZmlnLmdyZWVuWm9uZXMpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcuZ3JlZW5ab25lc1tncmVlbklkeF0uZnJvbSwgdGhpcy5jb25maWcuZ3JlZW5ab25lc1tncmVlbklkeF0udG8sIHNlbGYuY29uZmlnLmdyZWVuQ29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgeWVsbG93SWR4IGluIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLnllbGxvd1pvbmVzW3llbGxvd0lkeF0uZnJvbSwgdGhpcy5jb25maWcueWVsbG93Wm9uZXNbeWVsbG93SWR4XS50bywgc2VsZi5jb25maWcueWVsbG93Q29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgcmVkSWR4IGluIHRoaXMuY29uZmlnLnJlZFpvbmVzKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLnJlZFpvbmVzW3JlZElkeF0uZnJvbSwgdGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS50bywgc2VsZi5jb25maWcucmVkQ29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZvbnRTaXplID0gMDtcblxuICAgICAgICBpZiAodW5kZWZpbmVkICE9IHRoaXMuY29uZmlnLmxhYmVsKVxuICAgICAgICB7XG4gICAgICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDkpO1xuICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2Zzp0ZXh0XCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCB0aGlzLmNvbmZpZy5jeSAvIDIgKyBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgICAgIC50ZXh0KHRoaXMuY29uZmlnLmxhYmVsKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSArIFwicHhcIilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzMzM1wiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjBweFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gMTYpO1xuICAgICAgICB2YXIgbWFqb3JEZWx0YSA9IHRoaXMuY29uZmlnLnJhbmdlIC8gKHRoaXMuY29uZmlnLm1ham9yVGlja3MgLSAxKTtcbiAgICAgICAgZm9yICh2YXIgbWFqb3IgPSB0aGlzLmNvbmZpZy5taW47IG1ham9yIDw9IHRoaXMuY29uZmlnLm1heDsgbWFqb3IgKz0gbWFqb3JEZWx0YSlcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIG1pbm9yRGVsdGEgPSBtYWpvckRlbHRhIC8gdGhpcy5jb25maWcubWlub3JUaWNrcyxcbiAgICAgICAgICAgICAgICBwb2ludDEgPSAwLFxuICAgICAgICAgICAgICAgIHBvaW50MiA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBtaW5vciA9IG1ham9yICsgbWlub3JEZWx0YTsgbWlub3IgPCBNYXRoLm1pbihtYWpvciArIG1ham9yRGVsdGEsIHRoaXMuY29uZmlnLm1heCk7IG1pbm9yICs9IG1pbm9yRGVsdGEpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcG9pbnQxID0gdGhpcy52YWx1ZVRvUG9pbnQobWlub3IsIDAuNzUpO1xuICAgICAgICAgICAgICAgIHBvaW50MiA9IHRoaXMudmFsdWVUb1BvaW50KG1pbm9yLCAwLjg1KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6bGluZVwiKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIHBvaW50MS54KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIHBvaW50MS55KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIHBvaW50Mi54KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIHBvaW50Mi55KVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjNjY2XCIpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjFweFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcG9pbnQxID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuNyk7XG4gICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC44NSk7XG5cbiAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6bGluZVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieDFcIiwgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5MVwiLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIHBvaW50Mi54KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieTJcIiwgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiIzMzM1wiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjJweFwiKTtcblxuICAgICAgICAgICAgaWYgKG1ham9yID09IHRoaXMuY29uZmlnLm1pbiB8fCBtYWpvciA9PSB0aGlzLmNvbmZpZy5tYXgpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuNjMpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2Zzp0ZXh0XCIpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCBwb2ludC54KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgcG9pbnQueSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBmb250U2l6ZSAvIDMpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgbWFqb3IgPT0gdGhpcy5jb25maWcubWluID8gXCJzdGFydFwiIDogXCJlbmRcIilcbiAgICAgICAgICAgICAgICAgICAgLnRleHQobWFqb3IpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSArIFwicHhcIilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiMzMzNcIilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMHB4XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOmdcIikuYXR0cihcImNsYXNzXCIsIFwicG9pbnRlckNvbnRhaW5lclwiKTtcblxuICAgICAgICB2YXIgbWlkVmFsdWUgPSAodGhpcy5jb25maWcubWluICsgdGhpcy5jb25maWcubWF4KSAvIDI7XG5cbiAgICAgICAgdmFyIHBvaW50ZXJQYXRoID0gdGhpcy5idWlsZFBvaW50ZXJQYXRoKG1pZFZhbHVlKTtcblxuICAgICAgICB2YXIgcG9pbnRlckxpbmUgPSBkMy5zdmcubGluZSgpXG4gICAgICAgICAgICAueChmdW5jdGlvbihkKSB7IHJldHVybiBkLnggfSlcbiAgICAgICAgICAgIC55KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueSB9KVxuICAgICAgICAgICAgLmludGVycG9sYXRlKFwiYmFzaXNcIik7XG5cbiAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoXCJwYXRoXCIpXG4gICAgICAgICAgICAuZGF0YShbcG9pbnRlclBhdGhdKVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmc6cGF0aFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIHBvaW50ZXJMaW5lKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiM4ODhcIik7XG5cbiAgICAgICAgcG9pbnRlckNvbnRhaW5lci5hcHBlbmQoXCJzdmc6Y2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgIC5hdHRyKFwiclwiLCAwLjEyICogdGhpcy5jb25maWcucmFkdWlzKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiM4ODhcIik7XG5cbiAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxMCk7XG4gICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKFwidGV4dFwiKVxuICAgICAgICAgICAgLmRhdGEoW21pZFZhbHVlXSlcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKFwic3ZnOnRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCB0aGlzLmNvbmZpZy5zaXplIC0gdGhpcy5jb25maWcuY3kgLyA0IC0gZm9udFNpemUpXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSArIFwicHhcIilcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMDAwXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIwcHhcIik7XG5cbiAgICAgICAgdGhpcy5yZWRyYXcodGhpcy5jb25maWcubWluLCAwKTtcbiAgICB9O1xuXG4gICAgdGhpcy5idWlsZFBvaW50ZXJQYXRoID0gZnVuY3Rpb24odmFsdWUpXG4gICAge1xuICAgICAgICB2YXIgZGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvIDEzO1xuXG4gICAgICAgIHZhciBoZWFkID0gdmFsdWVUb1BvaW50KHZhbHVlLCAwLjg1KTtcbiAgICAgICAgdmFyIGhlYWQxID0gdmFsdWVUb1BvaW50KHZhbHVlIC0gZGVsdGEsIDAuMTIpO1xuICAgICAgICB2YXIgaGVhZDIgPSB2YWx1ZVRvUG9pbnQodmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgdmFyIHRhaWxWYWx1ZSA9IHZhbHVlIC0gKHRoaXMuY29uZmlnLnJhbmdlICogKDEvKDI3MC8zNjApKSAvIDIpO1xuICAgICAgICB2YXIgdGFpbCA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUsIDAuMjgpO1xuICAgICAgICB2YXIgdGFpbDEgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlIC0gZGVsdGEsIDAuMTIpO1xuICAgICAgICB2YXIgdGFpbDIgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlICsgZGVsdGEsIDAuMTIpO1xuXG4gICAgICAgIHJldHVybiBbaGVhZCwgaGVhZDEsIHRhaWwyLCB0YWlsLCB0YWlsMSwgaGVhZDIsIGhlYWRdO1xuXG4gICAgICAgIGZ1bmN0aW9uIHZhbHVlVG9Qb2ludCh2YWx1ZSwgZmFjdG9yKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgcG9pbnQgPSBzZWxmLnZhbHVlVG9Qb2ludCh2YWx1ZSwgZmFjdG9yKTtcbiAgICAgICAgICAgIHBvaW50LnggLT0gc2VsZi5jb25maWcuY3g7XG4gICAgICAgICAgICBwb2ludC55IC09IHNlbGYuY29uZmlnLmN5O1xuICAgICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuZHJhd0JhbmQgPSBmdW5jdGlvbihzdGFydCwgZW5kLCBjb2xvcilcbiAgICB7XG4gICAgICAgIGlmICgwID49IGVuZCAtIHN0YXJ0KSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpwYXRoXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9yKVxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGQzLnN2Zy5hcmMoKVxuICAgICAgICAgICAgICAgIC5zdGFydEFuZ2xlKHRoaXMudmFsdWVUb1JhZGlhbnMoc3RhcnQpKVxuICAgICAgICAgICAgICAgIC5lbmRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKGVuZCkpXG4gICAgICAgICAgICAgICAgLmlubmVyUmFkaXVzKDAuNjUgKiB0aGlzLmNvbmZpZy5yYWR1aXMpXG4gICAgICAgICAgICAgICAgLm91dGVyUmFkaXVzKDAuODUgKiB0aGlzLmNvbmZpZy5yYWR1aXMpKVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oKSB7IHJldHVybiBcInRyYW5zbGF0ZShcIiArIHNlbGYuY29uZmlnLmN4ICsgXCIsIFwiICsgc2VsZi5jb25maWcuY3kgKyBcIikgcm90YXRlKDI3MClcIiB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5yZWRyYXcgPSBmdW5jdGlvbih2YWx1ZSwgdHJhbnNpdGlvbkR1cmF0aW9uKVxuICAgIHtcbiAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuc2VsZWN0KFwiLnBvaW50ZXJDb250YWluZXJcIik7XG5cbiAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoXCJ0ZXh0XCIpLnRleHQoTWF0aC5yb3VuZCh2YWx1ZSkpO1xuXG4gICAgICAgIHZhciBwb2ludGVyID0gcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoXCJwYXRoXCIpO1xuICAgICAgICBwb2ludGVyLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmR1cmF0aW9uKHVuZGVmaW5lZCAhPSB0cmFuc2l0aW9uRHVyYXRpb24gPyB0cmFuc2l0aW9uRHVyYXRpb24gOiB0aGlzLmNvbmZpZy50cmFuc2l0aW9uRHVyYXRpb24pXG4gICAgICAgICAgICAvLy5kZWxheSgwKVxuICAgICAgICAgICAgLy8uZWFzZShcImxpbmVhclwiKVxuICAgICAgICAgICAgLy8uYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKVxuICAgICAgICAgICAgLmF0dHJUd2VlbihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHNlbGYuY29uZmlnLm1heCkgcG9pbnRlclZhbHVlID0gc2VsZi5jb25maWcubWF4ICsgMC4wMipzZWxmLmNvbmZpZy5yYW5nZTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA8IHNlbGYuY29uZmlnLm1pbikgcG9pbnRlclZhbHVlID0gc2VsZi5jb25maWcubWluIC0gMC4wMipzZWxmLmNvbmZpZy5yYW5nZTtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0Um90YXRpb24gPSAoc2VsZi52YWx1ZVRvRGVncmVlcyhwb2ludGVyVmFsdWUpIC0gOTApO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Um90YXRpb24gPSBzZWxmLl9jdXJyZW50Um90YXRpb24gfHwgdGFyZ2V0Um90YXRpb247XG4gICAgICAgICAgICAgICAgc2VsZi5fY3VycmVudFJvdGF0aW9uID0gdGFyZ2V0Um90YXRpb247XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc3RlcClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3RhdGlvbiA9IGN1cnJlbnRSb3RhdGlvbiArICh0YXJnZXRSb3RhdGlvbi1jdXJyZW50Um90YXRpb24pKnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZShcIiArIHNlbGYuY29uZmlnLmN4ICsgXCIsIFwiICsgc2VsZi5jb25maWcuY3kgKyBcIikgcm90YXRlKFwiICsgcm90YXRpb24gKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB2YXIgb3V0ZXJDaXJjbGUgPSB0aGlzLmJvZHkuc2VsZWN0KFwiLm91dGVyLWNpcmNsZVwiKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChpID4gMCAmJiBpIDwgNzUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLmdyZWVuQ29sb3I7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID49IDc1ICYmIGkgPCA5MCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcueWVsbG93Q29sb3I7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLnJlZENvbG9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnZhbHVlVG9EZWdyZWVzID0gZnVuY3Rpb24odmFsdWUpXG4gICAge1xuICAgICAgICAvLyB0aGFua3MgQGNsb3NlYWxlcnRcbiAgICAgICAgLy9yZXR1cm4gdmFsdWUgLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCAtIDQ1O1xuICAgICAgICByZXR1cm4gdmFsdWUgLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCAtICh0aGlzLmNvbmZpZy5taW4gLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCArIDQ1KTtcbiAgICB9O1xuXG4gICAgdGhpcy52YWx1ZVRvUmFkaWFucyA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVUb0RlZ3JlZXModmFsdWUpICogTWF0aC5QSSAvIDE4MDtcbiAgICB9O1xuXG4gICAgdGhpcy52YWx1ZVRvUG9pbnQgPSBmdW5jdGlvbih2YWx1ZSwgZmFjdG9yKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHsgXHR4OiB0aGlzLmNvbmZpZy5jeCAtIHRoaXMuY29uZmlnLnJhZHVpcyAqIGZhY3RvciAqIE1hdGguY29zKHRoaXMudmFsdWVUb1JhZGlhbnModmFsdWUpKSxcbiAgICAgICAgICAgIHk6IHRoaXMuY29uZmlnLmN5IC0gdGhpcy5jb25maWcucmFkdWlzICogZmFjdG9yICogTWF0aC5zaW4odGhpcy52YWx1ZVRvUmFkaWFucyh2YWx1ZSkpIFx0XHR9O1xuICAgIH07XG5cbiAgICAvLyBpbml0aWFsaXphdGlvblxuICAgIHRoaXMuY29uZmlndXJlKGNvbmZpZ3VyYXRpb24pO1xufSIsIi8qISBcbiAqIGFuZ3VsYXItaG90a2V5cyB2MS41LjBcbiAqIGh0dHBzOi8vY2hpZWZmYW5jeXBhbnRzLmdpdGh1Yi5pby9hbmd1bGFyLWhvdGtleXNcbiAqIENvcHlyaWdodCAoYykgMjAxNSBXZXMgQ3J1dmVyXG4gKiBMaWNlbnNlOiBNSVRcbiAqL1xuIWZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7YW5ndWxhci5tb2R1bGUoXCJjZnAuaG90a2V5c1wiLFtdKS5wcm92aWRlcihcImhvdGtleXNcIixbXCIkaW5qZWN0b3JcIixmdW5jdGlvbihhKXt0aGlzLmluY2x1ZGVDaGVhdFNoZWV0PSEwLHRoaXMudXNlTmdSb3V0ZT1hLmhhcyhcIm5nVmlld0RpcmVjdGl2ZVwiKSx0aGlzLnRlbXBsYXRlVGl0bGU9XCJLZXlib2FyZCBTaG9ydGN1dHM6XCIsdGhpcy50ZW1wbGF0ZUhlYWRlcj1udWxsLHRoaXMudGVtcGxhdGVGb290ZXI9bnVsbCx0aGlzLnRlbXBsYXRlPSc8ZGl2IGNsYXNzPVwiY2ZwLWhvdGtleXMtY29udGFpbmVyIGZhZGVcIiBuZy1jbGFzcz1cIntpbjogaGVscFZpc2libGV9XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjxkaXYgY2xhc3M9XCJjZnAtaG90a2V5c1wiPjxoNCBjbGFzcz1cImNmcC1ob3RrZXlzLXRpdGxlXCIgbmctaWY9XCIhaGVhZGVyXCI+e3sgdGl0bGUgfX08L2g0PjxkaXYgbmctYmluZC1odG1sPVwiaGVhZGVyXCIgbmctaWY9XCJoZWFkZXJcIj48L2Rpdj48dGFibGU+PHRib2R5Pjx0ciBuZy1yZXBlYXQ9XCJob3RrZXkgaW4gaG90a2V5cyB8IGZpbHRlcjp7IGRlc2NyaXB0aW9uOiBcXCchJCR1bmRlZmluZWQkJFxcJyB9XCI+PHRkIGNsYXNzPVwiY2ZwLWhvdGtleXMta2V5c1wiPjxzcGFuIG5nLXJlcGVhdD1cImtleSBpbiBob3RrZXkuZm9ybWF0KCkgdHJhY2sgYnkgJGluZGV4XCIgY2xhc3M9XCJjZnAtaG90a2V5cy1rZXlcIj57eyBrZXkgfX08L3NwYW4+PC90ZD48dGQgY2xhc3M9XCJjZnAtaG90a2V5cy10ZXh0XCI+e3sgaG90a2V5LmRlc2NyaXB0aW9uIH19PC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT48ZGl2IG5nLWJpbmQtaHRtbD1cImZvb3RlclwiIG5nLWlmPVwiZm9vdGVyXCI+PC9kaXY+PGRpdiBjbGFzcz1cImNmcC1ob3RrZXlzLWNsb3NlXCIgbmctY2xpY2s9XCJ0b2dnbGVDaGVhdFNoZWV0KClcIj7DlzwvZGl2PjwvZGl2PjwvZGl2PicsdGhpcy5jaGVhdFNoZWV0SG90a2V5PVwiP1wiLHRoaXMuY2hlYXRTaGVldERlc2NyaXB0aW9uPVwiU2hvdyAvIGhpZGUgdGhpcyBoZWxwIG1lbnVcIix0aGlzLiRnZXQ9W1wiJHJvb3RFbGVtZW50XCIsXCIkcm9vdFNjb3BlXCIsXCIkY29tcGlsZVwiLFwiJHdpbmRvd1wiLFwiJGRvY3VtZW50XCIsZnVuY3Rpb24oYSxiLGMsZCxlKXtmdW5jdGlvbiBmKGEpe3ZhciBiPXtjb21tYW5kOlwi4oyYXCIsc2hpZnQ6XCLih6dcIixsZWZ0Olwi4oaQXCIscmlnaHQ6XCLihpJcIix1cDpcIuKGkVwiLGRvd246XCLihpNcIixcInJldHVyblwiOlwi4oapXCIsYmFja3NwYWNlOlwi4oyrXCJ9O2E9YS5zcGxpdChcIitcIik7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspXCJtb2RcIj09PWFbY10mJihkLm5hdmlnYXRvciYmZC5uYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcIk1hY1wiKT49MD9hW2NdPVwiY29tbWFuZFwiOmFbY109XCJjdHJsXCIpLGFbY109YlthW2NdXXx8YVtjXTtyZXR1cm4gYS5qb2luKFwiICsgXCIpfWZ1bmN0aW9uIGcoYSxiLGMsZCxlLGYpe3RoaXMuY29tYm89YSBpbnN0YW5jZW9mIEFycmF5P2E6W2FdLHRoaXMuZGVzY3JpcHRpb249Yix0aGlzLmNhbGxiYWNrPWMsdGhpcy5hY3Rpb249ZCx0aGlzLmFsbG93SW49ZSx0aGlzLnBlcnNpc3RlbnQ9Zix0aGlzLl9mb3JtYXRlZD1udWxsfWZ1bmN0aW9uIGgoKXtmb3IodmFyIGE9by5ob3RrZXlzLmxlbmd0aDthLS07KXt2YXIgYj1vLmhvdGtleXNbYV07YiYmIWIucGVyc2lzdGVudCYmayhiKX19ZnVuY3Rpb24gaSgpe28uaGVscFZpc2libGU9IW8uaGVscFZpc2libGUsby5oZWxwVmlzaWJsZT8odD1sKFwiZXNjXCIpLGsoXCJlc2NcIiksaihcImVzY1wiLHQuZGVzY3JpcHRpb24saSxudWxsLFtcIklOUFVUXCIsXCJTRUxFQ1RcIixcIlRFWFRBUkVBXCJdKSk6KGsoXCJlc2NcIiksdCE9PSExJiZqKHQpKX1mdW5jdGlvbiBqKGEsYixjLGQsZSxmKXt2YXIgaCxpPVtcIklOUFVUXCIsXCJTRUxFQ1RcIixcIlRFWFRBUkVBXCJdLGo9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpO2lmKFwiW29iamVjdCBPYmplY3RdXCI9PT1qJiYoYj1hLmRlc2NyaXB0aW9uLGM9YS5jYWxsYmFjayxkPWEuYWN0aW9uLGY9YS5wZXJzaXN0ZW50LGU9YS5hbGxvd0luLGE9YS5jb21ibyksYiBpbnN0YW5jZW9mIEZ1bmN0aW9uPyhkPWMsYz1iLGI9XCIkJHVuZGVmaW5lZCQkXCIpOmFuZ3VsYXIuaXNVbmRlZmluZWQoYikmJihiPVwiJCR1bmRlZmluZWQkJFwiKSx2b2lkIDA9PT1mJiYoZj0hMCksXCJmdW5jdGlvblwiPT10eXBlb2YgYyl7aD1jLGUgaW5zdGFuY2VvZiBBcnJheXx8KGU9W10pO2Zvcih2YXIgayxsPTA7bDxlLmxlbmd0aDtsKyspZVtsXT1lW2xdLnRvVXBwZXJDYXNlKCksaz1pLmluZGV4T2YoZVtsXSksLTEhPT1rJiZpLnNwbGljZShrLDEpO2M9ZnVuY3Rpb24oYSl7dmFyIGI9ITAsYz1hLnRhcmdldHx8YS5zcmNFbGVtZW50LGQ9Yy5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpO2lmKChcIiBcIitjLmNsYXNzTmFtZStcIiBcIikuaW5kZXhPZihcIiBtb3VzZXRyYXAgXCIpPi0xKWI9ITA7ZWxzZSBmb3IodmFyIGU9MDtlPGkubGVuZ3RoO2UrKylpZihpW2VdPT09ZCl7Yj0hMTticmVha31iJiZuKGguYXBwbHkodGhpcyxhcmd1bWVudHMpKX19XCJzdHJpbmdcIj09dHlwZW9mIGQ/TW91c2V0cmFwLmJpbmQoYSxuKGMpLGQpOk1vdXNldHJhcC5iaW5kKGEsbihjKSk7dmFyIG09bmV3IGcoYSxiLGMsZCxlLGYpO3JldHVybiBvLmhvdGtleXMucHVzaChtKSxtfWZ1bmN0aW9uIGsoYSl7dmFyIGI9YSBpbnN0YW5jZW9mIGc/YS5jb21ibzphO2lmKE1vdXNldHJhcC51bmJpbmQoYiksYW5ndWxhci5pc0FycmF5KGIpKXtmb3IodmFyIGM9ITAsZD1iLmxlbmd0aDtkLS07KWM9ayhiW2RdKSYmYztyZXR1cm4gY312YXIgZT1vLmhvdGtleXMuaW5kZXhPZihsKGIpKTtyZXR1cm4gZT4tMT8oby5ob3RrZXlzW2VdLmNvbWJvLmxlbmd0aD4xP28uaG90a2V5c1tlXS5jb21iby5zcGxpY2Uoby5ob3RrZXlzW2VdLmNvbWJvLmluZGV4T2YoYiksMSk6by5ob3RrZXlzLnNwbGljZShlLDEpLCEwKTohMX1mdW5jdGlvbiBsKGEpe2lmKCFhKXJldHVybiBvLmhvdGtleXM7Zm9yKHZhciBiLGM9MDtjPG8uaG90a2V5cy5sZW5ndGg7YysrKWlmKGI9by5ob3RrZXlzW2NdLGIuY29tYm8uaW5kZXhPZihhKT4tMSlyZXR1cm4gYjtyZXR1cm4hMX1mdW5jdGlvbiBtKGEpe3JldHVybiBhLiRpZCBpbiBwfHwocFthLiRpZF09W10sYS4kb24oXCIkZGVzdHJveVwiLGZ1bmN0aW9uKCl7Zm9yKHZhciBiPXBbYS4kaWRdLmxlbmd0aDtiLS07KWsocFthLiRpZF0ucG9wKCkpfSkpLHthZGQ6ZnVuY3Rpb24oYil7dmFyIGM7cmV0dXJuIGM9YXJndW1lbnRzLmxlbmd0aD4xP2ouYXBwbHkodGhpcyxhcmd1bWVudHMpOmooYikscFthLiRpZF0ucHVzaChjKSx0aGlzfX19ZnVuY3Rpb24gbihhKXtyZXR1cm4gZnVuY3Rpb24oYyxkKXtpZihhIGluc3RhbmNlb2YgQXJyYXkpe3ZhciBlPWFbMF0sZj1hWzFdO2E9ZnVuY3Rpb24oYSl7Zi5zY29wZS4kZXZhbChlKX19Yi4kYXBwbHkoZnVuY3Rpb24oKXthKGMsbChkKSl9KX19TW91c2V0cmFwLnByb3RvdHlwZS5zdG9wQ2FsbGJhY2s9ZnVuY3Rpb24oYSxiKXtyZXR1cm4oXCIgXCIrYi5jbGFzc05hbWUrXCIgXCIpLmluZGV4T2YoXCIgbW91c2V0cmFwIFwiKT4tMT8hMTpiLmNvbnRlbnRFZGl0YWJsZSYmXCJ0cnVlXCI9PWIuY29udGVudEVkaXRhYmxlfSxnLnByb3RvdHlwZS5mb3JtYXQ9ZnVuY3Rpb24oKXtpZihudWxsPT09dGhpcy5fZm9ybWF0ZWQpe2Zvcih2YXIgYT10aGlzLmNvbWJvWzBdLGI9YS5zcGxpdCgvW1xcc10vKSxjPTA7YzxiLmxlbmd0aDtjKyspYltjXT1mKGJbY10pO3RoaXMuX2Zvcm1hdGVkPWJ9cmV0dXJuIHRoaXMuX2Zvcm1hdGVkfTt2YXIgbz1iLiRuZXcoKTtvLmhvdGtleXM9W10sby5oZWxwVmlzaWJsZT0hMSxvLnRpdGxlPXRoaXMudGVtcGxhdGVUaXRsZSxvLmhlYWRlcj10aGlzLnRlbXBsYXRlSGVhZGVyLG8uZm9vdGVyPXRoaXMudGVtcGxhdGVGb290ZXIsby50b2dnbGVDaGVhdFNoZWV0PWk7dmFyIHA9W107aWYodGhpcy51c2VOZ1JvdXRlJiZiLiRvbihcIiRyb3V0ZUNoYW5nZVN1Y2Nlc3NcIixmdW5jdGlvbihhLGIpe2goKSxiJiZiLmhvdGtleXMmJmFuZ3VsYXIuZm9yRWFjaChiLmhvdGtleXMsZnVuY3Rpb24oYSl7dmFyIGM9YVsyXTsoXCJzdHJpbmdcIj09dHlwZW9mIGN8fGMgaW5zdGFuY2VvZiBTdHJpbmcpJiYoYVsyXT1bYyxiXSksYVs1XT0hMSxqLmFwcGx5KHRoaXMsYSl9KX0pLHRoaXMuaW5jbHVkZUNoZWF0U2hlZXQpe3ZhciBxPWVbMF0scj1hWzBdLHM9YW5ndWxhci5lbGVtZW50KHRoaXMudGVtcGxhdGUpO2oodGhpcy5jaGVhdFNoZWV0SG90a2V5LHRoaXMuY2hlYXRTaGVldERlc2NyaXB0aW9uLGkpLChyPT09cXx8cj09PXEuZG9jdW1lbnRFbGVtZW50KSYmKHI9cS5ib2R5KSxhbmd1bGFyLmVsZW1lbnQocikuYXBwZW5kKGMocykobykpfXZhciB0PSExLHU9e2FkZDpqLGRlbDprLGdldDpsLGJpbmRUbzptLHRlbXBsYXRlOnRoaXMudGVtcGxhdGUsdG9nZ2xlQ2hlYXRTaGVldDppLGluY2x1ZGVDaGVhdFNoZWV0OnRoaXMuaW5jbHVkZUNoZWF0U2hlZXQsY2hlYXRTaGVldEhvdGtleTp0aGlzLmNoZWF0U2hlZXRIb3RrZXksY2hlYXRTaGVldERlc2NyaXB0aW9uOnRoaXMuY2hlYXRTaGVldERlc2NyaXB0aW9uLHVzZU5nUm91dGU6dGhpcy51c2VOZ1JvdXRlLHB1cmdlSG90a2V5czpoLHRlbXBsYXRlVGl0bGU6dGhpcy50ZW1wbGF0ZVRpdGxlfTtyZXR1cm4gdX1dfV0pLmRpcmVjdGl2ZShcImhvdGtleVwiLFtcImhvdGtleXNcIixmdW5jdGlvbihhKXtyZXR1cm57cmVzdHJpY3Q6XCJBXCIsbGluazpmdW5jdGlvbihiLGMsZCl7dmFyIGUsZjthbmd1bGFyLmZvckVhY2goYi4kZXZhbChkLmhvdGtleSksZnVuY3Rpb24oYixjKXtmPVwic3RyaW5nXCI9PXR5cGVvZiBkLmhvdGtleUFsbG93SW4/ZC5ob3RrZXlBbGxvd0luLnNwbGl0KC9bXFxzLF0rLyk6W10sZT1jLGEuYWRkKHtjb21ibzpjLGRlc2NyaXB0aW9uOmQuaG90a2V5RGVzY3JpcHRpb24sY2FsbGJhY2s6YixhY3Rpb246ZC5ob3RrZXlBY3Rpb24sYWxsb3dJbjpmfSl9KSxjLmJpbmQoXCIkZGVzdHJveVwiLGZ1bmN0aW9uKCl7YS5kZWwoZSl9KX19fV0pLnJ1bihbXCJob3RrZXlzXCIsZnVuY3Rpb24oYSl7fV0pfSgpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBkKGEsYixjKXtyZXR1cm4gYS5hZGRFdmVudExpc3RlbmVyP3ZvaWQgYS5hZGRFdmVudExpc3RlbmVyKGIsYywhMSk6dm9pZCBhLmF0dGFjaEV2ZW50KFwib25cIitiLGMpfWZ1bmN0aW9uIGUoYSl7aWYoXCJrZXlwcmVzc1wiPT1hLnR5cGUpe3ZhciBiPVN0cmluZy5mcm9tQ2hhckNvZGUoYS53aGljaCk7cmV0dXJuIGEuc2hpZnRLZXl8fChiPWIudG9Mb3dlckNhc2UoKSksYn1yZXR1cm4gclthLndoaWNoXT9yW2Eud2hpY2hdOnNbYS53aGljaF0/c1thLndoaWNoXTpTdHJpbmcuZnJvbUNoYXJDb2RlKGEud2hpY2gpLnRvTG93ZXJDYXNlKCl9ZnVuY3Rpb24gZihhLGIpe3JldHVybiBhLnNvcnQoKS5qb2luKFwiLFwiKT09PWIuc29ydCgpLmpvaW4oXCIsXCIpfWZ1bmN0aW9uIGcoYSl7dmFyIGI9W107cmV0dXJuIGEuc2hpZnRLZXkmJmIucHVzaChcInNoaWZ0XCIpLGEuYWx0S2V5JiZiLnB1c2goXCJhbHRcIiksYS5jdHJsS2V5JiZiLnB1c2goXCJjdHJsXCIpLGEubWV0YUtleSYmYi5wdXNoKFwibWV0YVwiKSxifWZ1bmN0aW9uIGgoYSl7cmV0dXJuIGEucHJldmVudERlZmF1bHQ/dm9pZCBhLnByZXZlbnREZWZhdWx0KCk6dm9pZChhLnJldHVyblZhbHVlPSExKX1mdW5jdGlvbiBpKGEpe3JldHVybiBhLnN0b3BQcm9wYWdhdGlvbj92b2lkIGEuc3RvcFByb3BhZ2F0aW9uKCk6dm9pZChhLmNhbmNlbEJ1YmJsZT0hMCl9ZnVuY3Rpb24gaihhKXtyZXR1cm5cInNoaWZ0XCI9PWF8fFwiY3RybFwiPT1hfHxcImFsdFwiPT1hfHxcIm1ldGFcIj09YX1mdW5jdGlvbiBrKCl7aWYoIXEpe3E9e307Zm9yKHZhciBhIGluIHIpYT45NSYmMTEyPmF8fHIuaGFzT3duUHJvcGVydHkoYSkmJihxW3JbYV1dPWEpfXJldHVybiBxfWZ1bmN0aW9uIGwoYSxiLGMpe3JldHVybiBjfHwoYz1rKClbYV0/XCJrZXlkb3duXCI6XCJrZXlwcmVzc1wiKSxcImtleXByZXNzXCI9PWMmJmIubGVuZ3RoJiYoYz1cImtleWRvd25cIiksY31mdW5jdGlvbiBtKGEpe3JldHVyblwiK1wiPT09YT9bXCIrXCJdOihhPWEucmVwbGFjZSgvXFwrezJ9L2csXCIrcGx1c1wiKSxhLnNwbGl0KFwiK1wiKSl9ZnVuY3Rpb24gbihhLGIpe3ZhciBjLGQsZSxmPVtdO2ZvcihjPW0oYSksZT0wO2U8Yy5sZW5ndGg7KytlKWQ9Y1tlXSx1W2RdJiYoZD11W2RdKSxiJiZcImtleXByZXNzXCIhPWImJnRbZF0mJihkPXRbZF0sZi5wdXNoKFwic2hpZnRcIikpLGooZCkmJmYucHVzaChkKTtyZXR1cm4gYj1sKGQsZixiKSx7a2V5OmQsbW9kaWZpZXJzOmYsYWN0aW9uOmJ9fWZ1bmN0aW9uIG8oYSxjKXtyZXR1cm4gYT09PWI/ITE6YT09PWM/ITA6byhhLnBhcmVudE5vZGUsYyl9ZnVuY3Rpb24gcChhKXtmdW5jdGlvbiBjKGEpe2E9YXx8e307dmFyIGIsYz0hMTtmb3IoYiBpbiB1KWFbYl0/Yz0hMDp1W2JdPTA7Y3x8KHg9ITEpfWZ1bmN0aW9uIGsoYSxiLGMsZCxlLGcpe3ZhciBoLGksaz1bXSxsPWMudHlwZTtpZighcy5fY2FsbGJhY2tzW2FdKXJldHVybltdO2ZvcihcImtleXVwXCI9PWwmJmooYSkmJihiPVthXSksaD0wO2g8cy5fY2FsbGJhY2tzW2FdLmxlbmd0aDsrK2gpaWYoaT1zLl9jYWxsYmFja3NbYV1baF0sKGR8fCFpLnNlcXx8dVtpLnNlcV09PWkubGV2ZWwpJiZsPT1pLmFjdGlvbiYmKFwia2V5cHJlc3NcIj09bCYmIWMubWV0YUtleSYmIWMuY3RybEtleXx8ZihiLGkubW9kaWZpZXJzKSkpe3ZhciBtPSFkJiZpLmNvbWJvPT1lLG49ZCYmaS5zZXE9PWQmJmkubGV2ZWw9PWc7KG18fG4pJiZzLl9jYWxsYmFja3NbYV0uc3BsaWNlKGgsMSksay5wdXNoKGkpfXJldHVybiBrfWZ1bmN0aW9uIGwoYSxiLGMsZCl7cy5zdG9wQ2FsbGJhY2soYixiLnRhcmdldHx8Yi5zcmNFbGVtZW50LGMsZCl8fGEoYixjKT09PSExJiYoaChiKSxpKGIpKX1mdW5jdGlvbiBtKGEpe1wibnVtYmVyXCIhPXR5cGVvZiBhLndoaWNoJiYoYS53aGljaD1hLmtleUNvZGUpO3ZhciBiPWUoYSk7aWYoYilyZXR1cm5cImtleXVwXCI9PWEudHlwZSYmdj09PWI/dm9pZCh2PSExKTp2b2lkIHMuaGFuZGxlS2V5KGIsZyhhKSxhKX1mdW5jdGlvbiBvKCl7Y2xlYXJUaW1lb3V0KHQpLHQ9c2V0VGltZW91dChjLDFlMyl9ZnVuY3Rpb24gcShhLGIsZCxmKXtmdW5jdGlvbiBnKGIpe3JldHVybiBmdW5jdGlvbigpe3g9YiwrK3VbYV0sbygpfX1mdW5jdGlvbiBoKGIpe2woZCxiLGEpLFwia2V5dXBcIiE9PWYmJih2PWUoYikpLHNldFRpbWVvdXQoYywxMCl9dVthXT0wO2Zvcih2YXIgaT0wO2k8Yi5sZW5ndGg7KytpKXt2YXIgaj1pKzE9PT1iLmxlbmd0aCxrPWo/aDpnKGZ8fG4oYltpKzFdKS5hY3Rpb24pO3IoYltpXSxrLGYsYSxpKX19ZnVuY3Rpb24gcihhLGIsYyxkLGUpe3MuX2RpcmVjdE1hcFthK1wiOlwiK2NdPWIsYT1hLnJlcGxhY2UoL1xccysvZyxcIiBcIik7dmFyIGYsZz1hLnNwbGl0KFwiIFwiKTtyZXR1cm4gZy5sZW5ndGg+MT92b2lkIHEoYSxnLGIsYyk6KGY9bihhLGMpLHMuX2NhbGxiYWNrc1tmLmtleV09cy5fY2FsbGJhY2tzW2Yua2V5XXx8W10sayhmLmtleSxmLm1vZGlmaWVycyx7dHlwZTpmLmFjdGlvbn0sZCxhLGUpLHZvaWQgcy5fY2FsbGJhY2tzW2Yua2V5XVtkP1widW5zaGlmdFwiOlwicHVzaFwiXSh7Y2FsbGJhY2s6Yixtb2RpZmllcnM6Zi5tb2RpZmllcnMsYWN0aW9uOmYuYWN0aW9uLHNlcTpkLGxldmVsOmUsY29tYm86YX0pKX12YXIgcz10aGlzO2lmKGE9YXx8YiwhKHMgaW5zdGFuY2VvZiBwKSlyZXR1cm4gbmV3IHAoYSk7cy50YXJnZXQ9YSxzLl9jYWxsYmFja3M9e30scy5fZGlyZWN0TWFwPXt9O3ZhciB0LHU9e30sdj0hMSx3PSExLHg9ITE7cy5faGFuZGxlS2V5PWZ1bmN0aW9uKGEsYixkKXt2YXIgZSxmPWsoYSxiLGQpLGc9e30saD0wLGk9ITE7Zm9yKGU9MDtlPGYubGVuZ3RoOysrZSlmW2VdLnNlcSYmKGg9TWF0aC5tYXgoaCxmW2VdLmxldmVsKSk7Zm9yKGU9MDtlPGYubGVuZ3RoOysrZSlpZihmW2VdLnNlcSl7aWYoZltlXS5sZXZlbCE9aCljb250aW51ZTtpPSEwLGdbZltlXS5zZXFdPTEsbChmW2VdLmNhbGxiYWNrLGQsZltlXS5jb21ibyxmW2VdLnNlcSl9ZWxzZSBpfHxsKGZbZV0uY2FsbGJhY2ssZCxmW2VdLmNvbWJvKTt2YXIgbT1cImtleXByZXNzXCI9PWQudHlwZSYmdztkLnR5cGUhPXh8fGooYSl8fG18fGMoZyksdz1pJiZcImtleWRvd25cIj09ZC50eXBlfSxzLl9iaW5kTXVsdGlwbGU9ZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZD0wO2Q8YS5sZW5ndGg7KytkKXIoYVtkXSxiLGMpfSxkKGEsXCJrZXlwcmVzc1wiLG0pLGQoYSxcImtleWRvd25cIixtKSxkKGEsXCJrZXl1cFwiLG0pfWZvcih2YXIgcSxyPXs4OlwiYmFja3NwYWNlXCIsOTpcInRhYlwiLDEzOlwiZW50ZXJcIiwxNjpcInNoaWZ0XCIsMTc6XCJjdHJsXCIsMTg6XCJhbHRcIiwyMDpcImNhcHNsb2NrXCIsMjc6XCJlc2NcIiwzMjpcInNwYWNlXCIsMzM6XCJwYWdldXBcIiwzNDpcInBhZ2Vkb3duXCIsMzU6XCJlbmRcIiwzNjpcImhvbWVcIiwzNzpcImxlZnRcIiwzODpcInVwXCIsMzk6XCJyaWdodFwiLDQwOlwiZG93blwiLDQ1OlwiaW5zXCIsNDY6XCJkZWxcIiw5MTpcIm1ldGFcIiw5MzpcIm1ldGFcIiwyMjQ6XCJtZXRhXCJ9LHM9ezEwNjpcIipcIiwxMDc6XCIrXCIsMTA5OlwiLVwiLDExMDpcIi5cIiwxMTE6XCIvXCIsMTg2OlwiO1wiLDE4NzpcIj1cIiwxODg6XCIsXCIsMTg5OlwiLVwiLDE5MDpcIi5cIiwxOTE6XCIvXCIsMTkyOlwiYFwiLDIxOTpcIltcIiwyMjA6XCJcXFxcXCIsMjIxOlwiXVwiLDIyMjpcIidcIn0sdD17XCJ+XCI6XCJgXCIsXCIhXCI6XCIxXCIsXCJAXCI6XCIyXCIsXCIjXCI6XCIzXCIsJDpcIjRcIixcIiVcIjpcIjVcIixcIl5cIjpcIjZcIixcIiZcIjpcIjdcIixcIipcIjpcIjhcIixcIihcIjpcIjlcIixcIilcIjpcIjBcIixfOlwiLVwiLFwiK1wiOlwiPVwiLFwiOlwiOlwiO1wiLCdcIic6XCInXCIsXCI8XCI6XCIsXCIsXCI+XCI6XCIuXCIsXCI/XCI6XCIvXCIsXCJ8XCI6XCJcXFxcXCJ9LHU9e29wdGlvbjpcImFsdFwiLGNvbW1hbmQ6XCJtZXRhXCIsXCJyZXR1cm5cIjpcImVudGVyXCIsZXNjYXBlOlwiZXNjXCIscGx1czpcIitcIixtb2Q6L01hY3xpUG9kfGlQaG9uZXxpUGFkLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSk/XCJtZXRhXCI6XCJjdHJsXCJ9LHY9MTsyMD52OysrdilyWzExMSt2XT1cImZcIit2O2Zvcih2PTA7OT49djsrK3Ypclt2Kzk2XT12O3AucHJvdG90eXBlLmJpbmQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXM7cmV0dXJuIGE9YSBpbnN0YW5jZW9mIEFycmF5P2E6W2FdLGQuX2JpbmRNdWx0aXBsZS5jYWxsKGQsYSxiLGMpLGR9LHAucHJvdG90eXBlLnVuYmluZD1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7cmV0dXJuIGMuYmluZC5jYWxsKGMsYSxmdW5jdGlvbigpe30sYil9LHAucHJvdG90eXBlLnRyaWdnZXI9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzO3JldHVybiBjLl9kaXJlY3RNYXBbYStcIjpcIitiXSYmYy5fZGlyZWN0TWFwW2ErXCI6XCIrYl0oe30sYSksY30scC5wcm90b3R5cGUucmVzZXQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3JldHVybiBhLl9jYWxsYmFja3M9e30sYS5fZGlyZWN0TWFwPXt9LGF9LHAucHJvdG90eXBlLnN0b3BDYWxsYmFjaz1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7cmV0dXJuKFwiIFwiK2IuY2xhc3NOYW1lK1wiIFwiKS5pbmRleE9mKFwiIG1vdXNldHJhcCBcIik+LTE/ITE6byhiLGMudGFyZ2V0KT8hMTpcIklOUFVUXCI9PWIudGFnTmFtZXx8XCJTRUxFQ1RcIj09Yi50YWdOYW1lfHxcIlRFWFRBUkVBXCI9PWIudGFnTmFtZXx8Yi5pc0NvbnRlbnRFZGl0YWJsZX0scC5wcm90b3R5cGUuaGFuZGxlS2V5PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztyZXR1cm4gYS5faGFuZGxlS2V5LmFwcGx5KGEsYXJndW1lbnRzKX0scC5pbml0PWZ1bmN0aW9uKCl7dmFyIGE9cChiKTtmb3IodmFyIGMgaW4gYSlcIl9cIiE9PWMuY2hhckF0KDApJiYocFtjXT1mdW5jdGlvbihiKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYVtiXS5hcHBseShhLGFyZ3VtZW50cyl9fShjKSl9LHAuaW5pdCgpLGEuTW91c2V0cmFwPXAsXCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHMmJihtb2R1bGUuZXhwb3J0cz1wKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZShmdW5jdGlvbigpe3JldHVybiBwfSl9KHdpbmRvdyxkb2N1bWVudCk7IiwiaWYgKCFTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzKSB7XG4gICAgU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uKHNlYXJjaCwgc3RhcnQpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICBpZiAodHlwZW9mIHN0YXJ0ICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgc3RhcnQgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0YXJ0ICsgc2VhcmNoLmxlbmd0aCA+IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleE9mKHNlYXJjaCwgc3RhcnQpICE9PSAtMTtcbiAgICAgICAgfVxuICAgIH07XG59IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb25maWcoZnVuY3Rpb24gKCRwcm92aWRlKSB7XG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGh0dHBCYWNrZW5kJywgYW5ndWxhci5tb2NrLmUyZS4kaHR0cEJhY2tlbmREZWNvcmF0b3IpO1xuICAgIH0pLnJ1bihmdW5jdGlvbiAoJGh0dHBCYWNrZW5kLCBzY2FsZUNvbmZpZywgWE1MSHR0cFJlcXVlc3QpIHtcblxuICAgICAgICB2YXIgZ2V0U3luYyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgZmFsc2UpO1xuICAgICAgICAgICAgcmVxdWVzdC5zZW5kKG51bGwpO1xuICAgICAgICAgICAgcmV0dXJuIFtyZXF1ZXN0LnN0YXR1cywgcmVxdWVzdC5yZXNwb25zZSwge31dO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRVcmxQYXJhbXMgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0ge307XG5cbiAgICAgICAgICAgIGlmICh1cmwgJiYgdXJsLnNwbGl0KCc/JykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHVybC5zcGxpdCgnPycpWzFdLnNwbGl0KCcmJykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGl0ZW0uc3BsaXQoJz0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBzWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHNbMV0gJiYgZGVjb2RlVVJJQ29tcG9uZW50KHNbMV0pO1xuICAgICAgICAgICAgICAgICAgICAoayBpbiBvYmopID8gb2JqW2tdLnB1c2godikgOiBvYmpba10gPSBbdl1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBJbmdlc3RzIFN0YXR1c1xuICAgICAgICB2YXIgaW5nZXN0c1N0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2luZ2VzdHMnKSArICdpbmdlc3RzL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChpbmdlc3RzU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHN0cmlrZXMgPSBKU09OLnBhcnNlKGdldFN5bmMoJ3Rlc3QvZGF0YS9pbmdlc3RTdHJpa2VzLmpzb24nKVsxXSksXG4gICAgICAgICAgICAgICAgc3RhcnREYXRlID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3Jykuc3RhcnRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgZW5kRGF0ZSA9IG1vbWVudC51dGMoKS5hZGQoMSwgJ2QnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBudW1Ib3VycyA9IG1vbWVudC51dGMoZW5kRGF0ZSkuZGlmZihtb21lbnQudXRjKHN0YXJ0RGF0ZSksICdoJyksXG4gICAgICAgICAgICAgICAgdGhpc1RpbWUgPSAnJyxcbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSBbXSxcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gW107XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaChzdHJpa2VzLnJlc3VsdHMsIGZ1bmN0aW9uIChzdHJpa2UpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtSG91cnM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzVGltZSA9IG1vbWVudC51dGMoc3RhcnREYXRlKS5hZGQoaSwgJ2gnKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiB0aGlzVGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoNTAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoNTAwMDAwMDAwIC0gNTAwMDAwMCArIDEpKSArIDUwMDAwMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc3RyaWtlOiBzdHJpa2UsXG4gICAgICAgICAgICAgICAgICAgIG1vc3RfcmVjZW50OiBtb21lbnQudXRjKCkuc3RhcnRPZignaCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGZpbGVzOiAyLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAxMjM0NTY3ODksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgY291bnQ6IDIsXG4gICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICBwcmV2aW91czogbnVsbCxcbiAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgZGF0YSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJbmdlc3RzXG4gICAgICAgIHZhciBpbmdlc3RzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2luZ2VzdHMuanNvbic7XG4gICAgICAgIHZhciBpbmdlc3RzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnaW5nZXN0cycpICsgJ2luZ2VzdHMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoaW5nZXN0c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJldHVybk9iaiA9IGdldFN5bmMoaW5nZXN0c092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICBpbmdlc3RzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm9yZGVyICYmIHVybFBhcmFtcy5vcmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLm9yZGVyLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSBvLmNoYXJBdCgwKSA9PT0gJy0nID8gJ2Rlc2MnIDogJ2FzYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IG9yZGVyID09PSAnZGVzYycgPyB1cmxQYXJhbXMub3JkZXJbMF0uc3Vic3RyaW5nKDEpIDogdXJsUGFyYW1zLm9yZGVyWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaW5nZXN0cy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihpbmdlc3RzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5wYWdlICYmIHVybFBhcmFtcy5wYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHBhcnNlSW50KHVybFBhcmFtcy5wYWdlWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemUgPSBwYXJzZUludCh1cmxQYXJhbXMucGFnZV9zaXplWzBdKTtcblxuICAgICAgICAgICAgICAgIGlmIChwYWdlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZ2VzdHMucmVzdWx0cyA9IF8udGFrZShpbmdlc3RzLnJlc3VsdHMsIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRJZHggPSAocGFnZSAtIDEpICogcGFnZVNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZHhBcnJheSA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydElkeDsgaSA8IGluZ2VzdHMucmVzdWx0cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkeEFycmF5LnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpbmdlc3RzLnJlc3VsdHMgPSBfLmF0KGluZ2VzdHMucmVzdWx0cywgaWR4QXJyYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpbmdlc3RzLnJlc3VsdHMgPSBfLmZpbHRlcihpbmdlc3RzLnJlc3VsdHMsIGZ1bmN0aW9uIChpbmdlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZ2VzdC5zdGF0dXMgPT09IHVybFBhcmFtcy5zdGF0dXNbMF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KGluZ2VzdHMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTb3VyY2UgZGV0YWlsc1xuICAgICAgICB2YXIgc291cmNlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zb3VyY2VEZXRhaWxzLmpzb24nO1xuICAgICAgICB2YXIgc291cmNlRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3NvdXJjZXMnKSArICdzb3VyY2VzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHNvdXJjZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIC8vIC8vIGdldCB0aGUgam9iVHlwZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIC8vIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgLy8gdmFyIGZpbGVuYW1lID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgLy8gc291cmNlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zb3VyY2UtZGV0YWlscy8nICsgZmlsZW5hbWUgKyAnLmpzb24nO1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoc291cmNlRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBTb3VyY2VzXG4gICAgICAgIHZhciBzb3VyY2VzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3NvdXJjZXMuanNvbic7XG4gICAgICAgIHZhciBzb3VyY2VzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnc291cmNlcycpICsgJ3NvdXJjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoc291cmNlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy9yZXR1cm4gZ2V0U3luYyhzb3VyY2VzT3ZlcnJpZGVVcmwpO1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJldHVybk9iaiA9IGdldFN5bmMoc291cmNlc092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICBzb3VyY2VzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLmZpbGVfbmFtZSAmJiB1cmxQYXJhbXMuZmlsZV9uYW1lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gWydmaWxlX25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gWydhc2MnXTtcblxuICAgICAgICAgICAgICAgIHNvdXJjZXMucmVzdWx0cyA9IF8uZmlsdGVyKHNvdXJjZXMucmVzdWx0cywgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuZmlsZV9uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModXJsUGFyYW1zLmZpbGVfbmFtZVswXS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNvdXJjZXMucmVzdWx0cyA9IF8uc29ydEJ5T3JkZXIoc291cmNlcy5yZXN1bHRzLCBmaWVsZHMsIG9yZGVycyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KHNvdXJjZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgbG9hZFxuICAgICAgICB2YXIgam9iTG9hZFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2xvYWQnKSArICdsb2FkLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkxvYWRSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbnVtSG91cnMgPSBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS5kaWZmKG1vbWVudC51dGMoKS5zdWJ0cmFjdCg3LCAnZCcpLnN0YXJ0T2YoJ2QnKSwgJ2gnKTtcbiAgICAgICAgICAgIHZhciBzdGFydFRpbWUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoNywgJ2QnKS5zdGFydE9mKCdkJyk7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBjb3VudDogbnVtSG91cnMsXG4gICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICBwcmV2aW91czogbnVsbCxcbiAgICAgICAgICAgICAgICByZXN1bHRzOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IG1vbWVudC51dGMoc3RhcnRUaW1lKS5hZGQoaSwgJ2gnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBwZW5kaW5nX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgcXVldWVkX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgcnVubmluZ19jb3VudDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMCAtIDIwICsgMSkpICsgMjBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIGRhdGEsIHt9XTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIGRldGFpbHNcbiAgICAgICAgdmFyIGpvYkRldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iRGV0YWlscy5qc29uJztcbiAgICAgICAgdmFyIGpvYkRldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIGpvYlR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIGpvYkRldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iLWRldGFpbHMvam9iRGV0YWlscycgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2JzXG4gICAgICAgIHZhciBqb2JzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYnMuanNvbic7XG4gICAgICAgIHZhciBqb2JzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9icycpICsgJ2pvYnMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoam9ic1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJldHVybk9iaiA9IGdldFN5bmMoam9ic092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICBqb2JzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm9yZGVyICYmIHVybFBhcmFtcy5vcmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLm9yZGVyLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSBvLmNoYXJBdCgwKSA9PT0gJy0nID8gJ2Rlc2MnIDogJ2FzYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IG9yZGVyID09PSAnZGVzYycgPyB1cmxQYXJhbXMub3JkZXJbMF0uc3Vic3RyaW5nKDEpIDogdXJsUGFyYW1zLm9yZGVyWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gJ2pvYl90eXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSAnam9iX3R5cGUubmFtZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGpvYnMucmVzdWx0cyA9IF8uc29ydEJ5T3JkZXIoam9icy5yZXN1bHRzLCBmaWVsZHMsIG9yZGVycyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgam9icy5yZXN1bHRzID0gXy5maWx0ZXIoam9icy5yZXN1bHRzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqb2Iuc3RhdHVzID09PSB1cmxQYXJhbXMuc3RhdHVzWzBdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm5PYmpbMV0gPSBKU09OLnN0cmluZ2lmeShqb2JzKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJldHVybk9iajtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIHR5cGUgc3RhdHVzXG4gICAgICAgIHZhciBqb2JUeXBlU3RhdHVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYlR5cGVTdGF0dXMuanNvbic7XG4gICAgICAgIHZhciBqb2JUeXBlU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JUeXBlU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoam9iVHlwZVN0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUnVubmluZyBqb2IgdHlwZXNcbiAgICAgICAgdmFyIHJ1bm5pbmdKb2JzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3J1bm5pbmdKb2JzLmpzb24nO1xuICAgICAgICB2YXIgcnVubmluZ0pvYnNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvcnVubmluZy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChydW5uaW5nSm9ic1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHJ1bm5pbmdKb2JzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgVHlwZSBEZXRhaWxzXG4gICAgICAgIHZhciBqb2JUeXBlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2ItdHlwZXMvam9iVHlwZTEuanNvbic7XG4gICAgICAgIHZhciBqb2JUeXBlRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JUeXBlRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy8gZ2V0IHRoZSBqb2JUeXBlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICBqb2JUeXBlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2ItdHlwZXMvam9iVHlwZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JUeXBlRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIHR5cGVzXG4gICAgICAgIHZhciBqb2JUeXBlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JUeXBlcy5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYlR5cGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhqb2JUeXBlc092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IEpTT04ucGFyc2UocmV0dXJuT2JqWzFdKTtcblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5vcmRlciAmJiB1cmxQYXJhbXMub3JkZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5vcmRlciwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yZGVyID0gby5jaGFyQXQoMCkgPT09ICctJyA/ICdkZXNjJyA6ICdhc2MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBvcmRlciA9PT0gJ2Rlc2MnID8gdXJsUGFyYW1zLm9yZGVyWzBdLnN1YnN0cmluZygxKSA6IHVybFBhcmFtcy5vcmRlclswXTtcblxuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGpvYlR5cGVzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKGpvYlR5cGVzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkoam9iVHlwZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEpvYiBleGVjdXRpb24gbG9nc1xuICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JFeGVjdXRpb25Mb2dDb21iaW5lZC5qc29uJztcbiAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkxvZ1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi1leGVjdXRpb25zJykgKyAnam9iLWV4ZWN1dGlvbnMvLiovbG9ncy9jb21iaW5lZC8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JFeGVjdXRpb25Mb2dSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JFeGVjdXRpb25Mb2dzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgZXhlY3V0aW9uIERldGFpbHNcbiAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkRldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iRXhlY3V0aW9uRGV0YWlscy5qc29uJztcbiAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkRldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkV4ZWN1dGlvbkRldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JFeGVjdXRpb25EZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIE1ldHJpY3MgUGxvdCBEYXRhIERldGFpbFxuICAgICAgICAvL3ZhciBtZXRyaWNzUGxvdERhdGFPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbWV0cmljc0pvYlR5cGVzUGxvdERhdGEuanNvbic7XG4gICAgICAgIHZhciBtZXRyaWNzUGxvdERhdGFSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdtZXRyaWNzJykgKyAnbWV0cmljcy8uKi8uKi8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NQbG90RGF0YVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJhbmRvbSA9IDA7XG5cbiAgICAgICAgICAgIHZhciByZXR1cm5PYmogPSB7XG4gICAgICAgICAgICAgICAgY291bnQ6IDI4LFxuICAgICAgICAgICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgICAgICAgICAgcHJldmlvdXM6IG51bGwsXG4gICAgICAgICAgICAgICAgcmVzdWx0czogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBudW1EYXlzID0gbW9tZW50LnV0Yyh1cmxQYXJhbXMuZW5kZWRbMF0pLmRpZmYobW9tZW50LnV0Yyh1cmxQYXJhbXMuc3RhcnRlZFswXSksICdkJykgKyAxO1xuXG4gICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLmNvbHVtbiwgZnVuY3Rpb24gKG1ldHJpYykge1xuICAgICAgICAgICAgICAgIHZhciBtYXhSYW5kb20gPSBtZXRyaWMgPT09ICd0b3RhbF9jb3VudCcgPyAxMDAwIDogMjAwO1xuICAgICAgICAgICAgICAgIHZhciBtaW5SYW5kb20gPSBtZXRyaWMgPT09ICd0b3RhbF9jb3VudCcgPyA4MDAgOiAxMDtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IHsgdGl0bGU6IF8uc3RhcnRDYXNlKG1ldHJpYykgfSxcbiAgICAgICAgICAgICAgICAgICAgbWluX3g6IG1vbWVudC51dGModXJsUGFyYW1zLnN0YXJ0ZWRbMF0pLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICBtYXhfeDogbW9tZW50LnV0Yyh1cmxQYXJhbXMuZW5kZWRbMF0pLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICBtaW5feTogMSxcbiAgICAgICAgICAgICAgICAgICAgbWF4X3k6IDEwMDAsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogW11cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXlzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5jaG9pY2VfaWQgJiYgdXJsUGFyYW1zLmNob2ljZV9pZC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLmNob2ljZV9pZCwgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDUgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZG9tIDw9IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heFJhbmRvbSAtIG1pblJhbmRvbSArIDEpKSArIG1pblJhbmRvbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG1vbWVudC51dGModXJsUGFyYW1zLnN0YXJ0ZWRbMF0pLmFkZChpLCAnZCcpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1IC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZG9tIDw9IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKHVybFBhcmFtcy5zdGFydGVkWzBdKS5hZGQoaSwgJ2QnKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXhSYW5kb20gLSBtaW5SYW5kb20gKyAxKSkgKyBtaW5SYW5kb21cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm5PYmoucmVzdWx0cy5wdXNoKHJldHVyblJlc3VsdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIHJldHVybk9iaiwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBNZXRyaWNzIERldGFpbFxuICAgICAgICB2YXIgbWV0cmljc0RldGFpbFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ21ldHJpY3MnKSArICdtZXRyaWNzLy4qLycsJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobWV0cmljc0RldGFpbFJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybEFyciA9IHVybC5zcGxpdCgnLycpLFxuICAgICAgICAgICAgICAgIGRldGFpbFR5cGUgPSB1cmxBcnJbdXJsQXJyLmxlbmd0aCAtIDJdO1xuXG4gICAgICAgICAgICBpZiAoZGV0YWlsVHlwZSA9PT0gJ2pvYi10eXBlcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3luYygndGVzdC9kYXRhL21ldHJpY3NKb2JUeXBlcy5qc29uJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRldGFpbFR5cGUgPT09ICdlcnJvci10eXBlcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3luYygndGVzdC9kYXRhL21ldHJpY3NFcnJvclR5cGVzLmpzb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKCd0ZXN0L2RhdGEvbWV0cmljc0luZ2VzdC5qc29uJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE1ldHJpY3NcbiAgICAgICAgdmFyIG1ldHJpY3NPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbWV0cmljcy5qc29uJztcbiAgICAgICAgdmFyIG1ldHJpY3NSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdtZXRyaWNzJykgKyAnbWV0cmljcy8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhtZXRyaWNzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBOb2RlIHN0YXR1c1xuICAgICAgICB2YXIgbm9kZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2RlU3RhdHVzLmpzb24nO1xuICAgICAgICB2YXIgbm9kZVN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ25vZGVzJykgKyAnbm9kZXMvc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG5vZGVTdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhub2RlU3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBOb2RlIGRldGFpbHNcbiAgICAgICAgdmFyIG5vZGVPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbm9kZS5qc29uJztcbiAgICAgICAgdmFyIG5vZGVSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG5vZGVSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhub2RlT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QQVRDSChub2RlUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZU92ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gTm9kZXNcbiAgICAgICAgdmFyIG5vZGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL25vZGVzLmpzb24nO1xuICAgICAgICB2YXIgbm9kZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG5vZGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFF1ZXVlIFN0YXR1cyBzZXJ2aWNlXG4gICAgICAgIHZhciBxdWV1ZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9xdWV1ZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIHF1ZXVlU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncXVldWUnKSArICdxdWV1ZS9zdGF0dXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocXVldWVTdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhxdWV1ZVN0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWNpcGUgRGV0YWlsc1xuICAgICAgICB2YXIgcmVjaXBlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9yZWNpcGVEZXRhaWxzLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3JlY2lwZXMnKSArICdyZWNpcGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgcmVjaXBlRGV0YWlsLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICByZWNpcGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZS1kZXRhaWxzL3JlY2lwZURldGFpbCcgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZWNpcGVEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMocmVjaXBlRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlcyBzZXJ2aWNlXG4gICAgICAgIHZhciByZWNpcGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZXMuanNvbic7XG4gICAgICAgIHZhciByZWNpcGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlcycpICsgJ3JlY2lwZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJldHVybk9iaiA9IGdldFN5bmMocmVjaXBlc092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICByZWNpcGVzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm9yZGVyICYmIHVybFBhcmFtcy5vcmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLm9yZGVyLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSBvLmNoYXJBdCgwKSA9PT0gJy0nID8gJ2Rlc2MnIDogJ2FzYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IG9yZGVyID09PSAnZGVzYycgPyB1cmxQYXJhbXMub3JkZXJbMF0uc3Vic3RyaW5nKDEpIDogdXJsUGFyYW1zLm9yZGVyWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gJ3JlY2lwZV90eXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSAncmVjaXBlX3R5cGUubmFtZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlY2lwZXMucmVzdWx0cyA9IF8uc29ydEJ5T3JkZXIocmVjaXBlcy5yZXN1bHRzLCBmaWVsZHMsIG9yZGVycyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KHJlY2lwZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWNpcGUgdHlwZSB2YWxpZGF0aW9uIHNlcnZpY2VcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVWYWxpZGF0aW9uT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZVR5cGVWYWxpZGF0aW9uU3VjY2Vzcy5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVWYWxpZGF0aW9uUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzL3ZhbGlkYXRpb24vJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHJlY2lwZVR5cGVWYWxpZGF0aW9uUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMocmVjaXBlVHlwZVZhbGlkYXRpb25PdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZSBUeXBlIERldGFpbHNcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZS10eXBlcy9yZWNpcGVUeXBlMS5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVEZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZVR5cGVEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHJlY2lwZVR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIHJlY2lwZVR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZS10eXBlcy9yZWNpcGVUeXBlJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IGdldFN5bmMocmVjaXBlVHlwZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3JlY2lwZVR5cGUnICsgaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnBhcnNlKHJldHVyblZhbHVlKSwge31dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZSBUeXBlcyBzZXJ2aWNlXG4gICAgICAgIHZhciByZWNpcGVUeXBlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9yZWNpcGVUeXBlcy5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZVR5cGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhyZWNpcGVUeXBlc092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICByZWNpcGVUeXBlcyA9IEpTT04ucGFyc2UocmV0dXJuT2JqWzFdKTtcblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5vcmRlciAmJiB1cmxQYXJhbXMub3JkZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5vcmRlciwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yZGVyID0gby5jaGFyQXQoMCkgPT09ICctJyA/ICdkZXNjJyA6ICdhc2MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBvcmRlciA9PT0gJ2Rlc2MnID8gdXJsUGFyYW1zLm9yZGVyWzBdLnN1YnN0cmluZygxKSA6IHVybFBhcmFtcy5vcmRlclswXTtcblxuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlY2lwZVR5cGVzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKHJlY2lwZVR5cGVzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkocmVjaXBlVHlwZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTYXZlIFJlY2lwZSBUeXBlXG4gICAgICAgIHZhciByZWNpcGVUeXBlU2F2ZVJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3JlY2lwZS10eXBlcycpICsgJ3JlY2lwZS10eXBlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QocmVjaXBlVHlwZVNhdmVSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciByZWNpcGVKb2JUeXBlcyA9IFtdLFxuICAgICAgICAgICAgICAgIHJlY2lwZUpvYlR5cGVzRGV0YWlscyA9IFtdLFxuICAgICAgICAgICAgICAgIGpvYlR5cGVEYXRhID0gZ2V0U3luYygndGVzdC9kYXRhL2pvYlR5cGVzLmpzb24nKSxcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IEpTT04ucGFyc2Uoam9iVHlwZURhdGFbMV0pLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgcmVjaXBlVHlwZSA9IEpTT04ucGFyc2UoZGF0YSksXG4gICAgICAgICAgICAgICAgdW5pcXVlUmVjaXBlVHlwZUpvYnMgPSBfLnVuaXEocmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsICdqb2JfdHlwZScpO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHVuaXF1ZVJlY2lwZVR5cGVKb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgcmVjaXBlSm9iVHlwZXMucHVzaChfLmZpbmQoam9iVHlwZXMsIGZ1bmN0aW9uIChqb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqb2JUeXBlLm5hbWUgPT09IGpvYi5qb2JfdHlwZS5uYW1lICYmIGpvYlR5cGUudmVyc2lvbiA9PT0gam9iLmpvYl90eXBlLnZlcnNpb247XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfLmZvckVhY2gocmVjaXBlSm9iVHlwZXMsIGZ1bmN0aW9uIChqb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGp0ID0gZ2V0U3luYygndGVzdC9kYXRhL2pvYi10eXBlcy9qb2JUeXBlJyArIGpvYlR5cGUuaWQgKyAnLmpzb24nKTtcbiAgICAgICAgICAgICAgICByZWNpcGVKb2JUeXBlc0RldGFpbHMucHVzaChKU09OLnBhcnNlKGp0WzFdKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciByZXR1cm5SZWNpcGUgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAwMCAtIDUgKyAxKSkgKyA1LFxuICAgICAgICAgICAgICAgIG5hbWU6IHJlY2lwZVR5cGUubmFtZSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiByZWNpcGVUeXBlLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgdGl0bGU6IHJlY2lwZVR5cGUudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlY2lwZVR5cGUuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgaXNfYWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRlZmluaXRpb246IHJlY2lwZVR5cGUuZGVmaW5pdGlvbixcbiAgICAgICAgICAgICAgICByZXZpc2lvbl9udW06IDEsXG4gICAgICAgICAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGxhc3RfbW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBhcmNoaXZlZDogbnVsbCxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyX3J1bGU6IHJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlczogcmVjaXBlSm9iVHlwZXNEZXRhaWxzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04uc3RyaW5naWZ5KHJldHVyblJlY2lwZSksIHt9XTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3RhdHVzIHNlcnZpY2VcbiAgICAgICAgdmFyIHN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdGF0dXMuanNvbic7XG4gICAgICAgIHZhciBzdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdzdGF0dXMnKSArICdzdGF0dXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoc3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoc3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBWZXJzaW9uXG4gICAgICAgIHZhciB2ZXJzaW9uT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3ZlcnNpb24uanNvbic7XG4gICAgICAgIHZhciB2ZXJzaW9uUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3YzL3ZlcnNpb24vJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQodmVyc2lvblJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHZlcnNpb25PdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdvcmtzcGFjZSBEZXRhaWxzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMvd29ya3NwYWNlMS5qc29uJztcbiAgICAgICAgdmFyIHdvcmtzcGFjZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCd3b3Jrc3BhY2VzJykgKyAnd29ya3NwYWNlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVCh3b3Jrc3BhY2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHdvcmtzcGFjZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgd29ya3NwYWNlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS93b3Jrc3BhY2VzL3dvcmtzcGFjZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBnZXRTeW5jKHdvcmtzcGFjZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3dvcmtzcGFjZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICAvLyBXb3Jrc3BhY2VzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMuanNvbic7XG4gICAgICAgIHZhciB3b3Jrc3BhY2VzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQod29ya3NwYWNlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHdvcmtzcGFjZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNhdmUgV29ya3NwYWNlXG4gICAgICAgIHZhciBnZXRXb3Jrc3BhY2VSZXR1cm4gPSBmdW5jdGlvbiAoZGF0YSwgaWQpIHtcbiAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICAgICAgICB0aXRsZTogd29ya3NwYWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB3b3Jrc3BhY2UuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgYmFzZV91cmw6IHdvcmtzcGFjZS5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICBpc19hY3RpdmU6IHdvcmtzcGFjZS5pc19hY3RpdmUgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgdXNlZF9zaXplOiAwLFxuICAgICAgICAgICAgICAgIHRvdGFsX3NpemU6IDAsXG4gICAgICAgICAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGFyY2hpdmVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGxhc3RfbW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBqc29uX2NvbmZpZzogd29ya3NwYWNlLmpzb25fY29uZmlnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgd29ya3NwYWNlQ3JlYXRlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHdvcmtzcGFjZUNyZWF0ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJldHVybldvcmtzcGFjZSA9IGdldFdvcmtzcGFjZVJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBBVENIKHdvcmtzcGFjZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgd29ya3NwYWNlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuV29ya3NwYWNlID0gZ2V0V29ya3NwYWNlUmV0dXJuKGRhdGEsIGlkKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN0cmlrZSBEZXRhaWxzXG4gICAgICAgIHZhciBzdHJpa2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3N0cmlrZXMvc3RyaWtlMS5qc29uJztcbiAgICAgICAgdmFyIHN0cmlrZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzdHJpa2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHN0cmlrZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgc3RyaWtlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdHJpa2VzL3N0cmlrZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBnZXRTeW5jKHN0cmlrZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3N0cmlrZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3RyaWtlc1xuICAgICAgICB2YXIgc3RyaWtlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdHJpa2VzLmpzb24nO1xuICAgICAgICB2YXIgc3RyaWtlc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdHJpa2VzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHN0cmlrZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhzdHJpa2VzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTYXZlIFN0cmlrZVxuICAgICAgICB2YXIgZ2V0U3RyaWtlUmV0dXJuID0gZnVuY3Rpb24gKGRhdGEsIGlkKSB7XG4gICAgICAgICAgICB2YXIgc3RyaWtlID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpZDogaWQgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgbmFtZTogc3RyaWtlLm5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmlrZS50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RyaWtlLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGpvYjogbnVsbCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbGFzdF9tb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb246IHN0cmlrZS5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc3RyaWtlQ3JlYXRlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3N0cmlrZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHN0cmlrZUNyZWF0ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJldHVyblN0cmlrZSA9IGdldFN0cmlrZVJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5TdHJpa2UpLCB7fV07XG4gICAgICAgIH0pO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBBVENIKHN0cmlrZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgc3RyaWtlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuU3RyaWtlID0gZ2V0U3RyaWtlUmV0dXJuKGRhdGEsIGlkKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5TdHJpa2UpLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvciBldmVyeXRoaW5nIGVsc2UsIGRvbid0IG1vY2tcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgIH0pO1xufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
